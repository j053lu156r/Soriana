sap.ui.define(["jquery.sap.global","sap/ui/core/Fragment","demo/controllers/BaseController","sap/m/UploadCollectionParameter","sap/ui/core/mvc/Controller","sap/m/PDFViewer","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","sap/m/MessageBox","sap/ui/core/routing/Router","demo/models/BaseModel","sap/f/library"],function(e,t,a,r,o,i,s,n){"use strict";var l=new this.Devoluciones;return a.extend("demo.controllers.Devoluciones.Master",{onInit:function(){this.getView().addEventDelegate({onAfterShow:function(e){var t=this.getConfigModel();t.setProperty("/barVisible",true);this.getOwnerComponent().setModel(new s,"tableHeaderDevo");this.clearFilters()}},this)},searchData:function(){if(!this.hasAccess(25)){return false}var e=false;if(!l.getModel()){l.initModel()}var t=sap.ui.core.format.DateFormat.getDateTimeInstance({parent:"yyyyMMdd"});var a=this.getView().byId("budat");var r=this.getView().byId("zfechreg");var o=this.buildSapDate(a.getDateValue());var i=this.buildSapDate(a.getSecondDateValue());var n=this.buildSapDate(r.getDateValue());var d=this.buildSapDate(r.getSecondDateValue());var g=this.getConfigModel().getProperty("/supplierInputKey");var p=this.getView().byId("xblnr").getValue();var u=this.getView().byId("werks").getValue();var f=this.getView().byId("zfolagrup").getValue();var c=this.getView().byId("zfolfedex").getValue();var v=this.getView().byId("zfechreg").getValue();if(g!=null&&g!=""){e=true}else{sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/global.supplierSelectError"))}if(e){if(p==""){if(o==""&&i==""){if(n==""&&d==""){if(u==""){if(f==""){if(c==""){e=false;sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/global.searchFieldsEmpty"))}else{e=true}}else{e=true}}else{e=true}e=true}else{e=true}}else{e=true}}else{e=true}}if(e){var h="/HrdReturnsSet?$expand=ETDTDEVNAV,ETFDEVNAV,ITDFAGR&$filter= IOption eq '2' and ILifnr eq '"+g+"'";if(p!=""){h+=" and IXblnr eq '"+p+"'"}if(o!=""&&i!=""){h+=" and IBudats eq '"+o+"'";h+=" and IBudatf eq '"+i+"'"}if(n!=""&&zfechregEndtDate!=""){h+=" and IRdates eq '"+n+"'";h+=" and IRdatef eq '"+d+"'"}if(u!=""){h+=" and IWerks eq '"+u+"'"}if(f!=""){h+=" and IZfolagrup eq '"+f+"'"}if(c!=""){h+=" and IZfolfedex eq '"+c+"'"}var m=l.getJsonModel(h);if(m!=null){var b=m.getProperty("/results/0");this.getOwnerComponent().setModel(new s(b),"tableHeaderDevo");this.paginate("tableHeaderDevo","/ETFDEVNAV",1,0);console.log(m)}}},onExit:function(){},codeButton:function(){if(!this.hasAccess(35)){return false}var e=this.byId("tableHeader").getSelectedItems();var t=this.getOwnerComponent().getModel("appTxts");if(e.length>0){if(e.length<=20){var a={IOption:"4",ITDFAGR:[]};e.forEach(function(e){var t=e.getBindingContext("tableHeaderDevo").getObject();var r={};r.Ebeln=t.Ebeln;r.Xblnr=t.Xblnr;r.Bktxt=t.Bktxt;r.Bsart=t.Bsart;r.Werks=t.Werks;r.Lifnr=t.Lifnr;a.ITDFAGR.push(r)});var r=l.create("/HrdReturnsSet",a);if(r!=null){if(r.ESuccess=="X"){var o="";this.getOwnerComponent().setModel(new s(r),"tablecode");console.log(r);sap.m.MessageBox.success(t.getProperty("/devo.success"))}else{sap.m.MessageBox.error(r.EMessage)}}}else{sap.m.MessageBox.error(t.getProperty("/devo.MaxLines"))}}else{sap.m.MessageBox.error(t.getProperty("/devo.NoSelections"))}},printButton:function(){if(!this.hasAccess(36)){return false}var e=this.byId("tableHeader").getSelectedItems();console.log(e);var t=this.getOwnerComponent().getModel("appTxts");if(e.length>0){if(e.length==1){var a={};var r="";e.forEach(function(e){var t=e.getBindingContext("tableHeaderDevo").getObject();console.log(t);var a={};a.Ebeln=t.Ebeln;a.Xblnr=t.Xblnr;a.Bktxt=t.Bktxt;a.Bsart=t.Bsart;a.Werks=t.Werks;a.Lifnr=t.Lifnr;a.Zfolagrup=t.Zfolagrup;r="/HrdReturnsSet?$expand=ETDTDEVNAV,ETFDEVNAV,ITDFAGR&$filter= IOption eq '5' and ILifnr eq '"+t.Lifnr+"'";r+=" and IZfolagrup eq '"+t.Zfolagrup+"'";r+=" and ICprint eq 'X'"});console.log(r);var o=l.getJsonModel(r);if(o!=null){var i=o.getProperty("/results/0");console.log(i);if(!this._uploadDialog2){this._uploadDialog2=sap.ui.xmlfragment("printGroupFragment","demo.views.Devoluciones.fragments.GroupCode",this);this.getView().addDependent(this._uploadDialog2)}var n="";if(i.Esprintd.Wname!=""&&i.Esprintd.Nlif!=""&&i.Esprintd.Ref!=""&&i.Esprintd.Zfolagrup!=""){n='<div id="codeGroupDiv" style= "text-align: center; width: 100%;" >'+'<img src ="./images/LogoSoriana.svg" width="350px" />'+'<div style="text-align: center; width: 100%; font-size: large; font-weight: bold; margin: 10pt;" >'+"Formatos de devoluciones y retiros a recolectar"+"</div>"+'<div style= "text-align:left; width: 100%;" >'+`<b>Entrega en:</b> ${i.Esprintd.Wname}`+"</div>"+'<div style= "text-align:left; width: 100%;" >'+`<b>Proveedor:</b> ${i.Esprintd.Nlif}`+"</div>"+'<div style= "text-align:left; width: 100%;" >'+`<b>No. Referencia:</b> ${i.Esprintd.Ref}`+"</div>"+'<div style= "text-align:left; width: 100%;" >'+"<b>Código agrupador:</b>"+i.Esprintd.Zfolagrup+"</div>"+'<svg id="barcode"></svg>'+"<p>"+"Este documento acredita al portador como representante del proveedor para realizar la recolección de mercancia contenida en esta cita."+"Su uso indebido será responsabilidad del proveedor."+"</p>"+"</div>";i.Esprintd.html=n;this.getOwnerComponent().setModel(new s(i),"tableprint");this._uploadDialog2.open();JsBarcode("#barcode",i.Esprintd.Zfolagrup)}}}else{sap.m.MessageBox.error(t.getProperty("/devo.Maxprint"))}}else{sap.m.MessageBox.error(t.getProperty("/devo.NoSelections"))}},onCloseDialogPrint:function(){if(this._uploadDialog2){this._uploadDialog2.close();this._uploadDialog2.destroy();this._uploadDialog2=undefined}},saveCoordinates:function(){var e=document.getElementById("codeGroupDiv");var t={margin:1,filename:"GroupCode.pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:true},jsPDF:{unit:"in",format:"letter",orientation:"portrait"},pagebreak:{mode:["avoid-all","css","legacy"]}};html2pdf().set(t).from(e).save();e.clear()},filtrado:function(e){var t=[];var a=e.getParameter("query");var r=this.getView().byId("selectFilter");var o=r.getSelectedKey();if(a&&a.length>0){var i=new sap.ui.model.Filter(o,sap.ui.model.FilterOperator.Contains,a);t.push(i)}var s=this.getView().byId("complPagoList");var n=s.getBinding("items");n.filter(t)},setDaterangeMaxMin:function(){var e=this.getView().byId("dateRange");var t=new Date;var a=new Date;var r=new Date;r.setDate(t.getDate()-7);a.setDate(t.getDate()-30);e.setSecondDateValue(t);e.setDateValue(r)},onListItemPress:function(e){var t=e.getSource().getBindingContext("tableHeaderDevo").getPath(),a=t.split("/").slice(-1).pop();var r=this.getOwnerComponent().getModel("tableHeaderDevo");var o=r.getProperty("/ETFDEVNAV/Paginated/results");var i=o[a];this.getOwnerComponent().getRouter().navTo("detailDevo",{layout:sap.f.LayoutType.TwoColumnsMidExpanded,xblnr:i.Xblnr,lifnr:i.Lifnr,ebeln:i.Ebeln,suc:i.Werks},true)},buildExportTable:function(){var e=this.getOwnerComponent().getModel("appTxts");var t=[{name:e.getProperty("/devo.folioDevo"),template:{content:"{Xblnr}"}},{name:e.getProperty("/devo.fechaDevo"),template:{content:"{Budat}"}},{name:e.getProperty("/devo.sucursal"),template:{content:"{Werks}"}},{name:e.getProperty("/devo.sucursal"),template:{content:"{Nwerks}"}},{name:e.getProperty("/devo.folioFedex"),template:{content:"{Zfolfedex}"}},{name:e.getProperty("/devo.Code"),template:{content:"{Zfolagrup}"}},{name:e.getProperty("/devo.status"),template:{content:"{Devol}"}}];this.exportxls("tableHeaderDevo","/ETFDEVNAV/results",t)},clearFilters:function(){this.getView().byId("xblnr").setValue("");this.getView().byId("budat").setValue("");this.getView().byId("werks").setValue("");this.getView().byId("zfolagrup").setValue("");this.getView().byId("zfolfedex").setValue("");this.getView().byId("zfechreg").setValue("")}})});