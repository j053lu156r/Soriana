sap.ui.define(["demo/controllers/BaseController","sap/m/MessageBox","sap/m/PDFViewer"],function(e,t,o){"use strict";var r=new this.Acuerdos;return e.extend("demo.controllers.AcuerdosNS.Master",{onInit:function(){this._pdfViewer=new o;this.getView().addDependent(this._pdfViewer);this.getView().addEventDelegate({onAfterShow:function(e){var t=this.getOwnerComponent().getModel();t.setProperty("/barVisible",true);this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel,"AcuerdosHdr");this.clearFilters()}},this);this.configFilterLanguage(this.getView().byId("filterBar"))},searchData:function(){var e=this.getOwnerComponent().getModel("appTxts");var o=true;if(!r.getModel()){r.initModel()}var n=this.getView().byId("sociedadInput").getValue();var a=this.getView().byId("documentoInput").getValue();var s=this.getView().byId("ejercicioInput").getValue();if(a==""||a==null){t.error(e.getProperty("/acuerdosNS.indNo"));o=false}else if(a!=""&&a!=null){if(n==""||n==null){t.error(e.getProperty("/acuerdos.indSoc"));o=false}else if(s==""||s==null){t.error(e.getProperty("/acuerdos.indEje"));o=false}}if(o){var i="AcuerdosNSSet?$filter=";i+="Bukrs eq '"+n+"'";i+=" and Belnr eq '"+a+"'";i+=" and Gjahr eq '"+s+"'";this.getView().byId("tableAcuerdos").setBusy(true);r.getJsonModelAsync(i,function(e,t){var o=e.getProperty("/results");if(o!=null){var r=o.reduce((e,t)=>+e+(+t["Base"]||0),0);var n=o.reduce((e,t)=>+e+(+t["Desct"]||0),0);var a=o.reduce((e,t)=>+e+(+t["Iva"]||0),0);var s=o.reduce((e,t)=>+e+(+t["Impieps"]||0),0);var i={TotBase:Number(r.toFixed(2)),TotDescto:Number(n.toFixed(2)),TotIVA:Number(a.toFixed(2)),TotIEPS:Number(s.toFixed(2))};t.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(i),"acuTotDetModel");t.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(o),"AcuerdosHdr")}t.getView().byId("tableAcuerdos").setBusy(false)},function(e){e.getView().byId("tableAcuerdos").setBusy(false)},this)}},onExit:function(){},clearFilters:function(){var e=new Date;var t=e.getFullYear();this.getView().byId("sociedadInput").setValue("2001");this.getView().byId("documentoInput").setValue("");this.getView().byId("ejercicioInput").setValue(t);var o=this.getOwnerComponent().getModel("AcuerdosHdr");if(o){o.setData([])}},buildExportTable:function(){var e=this.getOwnerComponent().getModel("appTxts");var t=[{name:e.getProperty("/acuerdos.sucursal"),template:{content:"{Werks}"}},{name:e.getProperty("/acuerdosNS.referencia"),template:{content:"{Refer}"}},{name:e.getProperty("/acuerdos.detConv"),template:{content:"{Conve}"}},{name:e.getProperty("/acuerdos.detCveMov"),template:{content:"{Cvemo}"}},{name:e.getProperty("/acuerdos.detFolio"),template:{content:"{Folio}"}},{name:e.getProperty("/acuerdosNS.proveedor"),template:{content:"{Lifnr}"}},{name:e.getProperty("/acuerdos.base"),template:{content:"{Base}"}},{name:e.getProperty("/acuerdos.desc"),template:{content:"{Desct}"}},{name:e.getProperty("/acuerdos.iva"),template:{content:"{Iva}"}},{name:e.getProperty("/acuerdos.pDesc"),template:{content:"{Prdes}"}},{name:e.getProperty("/acuerdosNS.cveFact"),template:{content:"{Cvefac}"}},{name:e.getProperty("/acuerdosNS.indIEPS"),template:{content:"{Bitieps}"}},{name:e.getProperty("/acuerdosNS.ieps"),template:{content:"{Impieps}"}}];this.exportxls("AcuerdosHdr","/",t)},onListItemPress:function(e){var t=e.getSource().getBindingContext("AcuerdosHdr").getPath(),o=t.split("/").slice(-1).pop();var r=this.getOwnerComponent().getModel("AcuerdosHdr");var n=r.getProperty("/");var a=n[o];var s=this.getView().byId("sociedadInput").getValue();var i=this.getView().byId("documentoInput").getValue();var d=this.getView().byId("ejercicioInput").getValue();this.getOwnerComponent().getRouter().navTo("detailDetailAcuNS",{layout:sap.f.LayoutType.TwoColumnsMidExpanded,sociedad:s,documento:i,ejercicio:d,tienda:a.Werks},true)},onPressPDF:function(){}})});