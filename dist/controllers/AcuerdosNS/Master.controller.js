sap.ui.define(["demo/controllers/BaseController","sap/m/MessageBox","sap/m/PDFViewer"],function(e,t,r){"use strict";var o=new this.Acuerdos;return e.extend("demo.controllers.AcuerdosNS.Master",{onInit:function(){this._pdfViewer=new r;this.getView().addDependent(this._pdfViewer);this.getView().addEventDelegate({onAfterShow:function(e){var t=this.getOwnerComponent().getModel();t.setProperty("/barVisible",true);this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel,"AcuerdosHdr");this.clearFilters()}},this);this.configFilterLanguage(this.getView().byId("filterBar"))},searchData:function(){var e=this.getOwnerComponent().getModel("appTxts");var r=true;if(!o.getModel()){o.initModel()}var n=this.getConfigModel().getProperty("/supplierInputKey");var s=this.getView().byId("referenciaInput").getValue();if(n==""||n==null){t.error(e.getProperty("/acuerdosHNS.indProveedor"));r=false}else if(s==""||s==null){t.error(e.getProperty("/acuerdosHNS.indReferencia"));r=false}if(r){var a="AcuerdosNSSet?$filter=";a+="Lifnr eq '"+n+"'";a+=" and Refer eq '"+s+"'";this.getView().byId("tableAcuerdos").setBusy(true);o.getJsonModelAsync(a,function(e,t){var r=e.getProperty("/results");if(r!=null){var o=r.reduce((e,t)=>+e+(+t["Base"]||0),0);var n=r.reduce((e,t)=>+e+(+t["Desct"]||0),0);var s=r.reduce((e,t)=>+e+(+t["Iva"]||0),0);var a=r.reduce((e,t)=>+e+(+t["Impieps"]||0),0);var i={TotBase:Number(o.toFixed(2)),TotDescto:Number(n.toFixed(2)),TotIVA:Number(s.toFixed(2)),TotIEPS:Number(a.toFixed(2))};t.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(i),"acuTotDetModel");t.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(r),"AcuerdosHdr")}t.getView().byId("tableAcuerdos").setBusy(false)},function(e){e.getView().byId("tableAcuerdos").setBusy(false)},this)}},onExit:function(){},clearFilters:function(){this.getView().byId("referenciaInput").setValue("");var e=this.getOwnerComponent().getModel("AcuerdosHdr");if(e){e.setData([])}var t=this.getOwnerComponent().getModel("acuTotDetModel");if(t){t.setData([])}},buildExportTable:function(){var e=this.getOwnerComponent().getModel("appTxts");var t=[{name:e.getProperty("/acuerdos.sucursal"),template:{content:"{Werks}"}},{name:e.getProperty("/acuerdosNS.referencia"),template:{content:"{Refer}"}},{name:e.getProperty("/acuerdos.detConv"),template:{content:"{Conve}"}},{name:e.getProperty("/acuerdos.detCveMov"),template:{content:"{Cvemo}"}},{name:e.getProperty("/acuerdos.detFolio"),template:{content:"{Folio}"}},{name:e.getProperty("/acuerdosNS.proveedor"),template:{content:"{Lifnr}"}},{name:e.getProperty("/acuerdos.base"),template:{content:"{Base}"}},{name:e.getProperty("/acuerdos.desc"),template:{content:"{Desct}"}},{name:e.getProperty("/acuerdos.iva"),template:{content:"{Iva}"}},{name:e.getProperty("/acuerdos.pDesc"),template:{content:"{Prdes}"}},{name:e.getProperty("/acuerdosNS.cveFact"),template:{content:"{Cvefac}"}},{name:e.getProperty("/acuerdosNS.indIEPS"),template:{content:"{Bitieps}"}},{name:e.getProperty("/acuerdosNS.ieps"),template:{content:"{Impieps}"}}];this.exportxls("AcuerdosHdr","/",t)},onListItemPress:function(e){var t=e.getSource().getBindingContext("AcuerdosHdr").getPath(),r=t.split("/").slice(-1).pop();var o=this.getOwnerComponent().getModel("AcuerdosHdr");var n=o.getProperty("/");var s=n[r];var a=this.getConfigModel().getProperty("/supplierInputKey");var i=this.getView().byId("referenciaInput").getValue();if(i.includes("/")){var d=i.substring(0,i.indexOf("/"));var u=i.split("/")[1]}else{d=i;u="NOREF2"}this.getOwnerComponent().getRouter().navTo("detailDetailAcuNS",{layout:sap.f.LayoutType.TwoColumnsMidExpanded,proveedor:a,ref1:d,ref2:u,centro:s.Werks},true)},onPressPDF:function(){}})});