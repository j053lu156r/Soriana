sap.ui.define(["demo/controllers/BaseController","sap/ui/model/json/JSONModel","sap/ui/export/library","sap/ui/export/Spreadsheet"],function(e,t,o,i){"use strict";var r=o.EdmType;return e.extend("demo.controllers.VisorNotasEntrada.Detail",{onInit:function(){$(document).ready(function(){$(document).on("focus",":input",function(){$(this).attr("autocomplete","off")})});this.oRouter=this.getOwnerComponent().getRouter();this.oModel=this.getOwnerComponent().getModel();var e=sap.ui.core.UIComponent.getRouterFor(this);e.getRoute("detailVisorNotas").attachMatched(this._onRouteMatched,this);this.VisibleTable()},onAfterRendering:function(){},handleFullScreen:function(e){this.bFocusFullScreenButton=true;var t=this.oModel.getProperty("/actionButtonsInfo/midColumn/fullScreen");this.oRouter.navTo("detailVisorNotas",{layout:sap.f.LayoutType.MidColumnFullScreen})},handleExitFullScreen:function(e){this.bFocusFullScreenButton=true;var t=this.oModel.getProperty("/actionButtonsInfo/midColumn/exitFullScreen");this.oRouter.navTo("detailVisorNotas",{layout:sap.f.LayoutType.MidColumnFullScreen})},handleClose:function(e){this.oRouter.navTo("masterVisorNotas",{layout:this.oModel.getProperty("/actionButtonsInfo/midColumn/closeColumn")})},ConfigTable:function(){var e=this;var t=e.getView().byId("dinamicTableNED");if(!t){t=sap.ui.xmlfragment(e.getView().getId(),"demo.views.VisorNotasEntrada.fragment.optionNEDetail",this);e.getView().addDependent(t);e.getView().byId("dinamicTableNED").addStyleClass(e.getOwnerComponent().getContentDensityClass())}t.open()},ClosepopUp:function(){var e=this;e.TableVisible();e.getView().byId("dinamicTableNED").close()},_onRouteMatched:function(e){var t=e.getParameter("arguments");if(t.Xblnr==="0.1"){t.Xblnr=""}if(t.XblnrFact==="0.1"){t.XblnrFact=""}var o=[];o={Mblnr:t.Mblnr,Mjahr:t.Mjahr,Ebeln:t.Ebeln,Lifnr:t.Lifnr,BudatMkpf:t.BudatMkpf,Werks:t.Werks,Xblnr:t.Xblnr,XblnrFact:t.XblnrFact,posiciones:[]};var i=this;var r="ZOSP_MMIM_MIGO_DOC_SRV";var n="MIGO_DOC(Mblnr='"+t.Mblnr+"',Mjahr='"+t.Mjahr+"')/DocDetalleNav";var a="";var l="";sap.ui.core.BusyIndicator.show();i._GEToDataV2(r,n,a,l).then(function(e){sap.ui.core.BusyIndicator.hide();var t=e.data.results;var o=[];for(var r=0;r<t.length;r++){o.push({Ean11:t[r].Ean11,Ebeln:t[r].Ebeln,Ebelp:t[r].Ebelp,Erfme:t[r].Erfme,Erfmg:t[r].Erfmg,Maktx:t[r].Maktx,Matnr:t[r].Matnr,Mblnr:t[r].Mblnr,Meins:t[r].Meins,Menge:t[r].Menge,Mjahr:t[r].Mjahr,Zeile:t[r].Zeile,Umrez:t[r].Umrez,Fconver:Number(t[r].Menge)/Number(t[r].Erfmg),Ctotal:t[r].Menge+" "+t[r].Meins,CPiezas:t[r].Erfmg+" "+t[r].Erfme})}var n=new sap.ui.model.json.JSONModel(o);i.getView().setModel(n,"DetallePosiciones")});var s=new sap.ui.model.json.JSONModel(o);i.getView().setModel(s,"DetalleModel")},VisibleTable:function(){var e=this;e.oModel=new t({idEbelp:true,idEan11:true,idMaktx:true,idErfmg:true,idFconver:true,idMenge:true});e.getView().setModel(e.oModel);e.TableVisible()},TableVisible:function(){var e=this;e.getView().byId("idEbelp").setVisible(e.getView().getModel().getProperty("/idEbelp"));e.getView().byId("idEan11").setVisible(e.getView().getModel().getProperty("/idEan11"));e.getView().byId("idMaktx").setVisible(e.getView().getModel().getProperty("/idMaktx"));e.getView().byId("idErfmg").setVisible(e.getView().getModel().getProperty("/idErfmg"));e.getView().byId("idFconver").setVisible(e.getView().getModel().getProperty("/idFconver"));e.getView().byId("idMenge").setVisible(e.getView().getModel().getProperty("/idMenge"))},onParentClicked:function(e){var t=e.getParameter("selected");this.oModel.setData({idEbelp:t,idEan11:t,idMaktx:t,idErfmg:t,idFconver:t,idMenge:t})},createColumnConfig:function(){var e=this;var t=e.getView().getModel("migoModel").getData(),o=[];var i=this.getOwnerComponent().getModel("appTxts");o.push({label:i.getProperty("/visor.position"),type:r.String,property:"Ebelp"});o.push({label:i.getProperty("/visor.codigo"),type:r.String,property:"Ean11"});o.push({label:i.getProperty("/visor.descripcion"),type:r.String,property:"Maktx"});o.push({label:i.getProperty("/visor.quantity"),type:r.String,property:"CPiezas"});o.push({label:i.getProperty("/visor.capacidad"),type:r.String,property:"Fconver"});o.push({label:i.getProperty("/visor.Fconver"),type:r.String,property:"Ctotal"});return o},buildExportTable:function(){var e,t,o,r,n,a=this;if(!a._oTable){a._oTable=this.byId("tableVisor")}n=a._oTable;t=n.getBinding().oList;e=a.createColumnConfig();o={workbook:{columns:e,hierarchyLevel:"Level"},dataSource:t,fileName:"Posiciones Notas de Entrada",worker:false};r=new i(o);r.build().finally(function(){r.destroy()})}})});