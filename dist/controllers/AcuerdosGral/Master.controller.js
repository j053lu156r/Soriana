sap.ui.define(["demo/controllers/BaseController","sap/ui/model/json/JSONModel","sap/m/MessageBox"],function(e,t,r){"use strict";var o=new this.Acuerdos;return e.extend("demo.controllers.AcuerdosGral.Master",{onInit:function(){this.getView().addEventDelegate({onAfterShow:function(e){var r=this.getOwnerComponent().getModel();r.setProperty("/barVisible",true);this.getOwnerComponent().setModel(new t,"AcuerdosGralHdr");this.clearFilters()}},this);this.configFilterLanguage(this.getView().byId("filterBar"))},searchData:function(){var e=true;if(!o.getModel()){o.initModel()}var t=this.getConfigModel().getProperty("/supplierInputKey");var a=this.getView().byId("documentoInput").getValue();var n=this.getView().byId("convenioInput").getValue();var s=this.getView().byId("centroInput").getValue();var l=this.getOwnerComponent().getModel("appTxts");if(t==""||t==null){r.error(l.getProperty("/acuerdosGral.indProv"));e=false}else if(a==""||a==null){r.error(l.getProperty("/acuerdosGral.indDocto"));e=false}if(e){var i="AcuerdosGralSet?$filter=Lifnr eq '"+t+"'";if(a!=""&&a!=null){i+=" and Belnr eq '"+a+"'"}if(n!=""&&n!=null){i+=" and Conve eq '"+n+"'"}if(s!=""&&s!=null){i+=" and Werks eq '"+s+"'"}this.getView().byId("tableAcuerdosGral").setBusy(true);o.getJsonModelAsync(i,function(e,t){var r=e.getProperty("/results");if(r!=null){var o=r.reduce((e,t)=>+e+(+t["Base"]||0),0);var a=r.reduce((e,t)=>+e+(+t["Desct"]||0),0);var n=r.reduce((e,t)=>+e+(+t["Iva"]||0),0);var s=r.reduce((e,t)=>+e+(+t["Ieps"]||0),0);var l=r.reduce((e,t)=>+e+(+t["Totca"]||0),0);var i={TotBase:Number(o.toFixed(2)),TotDesct:Number(a.toFixed(2)),TotIva:Number(n.toFixed(2)),TotIeps:Number(s.toFixed(2)),TotTotca:Number(l.toFixed(2))};t.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(i),"AcuerdosGralTot");t.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(r),"AcuerdosGralHdr")}t.getView().byId("tableAcuerdosGral").setBusy(false)},function(e){e.getView().byId("tableAcuerdosGral").setBusy(false)},this)}},clearFilters:function(){this.getView().byId("supplierInput").setValue("");this.getView().byId("documentoInput").setValue("");this.getView().byId("convenioInput").setValue("");this.getView().byId("centroInput").setValue("")},buildExportTable:function(){var e=this.getOwnerComponent().getModel("appTxts");var t=[{name:e.getProperty("/acuerdosGral.proveedor"),template:{content:"{Lifnr}"}},{name:e.getProperty("/acuerdosGral.documento"),template:{content:"{Belnr}"}},{name:e.getProperty("/acuerdosGral.convenio"),template:{content:"{Conve}"}},{name:e.getProperty("/acuerdosGral.centro"),template:{content:"{Werks}"}},{name:e.getProperty("/acuerdosGral.folio"),template:{content:"{Folio}"}},{name:e.getProperty("/acuerdosGral.base"),template:{content:"{Base}"}},{name:e.getProperty("/acuerdosGral.descto"),template:{content:"{Desct}"}},{name:e.getProperty("/acuerdosGral.iva"),template:{content:"{Iva}"}},{name:e.getProperty("/acuerdosGral.ieps"),template:{content:"{Ieps}"}},{name:e.getProperty("/acuerdosGral.totCargo"),template:{content:"{Totca}"}},{name:e.getProperty("/acuerdosGral.pDescto"),template:{content:"{Prdes}"}},{name:e.getProperty("/acuerdosGral.fecCargo"),template:{content:"{ path: 'Fecca', type: 'sap.ui.model.type.DateTime', formatOptions: { pattern: 'dd/MM/yyyy', UTC: true } }"}}];this.exportxls("AcuerdosGralHdr","/",t)}})});