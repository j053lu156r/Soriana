sap.ui.define(["jquery.sap.global","sap/ui/core/Fragment","demo/controllers/BaseController","sap/m/UploadCollectionParameter","sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","sap/m/MessageBox","sap/ui/export/library","sap/ui/export/Spreadsheet","sap/ui/core/routing/Router","demo/models/BaseModel","sap/f/library"],function(e,t,r,o,a,p,i,l,s,n){"use strict";var u=s.EdmType;var d=new this.MejorCond;return r.extend("demo.controllers.Statement.DetailReporte",{onInit:function(){this.oRouter=this.getOwnerComponent().getRouter();this.oModel=this.getOwnerComponent().getModel();this.oRouter.getRoute("EstadoCuentaReporte").attachPatternMatched(this._onDocumentMatched,this);this.oRouter.getRoute("ComplementoReporteMC").attachPatternMatched(this._onDocumentMatched,this);console.log("on reporte estado cuenta init-----")},searchData:function(){var e=this.getOwnerComponent().getModel("appTxts");var t=true;if(!d.getModel()){d.initModel()}var r=sap.ui.core.format.DateFormat.getDateInstance({pattern:"YYYY"});var o=new Date(this._date);var a=this.padLeadingZeros(this._proveedor,10);var p=this._document;var i=this._serie;var l=this._fecha.replace(/-/g,"");if(t){var s="RepMejorCondSet?$filter=(";if(p!=""&&p!=null){s+="IAcre eq '"+a+"'";s+=" and IFolio eq '"+p+"'";s+=" and ISerie eq '"+i+"'";s+=" and IFe eq '"+l+"')"}var n=d.getJsonModel(s);var u=n.getProperty("/results");console.log(u);this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(u),"MejorCondHdr")}},onExit:function(){},clearFilters:function(){this.getView().byId("sociedadInput").setValue("");this.getView().byId("documentoInput").setValue("");this.getView().byId("ejercicioInput").setValue("");this.getView().byId("acuerdoInput").setValue("");var e=this.getOwnerComponent().getModel("MejorCondHdr");if(e){e.setData([])}},buildExportTable:function(){var e,t,r,o,a,p=this;if(!p._oTable){p._oTable=this.byId("tableAcuerdos")}a=p._oTable;t=a.getBinding().oList;e=p.createColumnConfig();r={workbook:{columns:e,hierarchyLevel:"Level"},dataSource:t,fileName:"Estado de Cuenta",worker:false};o=new n(r);o.build().finally(function(){o.destroy()})},genereteRowAction:function(){var e=this.getOwnerComponent().getModel("appTxts");var t=this.byId("tableVisor");var r=t.getRowActionTemplate();if(r){r.destroy();r=null}r=new RowAction({items:[new RowActionItem({icon:"sap-icon://open-command-field",text:e.getProperty("/global.view"),press:e=>this.onPress(e)})]});t.setRowActionTemplate(r);t.setRowActionCount(2)},createColumnConfig:function(){var e=this;var t=e.getView().getModel("MejorCondHdr").getData(),r=[];var o=this.getOwnerComponent().getModel("appTxts");r.push({label:o.getProperty("/reporte.headerOrden"),type:u.String,property:"TeSalida/DocCompra"});r.push({label:o.getProperty("/reporte.headerPosicion"),type:u.String,property:"TeSalida/Posicion"});r.push({label:o.getProperty("/reporte.headerNE"),type:u.String,property:"TeSalida/FolionEntrada"});r.push({label:o.getProperty("/reporte.headerEntradaMercancia"),type:u.String,property:"TeSalida/DocMaterial"});r.push({label:o.getProperty("/reporte.headerRegFactura"),type:u.String,property:"TeSalida/DocFactura"});r.push({label:o.getProperty("/reporte.folioCargo"),type:u.String,property:"TeSalida/DocCargo"});r.push({label:o.getProperty("/reporte.refInterna"),type:u.String,property:"TeSalida/Cmsucfol"});r.push({label:o.getProperty("/reporte.EAN"),type:u.String,property:"TeSalida/EanUpc"});r.push({label:o.getProperty("/reporte.mterialRecibo"),type:u.String,property:"TeSalida/MaterialSap"});r.push({label:o.getProperty("/reporte.fechaRecibo"),type:u.String,property:"TeSalida/FecharSap"});r.push({label:o.getProperty("/reporte.unidadRecibo"),type:u.String,property:"TeSalida/UmedidaPSap"});r.push({label:o.getProperty("/reporte.cantidadRecibo"),type:u.Number,property:"TeSalida/CantidadSap"});r.push({label:o.getProperty("/reporte.costoRecibo"),type:u.Number,property:"TeSalida/PrecCDescSap"});r.push({label:o.getProperty("/reporte.subtotalRecibo"),type:u.Number,property:"TeSalida/ImporteSap"});r.push({label:o.getProperty("/reporte.impuestosRecibo"),type:u.Number,property:"TeSalida/ImpuestosSap"});r.push({label:o.getProperty("/reporte.totalRecibo"),type:u.Number,property:"TeSalida/ImpTotCImpSap"});r.push({label:o.getProperty("/reporte.recepcionCFDI"),type:u.String,property:"TeSalida/FechaRegSap"});r.push({label:o.getProperty("/reporte.factura"),type:u.String,property:"TeSalida/Serfol"});r.push({label:o.getProperty("/reporte.materialCFDI"),type:u.String,property:"TeSalida/Material"});r.push({label:o.getProperty("/reporte.unidadMedida"),type:u.String,property:"TeSalida/Unidad"});r.push({label:o.getProperty("/reporte.cantidadCFDI"),type:u.Number,property:"TeSalida/Cantidad"});r.push({label:o.getProperty("/reporte.costoCFDI"),type:u.Number,property:"TeSalida/PrecioUnSi"});r.push({label:o.getProperty("/reporte.subtotalCFDI"),type:u.Number,property:"TeSalida/ImporteTotal"});r.push({label:o.getProperty("/reporte.impuestosCFDI"),type:u.Number,property:"TeSalida/ImpuestosFact"});r.push({label:o.getProperty("/reporte.totalCFDI"),type:u.Number,property:"TeSalida/ImporteTotCi"});r.push({label:o.getProperty("/reporte.cantidadMC"),type:u.Number,property:"TeSalida/MejorCantidad"});r.push({label:o.getProperty("/reporte.costoMC"),type:u.Number,property:"TeSalida/MejorPrecio"});r.push({label:o.getProperty("/reporte.subtotalMC"),type:u.Number,property:"TeSalida/MejorSubtotal"});r.push({label:o.getProperty("/reporte.impuestosMC"),type:u.Number,property:"TeSalida/ImpuestosTotal"});r.push({label:o.getProperty("/reporte.totalMC"),type:u.Number,property:"TeSalida/MejorTotal"});r.push({label:o.getProperty("/reporte.subtotalNC"),type:u.Number,property:"TeSalida/NcargoMc"});r.push({label:o.getProperty("/reporte.impuestosNC"),type:u.Number,property:"TeSalida/NcargoImpMc"});r.push({label:o.getProperty("/reporte.totalNC"),type:u.Number,property:"TeSalida/NcargoTotMc"});r.push({label:o.getProperty("/reporte.Estatus"),type:u.String,property:"TeSalida/Estatus"});r.push({label:o.getProperty("/reporte.Estatus"),type:u.String,property:"TeSalida/DescEstat"});r.push({label:o.getProperty("/reporte.sucursal"),type:u.String,property:"TeSalida/Centro"});r.push({label:o.getProperty("/reporte.subtXML"),type:u.String,property:"TeSalida/SubtotalXML"});r.push({label:o.getProperty("/reporte.totalXML"),type:u.String,property:"TeSalida/TotalXML"});r.push({label:o.getProperty("/reporte.difXML"),type:u.String,property:"TeSalida/DifAddenda"});r.push({label:o.getProperty("/reporte.tasaIvaXML"),type:u.String,property:"TeSalida/TivaXML"});r.push({label:o.getProperty("/reporte.tasaIepsXML"),type:u.String,property:"TeSalida/TiepsXML"});r.push({label:o.getProperty("/reporte.tasaIvaSap"),type:u.String,property:"TeSalida/TivaSAP"});r.push({label:o.getProperty("/reporte.tasaIepsSap"),type:u.String,property:"TeSalida/TiepsSap"});r.push({label:o.getProperty("/reporte.difImp"),type:u.String,property:"TeSalida/DifImpuestos"});r.push({label:o.getProperty("/reporte.NoEAN"),type:u.String,property:"TeSalida/NoExisteEAN"});r.push({label:o.getProperty("/reporte.proveedorMsj"),type:u.String,property:"TeSalida/MsjProv"});return r},_onDocumentMatched:function(e){this._document=e.getParameter("arguments").document||this._document||"0";this._proveedor=e.getParameter("arguments").proveedor||this._proveedor||"0";this._serie=e.getParameter("arguments").serie||this._serie||"";this._fecha=e.getParameter("arguments").fecha||this._fecha||"0";this.searchData()},handleFullScreen:function(){var e=this.getOwnerComponent().getHelper().getNextUIState(2);this.bFocusFullScreenButton=true;var t=this.oModel.getProperty("/actionButtonsInfo/midColumn/fullScreen");this.oRouter.navTo("EstadoCuentaReporte",{layout:t,document:this._document,proveedor:this._proveedor,serie:this._serie,fecha:this._fecha})},handleExitFullScreen:function(){this.bFocusFullScreenButton=true;var e=this.oModel.getProperty("/actionButtonsInfo/midColumn/exitFullScreen");this.oRouter.navTo("EstadoCuentaReporte",{layout:e,document:this._document,proveedor:this._proveedor,serie:this._serie,fecha:this._fecha})},handleClose:function(){console.log("on hanlde close");var e=this.oModel.getProperty("/actionButtonsInfo/midColumn/closeColumn");this.onBackPreviousView()},padLeadingZeros:function(e,t){var r=e+"";while(r.length<t)r="0"+r;return r},formatDate:function(e){var t=e.getMonth();var r=e.getDate().toString();var o=e.getFullYear();o=o.toString().substr(-2);t=(t+1).toString();if(t.length===1){t="0"+t}if(r.length===1){r="0"+r}return r+t+o}})});