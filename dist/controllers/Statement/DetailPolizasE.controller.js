sap.ui.define(["demo/controllers/BaseController","sap/m/MessageBox","sap/m/PDFViewer","sap/ui/core/routing/History","sap/ui/core/routing/Router"],function(e,t,o,a,n){"use strict";var r=new this.Polizas;return e.extend("demo.controllers.Statement.DetailPolizasE",{onInit:function(){this._pdfViewer=new o;this.getView().addDependent(this._pdfViewer);this.oRouter=this.getOwnerComponent().getRouter();this.oModel=this.getOwnerComponent().getModel();this.oRouter.getRoute("BoletinVtaDetailPolizasE").attachPatternMatched(this._onDocumentMatched,this);this.getView().addEventDelegate({onAfterShow:function(e){var t=this.getOwnerComponent().getModel();t.setProperty("/barVisible",true)}},this);this.configFilterLanguage(this.getView().byId("filterBar"))},handleFullScreen:function(){this.bFocusFullScreenButton=true;var e=this.oModel.getProperty("/actionButtonsInfo/midColumn/fullScreen");this.oRouter.navTo("BoletinVtaDetailPolizasE",{layout:e,company:this._company,document:this._document,year:this._year})},handleExitFullScreen:function(){this.bFocusFullScreenButton=true;var e=this.oModel.getProperty("/actionButtonsInfo/midColumn/exitFullScreen");this.oRouter.navTo("BoletinVtaDetailPolizasE",{layout:e,company:this._company,document:this._document,year:this._year})},handleClose:function(){console.log("hasda");var e=a.getInstance();var t=e.getPreviousHash();if(t!==undefined){window.history.go(-1)}else{var o=sap.ui.core.UIComponent.getRouterFor(this);o.navTo("",true)}},_onDocumentMatched:function(e){console.log("entro1");this._company=e.getParameter("arguments").company||this._company||"0";this._document=e.getParameter("arguments").document||this._document||"0";this._year=e.getParameter("arguments").year||this._year||"0";var t={company:this._company,document:this._document,year:this._year};this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(t),"policieDetModel");this.searchData()},searchData:function(){console.log("buscar");var e=this.getOwnerComponent().getModel("appTxts");var t=true;if(!r.getModel()){r.initModel()}var o="finalcialDocumentsSet?$filter=Bukrs eq '"+this._company+"' and Belnr eq '"+this._document+"' and Gjahr eq '"+this._year+"'";this.getView().byId("tablePolizas").setBusy(true);var a=[];a.push(new sap.ui.model.Filter({path:"Bukrs",operator:sap.ui.model.FilterOperator.EQ,value1:this._company}));a.push(new sap.ui.model.Filter({path:"Belnr",operator:sap.ui.model.FilterOperator.EQ,value1:this._document}));a.push(new sap.ui.model.Filter({path:"Gjahr",operator:sap.ui.model.FilterOperator.EQ,value1:this._year}));var n=this;var i="ZOS_FI_DOCUMENTS_SRV";var s="finalcialDocumentsSet";var l="";var u=a;var d="";n.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel,"PolizasHdr");sap.ui.core.BusyIndicator.show();n._GEToDataV2(i,s,u,l,d).then(function(e){sap.ui.core.BusyIndicator.hide();console.log(e);var t=e.data.results;if(t!=null){if(t.length>0){var o=t[0].Name;var a=t[0].Knuma;var r=t.reduce((e,t)=>+e+(+t["Dmbtr"]||0),0);var i=t.reduce((e,t)=>+e+(+t["Wrbtr"]||0),0);var s=t.reduce((e,t)=>+e+(+t["Wmwst"]||0),0);var l={TotBase:Number(r.toFixed(2)),TotDescto:Number(i.toFixed(2)),TotIVA:Number(s.toFixed(2)),VendorName:o,Agreement:a};n.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(l),"acuTotDetModel");n.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(t),"PolizasHdr");n.paginate("PolizasHdr","/PolizasDet",1,0)}}n.getView().byId("tablePolizas").setBusy(false)})},onExit:function(){},onDebitDetail:function(){console.log("entro");var e=this.getView().byId("documentoInput").getValue();var t=this.getView().byId("ejercicioInput").getValue();var o=this.getOwnerComponent().getModel("PolizasHdr");var a=o.getProperty("/");var n=a[0];this.getOwnerComponent().getRouter().navTo("detailCargoEBoletinVta",{layout:sap.f.LayoutType.TwoColumnsMidExpanded,Company:n.Bukrs,Agreement:n.Knuma,Vendor:n.Lifnr,DateCreated:n.Erdat,document:e,year:t},true)},onDebitDetail2:function(){console.log("entro2");var e=this.getOwnerComponent().getModel("PolizasHdr");var t=e.getProperty("/");var o=t[0];console.log(o);this.getOwnerComponent().getRouter().navTo("detailCargoBoletinVta2",{layout:sap.f.LayoutType.TwoColumnsMidExpanded,Company:o.Bukrs,Agreement:o.Knuma,Vendor:o.Lifnr,DateCreated:o.Erdat,document:o.Belnr,year:o.Gjahr},true)},buildExportTable:function(){var e=this.getOwnerComponent().getModel("appTxts");var t=[{name:e.getProperty("/Polizas.sucursal"),template:{content:"{Centro}"}},{name:e.getProperty("/Polizas.base"),template:{content:"{Base}"}},{name:e.getProperty("/Polizas.desc"),template:{content:"{Descuento}"}},{name:e.getProperty("/Polizas.iva"),template:{content:"{IVA}"}},{name:e.getProperty("/Polizas.pDesc"),template:{content:"{PDesc}"}},{name:e.getProperty("/Polizas.unidad"),template:{content:"{Unidad}"}}];this.exportxls("PolizasHdr","/PolizasDet/results",t)}})});