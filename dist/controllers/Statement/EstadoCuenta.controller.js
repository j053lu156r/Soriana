sap.ui.define(["demo/controllers/BaseController","sap/ui/model/json/JSONModel","demo/models/BaseModel","sap/m/Label","sap/m/Link","sap/m/MessageToast","sap/m/Text","sap/ui/core/Fragment"],function(e,t,r,o,a,s,l,n){"use strict";var i="/sap/opu/odata/sap/ZOSP_STATEMENT_SRV_01/";var u;var d=new Date;return e.extend("demo.controllers.Statement.EstadoCuenta",{sCollection:"GroupedTotales>/Hierarchy",aCrumbs:["movimientos","positions"],mInitialOrderState:{products:{},count:0,hasCounts:false},onInit:function(){this.getView().addEventDelegate({onBeforeShow:function(e){this.clearFilters();this.getOwnerComponent().setModel(new t,"totales");this.getOwnerComponent().setModel(new t,"GroupedTotales");var r=new Date;r=r.getTime()-1e3*60*60*24*720;this.getView().byId("dateRange").setDateValue(new Date(r));this.getView().byId("dateRange").setSecondDateValue(new Date);var o=new t({filtros:[{filtro:"belnr",descripcion:"Documento"},{filtro:"xblnr",descripcion:"Factura"},{filtro:"",descripcion:""}]});this.getView().setModel(o,"filterOptions")}},this);if(!this._pTemplate){this._pTemplate=this.loadFragment({id:this.getView().getId(),name:"demo.views.Statement.Row"})}this._oTable=this.byId("idGroupTable");this._oTablev2=this.byId("detailsStatementList")},searchData:function(){let e=this.getView().byId("dateRange");let r=this.getView().byId("Belnr");let o=this.getView().byId("filtroBusqueda");let a=this.getConfigModel().getProperty("/supplierInputKey");console.log(this.byId("supplierInput").getValue());console.log(this.byId("supplierInput").getSelectedKey());let s=new Date;let l="20160219";let n=this.buildSapDate(s);let d=r.getValue();let p=this.getView().byId("checkPartidas");if(p.getSelected()){p.setSelected(false)}if(a==null||a==""){sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/global.supplierSelectError"));return false}if(l==""||n==""){}var c=o.getSelectedKey();var g="";if(c===""){g=""}else if(c==="belnr"){g=`and belnr eq '${d}' `}else if(c==="xblnr"){g=`and xblnr eq '${d}' `}var h=this.getOdata(i);let b=`EStmtHdrSet?$expand=Citms,Oitms&$filter= Lifnr eq '${a}' and Datei eq '${l}' and Datef eq '${n}' ${g} &$format=json`;var m=this.getOdataJsonModel(b,h);u=m.getJSON();var v=JSON.parse(u);let f=[...v.results[0].Citms.results,...v.results[0].Oitms.results];v.results[0].Detalles={results:[...f]};delete v.results[0].Citms;delete v.results[0].Oitms;v.results[0].periodo="Del "+this.formatDateTime(e.getDateValue(),"dd/MM/YYYY")+" al "+this.formatDateTime(e.getSecondDateValue(),"dd/MM/YYYY");var C=$.extend({},v.results[0]);var y=new t;y.setData(C);console.info("agrupando datos",f);let w=[...f];var M=this.groupArrayOfObjects(w,"DescripcionGpo");var T=[];var I=this;for(let e in M){var D=M[e].reduce(function(e,t){var r=t.Bschl==="21"?Number(t.Wrbtr):0;return e+r},0);var S=M[e].reduce(function(e,t){var r=t.Bschl!=="21"?Number(t.Wrbtr):0;var o=e+r;return o},0);var O=M[e];var V=O[0].IdNumGpo?O[0].IdNumGpo:"";T.push({IdNumGpo:V,name:e,totalRegs:M[e].length,totalDebit:Math.abs(this.truncate(S,2)),totalCredit:Math.abs(this.truncate(D,2)),positions:M[e]})}console.log("-----------------------------------------------------------------------------------");console.log(T);var B=T.filter(e=>e.Vblnr.startsWith("58"));var x=new t({Hierarchy:{movimientos:T,totalD:I.truncate(totalD,2),totalRmxn:B,totalCmxn:I.truncate(totalC,2),totalTmxn:I.truncate(totalGeneral,2),totalRusd:totalR,totalCusd:I.truncate(totalC,2),totalTusd:I.truncate(totalGeneral,2)},Bukrs:v.results[0].Bukrs});this.getOwnerComponent().setModel(x,"GroupedTotales");this.initTable();this.getOwnerComponent().setModel(y,"totales");this.paginate("totales","/Detalles",1,0)},onChange:function(){var e=this.getView().byId("dateRange").getDateValue();console.log(e)},searchDataV2:function(){let e=this.getView().byId("dateRange");let r=this.getView().byId("Belnr");let o=this.getView().byId("filtroBusqueda");let a=this.getConfigModel().getProperty("/supplierInputKey");console.log(a);console.log(this.byId("supplierInput").getValue().split("-")[0].trim());if(a===undefined){a=this.byId("supplierInput").getValue().split("-")[0].trim()}console.log(a);let s=new Date;console.log(this.buildSapDate(this.getView().byId("dateRange").getDateValue()));let l=this.buildSapDate(this.getView().byId("dateRange").getDateValue());let n=this.buildSapDate(s);let i="";let u=this.getView().byId("checkPartidas");if(u.getSelected()){u.setSelected(false)}if(a==null||a==""){sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/global.supplierSelectError"));return false}if(l==""||n==""){}var d="";var p="";var c=[];c.push(new sap.ui.model.Filter({path:"Lifnr",operator:sap.ui.model.FilterOperator.EQ,value1:a}));c.push(new sap.ui.model.Filter({path:"Datei",operator:sap.ui.model.FilterOperator.EQ,value1:l}));c.push(new sap.ui.model.Filter({path:"Datef",operator:sap.ui.model.FilterOperator.EQ,value1:n}));if(d==""){p=""}else if(d=="belnr"){c.push(new sap.ui.model.Filter({path:"belnr",operator:sap.ui.model.FilterOperator.EQ,value1:i}))}else if(d=="xblnr"){c.push(new sap.ui.model.Filter({path:"xblnr",operator:sap.ui.model.FilterOperator.EQ,value1:i}))}let g=this;var h=new t;var b=new t;g.getOwnerComponent().setModel(h,"GroupedTotales");g.initTable();g.getOwnerComponent().setModel(b,"totales");var m="ZOSP_STATEMENT_SRV_01";var v="EStmtHdrSet";var f=["Oitms"];var C=c;var y="";sap.ui.core.BusyIndicator.show();this._GetODataV2(m,v,C,f,y).then(function(e){sap.ui.core.BusyIndicator.hide();var r=e.data.results;let o=[...r[0].Oitms.results];var s=o.filter(e=>!e.Belnr.startsWith("58")&&!e.Belnr.startsWith("59"));var l=s.filter(e=>{if(e.DescripcionGpo===""){e.DescripcionGpo="AJUSTE DE FACTURAS";e.IdNumGpo="9";e.DescTipomov="CARGOS DIVERSOS";e.IdNumTipomov="65"}const t=new Date(e.Budat.replace(/-/g,"/"));return t<new Date});r[0].Detalles={results:[...l]};var n=$.extend({},r[0]);var i=new t;i.setData(n);let u=[...l];var d=g.groupArrayOfObjects(u,"DescripcionGpo");var p=[];for(let e in d){let t=d[e].filter(e=>e.Waers=="MXN");let r=d[e].filter(e=>e.Waers=="USD");var c=d[e].reduce(function(e,t){var r=t.Bschl==="21"?Number(t.Wrbtr):0;var o=e+r;return o},0);var h=t.reduce(function(e,t){var r=t.Bschl==="21"?Number(t.Wrbtr):0;var o=e+r;return o},0);var b=r.reduce(function(e,t){var r=t.Bschl==="21"?Number(t.Wrbtr):0;var o=e+r;return o},0);var m=d[e].reduce(function(e,t){var r=t.Bschl!=="21"?Number(t.Wrbtr):0;var o=e+r;return o},0);var v=t.reduce(function(e,t){var r=t.Bschl!=="21"?Number(t.Wrbtr):0;var o=e+r;return o},0);var f=r.reduce(function(e,t){var r=t.Bschl!=="21"?Number(t.Wrbtr):0;var o=e+r;return o},0);var C=d[e];var y=C[0].IdNumGpo?C[0].IdNumGpo:"";p.push({IdNumGpo:y,name:e,totalRegs:d[e].length,totalRegsMxn:t.length,totalRegsUsd:r.length,totalDebit:Math.abs(g.truncate(m,2)),totalDebitMxn:Math.abs(g.truncate(v,2)),totalDebitUsd:Math.abs(g.truncate(f,2)),totalCredit:Math.abs(g.truncate(c,2)),totalCreditMxn:Math.abs(g.truncate(h,2)),totalCreditUsd:Math.abs(g.truncate(b,2)),positions:d[e]})}var w=p.reduce(function(e,t){var r=Number(t.totalRegs);var o=e+r;return o},0);var M=p.reduce(function(e,t){var r=Number(t.totalRegsMxn);var o=e+r;return o},0);var T=p.reduce(function(e,t){var r=Number(t.totalRegsUsd);var o=e+r;return o},0);var I=p.reduce(function(e,t){var r=Number(t.totalDebit);var o=e+r;return o},0);var D=p.reduce(function(e,t){var r=Number(t.totalDebitMxn);var o=e+r;return o},0);var S=p.reduce(function(e,t){var r=Number(t.totalDebitUsd);var o=e+r;return o},0);var O=p.reduce(function(e,t){var r=Number(t.totalCredit);var o=e+r;return o},0);var V=p.reduce(function(e,t){var r=Number(t.totalCreditMxn);var o=e+r;return o},0);var B=p.reduce(function(e,t){var r=Number(t.totalCreditUsd);var o=e+r;return o},0);var x=g.truncate(I,2)-g.truncate(O,2);var P=Math.abs(g.truncate(D,2)-g.truncate(V,2));var A=Math.abs(g.truncate(S,2)-g.truncate(B,2));x=x-.01;var E=new t({Hierarchy:{movimientos:p,totalR:w,totalRmxn:M,totalRusd:T,totalD:g.truncate(I,2),totalDmxn:g.truncate(D,2),totalDusd:g.truncate(S,2),totalC:g.truncate(O,2),totalCmxn:g.truncate(V,2),totalCusd:g.truncate(B,2),totalT:g.truncate(x,2),totalTmxn:g.truncate(P,2),totalTusd:g.truncate(A,2)},Bukrs:r[0].Bukrs,Lifnr:a});g.getOwnerComponent().setModel(E,"GroupedTotales");g.initTable();g.getOwnerComponent().setModel(i,"totales");g.paginate("totales","/Detalles",1,0)})},groupArrayOfObjects:function(e,t){return e.reduce(function(e,r){(e[r[t]]=e[r[t]]||[]).push(r);return e},{})},searchPartidasAbiertas:function(){let e=this.getView().byId("dateRange");let r=this.getView().byId("Belnr");let o=this.getView().byId("filtroBusqueda");let a=this.getConfigModel().getProperty("/supplierInputKey");let s=new Date;let l="20160219";let n=this.buildSapDate(s);let i=r.getValue();let u=this.getView().byId("checkPartidas");if(u.getSelected()){u.setSelected(false)}if(a==null||a==""){sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/global.supplierSelectError"));return false}if(l==""||n==""){}var d=o.getSelectedKey();var p="";let c=[];c.push(new sap.ui.model.Filter({path:"Lifnr",operator:sap.ui.model.FilterOperator.EQ,value1:a}));c.push(new sap.ui.model.Filter({path:"Datei",operator:sap.ui.model.FilterOperator.EQ,value1:l}));c.push(new sap.ui.model.Filter({path:"Datei",operator:sap.ui.model.FilterOperator.EQ,value1:n}));if(d==""){p=""}else if(d=="belnr"){c.push(new sap.ui.model.Filter({path:"belnr",operator:sap.ui.model.FilterOperator.EQ,value1:i}))}else if(d=="xblnr"){c.push(new sap.ui.model.Filter({path:"xblnr",operator:sap.ui.model.FilterOperator.EQ,value1:i}))}var g="ZOSP_STATEMENT_SRV_01";var h="EStmtHdrSet";var b=["Citms","Oitms"];var m=c;var v="";sap.ui.core.BusyIndicator.show();let f=this;this._GetODataV2(g,h,m,b,v).then(function(e){sap.ui.core.BusyIndicator.hide();var r=e.data.results;console.log(r);let o=[...r[0].Citms.results,...r[0].Oitms.results];r[0].Detalles={results:[...o]};var a=$.extend({},r[0]);var s=new t;s.setData(a);let l=[...o];var n=f.groupArrayOfObjects(l,"DescripcionGpo");var i=[];for(let e in n){var u=n[e].reduce(function(e,t){var r=t.Bschl==="21"?Number(t.Wrbtr):0;var o=e+r;return o},0);var d=n[e].reduce(function(e,t){var r=t.Bschl!=="21"?Number(t.Wrbtr):0;var o=e+r;return o},0);var p=n[e];var c=p[0].IdNumGpo?p[0].IdNumGpo:"";i.push({IdNumGpo:c,name:e,totalRegs:n[e].length,totalDebit:Math.abs(f.truncate(d,2)),totalCredit:Math.abs(f.truncate(u,2)),positions:n[e]})}var g=i.reduce(function(e,t){var r=Number(t.totalRegs);var o=e+r;return o},0);var h=i.reduce(function(e,t){var r=Number(t.totalDebit);var o=e+r;return o},0);var b=i.reduce(function(e,t){var r=Number(t.totalCredit);var o=e+r;return o},0);var m=f.truncate(h,2)-f.truncate(b,2);m=m-.01;var v=new t({Hierarchy:{movimientos:i,totalR:g,totalD:f.truncate(h,2),totalC:f.truncate(b,2),totalT:f.truncate(m,2)},Bukrs:r[0].Bukrs});f.getOwnerComponent().setModel(v,"GroupedTotales");f.initTable();f.getOwnerComponent().setModel(s,"totales");f.paginate("totales","/Detalles",1,0)})},onTableGrouping:function(e){console.log(e.getSource().getSelected());if(!e.getSource().getSelected()){this.searchDataV2()}else{this.searchPartidasAbiertas()}},initTable:function(){console.log("on init table");var e=this._getInitialPath();this._setAggregation(e);var t=this.byId("breadcrumb");var r=new a({text:"{appTxts>/aportaciones.concepto}",press:[e,this.onBreadcrumbPress,this]});t.destroyLinks();t.addLink(r)},_getInitialPath:function(){return[this.sCollection,this.aCrumbs[0]].join("/")},_nextCrumb:function(e){for(var t=0,r=this.aCrumbs.length;t<r;t++){if(this.aCrumbs[t]===e){return this.aCrumbs[t+1]}}},truncate:function(e,t){return Math.trunc(e*Math.pow(10,t))/Math.pow(10,t)},_stripItemBinding:function(e){var t=e.split("/");return t.slice(0,t.length-1).join("/")},_setAggregation:function(e){var t=e.split("/").reverse()[0];if(t===this.aCrumbs[this.aCrumbs.length-1]){this._oTable.setMode("None");this._oTable.setMode("None");this.byId("statusColumn").setVisible(true);this.byId("folioColumn").setVisible(true);this.byId("referenceColumn").setVisible(true);this.byId("typeDocColumn").setVisible(true);this.byId("dateColumn").setVisible(true);this.byId("dateVColumn").setVisible(true);this.byId("amountColumn").setVisible(true);this.byId("mCondicionColumn").setVisible(true);this.byId("bloqueoColumn").setVisible(true);this.byId("conciliacionColumn").setVisible(false);this.byId("tipoMovColumn").setVisible(true);this.byId("tipoColumn").setVisible(false);this.byId("totalRegColumn").setVisible(false);this.byId("debitColumn").setVisible(false);this.byId("creditColumn").setVisible(false);this.byId("verReporteColumn").setVisible(true);this.byId("sucursalColumn").setVisible(true);this.byId("folio2Column").setVisible(true)}else{this._oTable.setMode("SingleSelectMaster");this.byId("statusColumn").setVisible(false);this.byId("tipoMovColumn").setVisible(false);this.byId("folioColumn").setVisible(false);this.byId("referenceColumn").setVisible(false);this.byId("typeDocColumn").setVisible(false);this.byId("dateColumn").setVisible(false);this.byId("dateVColumn").setVisible(false);this.byId("amountColumn").setVisible(false);this.byId("mCondicionColumn").setVisible(false);this.byId("bloqueoColumn").setVisible(false);this.byId("conciliacionColumn").setVisible(false);this.byId("tipoColumn").setVisible(true);this.byId("totalRegColumn").setVisible(true);this.byId("debitColumn").setVisible(true);this.byId("creditColumn").setVisible(true);this.byId("verReporteColumn").setVisible(false);this.byId("sucursalColumn").setVisible(false);this.byId("folio2Column").setVisible(false)}console.log("SET agregation spath",e);this._oTablev2.bindRows({path:e});console.log(this._oTablev2);this._pTemplate.then(function(t){var r=[new sap.ui.model.Sorter("IdNumGpo")];this._oTable.bindAggregation("items",e,t,r)}.bind(this))},conceptoSelect:function(e){console.log("on condepto select");let t=e.getSource().getBindingContext("GroupedTotales").getPath();console.log(t);var r=t.split("/");var o=t.split("/").reverse()[1];var l=r[r.length-2];console.log("current path",l);if(o!==this.aCrumbs[this.aCrumbs.length-1]){var n=this.byId("breadcrumb");var i=r[r.length-2];var u=this.aCrumbs.indexOf(i)+1;console.log("currentNOde",u);var d=new a({text:"{GroupedTotales>name}",press:[t+"/"+this.aCrumbs[u],this.onBreadcrumbPress,this]});d.bindElement({path:"GroupedTotales>"+t});n.addLink(d)}if(l===this.aCrumbs[this.aCrumbs.length-1]){var p={};console.log("on documnt press",e);console.log(t);let r=this.getOwnerComponent().getModel("GroupedTotales").getProperty(t);var c=this.getOwnerComponent().getModel("GroupedTotales").getProperty("/Bukrs");var g=r.Budat;var h=g.substr(0,4)?g.substr(0,4):"";console.log(this.getOwnerComponent().getModel("totales"));var b=r.Tcode;console.log(c,h,b);var m=r.Belnr;var v=["MEB4","WLF4","MEB2","MEB0","WLF2","ZMMFILACUERDO","WFL5"];var f=["Z_APORTACIONES"];if(v.includes(b)&&m.startsWith("510")||b==""&&!(m.startsWith("1700")&&r.Xblnr)){console.log("on detailAcuerdosAS");this.getOwnerComponent().getRouter().navTo("detailAcuerdosAS",{layout:sap.f.LayoutType.MidColumnFullScreen,document:r.Belnr,sociedad:c,ejercicio:h,doc:r.Xblnr?r.Xblnr:"NA"},true)}else if(f.includes(b)||m.startsWith("1700")&&r.Xblnr){console.log("on detailAportacionesAS");if(r.LifnrAportacion!==""){this.getOwnerComponent().getRouter().navTo("detailAportacionesAS",{layout:sap.f.LayoutType.MidColumnFullScreen,document:r.Xblnr,view:"EstadoCuenta"},true)}else{console.log("sin campo lifnr_aportacion");s.show("Sin aportaciÃ³n")}}}else{var C="GroupedTotales>";var y=[t,this._nextCrumb(l)].join("/");this._setAggregation(C+y);console.log("new spath",y)}},____handleSelection:function(e){console.log("on condepto select");var t=e.getParameter("listItem").getBindingContextPath();console.log(t);var r=t.split("/");var o=t.split("/").reverse()[1];var s=r[r.length-2];console.log("current path",s);if(o!==this.aCrumbs[this.aCrumbs.length-1]){var l=this.byId("breadcrumb");var n=r[r.length-2];var i=this.aCrumbs.indexOf(n)+1;console.log("currentNOde",i);var u=new a({text:"{GroupedTotales>name}",press:[t+"/"+this.aCrumbs[i],this.onBreadcrumbPress,this]});u.bindElement({path:"GroupedTotales>"+t});l.addLink(u)}if(s===this.aCrumbs[this.aCrumbs.length-1]){var d={};console.log("on documnt press",e);console.log(t);let r=this.getOwnerComponent().getModel("GroupedTotales").getProperty(t);var p=this.getOwnerComponent().getModel("GroupedTotales").getProperty("/Bukrs");var c=r.Budat;var g=c.substr(0,4)?c.substr(0,4):"";console.log(this.getOwnerComponent().getModel("totales"));var h=r.Tcode;console.log(p,g,h);var b=r.Belnr;var m=["MEB4","WLF4","MEB2","MEB0","WLF2","ZMMFILACUERDO","WFL5"];var v=["Z_APORTACIONES"];if(m.includes(h)&&b.startsWith("510")||h==""&&!(b.startsWith("1700")&&r.Xblnr)){console.log("on detailAcuerdosAS");this.getOwnerComponent().getRouter().navTo("detailAcuerdosAS",{layout:sap.f.LayoutType.MidColumnFullScreen,document:r.Belnr,sociedad:p,ejercicio:g,doc:r.Xblnr?r.Xblnr:"NA"},true)}else if(v.includes(h)||b.startsWith("1700")&&r.Xblnr){console.log("on detailAportacionesAS");this.getOwnerComponent().getRouter().navTo("detailAportacionesAS",{layout:sap.f.LayoutType.MidColumnFullScreen,document:r.Xblnr,view:"EstadoCuenta"},true)}}else{var f="GroupedTotales>";var C=[t,this._nextCrumb(s)].join("/");this._setAggregation(f+C);console.log("new spath",C)}},onBreadcrumbPress:function(e,t){var r=e.getSource();var o=this.byId("breadcrumb");var a=o.indexOfLink(r);var s=o.getLinks().slice(a+1);if(s.length){s.forEach(function(e){e.destroy()});this._setAggregation(t)}},clearFilters:function(){this.getView().byId("dateRange").setValue("")},paginar:function(e){let t=parseInt(this.getOwnerComponent().getModel("totales").getProperty("/Detalles/results/length"),10);let r=parseInt(e.getKey(),10);this.paginateValue(e,"totales","/Detalles")},buildExportTable:function(){var e=this.getOwnerComponent().getModel("appTxts");var t=this.formatData(this.getOwnerComponent().getModel("totales").getProperty("/Detalles/results"),e);console.log(t);var r=[{label:e.getProperty("/aportaciones.concepto").toUpperCase(),property:["IdNumTipomov","DescTipomov"],template:"{0} {1}",width:31},{label:e.getProperty("/state.statusUPC").toUpperCase(),property:"status",width:15},{label:e.getProperty("/state.xlsx.folio").toUpperCase(),property:"Folio",width:15},{label:e.getProperty("/state.xlsx.sucursal").toUpperCase(),property:"Sucursal",width:15},{label:e.getProperty("/state.folioUPC").toUpperCase(),property:"Belnr",width:20},{label:e.getProperty("/state.referenceUPC").toUpperCase(),property:"Xblnr",width:20},{label:e.getProperty("/state.typeDocUPC").toUpperCase(),property:"Ltext",width:22},{label:e.getProperty("/state.date").toUpperCase(),property:"Budat",width:22},{label:e.getProperty("/clarifications.expirationDate").toUpperCase(),property:"FechaTesoreria",width:22},{label:e.getProperty("/state.amount").toUpperCase(),property:"Wrbtr",type:sap.ui.export.EdmType.Number,delimiter:true,scale:2,width:15},{label:e.getProperty("/reporte.headerTitulo").toUpperCase(),property:"MCondicion",type:sap.ui.export.EdmType.Number,delimiter:true,scale:2,width:32},{label:e.getProperty("/state.bloqueado").toUpperCase(),property:"DescripcionBloqueo",width:32}];this.buildExcelSpreadSheet(r,t,"Estado de cuenta.xlsx")},formatData:function(e,t){e.forEach(function(e){if(e.Pendt===true){e.status=t.getProperty("/state.xlsx.statusPend")}else if(e.Belnr===e.Augbl){e.status=t.getProperty("/state.xlsx.statusPago")}else{e.status=t.getProperty("/state.xlsx.statusCont")}if(e.MCondicion!=="0.00"){e.MCondicion="-"+e.MCondicion}});return e},onMarkerPress:function(e){},formatDateTime:(e,t,r)=>{if(!e instanceof Date&&typeof e!=="string"&&typeof format!=="string")return false;let o={format:t,pattern:t};let a=sap.ui.core.format.DateFormat.getDateTimeInstance(o);if(e instanceof Date)return a.format(e);if(typeof e=="string"){let t;switch(String(r).toLowerCase()){case"yyyymmdd":let r=[];r.push(e.substring(0,4));r.push(e.substring(4,2));r.push(e.substring(6,2));t=new Date(r[0],r[1],r[2]);break;default:return false;break}return a.format(t)}},onDocumentDevolucionPress:function(e){var t=e.getSource().getBindingContext("GroupedTotales").getPath();let r=this.getOwnerComponent().getModel("GroupedTotales").getProperty(t);console.log(r);var o=this.getOwnerComponent().getModel("GroupedTotales").getProperty("/Lifnr");this.getOwnerComponent().getRouter().navTo("detailDevoEstadoCuenta",{layout:sap.f.LayoutType.MidColumnFullScreen,xblnr:r.Foliodescuento,lifnr:o,ebeln:r.Ebeln,suc:r.Sucursal},true)},onDocumentPress:function(e){var t=e.getSource().getBindingContext("GroupedTotales").getPath();let r=this.getOwnerComponent().getModel("GroupedTotales").getProperty(t);var o=this.getOwnerComponent().getModel("GroupedTotales").getProperty("/Bukrs");var a=r.Budat;var l=a.substr(0,4)?a.substr(0,4):"";console.log(this.getOwnerComponent().getModel("totales"));var n=r.Tcode;console.log(o,l,n);var i=r.Belnr;var u=["MEB4","WLF4","MEB2","MEB0","WLF2","ZMMFILACUERDO","WFL5"];var d=["Z_APORTACIONES"];var p=["ZMM_ACUERDOS_LIQUI"];var c=r.Boart;var g=["ZD33","ZD34","ZM33","ZM34"];console.log(r);if(u.includes(n)&&i.startsWith("510")||n==""&&!(i.startsWith("1700")&&r.Xblnr)){console.log("on detailAcuerdosAS");if(g.includes(c)){this.getOwnerComponent().getRouter().navTo("detailAcuerdosECNS",{layout:sap.f.LayoutType.TwoColumnsMidExpanded,document:r.Belnr,sociedad:o,ejercicio:l,doc:r.Xblnr?r.Xblnr:"NA"},true)}else{this.getOwnerComponent().getRouter().navTo("detailAcuerdosAS",{layout:sap.f.LayoutType.TwoColumnsMidExpanded,document:r.Belnr,sociedad:o,ejercicio:l,doc:r.Xblnr?r.Xblnr:"NA"},true)}}else if(d.includes(n)||i.startsWith("1700")&&r.Xblnr){console.log("on detailAportacionesAS");if(r.LifnrAportacion!==""){console.log("on detailAportacionesAS1");this.getOwnerComponent().getRouter().navTo("detailAportacionesAS",{layout:sap.f.LayoutType.MidColumnFullScreen,document:r.Foliodescuento,view:"EstadoCuenta",belnr:i,bukrs:o,gjahr:l},true)}else{s.show("Sin detalle")}}else if(n==="ZMM_ACUERDOS_LIQUI"){console.log("on boletin vtz");console.log(i,o,l);this.getOwnerComponent().getRouter().navTo("BoletinVtaDetailPolizasE",{layout:sap.f.LayoutType.MidColumnFullScreen,document:i,company:o,year:l},true)}else if(n==="ZFI_INVLOAD"){console.log("HolaJuan");console.log(o);console.log(i);this.getOwnerComponent().getRouter().navTo("AcuerdosEC",{layout:sap.f.LayoutType.TwoColumnsMidExpanded,document:i,sociedad:o},true)}},onPress:function(e){console.info(e);var t=e.getSource().getBindingContext("GroupedTotales").getPath();console.log(t);let r=this.getOwnerComponent().getModel("GroupedTotales").getProperty(t);let o=this.getConfigModel().getProperty("/supplierInputKey");console.log(r);if(r.Xblnr==""){return}var a=r.Xblnr;var s=a.replace(/[0-9]/g,"");var l=s.replace("-","");var n=a.replace(/\D/g,"");console.log(s);console.log(l);console.log(n);this.getOwnerComponent().getRouter().navTo("EstadoCuentaReporte",{layout:sap.f.LayoutType.MidColumnFullScreen,document:n,proveedor:o,serie:s,fecha:r.Budat},false)},hasReport:function(e){return Math.abs(e)>0?true:false}})});