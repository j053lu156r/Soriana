sap.ui.define(["demo/controllers/BaseController"],function(e){"use strict";var t=new this.CartaPorte;var o=new this.FilesCartaPorte;return e.extend("demo.controllers.UploadCP.Master",{oFileUploader:undefined,cboxComboBoxDet:undefined,cboxTipoOper:undefined,inputFolio:undefined,onInit:function(){this.configFilterLanguage(this.getView().byId("filterBar"));this.onLoadCedis();this.onLoadTipoOperacion();this.oFileUploader=this.getView().byId("fuTxt");this.cboxComboBoxDet=this.getView().byId("UCPComboBoxDet");this.cboxTipoOper=this.getView().byId("UCPComboBoxOp");var e=sap.ui.core.UIComponent.getRouterFor(this);e.getRoute("masterUploadCP").attachMatched(this._onRouteMatched,this)},_onRouteMatched:function(e){this._clearInputs()},onExit:function(){that._clearInputs()},onLoadCedis:function(){const e=this;const o=new XMLSerializer;var s='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" '+'xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">'+"<soap:Body>"+'<GetCedis xmlns="http://tempuri.org/" />'+"</soap:Body>"+"</soap:Envelope>";$.ajax({async:true,url:t.sUrl,method:"POST",headers:{"Content-Type":"text/xml; charset=utf-8","Access-Control-Allow-Origin":"*"},data:s,success:async function(t){const s=o.serializeToString(t.getElementsByTagName("GetCedisResult")[0]);let a=xml2js(s,{compact:true});let r=a.GetCedisResult;r.Cedis=await e._formatDataCedis(r.Cedis);var n=new sap.ui.model.json.JSONModel;n.setData(r);e.getOwnerComponent().setModel(n,"CedisModel")},error:function(e,t,o){sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/cartaPorte.missingCedisError"))}})},onLoadTipoOperacion:function(){const e=this;const o=new XMLSerializer;var s='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" '+'xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">'+"<soap:Body>"+'<GetTipoOper xmlns="http://tempuri.org/" />'+"</soap:Body>"+"</soap:Envelope>";$.ajax({async:true,url:t.sUrl,method:"POST",headers:{"Content-Type":"text/xml; charset=utf-8","Access-Control-Allow-Origin":"*"},data:s,success:async function(t){const s=o.serializeToString(t.getElementsByTagName("GetTipoOperResult")[0]);let a=xml2js(s,{compact:true});let r=a.GetTipoOperResult;r.TipoOperacion=await e._formatDataTipoOper(r.TipoOperacion);var n=new sap.ui.model.json.JSONModel;n.setData(r);e.getOwnerComponent().setModel(n,"TipoOperModel")},error:function(e,t,o){sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/cartaPorte.missingTipoOperError"))}})},async _formatDataCedis(e){await e.forEach(function(t,o){let s={Id_Num_UN:0,Ids_Num_UN:0,Desc_UN:""};s.Id_Num_UN=t.Id_Num_UN._text;s.Ids_Num_UN=t.Ids_Num_UN._text;s.Desc_UN=t.Desc_UN._text;e[o]=s});return e},async _formatDataTipoOper(e){await e.forEach(function(t,o){let s={Id_Num_TipoOper:0,Desc_TipoOper:""};s.Id_Num_TipoOper=t.Id_Num_TipoOper._text;s.Desc_TipoOper=t.Desc_TipoOper._text;e[o]=s});return e},cpUploadPress:function(){let e=this;const t=new XMLSerializer;let s=this.getConfigModel().getProperty("/supplierInputKey");var a=this.oFileUploader.oFileUpload.files[0];let r=this.cboxComboBoxDet.getSelectedKey();let n=this.cboxTipoOper.getSelectedKey();if(r==""||n==""||s==undefined||a==undefined){sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/cartaPorte.uploadMissingDataError"))}else{sap.ui.core.BusyIndicator.show(0);const i=new FormData;i.append("IdsNumUn",r);i.append("TipoOperacion",n);i.append("provid",s);i.append("folio","20");i.append("BControlCargar","enviar");i.append("archivoCartaPorte",a);$.ajax({async:true,url:o.sUrl,method:"POST",headers:{"Access-Control-Allow-Origin":"*"},processData:false,contentType:false,mimeType:"multipart/form-data",data:i,success:function(o){sap.ui.core.BusyIndicator.hide();var s=new sap.ui.model.xml.XMLModel;s.setXML(o);var a=s.getData();var r="";let n=xml2js(t.serializeToString(a.getElementsByTagName("mensajes")[0]),{compact:true});var i=n.mensajes.mensaje;if(i.length!==undefined){i.forEach(function(e){r=r+e._text+"\n\n"});sap.m.MessageBox.alert(r,{icon:sap.m.MessageBox.Icon.INFORMATION,title:e.getOwnerComponent().getModel("appTxts").getProperty("/cartaPorte.ResponseTitle"),actions:[sap.m.MessageBox.Action.OK],emphasizedAction:sap.m.MessageBox.Action.OK})}else{sap.m.MessageBox.alert(i._text,{icon:sap.m.MessageBox.Icon.INFORMATION,title:e.getOwnerComponent().getModel("appTxts").getProperty("/cartaPorte.ResponseTitle"),actions:[sap.m.MessageBox.Action.OK],emphasizedAction:sap.m.MessageBox.Action.OK})}},error:function(){sap.ui.core.BusyIndicator.hide();sap.m.MessageBox.error(e.getOwnerComponent().getModel("appTxts").getProperty("/cartaPorte.uploadError"));e._clearInputs()}})}},_clearInputs(){this.cboxComboBoxDet.setSelectedKey(null);this.cboxTipoOper.setSelectedKey(null);this.oFileUploader.clear()}})});