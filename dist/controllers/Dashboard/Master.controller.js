sap.ui.define(["sap/ui/core/mvc/Controller","demo/controllers/BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","demo/models/formatter","sap/ui/core/date/UI5Date"],function(e,t,a,r,o,s,d){"use strict";const l=new this.CatalogosDashboard;const i=new this.ReporteGralDashboard;const p=new this.ReporteGpoResolutor;const n=new this.ReporteAvgTiempo;const c=new this.ReporteExecComp;var e=t.extend("sap.m.sample.SplitApp.C",{formatter:s,iconTabBar:undefined,cboxAntiguedad:undefined,dateAlta:undefined,dateAltaGr:undefined,dateAltaAvgT:undefined,cboxTipo:undefined,cboxTipoGr:undefined,cboxTipoAvgT:undefined,cboxTipoExecC:undefined,cboxEstatus:undefined,cboxEstatusGr:undefined,cboxEstatusAvgT:undefined,cboxEstatusExecC:undefined,cboxGrupoRes:undefined,cboxEjercicioExecC:undefined,cboxDateIniExecC:undefined,cboxDateFinExecC:undefined,detailData:[],detailDataGR:[],detailDataAVGT:[],donutImporte:undefined,donutCantidad:undefined,barChar:undefined,barCharAvgTRes:undefined,barCharAvgTPend:undefined,onInit:function(){var e=new a;e.setData({today:d.getInstance(new Date)});this.getView().setModel(e);var t=this.byId("idIconTabBar");t.setHeaderMode("Inline");this.configFilterLanguage(this.getView().byId("filterBar"));this.catalogModel=new sap.ui.model.odata.v2.ODataModel(l.sUrl);this.reporteGral=new sap.ui.model.odata.v2.ODataModel(i.sUrl);this.reporteGpoRes=new sap.ui.model.odata.v2.ODataModel(p.sUrl);this.reporteAvgTime=new sap.ui.model.odata.v2.ODataModel(n.sUrl);this.reporteExecComp=new sap.ui.model.odata.v2.ODataModel(c.sUrl);this.iconTabBar=this.getView().byId("idIconTabBar");this.cboxAntiguedad=this.getView().byId("cboxAntiguedad");this.cboxTipo=this.getView().byId("cboxTipo");this.cboxEstatus=this.getView().byId("cboxEstatus");this.dateAlta=this.getView().byId("dateAlta");this.donutImporte=this.getView().byId("donutImporte");this.donutCantidad=this.getView().byId("donutCantidad");this.dateAltaGr=this.getView().byId("dateAltaGR");this.cboxTipoGr=this.getView().byId("cboxTipoGR");this.cboxEstatusGr=this.getView().byId("cboxEstatusGR");this.cboxGrupoRes=this.getView().byId("cboxGrupoRes");this.dateAltaAvgT=this.getView().byId("dateAltaAvgT");this.cboxTipoAvgT=this.getView().byId("cboxTipoAvgT");this.cboxEstatusAvgT=this.getView().byId("cboxEstatusAvgT");this.cboxTipoExecC=this.getView().byId("cboxTipoExecC");this.cboxEstatusExecC=this.getView().byId("cboxEstatusExecC");this.cboxEjercicioExecC=this.getView().byId("cboxEjercicioExecC");this.barChar=this.getView().byId("barChar");this.barCharAvgTRes=this.getView().byId("barCharAvgTRes");this.barCharAvgTPend=this.getView().byId("barCharAvgTPend");this.cboxDateIniExecC=this.getView().byId("cboxDateIniExecC");this.cboxDateFinExecC=this.getView().byId("cboxDateFinExecC");this.onLoadTiposAclaracion();this.onLoadAnalistas();this.onLoadGrupos()},searchData:function(){const e=this.iconTabBar.getSelectedKey();switch(e){case"repGeneral":this.onGeneralRep();break;case"repSolGroup":this.onSolvGroupRep();break;case"repAvgTime":this.onAvgTimeRep();break;case"repCompExec":this.onExecCompRep();break;case"repAclarProv":break;case"repAclarAnalyst":break;default:break}},onLoadTiposAclaracion:function(){var e=this;this.catalogModel.read("/CATACLARACIONESSet",{success:function(t){var r=new a({Tipos:t.results});e.getView().setModel(r,"TiposAclaracion")},error:function(t){sap.m.MessageBox.error(e.getOwnerComponent().getModel("appTxts").getProperty("/dashboard.catalog.tipos"))}})},onLoadAnalistas:function(){var e=this;this.catalogModel.read("/CATANALISTASSet",{success:function(t){var r=new a({Analistas:t.results});e.getView().setModel(r,"AnalistasModel")},error:function(t){sap.m.MessageBox.error(e.getOwnerComponent().getModel("appTxts").getProperty("/dashboard.catalog.analyst"))}})},onLoadGrupos:function(){var e=this;this.catalogModel.read("/CATRESOLUTORESSet",{success:function(t){var r=new a({Grupos:t.results});e.getView().setModel(r,"GruposModel")},error:function(t){sap.m.MessageBox.error(e.getOwnerComponent().getModel("appTxts").getProperty("/dashboard.catalog.resolutores"))}})},onGeneralRep:function(){var e=this;var t=this.getConfigModel().getProperty("/supplierInputKey");var s=this.cboxAntiguedad.getSelectedKey();var d=this.dateAlta.getDateValue();var l=this.dateAlta.getSecondDateValue();var i=this.cboxTipo.getSelectedKey();var p=this.cboxEstatus.getSelectedKey();var n=[];if(d!==""&&d!==null&&d!==undefined&&l!==""&&l!==null&&l!==undefined){n.push(new r("Fechaalta",o.BT,d,l))}else{sap.m.MessageBox.error(e.getOwnerComponent().getModel("appTxts").getProperty("/dashboard.error.dates"));return}if(t!==undefined&&t!==null&&t!==""){n.push(new r("Acreedor",o.EQ,t))}if(s!==null&&s!==""&&s!==undefined){n.push(new r("Antiguedad",o.EQ,s))}if(i!==null&&i!==""&&i!==undefined){n.push(new r("Tipo",o.EQ,i))}if(p!==null&&p!==""&&p!==undefined){n.push(new r("Estatus",o.EQ,p))}this.reporteGral.read("/DASHMAINSet",{method:"GET",urlParameters:{$expand:"TOTALESNAV,DETALLESNAV"},filters:n,success:function(t){if(t.results[0].TOTALESNAV.results.length>0){let s=Intl.NumberFormat("en-US");var r=t.results[0].TOTALESNAV.results[0];e.detailData=t.results[0].DETALLESNAV.results;r.Cantpagadas=s.format(parseFloat(r.Cantpagadas).toFixed(2));r.Cantpendientes=s.format(parseFloat(r.Cantpendientes).toFixed(2));r.Cantrecibidas=s.format(parseFloat(r.Cantrecibidas).toFixed(2));r.Cantresueltas=s.format(parseFloat(r.Cantresueltas).toFixed(2));r.Importepagadas=s.format(parseFloat(r.Importepagadas).toFixed(2));r.Importependientes=s.format(parseFloat(r.Importependientes).toFixed(2));r.Importerecibidas=s.format(parseFloat(r.Importerecibidas).toFixed(2));r.Importeresueltas=s.format(parseFloat(r.Importeresueltas).toFixed(2));r.Porcentajependientes=parseFloat(r.Porcentajependientes);r.Porcentajeresueltas=parseFloat(r.Porcentajeresueltas);var o=new a(r);e.getView().setModel(o,"CardsModel")}else{sap.m.MessageBox.error(e.getOwnerComponent().getModel("appTxts").getProperty("/dashboard.error.data"))}},error:function(t){sap.m.MessageBox.error(e.getOwnerComponent().getModel("appTxts").getProperty("/dashboard.error.dates"))}})},onSolvGroupRep:function(){var e=this;var t=this.dateAltaGr.getDateValue();var s=this.dateAltaGr.getSecondDateValue();var d=this.cboxTipoGr.getSelectedKey();var l=this.cboxEstatusGr.getSelectedKey();var i=this.cboxGrupoRes.getSelectedKey();var p=this.getConfigModel().getProperty("/supplierInputKey");var n=[];if(t!==""&&t!==null&&t!==undefined&&s!==""&&s!==null&&s!==undefined){n.push(new r("Fechaalta",o.BT,t,s))}else{sap.m.MessageBox.error(e.getOwnerComponent().getModel("appTxts").getProperty("/dashboard.error.dates"));return}if(d!==null&&d!==""&&d!==undefined){n.push(new r("Tipo",o.EQ,d))}if(l!==null&&l!==""&&l!==undefined){n.push(new r("Estatus",o.EQ,l))}if(i!==null&&i!==""&&i!==undefined){n.push(new r("Gporesolutor",o.EQ,i))}if(p!==undefined&&p!==null&&p!==""){n.push(new r("Acreedor",o.EQ,p))}this.reporteGpoRes.read("/DASHMAINSet",{method:"GET",urlParameters:{$expand:"TOTALESNAV,DETALLESNAV"},filters:n,success:function(t){if(t.results[0].TOTALESNAV.results.length>0){var r=t.results[0].TOTALESNAV.results;e.detailDataGR=t.results[0].DETALLESNAV.results;var o=new a({oData:r});e.getView().setModel(o,"GpoResModel")}else{sap.m.MessageBox.error(e.getOwnerComponent().getModel("appTxts").getProperty("/dashboard.error.data"))}},error:function(t){sap.m.MessageBox.error(e.getOwnerComponent().getModel("appTxts").getProperty("/dashboard.error.execute"))}})},onAvgTimeRep:function(){var e=this;var t=this.dateAltaAvgT.getDateValue();var s=this.dateAltaAvgT.getSecondDateValue();var d=this.cboxTipoAvgT.getSelectedKey();var l=this.cboxEstatusAvgT.getSelectedKey();var i=this.getConfigModel().getProperty("/supplierInputKey");var p=[];if(t!==""&&t!==null&&t!==undefined&&s!==""&&s!==null&&s!==undefined){p.push(new r("Fechaalta",o.BT,t,s))}else{sap.m.MessageBox.error(e.getOwnerComponent().getModel("appTxts").getProperty("/dashboard.error.dates"));return}if(d!==null&&d!==""&&d!==undefined){p.push(new r("Tipo",o.EQ,d))}if(l!==null&&l!==""&&l!==undefined){p.push(new r("Estatus",o.EQ,l))}if(i!==undefined&&i!==null&&i!==""){p.push(new r("Acreedor",o.EQ,i))}this.reporteAvgTime.read("/DASHMAINSet",{method:"GET",urlParameters:{$expand:"TOTALESNAV,DETALLESNAV"},filters:p,success:function(t){if(t.results[0].TOTALESNAV.results.length>0){console.log(t);var r=t.results[0].TOTALESNAV.results;e.detailDataAVGT=t.results[0].DETALLESNAV.results;var o=new a({oData:r});e.getView().setModel(o,"AvgTimeModel")}else{sap.m.MessageBox.error(e.getOwnerComponent().getModel("appTxts").getProperty("/dashboard.error.data"))}},error:function(t){sap.m.MessageBox.error(e.getOwnerComponent().getModel("appTxts").getProperty("/dashboard.error.execute"))}})},onExecCompRep:function(){var e=this;var t=this.getConfigModel().getProperty("/supplierInputKey");var s=this.cboxTipoExecC.getSelectedKey();var d=this.cboxEstatusExecC.getSelectedKey();var l=this.cboxEjercicioExecC.getSelectedKey();var i=this.cboxDateIniExecC.getSelectedKey();var p=this.cboxDateFinExecC.getSelectedKey();var n=[];if(l!==undefined&&l!==null&&l!==""){n.push(new r("Ejercicio",o.EQ,l))}else{sap.m.MessageBox.error(e.getOwnerComponent().getModel("appTxts").getProperty("/dashboard.error.year"));return}if(i!==undefined&&i!==null&&i!==""&&p!==undefined&&p!==null&&p!==""){n.push(new r("Mes",o.BT,i,p))}if(t!==undefined&&t!==null&&t!==""){n.push(new r("Acreedor",o.EQ,t))}if(s!==null&&s!==""&&s!==undefined){n.push(new r("Tipo",o.EQ,s))}if(d!==null&&d!==""&&d!==undefined){n.push(new r("Estatus",o.EQ,d))}this.reporteExecComp.read("/DASHMAINSet",{method:"GET",urlParameters:{$expand:"TOTALESNAV,DETALLESEJERCICIONAV,DETALLESEJERMESNAV"},filters:n,success:function(t){if(t.results[0].TOTALESNAV.results.length>0){console.log(t);let s=Intl.NumberFormat("en-US");var r=t.results[0].TOTALESNAV.results[0];var o=new a({oData:r});e.getView().setModel(o,"CardsModelExec")}else{sap.m.MessageBox.error(e.getOwnerComponent().getModel("appTxts").getProperty("/dashboard.error.data"))}},error:function(t){sap.m.MessageBox.error(e.getOwnerComponent().getModel("appTxts").getProperty("/dashboard.error.execute"))}})},downloadExcelGralRep:function(){if(this.detailData.length>0){var e=this;var t=this.getOwnerComponent().getModel("appTxts");var a=this.donutCantidad.getSelectedSegments();var r=this.donutImporte.getSelectedSegments();var o=[];var s=[{label:t.getProperty("/dashboard.repGeneral.excel.proveedor"),property:"Proveedor",type:sap.ui.export.EdmType.Number,width:12},{label:t.getProperty("/dashboard.repGeneral.excel.razonsocial"),property:"Razonsocial",width:40},{label:t.getProperty("/dashboard.repGeneral.excel.fechaalta"),property:"Fechaalta",type:sap.ui.export.EdmType.Date,format:"dddd, d.mmmm yyyy",width:30},{label:t.getProperty("/dashboard.repGeneral.excel.fechasolucion"),property:"Fechasolucion",type:sap.ui.export.EdmType.Date,format:"dddd, d.mmmm yyyy",width:30},{label:t.getProperty("/dashboard.repGeneral.excel.tipo"),property:["Tipo","Desctipo"],template:"{0} {1}",width:26},{label:t.getProperty("/dashboard.repGeneral.excel.estatus"),property:"Estatus",width:10},{label:t.getProperty("/dashboard.repGeneral.excel.grupo"),property:"Grupo",width:25},{label:t.getProperty("/dashboard.repGeneral.excel.totalrecla"),property:"Totalreclamado",type:sap.ui.export.EdmType.Number,delimiter:true,scale:2,width:20},{label:t.getProperty("/dashboard.repGeneral.excel.totalaclarado"),property:"Totalaclarado",type:sap.ui.export.EdmType.Number,delimiter:true,scale:2,width:20},{label:t.getProperty("/dashboard.repGeneral.excel.importepagado"),property:"Importepagado",type:sap.ui.export.EdmType.Number,delimiter:true,scale:2,width:20},{label:t.getProperty("/dashboard.repGeneral.excel.diasantiguedad"),property:"Diasantiguedad",type:sap.ui.export.EdmType.Number,width:21}];if(a.length===0&&r.length===0||a.length===2&&r.length===2){this.buildExcelSpreadSheet(s,this.detailData,"Reporte Dashboard de Aclaraciones.xlsx")}else{const d=a.concat(r);let l=[];if(d.length>0){d.forEach(function(e){if(e.getLabel()===t.getProperty("/dashboard.card.title.porcetajePend")||e.getLabel()===t.getProperty("/dashboard.card.title.impPend")){o.push("E")}else{o.push("H")}});let a=[...new Set(o)];a.forEach(function(t){let a=e.detailData.filter(e=>e.Estatus===t);l=l.concat(a)});if(l.length>0){this.buildExcelSpreadSheet(s,l,"Reporte Dashboard de Aclaraciones.xlsx")}else{sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/dashboard.excel.error.data"))}}}}else{sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/dashboard.excel.error.data"))}},onDownloadExcelGpoRes:function(){if(this.detailDataGR.length>0){var e=this;var t=this.getOwnerComponent().getModel("appTxts");var a=this.barChar.getSelectedBars();var r=[{label:t.getProperty("/dashboard.repGeneral.excel.grupo"),property:"Nombregrupo",width:25},{label:t.getProperty("/dashboard.repGeneral.excel.proveedor"),property:"Proveedor",type:sap.ui.export.EdmType.Number,width:12},{label:t.getProperty("/dashboard.repGeneral.excel.razonsocial"),property:"Razonsocial",width:40},{label:t.getProperty("/dashboard.repGeneral.excel.fechaalta"),property:"Fechaalta",type:sap.ui.export.EdmType.Date,format:"dddd, d.mmmm yyyy",width:30},{label:t.getProperty("/dashboard.repGpoRes.excel.fechaasignacion"),property:"Fechaasignacion",type:sap.ui.export.EdmType.Date,format:"dddd, d.mmmm yyyy",width:30},{label:t.getProperty("/dashboard.repGeneral.excel.fechasolucion"),property:"Fechasolucion",type:sap.ui.export.EdmType.Date,format:"dddd, d.mmmm yyyy",width:30},{label:t.getProperty("/dashboard.repGeneral.excel.tipo"),property:["Tipo","Desctipo"],template:"{0} {1}",width:26},{label:t.getProperty("/dashboard.repGpoRes.excel.folio"),property:"Folio",width:26},{label:t.getProperty("/dashboard.repGeneral.excel.totalrecla"),property:"Totalreclamado",type:sap.ui.export.EdmType.Number,delimiter:true,scale:2,width:20},{label:t.getProperty("/dashboard.repGeneral.excel.estatus"),property:"Estatus",width:10},{label:t.getProperty("/dashboard.repGpoRes.excel.analista"),property:"Analista",width:25},{label:t.getProperty("/dashboard.repGeneral.excel.diasantiguedad"),property:"Antiguedad",type:sap.ui.export.EdmType.Number,width:21}];if(a.length===0||a.length===this.barChar.getBars().length){this.buildExcelSpreadSheet(r,this.detailDataGR,"Reporte Dashboard Grupo Resolutor.xlsx")}else{let t=[];a.forEach(function(a){var r=a.getLabel().split(":")[0];let o=e.detailDataGR.filter(e=>e.Nombregrupo===r);t=t.concat(o)});this.buildExcelSpreadSheet(r,t,"Reporte Dashboard Grupo Resolutor.xlsx")}}else{sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/dashboard.excel.error.data"))}},onDownloadExcelAvgT:function(){if(this.detailDataAVGT.length>0){var e=this;var t=this.getOwnerComponent().getModel("appTxts");let r=this.barCharAvgTRes.getSelectedBars();let o=this.barCharAvgTPend.getSelectedBars();var a=[{label:t.getProperty("/dashboard.repGeneral.excel.proveedor"),property:"Proveedor",type:sap.ui.export.EdmType.Number,width:12},{label:t.getProperty("/dashboard.repGeneral.excel.razonsocial"),property:"Razonsocial",width:40},{label:t.getProperty("/dashboard.repGeneral.excel.tipo"),property:["Tipo","Desctipo"],template:"{0} {1}",width:26},{label:t.getProperty("/dashboard.repGeneral.excel.estatus"),property:"Estatus",width:10},{label:t.getProperty("/dashboard.repGeneral.excel.fechaalta"),property:"Fechaalta",type:sap.ui.export.EdmType.Date,format:"dddd, d.mmmm yyyy",width:30},{label:t.getProperty("/dashboard.repGpoRes.excel.fechaasignacion"),property:"Fechaasignacion",type:sap.ui.export.EdmType.Date,format:"dddd, d.mmmm yyyy",width:30},{label:t.getProperty("/dashboard.repGeneral.excel.fechasolucion"),property:"Fechasolucion",type:sap.ui.export.EdmType.Date,format:"dddd, d.mmmm yyyy",width:30},{label:t.getProperty("/dashboard.repGeneral.excel.grupo"),property:"Nombregrupo",width:25},{label:t.getProperty("/dashboard.repGpoRes.excel.analista"),property:"Analista",width:25},{label:t.getProperty("/dashboard.repGeneral.excel.totalrecla"),property:"Totalreclamado",type:sap.ui.export.EdmType.Number,delimiter:true,scale:2,width:20},{label:t.getProperty("/dashboard.repGeneral.excel.totalaclarado"),property:"Totalaclarado",type:sap.ui.export.EdmType.Number,delimiter:true,scale:2,width:20},{label:t.getProperty("/dashboard.repGeneral.excel.diasantiguedad"),property:"Antiguedad",type:sap.ui.export.EdmType.Number,width:21}];if(r.length===0&&o===0||r.length===this.barCharAvgTRes.getBars().length&&o.length===this.selectedPend.getBars().length){this.buildExcelSpreadSheet(a,this.detailDataAVGT,"Reporte Dashboard Tiempo Promedio de Resolución.xlsx")}else{let t=[];r.forEach(function(a){var r=a.getLabel().split(":")[0];let o=e.detailDataAVGT.filter(e=>e.Tipo===r&&e.Estatus==="H");t=t.concat(o)});o.forEach(function(a){var r=a.getLabel().split(":")[0];let o=e.detailDataAVGT.filter(e=>e.Tipo===r&&e.Estatus==="E");t=t.concat(o)});this.buildExcelSpreadSheet(a,t,"Reporte Dashboard Tiempo Promedio de Resolución.xlsx")}}else{sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/dashboard.excel.error.data"))}}});return e});