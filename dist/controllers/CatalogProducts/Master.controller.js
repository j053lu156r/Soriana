sap.ui.define(["demo/controllers/BaseController","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator","demo/models/formatterCatPrd","sap/ui/core/BusyIndicator","sap/ui/export/library","sap/ui/export/Spreadsheet","sap/ui/core/util/Export","sap/ui/core/util/ExportTypeCSV"],function(e,t,r,a,o,n,i,p,l,s,g,d){"use strict";var c=l.EdmType;return e.extend("demo.controllers.CatalogProducts.Master",{onInit:function(){},onAfterRendering(){var e=this.getView().getModel("configSite").getData();console.log(e.supplierInputKey);if(e.supplierInputKey!==undefined){this.SearchDivision()}this.SearchFTienda();this.SearchTSurtido()},buscarD:function(){console.log("buscarD");var e=this;console.log(e.getView().byId("Ftienda").getValue());if(e.getView().byId("supplierInput").getValue()===""){sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/visor.SearchError"));return false}if(e.getView().byId("Ftienda").getValue()===""){sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/visor.ftiendaError"));return false}if(e.getView().byId("Ftienda").getValue()!=="HIPER"){e.busqueda_multiple()}else{e.busqueda_multiple()}},searchData:function(){console.log("searchData");if(!this.hasAccess(48)){return false}var e=this;var t=e.getView().getModel("configSite").getData();if(e.getView().byId("supplierInput").getValue()===""){sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/visor.SearchError"));return false}if(e.getView().byId("Ftienda").getValue()===""){sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/visor.ftiendaError"));return false}var r=[];r.push(new sap.ui.model.Filter({path:"Vendor",operator:sap.ui.model.FilterOperator.EQ,value1:t.supplierInputKey}));if(e.getView().byId("FDivision").getSelectedKey()!==""){r.push(new sap.ui.model.Filter({path:"Node",operator:sap.ui.model.FilterOperator.EQ,value1:e.getView().byId("FDivision").getSelectedKey()}))}if(e.getView().byId("Fsurtido").getSelectedKey()!==""){r.push(new sap.ui.model.Filter({path:"Dismm",operator:sap.ui.model.FilterOperator.EQ,value1:e.getView().byId("Fsurtido").getSelectedKey()}))}if(e.getView().byId("Ftienda").getSelectedKey()!==""){r.push(new sap.ui.model.Filter({path:"EkorgT001w",operator:sap.ui.model.FilterOperator.EQ,value1:e.getView().byId("Ftienda").getSelectedKey()}))}if(e.getView().byId("SKU").getValue()!==""){r.push(new sap.ui.model.Filter({path:"Ean11",operator:sap.ui.model.FilterOperator.EQ,value1:e.getView().byId("SKU").getValue()}))}var a="ZOSP_MMPI_MATNR_LIST_SRV";var o="LIFNR_MATNR_LIST";var n="";var i=r;var p="";sap.ui.core.BusyIndicator.show();e._GEToDataV2(a,o,i,n,p).then(function(t){sap.ui.core.BusyIndicator.hide();var r=t.data.results;console.log(r);if(r.length>0){const t=new sap.ui.model.json.JSONModel(r);e.getView().setModel(t,"ModelTP");e.DescargarLog();e.getView().byId("FDivision").setSelectedKey("");e.getView().byId("Fsurtido").setSelectedKey("");e.getView().byId("Ftienda").setSelectedKey("");e.getView().byId("SKU").setValue("")}else{sap.m.MessageBox.error("busqueda sin resultados")}})},busqueda_multiple:function(){var e=[];var t=[];var r=this;var a=r.getView().getModel("configSite").getData();var o=5e3,n=0;e.push(new sap.ui.model.Filter({path:"Vendor",operator:sap.ui.model.FilterOperator.EQ,value1:a.supplierInputKey}));if(r.getView().byId("FDivision").getSelectedKey()!==""){e.push(new sap.ui.model.Filter({path:"Node",operator:sap.ui.model.FilterOperator.EQ,value1:r.getView().byId("FDivision").getSelectedKey()}))}if(r.getView().byId("Fsurtido").getSelectedKey()!==""){e.push(new sap.ui.model.Filter({path:"Dismm",operator:sap.ui.model.FilterOperator.EQ,value1:r.getView().byId("Fsurtido").getSelectedKey()}))}if(r.getView().byId("Ftienda").getSelectedKey()!==""){e.push(new sap.ui.model.Filter({path:"EkorgT001w",operator:sap.ui.model.FilterOperator.EQ,value1:r.getView().byId("Ftienda").getSelectedKey()}))}if(r.getView().byId("SKU").getValue()!==""){e.push(new sap.ui.model.Filter({path:"Ean11",operator:sap.ui.model.FilterOperator.EQ,value1:r.getView().byId("SKU").getValue()}))}var i=[];var p="ZOSP_MMPI_MATNR_LIST_SRV";var l="LIFNR_MATNR_LIST";var s="";var g=e;sap.ui.core.BusyIndicator.show();var d=0;c(0);function c(e){var t=new Promise((e,t)=>{var a=[];r._GEToDataV2(p,l,g,s,o,n).then(function(t){a=t.data.results;d=Number(a[0].Zcount);console.log(a);if(a.length>0){i.push(a)}e(a)});n=n+5e3});var a=new Promise((e,t)=>{var a=[];r._GEToDataV2(p,l,g,s,o,n).then(function(t){a=t.data.results;console.log(a);if(a.length>0){i.push(a)}e(a)});n=n+5e3});var u=new Promise((e,t)=>{var a=[];r._GEToDataV2(p,l,g,s,o,n).then(function(t){a=t.data.results;console.log(a);if(a.length>0){i.push(a)}e(a)});n=n+5e3});var y=new Promise((e,t)=>{var a=[];r._GEToDataV2(p,l,g,s,o,n).then(function(t){a=t.data.results;console.log(a);if(a.length>0){i.push(a)}e(a)});n=n+5e3});Promise.all([t,a,u,y]).then(t=>{e=e+2e4;console.log(t);console.log(i);console.log(e);if(e<d){console.log(e);c(e)}else{var a=[];for(var o=0;o<i.length;o++){for(var n=0;n<i[o].length;n++){a.push(i[o][n])}}console.log(a);r.getView().byId("FDivision").setSelectedKey("");r.getView().byId("Fsurtido").setSelectedKey("");r.getView().byId("Ftienda").setSelectedKey("");r.getView().byId("SKU").setValue("");const e=new sap.ui.model.json.JSONModel(a);r.getView().setModel(e,"ModelTP");console.log(r.getView().getModel("ModelTP").getData());r.DescargarLog();sap.ui.core.BusyIndicator.hide()}}).catch(e=>{console.log(e)})}},SearchDivision:function(){var e=this;var t=e.getView().getModel("configSite").getData();var r=[];r.push(new sap.ui.model.Filter({path:"Vendor",operator:sap.ui.model.FilterOperator.EQ,value1:t.supplierInputKey.toString()}));var a="ZOSP_MMPI_MATNR_LIST_SRV";var o="DIV_MATGRP_LIST";var n="";var i=r;var p="";sap.ui.core.BusyIndicator.show();e._GEToDataV2(a,o,i,n,p).then(function(t){sap.ui.core.BusyIndicator.hide();var r=t.data.results;console.log(r);const a=new sap.ui.model.json.JSONModel(r);e.getView().setModel(a,"Division")})},SearchFTienda:function(){var e=this;var t="ZOSP_MMPI_MATNR_LIST_SRV";var r="EKORG_LIST";var a="";var o="";var n="";sap.ui.core.BusyIndicator.show();e._GEToDataV2(t,r,o,a,n).then(function(t){sap.ui.core.BusyIndicator.hide();var r=t.data.results;console.log(r);const a=new sap.ui.model.json.JSONModel(r);e.getView().setModel(a,"Tienda")})},SearchTSurtido:function(){var e=this;var t="ZOSP_MMPI_MATNR_LIST_SRV";var r="DISMM_LIST";var a="";var o="";var n="";sap.ui.core.BusyIndicator.show();e._GEToDataV2(t,r,o,a,n).then(function(t){sap.ui.core.BusyIndicator.hide();var r=t.data.results;const a=new sap.ui.model.json.JSONModel(r);e.getView().setModel(a,"Surtido")})},createColumnConfig:function(){var e=this;var t=e.getView().getModel("ModelTP").getData(),r=[];console.log(t);var a=this.getOwnerComponent().getModel("appTxts");r.push({label:a.getProperty("/CatagProd.Exc1"),type:c.String,property:"Node"});r.push({label:a.getProperty("/CatagProd.Exc2"),type:c.String,property:"Ltext"});r.push({label:a.getProperty("/CatagProd.Exc3"),type:c.String,property:"MatGrp"});r.push({label:a.getProperty("/CatagProd.Exc14"),type:c.String,property:"Wgbez"});r.push({label:a.getProperty("/CatagProd.Exc1"),type:c.String,property:"BrandDescr"});r.push({label:a.getProperty("/CatagProd.Exc2"),type:c.String,property:"BrandId"});r.push({label:a.getProperty("/CatagProd.Exc3"),type:c.String,property:"Dismm"});r.push({label:a.getProperty("/CatagProd.Exc4"),type:c.String,property:"Ean11"});r.push({label:a.getProperty("/CatagProd.Exc5"),type:c.String,property:"InfoRec"});r.push({label:a.getProperty("/CatagProd.Exc7"),type:c.String,property:"Maktx"});r.push({label:a.getProperty("/CatagProd.Exc9"),type:c.String,property:"Material"});r.push({label:a.getProperty("/CatagProd.Exc11"),type:c.String,property:"Node02"});r.push({label:a.getProperty("/CatagProd.Exc12"),type:c.String,property:"Vendor"});r.push({label:a.getProperty("/CatagProd.Exc13"),type:c.String,property:"Werks"});return r},buildExportpiechart:function(){var e,t,r,a;e=this.createColumnConfig();t=this.getView().getModel("ModelTP").getData();console.log(t);r={workbook:{columns:e},dataSource:t,fileName:"prueba"};a=new s(r);a.build().then(function(){}).finally(a.destroy)},DescargarLog:sap.m.Table.prototype.exportData||function(){var e=this.getView().getModel("ModelTP");let t=this.getOwnerComponent().getModel("appTxts");var r=this.getView().getModel("configSite").getData();var a={name:t.getProperty("/CatagProd.Exc1"),template:{content:"{Node}"}};var o={name:t.getProperty("/CatagProd.Exc2"),template:{content:"{Ltext}"}};var n={name:t.getProperty("/CatagProd.Exc3"),template:{content:"{MatGrp}"}};var i={name:t.getProperty("/CatagProd.Exc4"),template:{content:"{Wgbez}"}};var p={name:t.getProperty("/CatagProd.Exc5"),template:{content:"{NodeSeg}"}};var l={name:t.getProperty("/CatagProd.Exc6"),template:{content:"{LtextSeg}"}};var s={name:t.getProperty("/CatagProd.Exc7"),template:{content:"{BrandId}"}};var c={name:t.getProperty("/CatagProd.Exc8"),template:{content:"{BrandDescr}"}};var u={name:t.getProperty("/CatagProd.Exc9"),template:{content:"'{Ean11}"}};var y={name:t.getProperty("/CatagProd.Exc10"),template:{content:"{Maktx}"}};var m={name:t.getProperty("/CatagProd.Exc11"),template:{content:"{Werks}"}};var v={name:t.getProperty("/CatagProd.Exc12"),template:{content:"{Name1}"}};var P={name:t.getProperty("/CatagProd.Exc13"),template:{content:"{EkorgT001w}"}};var h={name:t.getProperty("/CatagProd.Exc14"),template:{content:"{EkorgEine}"}};var w={name:t.getProperty("/CatagProd.Exc15"),template:{content:"{Kbetr}"}};var S={name:t.getProperty("/CatagProd.Exc16"),template:{content:"{Konwa}"}};var E={name:t.getProperty("/CatagProd.Exc17"),template:{content:"{KbetrDto1}"}};var V={name:t.getProperty("/CatagProd.Exc18"),template:{content:"{KbetrDto2}"}};var I={name:t.getProperty("/CatagProd.Exc19"),template:{content:"{KbetrDto3}"}};var b={name:t.getProperty("/CatagProd.Exc20"),template:{content:"{KbetrDto4}"}};var x={name:t.getProperty("/CatagProd.Exc21"),template:{content:"{KbetrDtoad}"}};var f={name:t.getProperty("/CatagProd.Exc22"),template:{content:"{Bonificacion}"}};var C={name:t.getProperty("/CatagProd.Exc23"),template:{content:"{KbetrCargo}"}};var M={name:t.getProperty("/CatagProd.Exc24"),template:{content:"{Netpr}"}};var F={name:t.getProperty("/CatagProd.Exc25"),template:{content:"{Umrez}"}};var T={name:t.getProperty("/CatagProd.Exc26"),template:{content:"{Meins}"}};var D={name:t.getProperty("/CatagProd.Exc27"),template:{content:"'{Ean11Codemp}"}};var K={name:t.getProperty("/CatagProd.Exc28"),template:{content:"{KbetrCtoUni}"}};var _={name:t.getProperty("/CatagProd.Exc29"),template:{content:"{Zterm}"}};var O={name:t.getProperty("/CatagProd.Exc30"),template:{content:"{Text1}"}};var B={name:t.getProperty("/CatagProd.Exc31"),template:{content:"{Dismm}"}};var N={name:t.getProperty("/CatagProd.Exc32"),template:{content:"{Dibez}"}};var R={name:t.getProperty("/CatagProd.Exc33"),template:{content:"{Bwscl}"}};var L={name:t.getProperty("/CatagProd.Exc34"),template:{content:"{BwsclDesc}"}};var G=new g({exportType:new d({fileExtension:"csv",separatorChar:";"}),models:e,rows:{path:"/"},columns:[a,o,n,i,p,l,s,c,u,y,m,v,P,h,w,S,E,V,I,b,x,f,C,M,F,T,D,K,_,O,B,N,R,L]});var Q=r.supplierInputKey;if(this.getView().byId("FDivision").getSelectedKey()!==""){Q=Q+"-"+this.getView().byId("FDivision").getValue()}if(this.getView().byId("Fsurtido").getSelectedKey()!==""){Q=Q+"-"+this.getView().byId("Fsurtido").getValue()}if(this.getView().byId("Ftienda").getSelectedKey()!==""){Q=Q+"-"+this.getView().byId("Ftienda").getValue()}if(this.getView().byId("SKU").getValue()!==""){Q=Q+"-"+this.getView().byId("SKU").getValue()}G.saveFile(Q).catch(function(e){}).then(function(){G.destroy()})}})});