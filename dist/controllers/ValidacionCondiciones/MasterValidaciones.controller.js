sap.ui.define(["demo/controllers/BaseController","sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/f/library","sap/ui/table/RowAction","sap/ui/table/RowActionItem","sap/ui/table/RowSettings","sap/ui/export/library","sap/ui/export/Spreadsheet"],function(e,t,a,r,i,o,l,d,p){"use strict";var s=d.EdmType;return e.extend("demo.controllers.ValidacionCondiciones.MasterValidaciones",{onInit:function(){$(document).ready(function(){$(document).on("focus",":input",function(){$(this).attr("autocomplete","off")})});this.VisibleTable()},searchData2:function(){var e=this;var t="/sap/opu/odata/sap/ZOSP_MEJOR_COND_REP_SRV/RepMejorCondSet";if(this.getView().byId("supplierInput").getValue()!==""){t=t+"?$filter=(IAcre eq '"+this.getView().byId("supplierInput").getValue().split("-")[0].trim().padStart(10,0)+"'"}else{sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/ValCondi.ErrorPRoveedor"));return}if(e.getView().byId("IDSerie").getValue()!==""){t=t+"and ISerie eq '"+e.getView().byId("IDSerie").getValue()+"'"}if(e.getView().byId("IDFolio").getValue()!==""){t=t+" and IFolio eq '"+e.getView().byId("IDFolio").getValue()+"'"}if(e.getView().byId("dateRange").getValue()!==""){if(e.getView().byId("dateRange").getValue().split("-")[1].trim()===e.getView().byId("dateRange").getValue().split("-")[0].trim()){var a=e.getView().byId("dateRange").getDateValue();var r=e.getView().byId("dateRange").getDateValue()}else{var a=e.getView().byId("dateRange").getDateValue();var r=e.getView().byId("dateRange").getSecondDateValue()}t=t+"and (IFe ge '"+a.toISOString().slice(0,10).replaceAll("-","")+"' and IFe le '"+r.toISOString().slice(0,10).replaceAll("-","")+"')"}t=t+")";sap.ui.core.BusyIndicator.show();e._GEToDataV2ajax(t).then(function(t){sap.ui.core.BusyIndicator.hide();function a(e,t,a){return a.indexOf(e)===t}var r=t.d.results;const i=[];for(var o=0;o<r.length;o++){const e=r[o];let t=false;for(var l=0;l<i.length;l++){if(Number(i[l].TeSalida.Cmsucfol)===Number(e.TeSalida.Cmsucfol)&&Number(i[l].TeSalida.Posicion)===Number(e.TeSalida.Posicion)){t=true;break}}if(!t){i.push(e)}}i.sort((e,t)=>{if(Number(e.TeSalida.Cmsucfol)===Number(t.TeSalida.Cmsucfol)){return 0}if(Number(e.TeSalida.Cmsucfol)<Number(t.TeSalida.Cmsucfol)){return-1}return 1});var d=i.map(function(e){return e.TeSalida.Cmsucfol}).filter(a).map(function(e,t){return{key:t,value:e}});for(var p=0;p<d.length;p++){var s=0;var g=0;var n=0;var u=0;var b=0;var y=0;var V=0;var c=0;var S=0;var m=0;var C=0;var I=0;var w=0;var T=0;var P=0;var M=0;var f=0;var h=0;var N=0;for(var F=0;F<i.length;F++){if(i[F].TeSalida.Cmsucfol===d[p].value){s=s+Number(i[F].TeSalida.CantidadSap);g=g+Number(i[F].TeSalida.Cantidad);n=n+Number(i[F].TeSalida.MejorCantidad);y=y+Number(i[F].TeSalida.PrecCDescSap);b=b+Number(i[F].TeSalida.PrecioUnSi);u=u+Number(i[F].TeSalida.MejorPrecio);V=V+Number(i[F].TeSalida.ImporteSap);c=c+Number(i[F].TeSalida.ImporteTotal);S=S+Number(i[F].TeSalida.MejorSubtotal);m=m+Number(i[F].TeSalida.ImpuestosSap);C=C+Number(i[F].TeSalida.ImpuestosFact);I=I+Number(i[F].TeSalida.ImpuestosTotal);w=w+Number(i[F].TeSalida.ImpTotCImpSap);T=T+Number(i[F].TeSalida.ImporteTotCi);P=P+Number(i[F].TeSalida.MejorTotal);M=M+Number(i[F].TeSalida.NcargoMc);f=f+Number(i[F].TeSalida.NcargoImpMc);h=h+Number(i[F].TeSalida.NcargoTotMc);N=d[p].value}}var v={EMsj:"P",IAcre:"",ICmsu:"",IDocmat:"",IEsta:"",IFe:"",IFolio:"",INe:"",IPedi:"",ISerie:"",TeSalida:{Cantidad:g.toFixed(2),CantidadSap:s.toFixed(2),Cmsucfol:N,DescEstat:"",DocCargo:"",DocCompra:"",DocFactura:"",DocMaterial:"",EanUpc:"",Estatus:"",FechaRegSap:"",FecharSap:"",FolionEntrada:"",ImpTotCImpSap:w.toFixed(2),ImporteSap:V.toFixed(2),ImporteTotCi:T.toFixed(2),ImporteTotal:c.toFixed(2),ImpuestosFact:C.toFixed(2),ImpuestosSap:m.toFixed(2),ImpuestosTotal:I.toFixed(2),Lifnr:"",Material:"",MaterialSap:"",MejorCantidad:n.toFixed(2),MejorPrecio:u.toFixed(2),MejorSubtotal:S.toFixed(2),MejorTotal:P.toFixed(2),NcargoImpMc:f.toFixed(2),NcargoMc:M.toFixed(2),NcargoTotMc:h.toFixed(2),Posicion:"",PrecCDescSap:y.toFixed(2),PrecioUnSi:b.toFixed(2),Serfol:"",UmedidaPSap:"",Unidad:""}};i.push(v)}i.sort((e,t)=>{if(e.TeSalida.Cmsucfol===t.TeSalida.Cmsucfol){return 0}if(e.TeSalida.Cmsucfol<t.TeSalida.Cmsucfol){return-1}return 1});var D=new sap.ui.model.json.JSONModel(i);e.getView().setModel(D,"ModelValidacion")})},VisibleTable:function(){var e=this;e.oModel=new a({A:true,B:false,C:true,D:false,E:false,F:false,G:false,H:true,I:false,J:false,K:false,L:false,M:true,N:true,O:true,P:true,Q:false,R:false,S:false,T:false,U:true,V:true,W:true,X:true,Y:true,Z:true,AA:true,BB:true,CC:true,DD:true,EE:true,FF:true,GG:true,HH:false,II:true});e.getView().setModel(e.oModel);e.TableVisible()},TableVisible:function(){var e=this;e.getView().byId("A").setVisible(e.getView().getModel().getProperty("/A"));e.getView().byId("B").setVisible(e.getView().getModel().getProperty("/B"));e.getView().byId("C").setVisible(e.getView().getModel().getProperty("/C"));e.getView().byId("D").setVisible(e.getView().getModel().getProperty("/D"));e.getView().byId("E").setVisible(e.getView().getModel().getProperty("/E"));e.getView().byId("F").setVisible(e.getView().getModel().getProperty("/F"));e.getView().byId("G").setVisible(e.getView().getModel().getProperty("/G"));e.getView().byId("H").setVisible(e.getView().getModel().getProperty("/H"));e.getView().byId("I").setVisible(e.getView().getModel().getProperty("/I"));e.getView().byId("J").setVisible(e.getView().getModel().getProperty("/J"));e.getView().byId("K").setVisible(e.getView().getModel().getProperty("/K"));e.getView().byId("L").setVisible(e.getView().getModel().getProperty("/L"));e.getView().byId("M").setVisible(e.getView().getModel().getProperty("/M"));e.getView().byId("N").setVisible(e.getView().getModel().getProperty("/N"));e.getView().byId("O").setVisible(e.getView().getModel().getProperty("/O"));e.getView().byId("P").setVisible(e.getView().getModel().getProperty("/P"));e.getView().byId("Q").setVisible(e.getView().getModel().getProperty("/Q"));e.getView().byId("R").setVisible(e.getView().getModel().getProperty("/R"));e.getView().byId("S").setVisible(e.getView().getModel().getProperty("/S"));e.getView().byId("T").setVisible(e.getView().getModel().getProperty("/T"));e.getView().byId("U").setVisible(e.getView().getModel().getProperty("/U"));e.getView().byId("V").setVisible(e.getView().getModel().getProperty("/V"));e.getView().byId("W").setVisible(e.getView().getModel().getProperty("/W"));e.getView().byId("X").setVisible(e.getView().getModel().getProperty("/X"));e.getView().byId("Y").setVisible(e.getView().getModel().getProperty("/Y"));e.getView().byId("Z").setVisible(e.getView().getModel().getProperty("/Z"));e.getView().byId("AA").setVisible(e.getView().getModel().getProperty("/AA"));e.getView().byId("BB").setVisible(e.getView().getModel().getProperty("/BB"));e.getView().byId("CC").setVisible(e.getView().getModel().getProperty("/CC"));e.getView().byId("DD").setVisible(e.getView().getModel().getProperty("/DD"));e.getView().byId("EE").setVisible(e.getView().getModel().getProperty("/EE"));e.getView().byId("FF").setVisible(e.getView().getModel().getProperty("/FF"));e.getView().byId("GG").setVisible(e.getView().getModel().getProperty("/GG"));e.getView().byId("HH").setVisible(e.getView().getModel().getProperty("/HH"));e.getView().byId("II").setVisible(e.getView().getModel().getProperty("/II"))},ConfigTable:function(){var e=this;var t=e.getView().byId("dinamicTableVC");if(!t){t=sap.ui.xmlfragment(e.getView().getId(),"demo.views.ValidacionCondiciones.Fragment.optionVC",this);e.getView().addDependent(t);e.getView().byId("dinamicTableVC").addStyleClass(e.getOwnerComponent().getContentDensityClass())}t.open()},ClosepopUp:function(){var e=this;e.TableVisible();e.getView().byId("dinamicTableVC").close()},onParentClicked:function(e){var t=e.getParameter("selected");this.oModel.setData({A:t,B:t,C:t,D:t,E:t,F:t,G:t,H:t,I:t,J:t,K:t,L:t,M:t,N:t,O:t,P:t,Q:t,R:t,S:t,T:t,U:t,V:t,W:t,X:t,Y:t,Z:t,AA:t,BB:t,CC:t,DD:t,EE:t,FF:t,GG:t,HH:t,II:t,JJ:t})},genereteRowAction:function(){var e=this.getOwnerComponent().getModel("appTxts");var t=this.byId("tableVisor");var a=t.getRowActionTemplate();if(a){a.destroy();a=null}a=new i({items:[new o({icon:"sap-icon://open-command-field",text:e.getProperty("/global.view"),press:e=>this.onPress(e)})]});t.setRowActionTemplate(a);t.setRowActionCount(2)},createColumnConfig:function(){var e=this;var t=e.getView().getModel("migoModel").getData(),a=[];var r=this.getOwnerComponent().getModel("appTxts");a.push({label:r.getProperty("/ValCondi.headerOrden"),type:s.String,property:"TeSalida/DocCompra"});a.push({label:r.getProperty("/ValCondi.headerPosicion"),type:s.String,property:"TeSalida/Posicion"});a.push({label:r.getProperty("/ValCondi.headerNE"),type:s.String,property:"TeSalida/FolionEntrada"});a.push({label:r.getProperty("/ValCondi.headerEntradaMercancia"),type:s.String,property:"TeSalida/DocMaterial"});a.push({label:r.getProperty("/ValCondi.headerRegFactura"),type:s.String,property:"TeSalida/DocFactura"});a.push({label:r.getProperty("/ValCondi.folioCargo"),type:s.String,property:"TeSalida/DocCargo"});a.push({label:r.getProperty("/ValCondi.refInterna"),type:s.Number,property:"TeSalida/Cmsucfol"});a.push({label:r.getProperty("/ValCondi.EAN"),type:s.String,property:"TeSalida/EanUpc"});a.push({label:r.getProperty("/ValCondi.mterialRecibo"),type:s.String,property:"TeSalida/MaterialSap"});a.push({label:r.getProperty("/ValCondi.fechaRecibo"),type:s.String,property:"TeSalida/FecharSap"});a.push({label:r.getProperty("/ValCondi.unidadRecibo"),type:s.String,property:"TeSalida/UmedidaPSap"});a.push({label:r.getProperty("/ValCondi.cantidadRecibo"),type:s.Number,property:"TeSalida/CantidadSap"});a.push({label:r.getProperty("/ValCondi.costoRecibo"),type:s.Number,property:"TeSalida/PrecCDescSap"});a.push({label:r.getProperty("/ValCondi.subtotalRecibo"),type:s.Number,property:"TeSalida/ImporteSap"});a.push({label:r.getProperty("/ValCondi.impuestosRecibo"),type:s.Number,property:"TeSalida/ImpuestosSap"});a.push({label:r.getProperty("/ValCondi.totalRecibo"),type:s.Number,property:"TeSalida/ImpTotCImpSap"});a.push({label:r.getProperty("/ValCondi.recepcionCFDI"),type:s.String,property:"TeSalida/FechaRegSap"});a.push({label:r.getProperty("/ValCondi.factura"),type:s.String,property:"TeSalida/Serfol"});a.push({label:r.getProperty("/ValCondi.materialCFDI"),type:s.String,property:"TeSalida/Material"});a.push({label:r.getProperty("/ValCondi.unidadMedida"),type:s.String,property:"TeSalida/Unidad"});a.push({label:r.getProperty("/ValCondi.cantidadCFDI"),type:s.Number,property:"TeSalida/Cantidad"});a.push({label:r.getProperty("/ValCondi.costoCFDI"),type:s.Number,property:"TeSalida/PrecioUnSi"});a.push({label:r.getProperty("/ValCondi.subtotalCFDI"),type:s.Number,property:"TeSalida/ImporteTotal"});a.push({label:r.getProperty("/ValCondi.impuestosCFDI"),type:s.Number,property:"TeSalida/ImpuestosFact"});a.push({label:r.getProperty("/ValCondi.totalCFDI"),type:s.Number,property:"TeSalida/ImporteTotCi"});a.push({label:r.getProperty("/ValCondi.cantidadMC"),type:s.Number,property:"TeSalida/MejorCantidad"});a.push({label:r.getProperty("/ValCondi.costoMC"),type:s.Number,property:"TeSalida/MejorPrecio"});a.push({label:r.getProperty("/ValCondi.subtotalMC"),type:s.Number,property:"TeSalida/MejorSubtotal"});a.push({label:r.getProperty("/ValCondi.impuestosMC"),type:s.Number,property:"TeSalida/ImpuestosTotal"});a.push({label:r.getProperty("/ValCondi.totalMC"),type:s.Number,property:"TeSalida/MejorTotal"});a.push({label:r.getProperty("/ValCondi.subtotalNC"),type:s.Number,property:"TeSalida/NcargoMc"});a.push({label:r.getProperty("/ValCondi.impuestosNC"),type:s.Number,property:"TeSalida/NcargoImpMc"});a.push({label:r.getProperty("/ValCondi.totalNC"),type:s.Number,property:"TeSalida/NcargoTotMc"});a.push({label:r.getProperty("/ValCondi.Estatus"),type:s.String,property:"TeSalida/Estatus"});a.push({label:r.getProperty("/ValCondi.Estatus"),type:s.String,property:"TeSalida/DescEstat"});return a},buildExportTable:function(){var e,t,a,r,i,o=this;if(!o._oTable){o._oTable=this.byId("tableValidacion")}i=o._oTable;t=i.getBinding().oList;e=o.createColumnConfig();a={workbook:{columns:e,hierarchyLevel:"Level"},dataSource:t,fileName:"Validador de Condiciones",worker:false};r=new p(a);r.build().finally(function(){r.destroy()})}})});