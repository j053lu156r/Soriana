sap.ui.define(["demo/controllers/BaseController","sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/f/library","sap/ui/table/RowAction","sap/ui/table/RowActionItem","sap/ui/table/RowSettings","sap/ui/export/library","sap/ui/export/Spreadsheet"],function(e,t,r,a,i,o,l,p,d){"use strict";var s=p.EdmType;return e.extend("demo.controllers.ValidacionCondiciones.MasterValidaciones",{onInit:function(){$(document).ready(function(){$(document).on("focus",":input",function(){$(this).attr("autocomplete","off")})});this.VisibleTable()},searchData2:function(){var e=this;var t="/sap/opu/odata/sap/ZOSP_MEJOR_COND_REP_SRV/RepMejorCondSet";if(this.getView().byId("supplierInput").getValue()!==""){t=t+"?$filter=(IAcre eq '"+this.getView().byId("supplierInput").getValue().split("-")[0].trim().padStart(10,0)+"'"}else{sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/ValCondi.ErrorPRoveedor"));return}if(e.getView().byId("IDSerie").getValue()!==""){t=t+"and ISerie eq '"+e.getView().byId("IDSerie").getValue()+"'"}if(e.getView().byId("IDFolio").getValue()!==""){t=t+" and IFolio eq '"+e.getView().byId("IDFolio").getValue()+"'"}if(e.getView().byId("dateRange").getValue()!==""){if(e.getView().byId("dateRange").getValue().split("-")[1].trim()===e.getView().byId("dateRange").getValue().split("-")[0].trim()){var r=e.getView().byId("dateRange").getDateValue();var a=e.getView().byId("dateRange").getDateValue()}else{var r=e.getView().byId("dateRange").getDateValue();var a=e.getView().byId("dateRange").getSecondDateValue()}t=t+"and (IFe ge '"+r.toISOString().slice(0,10).replaceAll("-","")+"' and IFe le '"+a.toISOString().slice(0,10).replaceAll("-","")+"')"}t=t+")";sap.ui.core.BusyIndicator.show();e._GEToDataV2ajax(t).then(function(t){sap.ui.core.BusyIndicator.hide();function r(e,t,r){return r.indexOf(e)===t}var a=t.d.results;const i=a;i.sort((e,t)=>{if(Number(e.TeSalida.Cmsucfol)===Number(t.TeSalida.Cmsucfol)){return 0}if(Number(e.TeSalida.Cmsucfol)<Number(t.TeSalida.Cmsucfol)){return-1}return 1});var o=i.map(function(e){return e.TeSalida.Cmsucfol}).filter(r).map(function(e,t){return{key:t,value:e}});for(var l=0;l<o.length;l++){var p=0;var d=0;var s=0;var g=0;var n=0;var y=0;var u=0;var b=0;var V=0;var S=0;var c=0;var I=0;var m=0;var C=0;var T=0;var w=0;var P=0;var M=0;var f=0;for(var h=0;h<i.length;h++){if(i[h].TeSalida.Cmsucfol===o[l].value){p=p+Number(i[h].TeSalida.CantidadSap);d=d+Number(i[h].TeSalida.Cantidad);s=s+Number(i[h].TeSalida.MejorCantidad);y=y+Number(i[h].TeSalida.PrecCDescSap);n=n+Number(i[h].TeSalida.PrecioUnSi);g=g+Number(i[h].TeSalida.MejorPrecio);u=u+Number(i[h].TeSalida.ImporteSap);b=b+Number(i[h].TeSalida.ImporteTotal);V=V+Number(i[h].TeSalida.MejorSubtotal);S=S+Number(i[h].TeSalida.ImpuestosSap);c=c+Number(i[h].TeSalida.ImpuestosFact);I=I+Number(i[h].TeSalida.ImpuestosTotal);m=m+Number(i[h].TeSalida.ImpTotCImpSap);C=C+Number(i[h].TeSalida.ImporteTotCi);T=T+Number(i[h].TeSalida.MejorTotal);w=w+Number(i[h].TeSalida.NcargoMc);P=P+Number(i[h].TeSalida.NcargoImpMc);M=M+Number(i[h].TeSalida.NcargoTotMc);f=o[l].value}}var N={EMsj:"P",IAcre:"",ICmsu:"",IDocmat:"",IEsta:"",IFe:"",IFolio:"",INe:"",IPedi:"",ISerie:"",TeSalida:{Cantidad:d.toFixed(2),CantidadSap:p.toFixed(2),Cmsucfol:f,DescEstat:"",DocCargo:"",DocCompra:"",DocFactura:"",DocMaterial:"",EanUpc:"",Estatus:"",FechaRegSap:"",FecharSap:"",FolionEntrada:"",ImpTotCImpSap:m.toFixed(2),ImporteSap:u.toFixed(2),ImporteTotCi:C.toFixed(2),ImporteTotal:b.toFixed(2),ImpuestosFact:c.toFixed(2),ImpuestosSap:S.toFixed(2),ImpuestosTotal:I.toFixed(2),Lifnr:"",Material:"",MaterialSap:"",MejorCantidad:s.toFixed(2),MejorPrecio:g.toFixed(2),MejorSubtotal:V.toFixed(2),MejorTotal:T.toFixed(2),NcargoImpMc:P.toFixed(2),NcargoMc:w.toFixed(2),NcargoTotMc:M.toFixed(2),Posicion:"",PrecCDescSap:y.toFixed(2),PrecioUnSi:n.toFixed(2),Serfol:"",UmedidaPSap:"",Unidad:""}};i.push(N)}i.sort((e,t)=>{if(e.TeSalida.Cmsucfol===t.TeSalida.Cmsucfol){return 0}if(e.TeSalida.Cmsucfol<t.TeSalida.Cmsucfol){return-1}return 1});var v=new sap.ui.model.json.JSONModel(i);e.getView().setModel(v,"ModelValidacion")})},VisibleTable:function(){var e=this;e.oModel=new r({A:true,B:false,C:true,D:false,E:false,F:false,G:false,H:true,I:false,J:false,K:false,L:false,M:true,N:true,O:true,P:true,Q:false,R:false,S:false,T:false,U:true,V:true,W:true,X:true,Y:true,Z:true,AA:true,BB:true,CC:true,DD:true,EE:true,FF:true,GG:true,HH:false,II:true});e.getView().setModel(e.oModel);e.TableVisible()},TableVisible:function(){var e=this;e.getView().byId("A").setVisible(e.getView().getModel().getProperty("/A"));e.getView().byId("B").setVisible(e.getView().getModel().getProperty("/B"));e.getView().byId("C").setVisible(e.getView().getModel().getProperty("/C"));e.getView().byId("D").setVisible(e.getView().getModel().getProperty("/D"));e.getView().byId("E").setVisible(e.getView().getModel().getProperty("/E"));e.getView().byId("F").setVisible(e.getView().getModel().getProperty("/F"));e.getView().byId("G").setVisible(e.getView().getModel().getProperty("/G"));e.getView().byId("H").setVisible(e.getView().getModel().getProperty("/H"));e.getView().byId("I").setVisible(e.getView().getModel().getProperty("/I"));e.getView().byId("J").setVisible(e.getView().getModel().getProperty("/J"));e.getView().byId("K").setVisible(e.getView().getModel().getProperty("/K"));e.getView().byId("L").setVisible(e.getView().getModel().getProperty("/L"));e.getView().byId("M").setVisible(e.getView().getModel().getProperty("/M"));e.getView().byId("N").setVisible(e.getView().getModel().getProperty("/N"));e.getView().byId("O").setVisible(e.getView().getModel().getProperty("/O"));e.getView().byId("P").setVisible(e.getView().getModel().getProperty("/P"));e.getView().byId("Q").setVisible(e.getView().getModel().getProperty("/Q"));e.getView().byId("R").setVisible(e.getView().getModel().getProperty("/R"));e.getView().byId("S").setVisible(e.getView().getModel().getProperty("/S"));e.getView().byId("T").setVisible(e.getView().getModel().getProperty("/T"));e.getView().byId("U").setVisible(e.getView().getModel().getProperty("/U"));e.getView().byId("V").setVisible(e.getView().getModel().getProperty("/V"));e.getView().byId("W").setVisible(e.getView().getModel().getProperty("/W"));e.getView().byId("X").setVisible(e.getView().getModel().getProperty("/X"));e.getView().byId("Y").setVisible(e.getView().getModel().getProperty("/Y"));e.getView().byId("Z").setVisible(e.getView().getModel().getProperty("/Z"));e.getView().byId("AA").setVisible(e.getView().getModel().getProperty("/AA"));e.getView().byId("BB").setVisible(e.getView().getModel().getProperty("/BB"));e.getView().byId("CC").setVisible(e.getView().getModel().getProperty("/CC"));e.getView().byId("DD").setVisible(e.getView().getModel().getProperty("/DD"));e.getView().byId("EE").setVisible(e.getView().getModel().getProperty("/EE"));e.getView().byId("FF").setVisible(e.getView().getModel().getProperty("/FF"));e.getView().byId("GG").setVisible(e.getView().getModel().getProperty("/GG"));e.getView().byId("HH").setVisible(e.getView().getModel().getProperty("/HH"));e.getView().byId("II").setVisible(e.getView().getModel().getProperty("/II"))},ConfigTable:function(){var e=this;var t=e.getView().byId("dinamicTableVC");if(!t){t=sap.ui.xmlfragment(e.getView().getId(),"demo.views.ValidacionCondiciones.Fragment.optionVC",this);e.getView().addDependent(t);e.getView().byId("dinamicTableVC").addStyleClass(e.getOwnerComponent().getContentDensityClass())}t.open()},ClosepopUp:function(){var e=this;e.TableVisible();e.getView().byId("dinamicTableVC").close()},onParentClicked:function(e){var t=e.getParameter("selected");this.oModel.setData({A:t,B:t,C:t,D:t,E:t,F:t,G:t,H:t,I:t,J:t,K:t,L:t,M:t,N:t,O:t,P:t,Q:t,R:t,S:t,T:t,U:t,V:t,W:t,X:t,Y:t,Z:t,AA:t,BB:t,CC:t,DD:t,EE:t,FF:t,GG:t,HH:t,II:t,JJ:t})},genereteRowAction:function(){var e=this.getOwnerComponent().getModel("appTxts");var t=this.byId("tableVisor");var r=t.getRowActionTemplate();if(r){r.destroy();r=null}r=new i({items:[new o({icon:"sap-icon://open-command-field",text:e.getProperty("/global.view"),press:e=>this.onPress(e)})]});t.setRowActionTemplate(r);t.setRowActionCount(2)},createColumnConfig:function(){var e=this;var t=e.getView().getModel("migoModel").getData(),r=[];var a=this.getOwnerComponent().getModel("appTxts");r.push({label:a.getProperty("/ValCondi.headerOrden"),type:s.String,property:"TeSalida/DocCompra"});r.push({label:a.getProperty("/ValCondi.headerPosicion"),type:s.String,property:"TeSalida/Posicion"});r.push({label:a.getProperty("/ValCondi.headerNE"),type:s.String,property:"TeSalida/FolionEntrada"});r.push({label:a.getProperty("/ValCondi.headerEntradaMercancia"),type:s.String,property:"TeSalida/DocMaterial"});r.push({label:a.getProperty("/ValCondi.headerRegFactura"),type:s.String,property:"TeSalida/DocFactura"});r.push({label:a.getProperty("/ValCondi.folioCargo"),type:s.String,property:"TeSalida/DocCargo"});r.push({label:a.getProperty("/ValCondi.refInterna"),type:s.Number,property:"TeSalida/Cmsucfol"});r.push({label:a.getProperty("/ValCondi.EAN"),type:s.String,property:"TeSalida/EanUpc"});r.push({label:a.getProperty("/ValCondi.mterialRecibo"),type:s.String,property:"TeSalida/MaterialSap"});r.push({label:a.getProperty("/ValCondi.fechaRecibo"),type:s.String,property:"TeSalida/FecharSap"});r.push({label:a.getProperty("/ValCondi.unidadRecibo"),type:s.String,property:"TeSalida/UmedidaPSap"});r.push({label:a.getProperty("/ValCondi.cantidadRecibo"),type:s.Number,property:"TeSalida/CantidadSap"});r.push({label:a.getProperty("/ValCondi.costoRecibo"),type:s.Number,property:"TeSalida/PrecCDescSap"});r.push({label:a.getProperty("/ValCondi.subtotalRecibo"),type:s.Number,property:"TeSalida/ImporteSap"});r.push({label:a.getProperty("/ValCondi.impuestosRecibo"),type:s.Number,property:"TeSalida/ImpuestosSap"});r.push({label:a.getProperty("/ValCondi.totalRecibo"),type:s.Number,property:"TeSalida/ImpTotCImpSap"});r.push({label:a.getProperty("/ValCondi.recepcionCFDI"),type:s.String,property:"TeSalida/FechaRegSap"});r.push({label:a.getProperty("/ValCondi.factura"),type:s.String,property:"TeSalida/Serfol"});r.push({label:a.getProperty("/ValCondi.materialCFDI"),type:s.String,property:"TeSalida/Material"});r.push({label:a.getProperty("/ValCondi.unidadMedida"),type:s.String,property:"TeSalida/Unidad"});r.push({label:a.getProperty("/ValCondi.cantidadCFDI"),type:s.Number,property:"TeSalida/Cantidad"});r.push({label:a.getProperty("/ValCondi.costoCFDI"),type:s.Number,property:"TeSalida/PrecioUnSi"});r.push({label:a.getProperty("/ValCondi.subtotalCFDI"),type:s.Number,property:"TeSalida/ImporteTotal"});r.push({label:a.getProperty("/ValCondi.impuestosCFDI"),type:s.Number,property:"TeSalida/ImpuestosFact"});r.push({label:a.getProperty("/ValCondi.totalCFDI"),type:s.Number,property:"TeSalida/ImporteTotCi"});r.push({label:a.getProperty("/ValCondi.cantidadMC"),type:s.Number,property:"TeSalida/MejorCantidad"});r.push({label:a.getProperty("/ValCondi.costoMC"),type:s.Number,property:"TeSalida/MejorPrecio"});r.push({label:a.getProperty("/ValCondi.subtotalMC"),type:s.Number,property:"TeSalida/MejorSubtotal"});r.push({label:a.getProperty("/ValCondi.impuestosMC"),type:s.Number,property:"TeSalida/ImpuestosTotal"});r.push({label:a.getProperty("/ValCondi.totalMC"),type:s.Number,property:"TeSalida/MejorTotal"});r.push({label:a.getProperty("/ValCondi.subtotalNC"),type:s.Number,property:"TeSalida/NcargoMc"});r.push({label:a.getProperty("/ValCondi.impuestosNC"),type:s.Number,property:"TeSalida/NcargoImpMc"});r.push({label:a.getProperty("/ValCondi.totalNC"),type:s.Number,property:"TeSalida/NcargoTotMc"});r.push({label:a.getProperty("/ValCondi.Estatus"),type:s.String,property:"TeSalida/Estatus"});r.push({label:a.getProperty("/ValCondi.Estatus"),type:s.String,property:"TeSalida/DescEstat"});r.push({label:a.getProperty("/reporte.sucursal"),type:s.String,property:"TeSalida/Centro"});r.push({label:a.getProperty("/reporte.subtXML"),type:s.String,property:"TeSalida/SubtotalXML"});r.push({label:a.getProperty("/reporte.totalXML"),type:s.String,property:"TeSalida/TotalXML"});r.push({label:a.getProperty("/reporte.difXML"),type:s.String,property:"TeSalida/DifAddenda"});r.push({label:a.getProperty("/reporte.tasaIvaXML"),type:s.String,property:"TeSalida/TivaXML"});r.push({label:a.getProperty("/reporte.tasaIepsXML"),type:s.String,property:"TeSalida/TiepsXML"});r.push({label:a.getProperty("/reporte.tasaIvaSap"),type:s.String,property:"TeSalida/TivaSAP"});r.push({label:a.getProperty("/reporte.tasaIepsSap"),type:s.String,property:"TeSalida/TiepsSap"});r.push({label:a.getProperty("/reporte.difImp"),type:s.String,property:"TeSalida/DifImpuestos"});r.push({label:a.getProperty("/reporte.NoEAN"),type:s.String,property:"TeSalida/NoExisteEAN"});r.push({label:a.getProperty("/reporte.proveedorMsj"),type:s.String,property:"TeSalida/MsjProv"});return r},buildExportTable:function(){var e,t,r,a,i,o=this;if(!o._oTable){o._oTable=this.byId("tableValidacion")}i=o._oTable;t=i.getBinding().oList;e=o.createColumnConfig();r={workbook:{columns:e,hierarchyLevel:"Level"},dataSource:t,fileName:"Validador de Condiciones",worker:false};a=new d(r);a.build().finally(function(){a.destroy()})}})});