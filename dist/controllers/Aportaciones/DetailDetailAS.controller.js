sap.ui.define(["sap/ui/model/json/JSONModel","demo/controllers/BaseController","sap/m/PDFViewer","sap/m/MessageBox"],function(e,t,o,i){"use strict";var a=new this.Aportaciones;return t.extend("demo.controllers.Aportaciones.DetailDetailAS",{onInit:function(){this._pdfViewer=new o;this.getView().addDependent(this._pdfViewer);var e=this.getView().byId("exitFullScreenBtn"),t=this.getView().byId("enterFullScreenBtn");this.oRouter=this.getOwnerComponent().getRouter();this.oModel=this.getOwnerComponent().getModel();this.oRouter.getRoute("detailAportacionesAS").attachPatternMatched(this._onDocumentMatched,this);this.oRouter.getRoute("detailAportacionesComplemento").attachPatternMatched(this._onDocumentMatchedComplemento,this);this.oRouter.getRoute("detailAportacionesFactoraje").attachPatternMatched(this._onDocumentMatchedFactoraje,this);[e,t].forEach(function(e){e.addEventDelegate({onAfterRendering:function(){if(this.bFocusFullScreenButton){this.bFocusFullScreenButton=false;e.focus()}}.bind(this)})},this)},handleItemPress:function(e){},handleFullScreen:function(){this.bFocusFullScreenButton=true;var e=this.oModel.getProperty("/actionButtonsInfo/endColumn/fullScreen");var t=this.oModel.getProperty("/actionButtonsInfo/midColumn/fullScreen");if(this._vistaAnteior=="COMPLEMENTOS"){this.oRouter.navTo("detailAportacionesComplemento",{layout:e,document:this._folio})}else{this.oRouter.navTo("detailAportacionesAS",{layout:t,folio:this._folio,view:this._view})}},handleExitFullScreen:function(){this.bFocusFullScreenButton=true;var e=this.oModel.getProperty("/actionButtonsInfo/endColumn/exitFullScreen");var t="";if(this._vistaAnteior=="COMPLEMENTOS"){this.oRouter.navTo("detailAportacionesComplemento",{layout:e,document:this._folio})}else if(this._vistaAnteior=="FACTORAJE"){this.oRouter.navTo("detailAportacionesFactoraje",{layout:e,document:this._folio})}else{this.oRouter.navTo("detailAportacionesAS",{layout:this._layout,folio:this._folio,view:this._view})}},handleClose:function(){if(this._vistaAnteior=="COMPLEMENTOS"){this.oRouter.navTo("detailComplPagos",{layout:sap.f.LayoutType.TwoColumnsMidExpanded,document:this._doc,sociedad:this._sociedad,ejercicio:this._ejercicio,fecha:this._fecha})}else if(this._vistaAnteior=="FACTORAJE"){this.oRouter.navTo("detailFactoring",{layout:sap.f.LayoutType.TwoColumnsMidExpanded,document:this._doc,sociedad:this._sociedad,ejercicio:this._ejercicio,fecha:this._fecha})}else{this.oRouter.navTo("EstadoCuenta",{})}},_onDocumentMatched:function(t){this._vistaAnteior="ESTADO_CUENTA";this._folio=t.getParameter("arguments").document||this._folio||"0";this._layout=t.getParameter("arguments").layout||this._layout||"0";this._view=t.getParameter("arguments").view||this._view||"0";this._bukrs=t.getParameter("arguments").bukrs||this._bukrs||"0";this._belnr=t.getParameter("arguments").belnr||this._belnr||"0";this._gjahr=t.getParameter("arguments").gjahr||this._gjahr||"0";var o="AportaSet?$expand=AportaDet&$filter=IOption eq '1'";if(this._folio!=""&&this._folio!=null){o+=" and IFolio eq '"+this._folio+"'"}a.getJsonModelAsync(o,function(t,o){var i=t.getProperty("/results/0");if(i!=null){o.getOwnerComponent().setModel(new e(i.AportaDet.results[0]),"AportaDetDet")}},function(e){},this)},_onDocumentMatchedComplemento:function(e){var t=this;this._vistaAnteior="COMPLEMENTOS";this._folio=e.getParameter("arguments").document||this._folio||"0";this._layout=e.getParameter("arguments").layout||this._layout||"0";this._view=e.getParameter("arguments").view||this._view||"0";this._sociedad=e.getParameter("arguments").sociedad||this._sociedad||"0";this._fecha=e.getParameter("arguments").fecha||this._fecha||"0";this._ejercicio=e.getParameter("arguments").ejercicio||this._ejercicio||"0";this._doc=e.getParameter("arguments").doc||this._doc||"0";var o=[];o.push(new sap.ui.model.Filter({path:"IOption",operator:sap.ui.model.FilterOperator.EQ,value1:"1"}));if(this._folio!=""&&this._folio!=null){o.push(new sap.ui.model.Filter({path:"IFolio",operator:sap.ui.model.FilterOperator.EQ,value1:this._folio}))}var i="ZOSP_APORTA_SRV";var a="AportaSet";var s="AportaDet";var r=o;var n="";sap.ui.core.BusyIndicator.show();t._GEToDataV2(i,a,r,s).then(function(e){sap.ui.core.BusyIndicator.hide();var o=e.data.results[0];console.log(o);if(o.EError==="X"){sap.m.MessageBox.error(o.EDescripEvent,{onClose:function(e){t.handleClose()}})}if(o!=null){var i=new sap.ui.model.json.JSONModel(o.AportaDet.results[0]);t.getView().setModel(i,"AportaDetDet")}})},_onDocumentMatchedFactoraje:function(e){var t=this;this._vistaAnteior="FACTORAJE";this._folio=e.getParameter("arguments").document||this._folio||"0";this._layout=e.getParameter("arguments").layout||this._layout||"0";this._view=e.getParameter("arguments").view||this._view||"0";this._sociedad=e.getParameter("arguments").sociedad||this._sociedad||"0";this._fecha=e.getParameter("arguments").fecha||this._fecha||"0";this._ejercicio=e.getParameter("arguments").ejercicio||this._ejercicio||"0";this._doc=e.getParameter("arguments").doc||this._doc||"0";var o=[];o.push(new sap.ui.model.Filter({path:"IOption",operator:sap.ui.model.FilterOperator.EQ,value1:"1"}));if(this._folio!=""&&this._folio!=null){o.push(new sap.ui.model.Filter({path:"IFolio",operator:sap.ui.model.FilterOperator.EQ,value1:this._folio}))}var i="ZOSP_APORTA_SRV";var a="AportaSet";var s="AportaDet";var r=o;var n="";sap.ui.core.BusyIndicator.show();t._GEToDataV2(i,a,r,s).then(function(e){sap.ui.core.BusyIndicator.hide();var o=e.data.results[0];console.log(o);if(o.EError==="X"){sap.m.MessageBox.error(o.EDescripEvent,{onClose:function(e){t.handleClose()}})}if(o!=null){var i=new sap.ui.model.json.JSONModel(o.AportaDet.results[0]);t.getView().setModel(i,"AportaDetDet")}})},onPressPDF:function(){var e=this.getOwnerComponent().getModel("AportaDetDet");var t=e.getData();var o="/sap/opu/odata/sap/ZOSP_APORTA_SRV/";var i=o+"AportaFilesSet('"+t.Uuid+"')/$value";this._pdfViewer.setSource(i);this._pdfViewer.setTitle("CFDI");this._pdfViewer.open()},onPressXML:function(){var e=this.getOwnerComponent().getModel("AportaDetDet");var t=e.getData();var o="/sap/opu/odata/sap/ZOSP_APORTA_SRV/";var e=new sap.ui.model.odata.ODataModel(o);e.read("/AportaFilesSet('XML"+t.Uuid+"')/$value",{method:"GET",success:function(e,o){let i=t.Uuid;let a="application/xml";let s=o.body;sap.ui.core.util.File.save(s,i,"xml",a)},error:function(e){i.error(e.message)}})}})});