sap.ui.define(["sap/ui/model/json/JSONModel","demo/controllers/BaseController","sap/ui/core/mvc/Controller"],function(e,t){"use strict";var o=new this.MyInbox;return t.extend("demo.controllers.MiBandeja.Releases.Detail",{onInit:function(){console.log("3");var e=this.getView().byId("exitFullScreenBtn"),t=this.getView().byId("enterFullScreenBtn");this.oRouter=this.getOwnerComponent().getRouter();this.oModel=this.getOwnerComponent().getModel();this.oRouter.getRoute("detailRelease").attachPatternMatched(this._onDocumentMatched,this);var o=this.byId("dateRange");[e,t].forEach(function(e){e.addEventDelegate({onAfterRendering:function(){if(this.bFocusFullScreenButton){this.bFocusFullScreenButton=false;e.focus()}}.bind(this)})},this);console.log(this.getOwnerComponent().getModel("userdata"))},handleFullScreen:function(){this.bFocusFullScreenButton=true;var e=this.oModel.getProperty("/actionButtonsInfo/midColumn/fullScreen");this.oRouter.navTo("detailRelease",{layout:e,releaseId:this._release})},handleExitFullScreen:function(){this.bFocusFullScreenButton=true;var e=this.oModel.getProperty("/actionButtonsInfo/midColumn/exitFullScreen");this.oRouter.navTo("detailRelease",{layout:e,releaseId:this._release})},handleClose:function(){var e=this.oModel.getProperty("/actionButtonsInfo/midColumn/closeColumn");this.oRouter.navTo("masterRelease",{layout:e})},_onDocumentMatched:function(e){this._release=e.getParameter("arguments").releaseId||this._release||"0";var t=this.getOwnerComponent().getModel("userdata").getProperty("/IMail");var a=o.getJsonModel("/headInboxSet?$expand=ETATTACHNAV,ZTTSP_MENSPROVSet&$filter=IOption eq '4'"+" and IMail eq '"+t+"'"+" and IIdmen eq '"+this._release+"'");if(a!=null){var s=a.getProperty("/results/0");this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(s),"release");this.paginate("release","/ZTTSP_MENSPROVSet",1,0)}},editRelease:function(){if(!this.hasAccess(49)){return}var e=this.getOwnerComponent().getModel("release").getProperty("/ESdmens/Ztext");var t=this.getView().byId("message").getValue();var a=this.getView().byId("dateRange");var s=this.getOwnerComponent().getModel("userdata");var n=s.getProperty("/IMail");var r=s.getProperty("/EIdusua");var i=this.getView().byId("attacheds");var l=this.getView().getModel();var u=[];var d=this.getOwnerComponent().getModel("release").getProperty("/ETATTACHNAV");var c={IOption:"6",IIdusua:r,IAllpro:"",ISdate:"",IEdate:"",IIdmen:this._release,IFmail:"",ISubject:e,IText:t,ITPROVNAV:[],ITATTACNAV:[]};var h=o.create("/headInboxSet",c);if(h!=null){if(h.ESuccess=="X"){sap.m.MessageBox.success("Se ha modificado el comunicado.",{actions:[sap.m.MessageBox.Action.CLOSE],emphasizedAction:sap.m.MessageBox.Action.CLOSE,onClose:function(e){this.goToMainRelease();this.clearFields()}.bind(this)})}else{if(h.mensaje!=null){sap.m.MessageBox.error(h.mensaje)}else{sap.m.MessageBox.error("Ocurrio un error")}}}else{sap.m.MessageBox.error("No se pudo conectar con el servidor, intente nuevamente.")}},goToMainRelease:function(){this.oRouter.navTo("masterRelease")},formatDateQuote:function(e){if(e){jQuery.sap.require("sap.ui.core.format.DateFormat");var t=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"});var o=new Date(e);o.setDate(o.getDate()+1);return o}else{return null}},downloadAttach:function(e,t,o){switch(t){default:var a=this.buildBlob(e,t);var s=o.split(".");var n=s.length;var r=s[n-1];sap.ui.core.util.File.save(a,s[0],r,t);break}},pdfView:function(e,t){var o=this.buildBlobUrl(e,t);if(!this._PDFViewer){this.createPDFView(o)}else{if(this._PDFViewer.getSource()!==o){this._PDFViewer=null}this.createPDFView(o)}this._PDFViewer.open()},createPDFView:function(e){this._PDFViewer=new sap.m.PDFViewer({width:"auto",source:e});jQuery.sap.addUrlWhitelist("blob")}})});