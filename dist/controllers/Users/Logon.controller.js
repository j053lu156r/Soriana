sap.ui.define(["jquery.sap.global","sap/ui/core/mvc/Controller","demo/controllers/BaseController","sap/ui/core/Fragment","sap/m/MessageToast","sap/ui/model/json/JSONModel"],function(e,t,o,s,r,a){"use strict";var i=new UserModel;return o.extend("demo.controllers.Users.Logon",{getRouter:function(){return sap.ui.core.UIComponent.getRouterFor(this)},onInit:function(){var e=this.getOwnerComponent().getModel("appTxts").getProperty("/logon.llucer");var t=this.getOwnerComponent().getModel("appTxts").getProperty("/logon.pas");sap.ui.core.BusyIndicator.show(0);sap.ui.core.BusyIndicator.hide();var o=this.getView().byId("logon_user");var s=this.getView().byId("logon_pass");this.getView().addEventDelegate({onBeforeShow:function(e){o.setValue("");s.setValue("");this.getView().byId("logon_user").setValueState(sap.ui.core.ValueState.None);this.getConfigModel().setProperty("/barVisible",false)}},this);o.attachBrowserEvent("keydown",function(e){if(e.keyCode===13){e.preventDefault();if(s.getValue()===""){s.focus()}}},this);s.attachBrowserEvent("keydown",function(e){if(e.keyCode===13){e.preventDefault();this.sendLogin()}},this)},onAfterRendering:function(e){this.cargaParams()},cargaParams:function(){var e="X";sap.ui.getCore().getConfiguration().getFormatSettings().setLegacyNumberFormat(e)},onExit:function(){if(this._oDialog){this._oDialog.destroy()}},setInitialFocus:function(e){this.getView().addEventDelegate({onAfterShow:function(){setTimeout(function(){e.focus()}.bind(this),0)}},this)},onPress:function(e){this.sendLogin()},sendLogin(){var e=this;var t=this.getView().byId("logon_user");var o=this.getView().byId("logon_pass");var s=t.getValue();var r=o.getValue();if(s!==""){if(r===""){sap.m.MessageBox.warning(e.getOwnerComponent().getModel("appTxts").getProperty("/logonCon.pass"));o.focus();return}}else{sap.m.MessageBox.warning(e.getOwnerComponent().getModel("appTxts").getProperty("/logonCon.user"));t.focus();return}var a={IOption:"14",IMail:s,IPass:r,ETROLUSUANAV:[],ETUSUAPROVNAV:[],ETSUPPSNAV:[]};var n=/[\"\b\f\n\r\t\\\']/gi;var g=r.match(n);if(g!==null){sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/logon.regexError"));return}var l=i.create("/headerAdmSet",a);var p=new sap.ui.model.json.JSONModel;var u=false;if(l!=null){if(l.EAccallow=="X"){l.IMail=s;p.setData(l);u=true}else{sap.m.MessageBox.error(l.EMessage)}}else{sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/logon.erroServer"))}this.hasLoged(u,p)},hasLoged:function(e,t){if(e){var o="";var s="";var r="";this.setUserModel(t);if(t.getProperty("/Esusdata/Zusuasor")!=null&&t.getProperty("/Esusdata/Zusuasor")!="X"){o=t.getProperty("/ETROLUSUANAV/results/0").Lifnr;var a=t.getProperty("/ETUSUAPROVNAV/results").find(e=>e.Lifnr==o);s=a.Name;r=a.Simplif_flag}this.setActiveLifnr(o,s,undefined,r);this.getRouter().navTo("tile")}},onPressCON:function(){this.getRouter().navTo("ConfirmUser",{mail:"correo@correo.com"})},onPressRC:function(e){function t(e){var t=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(String(e).toLowerCase())}var o=this.getView().byId("logon_user");if(o.getValue()===""){sap.m.MessageBox.warning(this.getOwnerComponent().getModel("appTxts").getProperty("/logonCon.mail"))}else{if(t(o.getValue())){var s=0;var r=i.getJsonModel("/headerAdmSet?$expand=ETROLUSUANAV&$filter= IOption eq '14' and IMail eq '"+o.getValue()+"' and IForgpass eq 'X'");var a=r.getProperty("/results/0");if(a!=null){if(a.ESucmail=="X"){if(!this._oDialog||this.oDialog===undefined){this._oDialog=sap.ui.xmlfragment("demo.fragments.RecoverPass",this)}this.getView().addDependent(this._oDialog);jQuery.sap.syncStyleClass("sapUiSizeCompact",this.getView(),this._oDialog);this._oDialog.open()}else{sap.m.MessageBox.error(a.EMessage)}}else{sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/logonCon.user1")+o.getValue()+this.getOwnerComponent().getModel("appTxts").getProperty("/logonCon.user2"))}}else{sap.m.MessageBox.warning(this.getOwnerComponent().getModel("appTxts").getProperty("/logonCon.noMail"))}}},onCloseDialog:function(){if(this._oDialog){this._oDialog.destroy()}},verifyCode:function(e){var t=this.getView().byId("logon_user").getValue();var o=sap.ui.getCore().byId("verifyCode");var s=0;var r={IOption:"17",IMail:t,IAcode:o.getValue()};var a=i.create("/headerAdmSet",r);if(a){if(a.ESuccess=="X"){sap.ui.getCore().byId("pass1").setVisible(true);sap.ui.getCore().byId("pass2").setVisible(true);sap.ui.getCore().byId("confirmButton").setVisible(true);o.setVisible(false);sap.ui.getCore().byId("verifyButton").setVisible(false);sap.ui.getCore().byId("textIdentifier").setText("Por favor ingresa y confirma el nuevo password para tu cuenta.")}else{sap.m.MessageBox.error(a.EMessage)}}else{sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/logon.erroServer"))}},changePassword:function(){var e=this.getView().byId("logon_user").getValue();var t=sap.ui.getCore().byId("pass1").getValue();var o=sap.ui.getCore().byId("pass2").getValue();var s=sap.ui.getCore().byId("verifyCode").getValue();var r=/[\"\b\f\n\r\t\\\']/gi;var a=t.match(r);var n=o.match(r);if(a!==null||n!==null){sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/logon.regexError"));return}if(t.length<=0||t.length<8){sap.m.MessageBox.warning(this.getOwnerComponent().getModel("appTxts").getProperty("/logonCon.noPass"))}else{if(t===o){var g={IOption:"3",IMail:e,IAcode:s,INewpass:t};var l=i.create("/headerAdmSet",g);if(l!=null){if(l.ESuccess==="X"){sap.ui.getCore().byId("pass1").setVisible(false);sap.ui.getCore().byId("pass2").setVisible(false);sap.ui.getCore().byId("confirmButton").setVisible(false);sap.ui.getCore().byId("objectConfirm").setVisible(true);sap.ui.getCore().byId("textIdentifier").setVisible(false)}else{sap.m.MessageBox.error(l.EMessage)}}else{sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/logon.erroServer"))}}else{sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/logonCon.verifyPass"))}}}})});