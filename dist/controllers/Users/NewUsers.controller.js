sap.ui.define(["jquery.sap.global","sap/ui/core/Fragment","demo/controllers/BaseController","sap/m/UploadCollectionParameter","sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","sap/ui/core/routing/Router"],function(e,t,i,a,s,l){"use strict";var o=new this.UserModel;var r=new Map;return i.extend("demo.controllers.Users.NewUsers",{onInit:function(){this.oRouter=this.getOwnerComponent().getRouter();this.getView().addEventDelegate({onBeforeShow:function(e){this.onSelectColaborator();this.getOwnerComponent().setModel(new l(this.getOwnerComponent().getModel("tilesModel").getData()),"tilesModelLocal");r.clear()}},this)},onExit:function(){window.history.go(-1)},validateData:function(){var e=true;if(this.getView().byId("Mail").getValue()==""&&this.getView().byId("Mail2").getValue()==""){e=false;sap.m.MessageBox.warning("El campo correo y su confirmación son requeridos")}else{if(this.getView().byId("Mail").getValue()!=""&&!this.validateMail("Mail")){e=false}if(this.getView().byId("Mail2").getValue()!=""&&!this.validateMail("Mail2")){e=false}}if(e&&this.getView().byId("Mail").getValue()!=this.getView().byId("Mail2").getValue()){e=false;sap.m.MessageBox.warning("El correo no coincide, verifique sus entradas")}if(e&&this.getView().byId("Name1").getValue()==""){e=false;sap.m.MessageBox.warning("El campo nombre es requerido")}if(e&&(!this.getView().byId("bussUser").getSelected()&&!this.getView().byId("callUser").getSelected())){if(this.getConfigModel().getProperty("/supplierInputKey")==null){e=false;sap.m.MessageBox.warning("Se debe especificar un numero de proveedor")}}if(this.getView().byId("Celular2").getValue()!=""){if(!this.validatePhone("Celular2")){e=false}}if(this.getView().byId("Tel2").getValue()!=""){if(!this.validatePhone("Tel2")){e=false}}return e},createUser:function(){if(this.validateData()){if(!this.getView().byId("bussUser").getSelected()){var e=this.getConfigModel().getProperty("/supplierInputKey")}var t=this.getView().byId("Mail").getValue();var i=this.getView().byId("Name1").getValue();var a=this.getView().byId("Name2").getValue();var s=this.getView().byId("Name3").getValue();var l=this.getView().byId("Depto").getValue();var o=this.getView().byId("Celular2").getValue();var n=this.getView().byId("Tel2").getValue();var u=this.getView().byId("Puesto").getValue();var g=this.getView().byId("Jefe").getValue();var d=this.getOwnerComponent().getModel("userdata").getProperty("/EIdusua");var c=this.getView().byId("callUser").getSelected();var V=[];for(let[e,t]of r){V.push({Idfuncion:t.toString()})}var h="";if(c!=""){h="X"}var w={ILifnr:e,IIdusua:d,IOption:"1",IMail:t,Name1:i,Name2:a,Name3:s,Zpuesto:u,Zdepart:l,TelNumber:o,Znomjefe:g,TelNumber2:n,Zcallc:h,Spras:"s",ITFUNCTIONSNAV:V};this.sendMessage(w)}},sendMessage:function(e){var t=o.create("/headerAdmSet",e);if(t!=null){if(t.ESuccess=="X"){sap.m.MessageBox.success("Se ha creado el usuario y enviado la invitación.",{actions:[sap.m.MessageBox.Action.CLOSE],emphasizedAction:sap.m.MessageBox.Action.CLOSE,onClose:function(e){this.goToMainUser()}.bind(this)})}else{sap.m.MessageBox.success(t.EMessage)}}else{sap.m.MessageBox.error("No se pudo conectar con el servidor, intente nuevamente.")}},onCancel:function(){this.goToMainUser()},goToMainUser:function(){this.oRouter.navTo("masterUsers");this.clearFields()},clearFields:function(){this.getView().byId("bussUser").setSelected(false);this.getView().byId("Mail").setValue("");this.getView().byId("Mail2").setValue("");this.getView().byId("Name1").setValue("");this.getView().byId("Name2").setValue("");this.getView().byId("Name3").setValue("");this.getView().byId("Depto").setValue("");this.getView().byId("Celular2").setValue("");this.getView().byId("Tel2").setValue("");this.getView().byId("Puesto").setValue("");this.getView().byId("Jefe").setValue("");this.getView().byId("Mail").setValueState(sap.ui.core.ValueState.None);this.getView().byId("Mail2").setValueState(sap.ui.core.ValueState.None);this.getView().byId("Celular2").setValueState(sap.ui.core.ValueState.None);this.getView().byId("Tel2").setValueState(sap.ui.core.ValueState.None)},onSelectColaborator:function(){if(this.getView().byId("bussUser").getSelected()||this.getView().byId("callUser").getSelected()){var e=this.getView().byId("supplierInput").setEnabled(false)}else{var e=this.getView().byId("supplierInput").setEnabled(true)}},functionSelected:function(e){var t=e.getSource().getId();var i=e.getSource().getBindingContext("tilesModelLocal").getPath();var a=this.getOwnerComponent().getModel("tilesModelLocal").getProperty(i);var s=t;var l=a.idFunction;if(!r.has(s)){r.set(s,l)}else{r.delete(s)}}})});