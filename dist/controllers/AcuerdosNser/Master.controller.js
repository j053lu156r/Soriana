sap.ui.define(["demo/controllers/BaseController","sap/ui/model/json/JSONModel","sap/m/MessageBox"],function(e,t,r){"use strict";var o=new this.Acuerdos;return e.extend("demo.controllers.AcuerdosNser.Master",{onInit:function(){this.getView().addEventDelegate({onAfterShow:function(e){var r=this.getOwnerComponent().getModel();r.setProperty("/barVisible",true);this.getOwnerComponent().setModel(new t,"AcuerdosNserHdr");this.clearFilters()}},this);this.configFilterLanguage(this.getView().byId("filterBar"))},searchData:function(){var e=true;if(!o.getModel()){o.initModel()}var t=this.getConfigModel().getProperty("/supplierInputKey");var n=this.getView().byId("documentoInput").getValue();var a=this.getView().byId("convenioInput").getValue();var s=this.getView().byId("centroInput").getValue();var u=this.getOwnerComponent().getModel("appTxts");if(t==""||t==null){r.error(u.getProperty("/acuerdosNser.indProv"));e=false}else if(n==""||n==null){r.error(u.getProperty("/acuerdosNser.indDocto"));e=false}if(e){var d="AcuerdosNserSet?$filter=Lifnr eq '"+t+"'";if(n!=""&&n!=null){d+=" and Belnr eq '"+n+"'"}if(a!=""&&a!=null){d+=" and Conve eq '"+a+"'"}if(s!=""&&s!=null){d+=" and Werks eq '"+s+"'"}this.getView().byId("tableAcuerdosNser").setBusy(true);o.getJsonModelAsync(d,function(e,t){var r=e.getProperty("/results");if(r!=null){var o=r.reduce((e,t)=>+e+(+t["Canti"]||0),0);var n=r.reduce((e,t)=>+e+(+t["Pvmat"]||0),0);var a=r.reduce((e,t)=>+e+(+t["Cumat"]||0),0);var s=r.reduce((e,t)=>+e+(+t["Cargo"]||0),0);var u=r.reduce((e,t)=>+e+(+t["Iva"]||0),0);var d=r.reduce((e,t)=>+e+(+t["Ieps"]||0),0);var i=r.reduce((e,t)=>+e+(+t["Totca"]||0),0);var c={TotCanti:Number(o.toFixed(2)),TotPvmat:Number(n.toFixed(2)),TotCumat:Number(a.toFixed(2)),TotCargo:Number(s.toFixed(2)),TotIva:Number(u.toFixed(2)),TotIeps:Number(d.toFixed(2)),TotTotca:Number(i.toFixed(2))};t.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(c),"AcuerdosNserTot");t.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(r),"AcuerdosNserHdr")}t.getView().byId("tableAcuerdosNser").setBusy(false)},function(e){e.getView().byId("tableAcuerdosNser").setBusy(false)},this)}},clearFilters:function(){this.getView().byId("supplierInput").setValue("");this.getView().byId("documentoInput").setValue("");this.getView().byId("convenioInput").setValue("");this.getView().byId("centroInput").setValue("")},buildExportTable:function(){var e=this.getOwnerComponent().getModel("appTxts");var t=[{name:e.getProperty("/acuerdosNser.proveedor"),template:{content:"{Lifnr}"}},{name:e.getProperty("/acuerdosNser.documento"),template:{content:"{Belnr}"}},{name:e.getProperty("/acuerdosNser.convenio"),template:{content:"{Conve}"}},{name:e.getProperty("/acuerdosNser.centro"),template:{content:"{Werks}"}},{name:e.getProperty("/acuerdosNser.pedido"),template:{content:"{Ebeln}"}},{name:e.getProperty("/acuerdosNser.material"),template:{content:"{Matnr}"}},{name:e.getProperty("/acuerdosNser.descMat"),template:{content:"{Maktx}"}},{name:e.getProperty("/acuerdosNser.cantidad"),template:{content:"{Canti}"}},{name:e.getProperty("/acuerdosNser.pvMat"),template:{content:"{Pvmat}"}},{name:e.getProperty("/acuerdosNser.cuMat"),template:{content:"{Cumat}"}},{name:e.getProperty("/acuerdosNser.cargo"),template:{content:"{Cargo}"}},{name:e.getProperty("/acuerdosNser.iva"),template:{content:"{Iva}"}},{name:e.getProperty("/acuerdosNser.ieps"),template:{content:"{Ieps}"}},{name:e.getProperty("/acuerdosNser.totCargo"),template:{content:"{Totca}"}},{name:e.getProperty("/acuerdosNser.fecCargo"),template:{content:"{ path: 'Fecca', type: 'sap.ui.model.type.DateTime', formatOptions: { pattern: 'dd/MM/yyyy', UTC: true } }"}}];this.exportxls("AcuerdosNserHdr","/",t)}})});