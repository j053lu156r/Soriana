sap.ui.define(["demo/controllers/BaseController","sap/ui/core/Fragment","sap/ui/model/json/JSONModel"],function(e,t,i){"use strict";var s={prevPaymentSelect:null,prevDiffDeliverySelect:null};var r=new this.Pedidostemp;var o=new this.CfdiModel;var a="";return e.extend("demo.controllers.BaseRemission",{getTipoEntrega:function(){var e=this.getOwnerComponent().getModel("appTxts");console.log(e);var t={tipoEntrega:[{id:0,tipo:e.getProperty("/rem.tipoEnterga.all")},{id:1,tipo:e.getProperty("/rem.tipoEnterga.reverse")},{id:2,tipo:e.getProperty("/rem.tipoEnterga.consolidado")},{id:3,tipo:e.getProperty("/rem.tipoEnterga.importaciones")}]};return t},openSelectRemission:function(){if(!this.hasAccess(6)){return false}if(this.getConfigModel().getProperty("/supplierInputKey")!=null&&this.getConfigModel().getProperty("/supplierInputKey")!=""){var e=this.getView();if(!this._selDialog){this._selDialog=t.load({id:e.getId(),name:"demo.views.Remissions.fragments.DialogSelect",controller:this}).then(function(t){e.addDependent(t);return t}.bind(this))}this._selDialog.then(function(e){e.open()})}else{sap.m.MessageBox.error("Debe selecionar un proveedor para continuar.")}},openWizard:function(e){var i=this.getView();var s=e=="reverse"?"demo.views.Remissions.fragments.RemissionWizard":"demo.views.Remissions.fragments.RemissionCWizard";this.remissionType=e;if(!this._pDialog){this._pDialog=t.load({id:i.getId(),name:s,controller:this}).then(function(e){e.attachAfterOpen(this.onDialogAfterOpen,this);i.addDependent(e);return e}.bind(this))}this._pDialog.then(function(e){e.open()})},onContinueSelect:function(){this.onCancelSelect();var e=this.byId("paymentMethodSelection").getSelectedKey();this.openWizard(e)},onCancelSelect:function(){this.byId("selectTypeDialog").close();this.getView().setModel(new i,"selectedPositionsQty");this.getView().setModel(new i,"tableWizardOrderPosition");this.getView().setModel(new i,"selectedWizardPositions");this.getView().setModel(new i,"reviewModel")},onCloseWizard:function(){this._handleMessageBoxOpen(this.getView().getModel("appTxts").getProperty("/rem.discardButton"),"warning")},_handleMessageBoxOpen:function(e,t){sap.m.MessageBox[t](e,{actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(e){if(e===sap.m.MessageBox.Action.YES){this._oWizard.discardProgress(this._oWizard.getSteps()[0]);this.byId("wizardDialog").destroy();this._pDialog=null;this._oWizard=null;this.getView().setModel(new i,"tableWizardOrderPosition")}}.bind(this)})},onDialogAfterOpen:function(){this._oWizard=this.byId("CreateProductWizard");this.getView().byId("deliveryDate").setMinDate(new Date);this.handleButtonsVisibility()},handleButtonsVisibility:function(){var e=this.getView().getModel();var t=e.getProperty("/selectedPayment");switch(this._oWizard.getProgress()){case 1:e.setProperty("/nextButtonVisible",true);e.setProperty("/backButtonVisible",false);e.setProperty("/reviewButtonVisible",false);e.setProperty("/finishButtonVisible",false);this.remissionValidate();break;case 2:e.setProperty("/nextButtonVisible",true);e.setProperty("/backButtonVisible",true);e.setProperty("/reviewButtonVisible",false);e.setProperty("/finishButtonVisible",false);this.positionValidation();break;case 3:switch(t){case"reverse":e.setProperty("/backButtonVisible",true);e.setProperty("/nextButtonVisible",false);e.setProperty("/reviewButtonVisible",true);e.setProperty("/finishButtonVisible",false);break;case"packing":e.setProperty("/backButtonVisible",true);e.setProperty("/reviewButtonVisible",true);e.setProperty("/nextButtonVisible",false);e.setProperty("/finishButtonVisible",false);break}break;case 4:switch(t){case"reverse":e.setProperty("/backButtonVisible",true);e.setProperty("/nextButtonVisible",false);e.setProperty("/reviewButtonVisible",false);e.setProperty("/finishButtonVisible",true);break;case"packing":e.setProperty("/backButtonVisible",true);e.setProperty("/nextButtonVisible",false);e.setProperty("/reviewButtonVisible",false);e.setProperty("/finishButtonVisible",true);break}break;default:break}},setDiscardableProperty:function(e){var t=this._oWizard.getProgressStep();if(t!==e.discardStep){sap.m.MessageBox.warning(e.message,{actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(t){if(t===sap.m.MessageBox.Action.YES){this._oWizard.discardProgress(e.discardStep);s[e.historyPath]=this.getView().getModel().getProperty(e.modelPath);this.getView().getModel().setProperty("/nextButtonEnabled",true)}else{this.model.setProperty(e.modelPath,s[e.historyPath])}}.bind(this)})}else{s[e.historyPath]=this.getView().getModel().getProperty(e.modelPath)}},onDialogNextButton:function(){if(this._oWizard.getProgressStep().getValidated()){var e=this._oWizard.getSteps();this._oWizard.nextStep()}this.handleButtonsVisibility()},onDialogBackButton:function(){this._oWizard.previousStep();this.handleButtonsVisibility()},searchRemissionOrder:function(){this._document=this.byId("searchOrder").getValue();this._document.trim();this.getView().setModel(new i,"tableWizardOrderPosition");var e=`/notCreditSet?$expand=OEKKONAV&$filter=IOption eq '4' and ILifnr eq '${this.getConfigModel().getProperty("/supplierInputKey")}'`;e+=` and IEbeln eq '${this._document}'`;var t=r.getJsonModel(e);if(t!=null){var s=t.getProperty("/results/0");if(s!=null){if(s.ESuccess=="X"){this.getDetailOrder()}else{sap.m.MessageBox.error(s.EReturn)}}}},getDetailOrder:function(){var e="notCreditSet?$expand=Oekponav,OEKKONAV,OEKKOADVRNAV&$filter=IOption eq '5' and IEbeln eq '"+this._document+"'";e+=` and ILifnr eq '${this.getConfigModel().getProperty("/supplierInputKey")}'`;var t=r.getJsonModel(e);var s=t.getProperty("/results/0");if(s.Oekponav.results.length>0){this.getView().setModel(new i(s),"tableWizardOrderPosition");this.paginate("tableWizardOrderPosition","/Oekponav",1,0)}else{sap.m.MessageBox.error(s.EReturn)}},filterOrderPositions:function(e){var t=e.getSource().getValue();var i=this.getView().byId("tableWizardOrderPosition");var s=new sap.ui.model.Filter([new sap.ui.model.Filter("Ean11",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Txz01",sap.ui.model.FilterOperator.Contains,t)],false);i.getBinding("items").filter(s,sap.ui.model.FilterType.Application)},filterQtys:function(e){var t=e.getSource().getValue();var i=this.getView().byId("tableWizardOrderQty");var s=new sap.ui.model.Filter([new sap.ui.model.Filter("Ean11",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Txz01",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Ebeln",sap.ui.model.FilterOperator.Contains,t)],false);i.getBinding("items").filter(s,sap.ui.model.FilterType.Application)},filterQtysTree:function(e){var t=e.getSource().getValue();var i=this.getView().byId("tableWizardOrderQty");var s=new sap.ui.model.Filter([new sap.ui.model.Filter("Ean11",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Txz01",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Ean11Child",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Txz01Child",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Ebeln",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Bednr",sap.ui.model.FilterOperator.Contains,t)],false);i.getBinding("rows").filter(t?s:null)},onTreeChange:function(e){if(e.getParameter("reason")=="filter"){const e=this.getView().getModel("search");const t=e.getProperty("/query");this.byId("tableWizardOrderQty").expandToLevel(t?99:0)}},selectChange:function(e){var t={selecteds:[]};var s=this.getView().getModel("selectedWizardPositions");if(s!=null){var r=s.getProperty("/selecteds");if(r!=null){t.selecteds=r}}var o=e.getParameters("listItems").listItems;o.forEach(function(e){var i=e.getBindingContext("tableWizardOrderPosition").getPath();var s=this.getView().getModel("tableWizardOrderPosition").getProperty(i);if(e.getProperty("selected")){if(!t.selecteds.some(e=>e==s)){t.selecteds.push(s)}}else{var r=t.selecteds.find(e=>e==s);if(r!=null){t.selecteds.splice(r.index,1)}}},this);this.getView().setModel(new i(t),"selectedWizardPositions")},calculateTotal:function(e,t,i){var s=parseFloat(e).toFixed(3);var r=parseFloat(t).toFixed(3);var o=s*r;var a=new sap.ui.model.type.Currency({showMeasure:false});var n=parseFloat(o).toFixed(3).toString();return a.formatValue([n,i],"string")},positionValidation:function(){var e=false;var t=this.getView().getModel();var i=this.getView().getModel("selectedPositionsQty");if(i!=null){var s=i.getProperty("/selecteds/results");if(s!=null&&s.length>0){e=true}}if(e){if(this._oWizard!=null){this._oWizard.validateStep(this.byId("ProductInfoStep"))}t.setProperty("/nextButtonEnabled",true)}else{if(this._oWizard!=null){this._oWizard.invalidateStep(this.byId("ProductInfoStep"))}t.setProperty("/nextButtonEnabled",false);t.setProperty("/finishButtonVisible",false)}},remissionValidate:function(){var e=this.getView().getModel();var t=this.byId("deliveryDate");if(this.getConfigModel().getProperty("/supplierInportation")!=null&&this.getConfigModel().getProperty("/supplierInportation")=="X"){if(this.getView().byId("petition").getValue()!=""&&this.getView().byId("customs").getValue()!=""&&this.getView().byId("customsBrokert").getValue()!=""&&this.getView().byId("petitionType").getValue()!=""){e.setProperty("/nextButtonEnabled",true)}else{e.setProperty("/nextButtonEnabled",false);return}}if(t!=null&&t.getValue()!=""){e.setProperty("/nextButtonEnabled",true)}else{e.setProperty("/nextButtonEnabled",false)}},addSelecteds:function(){var e=this.getView().getModel("selectedWizardPositions");if(e!=null){sap.m.MessageBox.warning("Desea agregar los registros?",{actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(t){if(t===sap.m.MessageBox.Action.YES){this.pushSelecteds(e)}}.bind(this)})}},pushSelecteds:function(e){var t={selecteds:{results:[]}};var s=this.getView().getModel("selectedPositionsQty");if(s!=null){var r=s.getProperty("/selecteds/results");if(r!=null){t.selecteds.results=r}if(s.getProperty("/packagesList")!=null){t.packagesList=s.getProperty("/packagesList")}}var o=e.getProperty("/selecteds");o.forEach(function(e){var i=t.selecteds.results.some(t=>t.Ebeln==e.Ebeln&&t.Ebelp==e.Ebelp);if(!i){t.selecteds.results.push(e)}});t=this.addTaxes(t);this.getView().setModel(new i(t),"selectedPositionsQty");var a=0;if(this.remissionType=="packing"){a=t.selecteds.results.length}this.paginate("selectedPositionsQty","/selecteds",1,0);this.getView().setModel(new i,"selectedWizardPositions");this.byId("tableWizardOrderPosition").removeSelections(true);this.getView().setModel(new i,"tableWizardOrderPosition");this.positionValidation()},addTaxes:function(e){var t={IOption:"6",ICurrency:this.getView().byId("currency").getSelectedItem().getText(),IT_EBELN:[],Taxesnav:[{Ebeln:"",Ebelp:"",Mwskz:"",Tax:"",Ieps:"",Netpr:""}],Bednrnav:[{Ebeln:"",Ebelp:"",Werks:"",Name1:"",Bednr:"",CantPendiente:"",Meins:""}]};e.selecteds.results.forEach(function(e){if(e.iva==null&&e.ieps==null){var i={Ebeln:e.Ebeln,Ebelp:e.Ebelp,Mwskz:"",Tax:"",Netpr:e.Netpr};t.IT_EBELN.push(i)}});var i=r.create("notCreditSet",t);if(i!=null){if(i.ESuccess=="X"){i.Taxesnav.results.forEach(function(t){var s=e.selecteds.results.findIndex(e=>e.Ebeln==t.Ebeln&&e.Ebelp==t.Ebelp);if(s!=null){e.selecteds.results[s]["iva"]=t.Tax;e.selecteds.results[s]["ieps"]=t.Ieps;if(t.Netpr!=null&&t.Netpr!=0){e.selecteds.results[s].Netpr=t.Netpr;e.selecteds.results[s].Waers=this.getView().byId("currency").getSelectedItem().getText()}if(this.remissionType=="packing"){if(i.Bednrnav.results!=null&&i.Bednrnav.results.length>0){var r=i.Bednrnav.results.filter(i=>i.Bednr==t.Ebeln&&i.Ean11==e.selecteds.results[s].Ean11);if(r.length>0){e.selecteds.results[s].results=r;e.selecteds.results[s].results.forEach(function(t){t.Ean11Child=e.selecteds.results[s].Ean11;t.Txz01Child=e.selecteds.results[s].Txz01})}else{e.selecteds.results.splice(s,1);sap.m.MessageBox.error(`La posici칩n ${t.Ebelp} del pedido ${t.Ebeln} no corresponde a un pedido tipo ${this.remissionType}, no se agregar치 el registro`)}}else{e.selecteds.results.splice(s,1);sap.m.MessageBox.error(`La posici칩n ${t.Ebelp} del pedido ${t.Ebeln} no corresponde a un pedido tipo ${this.remissionType}, no se agregar치 el registro`)}}}},this)}else{sap.m.Message.error(i.EMessage)}}return e},getChildParetPath:function(e){var t="";var i=e.split("/");for(var s=0;s<i.length-2;s++){if(i[s]!=""){t+="/"+i[s]}}return t},changeQty:function(e){var t="";if(this.remissionType=="packing"){var i=e.getSource().getParent().getBindingContext("selectedPositionsQty").getPath();t=this.getChildParetPath(i);var s=this.getView().getModel("selectedPositionsQty").getProperty(i);if(s.QtySendChild!=null&&parseFloat(s.QtySendChild)>parseFloat(s.CantPendiente)){s.QtySendChild="";sap.m.MessageBox.error("La cantidad a enviar no puede ser mayor a la cantidad pendiente, verifique sus entradas.")}}else{t=e.getSource().getBindingContext("selectedPositionsQty").getPath()}var r=this.getView().getModel("selectedPositionsQty").getProperty(t);if(this.remissionType=="packing"){r.QtySend=parseFloat(r.results.map(e=>parseFloat(e.QtySendChild)).reduce((e,t)=>e+(t=t||0),0)).toFixed(3);e.getSource().setValue(parseFloat(s.QtySendChild).toFixed(3))}if(r.QtySend!=null&&parseFloat(r.QtySend)>parseFloat(r.Cresta)){r.QtySend="";sap.m.MessageBox.error("La cantidad a enviar no puede ser mayor a la cantidad pendiente, verifique sus entradas.")}else{r.QtyNet=parseFloat(r.QtySend*r.Netpr).toFixed(3);r.QtyIva=parseFloat(r.QtySend*r.Netpr*(r.iva/100)).toFixed(3);r.QtyIeps=parseFloat(r.QtySend*r.Netpr*(r.ieps/100)).toFixed(3);r.QtyTotal=parseFloat(r.QtySend*r.Netpr+r.QtyIva+r.QtyIeps).toFixed(3)}this.activateQty()},qtyValidation:function(){if(!this.activateQty()){sap.m.MessageBox.error("Se debe especificar una cantidad de entrega para todas las posiciones seleccionadas.")}else{this.defineReview()}},defineReview:function(){var e={Remision:{columnas:[]},Pedimento:{columnas:[]},Pedidos:{columnas:[]},Articulos:{columnas:[]},CajasTarimas:{columnas:[]},ArticulosPorCajaTarima:{columnas:[]}};var t=this.buildRemisionReview();var s=this.getView().getModel("selectedPositionsQty").getData();if(s!=null){var r=s.selecteds.results[0].Ebeln;var o=`REM-${r.substring(r.length-6)}`;var a=this.groupByAuto(s.selecteds.results,"Ebeln");t.CantidadPedidos=Object.keys(a).length;t.Subtotal=parseFloat(s.selecteds.results.map(e=>e.QtyNet).reduce((e,t)=>e+t,0)).toFixed(3);t.IEPS=parseFloat(s.selecteds.results.map(e=>e.QtyIeps).reduce((e,t)=>e+t,0)).toFixed(3);t.IVA=parseFloat(s.selecteds.results.map(e=>e.QtyIva).reduce((e,t)=>e+t,0)).toFixed(3);t.Total=parseFloat(s.selecteds.results.map(e=>e.QtyTotal).reduce((e,t)=>e+t,0)).toFixed(3);t.Cita=this.getView().byId("appointment").getValue();if(this.remissionType=="packing"){t.EmpaqueEnCajas=this.getView().byId("boxes")!=null&&this.getView().byId("boxes").getSelected()?"SI":"NO";t.EmpaqueEnTarimas=this.getView().byId("pallet")!=null&&this.getView().byId("pallet").getSelected()?"SI":"NO"}t.Remision=o;t.Tienda=s.selecteds.results[0].Werks;t.TiendaText=s.selecteds.results[0].Name1;t.Consecutivo="0";if(this.getConfigModel().getProperty("/supplierInportation")!=null&&this.getConfigModel().getProperty("/supplierInportation")=="X"){var n={};n.Proveedor=this.getConfigModel().getProperty("/supplierInputKey");n.Remision=o;n.Pedimento=this.getView().byId("petition").getValue();n.Aduana=this.getView().byId("customs").getValue();n.AgenteAduanal=this.getView().byId("customsBrokert").getValue();n.TipoPedimento=this.getView().byId("petitionType").getValue();n.FechaPedimento=this.getView().byId("petitionDate").getValue();n.FechaReciboLaredo=this.getView().byId("laredoDate").getValue();n.FechaBillOfLading=this.getView().byId("bLandingDate").getValue();e.Pedimento.columnas.push(n)}for(var l in a){var d={};d.Proveedor=this.getConfigModel().getProperty("/supplierInputKey");d.Remision=o;d.FolioPedido=l;d.Tienda=a[l][0].Werks;d.TiendaText=a[l][0].Name1;d.CantidadArticulos=a[l].length;e.Pedidos.columnas.push(d)}s.selecteds.results.forEach(function(t){var i={};i.Proveedor=this.getConfigModel().getProperty("/supplierInputKey");i.Remision=o;i.FolioPedido=t.Ebeln;i.Tienda=t.Werks;i.TiendaText=t.Name1;i.Codigo=t.Ean11;i.CodigoText=t.Txz01;i.CantidadUnidadCompra=parseFloat(t.QtySend).toFixed(3);i.CostoNetoUnidadCompra=parseFloat(t.QtyNet).toFixed(3);i.PorcentajeIEPS=parseFloat(t.ieps).toFixed(3);i.PorcentajeIVA=parseFloat(t.iva).toFixed(3);e.Articulos.columnas.push(i)},this);if(this.remissionType=="packing"){s.packagesList.forEach(function(t){var i={};i.Proveedor=this.getConfigModel().getProperty("/supplierInputKey");i.Remision=o;i.NumeroCajaTarima=t.idPackage;i.SucursalDistribuir=t.Werks;i.Name1=t.NWerks;i.CantidadArticulos=t.items.length;i.items=[];t.items.forEach(function(r){var a={};a.Proveedor=this.getConfigModel().getProperty("/supplierInputKey");a.Remision=o;a.FolioPedido=r.Bednr;a.NumeroCajaTarima=t.idPackage;a.SucursalDistribuir=r.Werks;a.Codigo=s.selecteds.results.find(e=>e.Ebeln==r.Bednr&&e.Ean11==r.Ean11).Ean11;a.Descripcion=s.selecteds.results.find(e=>e.Ebeln==r.Bednr&&e.Ean11==r.Ean11).Txz01;a.CantidadUnidadCompra=r.QtySendChild;i.items.push(a);e.ArticulosPorCajaTarima.columnas.push(a)},this);e.CajasTarimas.columnas.push(i)},this)}}e.Remision.columnas.push(t);this.getView().setModel(new i(e),"reviewModel")},buildRemisionReview:function(){var e={};e.Proveedor=this.getConfigModel().getProperty("/supplierInputKey");var t=new Date;var i=String(t.getDate()).padStart(2,"0");var s=String(t.getMonth()+1).padStart(2,"0");var r=t.getFullYear().toString().substr(-2);e.FechaRemision=`${s}/${i}/${r}`;e.TipoMoneda=this.getView().byId("currency").getSelectedKey();e.TipoMonedaText=this.getView().byId("currency").getSelectedItem().getText();e.TipoBulto=this.getView().byId("package").getSelectedKey();e.TipoBultoText=this.getView().byId("package").getSelectedItem().getText();e.EntregaMercancia=1;if(this.getView().byId("reqFisc").getSelected()){e.CumpleReqFiscales="Si"}else{e.CumpleReqFiscales="No"}e.CantidadBultos=this.getView().byId("packagesNo").getValue();e.FechaEntregaMercancia=this.getView().byId("deliveryDate").getValue();e.Descuentos=0;e.OtrosImpuestos=0;return e},groupByAuto:function(e,t){var i={};for(var s in e){if(!i.hasOwnProperty(e[s][t]))i[e[s][t]]=[];i[e[s][t]].push(e[s])}return i},activateQty:function(){var e=false;var t=this.getView().getModel("selectedPositionsQty").getProperty("/selecteds/results");var i=t.some(function(e){return e.QtySend==null||e.QtySend==""||e.QtySend==0},this);if(!i){if(this.remissionType=="packing"){for(var s=0;s<t.length;s++){i=t[s].results.some(function(e){return e.QtySendChild!=null&&e.Package==null});if(i){break}}}}if(!i){if(this.remissionType=="packing"){this.getView().getModel().setProperty("/reviewButtonEnabled",true)}else{this.getView().getModel().setProperty("/reviewButtonEnabled",true)}e=true}else{if(this.remissionType=="packing"){this.getView().getModel().setProperty("/reviewButtonEnabled",false)}else{this.getView().getModel().setProperty("/reviewButtonEnabled",false)}e=false}return e},handleWizardSubmit:function(){sap.m.MessageBox["confirm"](this.getView().getModel("appTxts").getProperty("/rem.submitMessage"),{actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(e){if(e===sap.m.MessageBox.Action.YES){var t=this.getConfigModel().getProperty("/supplierInputKey");var i=this.getView().getModel("reviewModel").getData();var s={Lifnr:t,Type:"A",Format:"X",Log:[{Uuid:"",Description:"",Sts:""}]};s.Cfdi=JSON.stringify(i);var r=o.create("/ECfdiSet ",s);if(r!=null){if(r.Log!=null){this.openLogErrorDialog(r)}else{sap.m.MessageBox.error(r.EMessage)}}this._oWizard.discardProgress(this._oWizard.getSteps()[0]);this.byId("wizardDialog").destroy();this._pDialog=null;this._oWizard=null}}.bind(this)})},openLogErrorDialog:function(e){if(!this._uploadDialog2){this._uploadDialog2=sap.ui.xmlfragment("uploadInvoice","demo.views.Remissions.fragments.LogError",this);this.getView().addDependent(this._uploadDialog2)}this._uploadDialog2.setModel(new i(e));this._uploadDialog2.open()},onCloseDialogUpload:function(){if(this._uploadDialog2){this._uploadDialog2.destroy();this._uploadDialog2=null}},packageOnlyNumbers:function(e){var t=this.byId(e).getValue();return bValid},setPackage:function(e){if(e.getSource().getValue()!=""){var t=/^[0-9]+$/;var i=e.getSource().getValue().match(t);if(!i){sap.m.MessageBox.error("Solo se permiten numeros en este campo");e.getSource().setValueState(sap.ui.core.ValueState.Error);return}else{e.getSource().setValueState(sap.ui.core.ValueState.Success)}}var s=[];var r=e.getSource().getParent().getBindingContext("selectedPositionsQty").getPath();var o=this.getView().getModel("selectedPositionsQty").getProperty(r);var a=e.getSource().getValue();var n=this.getView().getModel("selectedPositionsQty").getProperty("/packagesList");if(n!=null){s=n;var l=s.findIndex(e=>e.idPackage==a);if(o.pallet!=null){s=this.removePallet(o,s);o.pallet=""}if(l!=null&&l>=0){if(s[l].Werks==o.Werks){if(!s.includes(o)){s[l].items.push(o)}this.getView().getModel("selectedPositionsQty").setProperty("/packagesList",s)}else{sap.m.MessageBox.error(`La caja/tarima ${a} no corresponde al centro ${o.Werks}, verifique sus entradas.`);e.getSource().setValue("");a=""}}else{this.newPallet(a,o,s)}}else{this.newPallet(a,o,s)}o.pallet=a;this.activateQty()},newPallet:function(e,t,i){var s={idPackage:e,Werks:t.Werks,NWerks:t.Name1,items:[]};s.items.push(t);i.push(s);this.getView().getModel("selectedPositionsQty").setProperty("/packagesList",i)},removePallet:function(e,t){if(e.pallet!=null&&e.pallet!=""){var i=t.findIndex(t=>t.idPackage==e.pallet);var s=t[i].items.findIndex(t=>t==e);t[i].items.splice(s,1);if(t[i].items.length<=0){t.splice(i,1)}}return t},clearWizards:function(){if(this.remissionType=="packing"){}},changeRemission:function(e){var t=e.getSource().getValue();this.getView().getModel("reviewModel").getData().Pedidos.columnas.forEach(function(e){e.Remision=t});this.getView().getModel("reviewModel").getData().Articulos.columnas.forEach(function(e){e.Remision=t});this.getView().getModel("reviewModel").getData().CajasTarimas.columnas.forEach(function(e){e.Remision=t});this.getView().getModel("reviewModel").getData().ArticulosPorCajaTarima.columnas.forEach(function(e){e.Remision=t});this.getView().getModel("reviewModel").getData().Pedimento.columnas.forEach(function(e){e.Remision=t})},onCollapseAll:function(){var e=this.byId("tableWizardOrderQty");e.collapseAll()},onExpandFirstLevel:function(){var e=this.byId("tableWizardOrderQty");e.expandToLevel(1)}})});