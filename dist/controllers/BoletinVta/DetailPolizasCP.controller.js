sap.ui.define(["demo/controllers/BaseController","sap/m/MessageBox","sap/m/PDFViewer","sap/ui/core/routing/History","sap/ui/core/routing/Router"],function(e,t,o,n,a){"use strict";var r=new this.Polizas;return e.extend("demo.controllers.BoletinVta.DetailPolizasCP",{onInit:function(){var e=this.getView().byId("exitFullScreenBtn"),t=this.getView().byId("enterFullScreenBtn");this.oRouter=this.getOwnerComponent().getRouter();this.oModel=this.getOwnerComponent().getModel();this.oRouter.getRoute("BoletinVtaPolizasCP").attachPatternMatched(this._onDocumentMatched,this);[e,t].forEach(function(e){e.addEventDelegate({onAfterRendering:function(){if(this.bFocusFullScreenButton){this.bFocusFullScreenButton=false;e.focus()}}.bind(this)})},this)},handleFullScreen:function(){this.bFocusFullScreenButton=true;var e=this.oModel.getProperty("/actionButtonsInfo/endColumn/fullScreen");this.oRouter.navTo("BoletinVtaPolizasCP",{layout:e,company:this._company,document:this._document,year:this._year,fecha:this._fecha,documentO:this._documentO,yearO:this._yearO})},handleExitFullScreen:function(){this.bFocusFullScreenButton=true;var e=this.oModel.getProperty("/actionButtonsInfo/endColumn/exitFullScreen");this.oRouter.navTo("BoletinVtaPolizasCP",{layout:e,company:this._company,document:this._document,year:this._year,fecha:this._fecha,documentO:this._documentO,yearO:this._yearO})},handleClose:function(){this.oRouter.navTo("detailComplPagos",{document:this._documentO,layout:sap.f.LayoutType.TwoColumnsMidExpanded,sociedad:this._company,ejercicio:this._yearO,fecha:this._fecha})},_onDocumentMatched:function(e){this._company=e.getParameter("arguments").company||this._company||"0";this._document=e.getParameter("arguments").document||this._document||"0";this._year=e.getParameter("arguments").year||this._year||"0";this._fecha=e.getParameter("arguments").fecha||this._fecha||"0";this._documentO=e.getParameter("arguments").documentO||this._documentO||"0";this._yearO=e.getParameter("arguments").yearO||this._yearO||"0";var t={company:this._company,document:this._document,year:this._year};this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(t),"policieDetModel");this.searchData()},searchData:function(){if(!r.getModel()){r.initModel()}var e="finalcialDocumentsSet?$filter=Bukrs eq '"+this._company+"' and Belnr eq '"+this._document+"' and Gjahr eq '"+this._year+"'";this.getView().byId("tablePolizas").setBusy(true);r.getJsonModelAsync(e,function(e,t){var o=e.getProperty("/results");if(o!=null){if(o.length>0){var n=o[0].Name;var a=o[0].Knuma;var r=o.reduce((e,t)=>+e+(+t["Dmbtr"]||0),0);var i=o.reduce((e,t)=>+e+(+t["Wrbtr"]||0),0);var s=o.reduce((e,t)=>+e+(+t["Wmwst"]||0),0);var u={TotBase:Number(r.toFixed(2)),TotDescto:Number(i.toFixed(2)),TotIVA:Number(s.toFixed(2)),VendorName:n,Agreement:a};t.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(u),"acuTotDetModel");t.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(o),"PolizasHdr");t.paginate("PolizasHdr","/PolizasDet",1,0)}}t.getView().byId("tablePolizas").setBusy(false)},function(e){e.getView().byId("tablePolizas").setBusy(false)},this)},onExit:function(){},onDebitDetail:function(){var e=this.getOwnerComponent().getModel("PolizasHdr");var t=e.getProperty("/");var o=t[0];var n=this.getOwnerComponent().getHelper().getNextUIState(3);this.getOwnerComponent().getRouter().navTo("detailCargoBoletinVtaCP",{layout:n.layout,Company:o.Bukrs,Agreement:o.Knuma,Vendor:o.Lifnr,DateCreated:o.Erdat,document:o.Belnr,year:o.Gjahr,fecha:this._fecha,documentO:this._documentO,yearO:this._yearO},true)},buildExportTable:function(){var e=this.getOwnerComponent().getModel("appTxts");var t=[{name:e.getProperty("/Polizas.sucursal"),template:{content:"{Centro}"}},{name:e.getProperty("/Polizas.base"),template:{content:"{Base}"}},{name:e.getProperty("/Polizas.desc"),template:{content:"{Descuento}"}},{name:e.getProperty("/Polizas.iva"),template:{content:"{IVA}"}},{name:e.getProperty("/Polizas.pDesc"),template:{content:"{PDesc}"}},{name:e.getProperty("/Polizas.unidad"),template:{content:"{Unidad}"}}];this.exportxls("PolizasHdr","/PolizasDet/results",t)}})});