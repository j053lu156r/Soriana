sap.ui.define(["demo/controllers/BaseController","sap/m/MessageBox","sap/m/PDFViewer","sap/ui/core/routing/History","sap/ui/core/routing/Router"],function(e,t,o,r,n){"use strict";var a=new this.Polizas;return e.extend("demo.controllers.BoletinVta.Polizas",{onInit:function(){this._pdfViewer=new o;this.getView().addDependent(this._pdfViewer);this.oRouter=this.getOwnerComponent().getRouter();this.oModel=this.getOwnerComponent().getModel();this.getView().addEventDelegate({onAfterShow:function(e){var t=this.getOwnerComponent().getModel();t.setProperty("/barVisible",true);this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel,"PolizasHdr");this.clearFilters()}},this);this.configFilterLanguage(this.getView().byId("filterBar"))},searchData:function(){var e=this.getOwnerComponent().getModel("appTxts");var o=e.getProperty("/polizas.indSoc");var r=e.getProperty("/polizas.indEje");var n=true;if(!a.getModel()){a.initModel()}var i=this.getView().byId("sociedadInput").getValue();var s=this.getView().byId("documentoInput").getValue();var l=this.getView().byId("ejercicioInput").getValue();if(s==""||s==null){t.error(e.getProperty("/polizas.indNo"));n=false}else if(s!=""&&s!=null){if(i==""||i==null){t.error(o);n=false}else if(l==""||l==null){t.error(r);n=false}}if(n){var d="finalcialDocumentsSet?$filter=Bukrs eq '"+i+"' and Belnr eq '"+s+"' and Gjahr eq '"+l+"'";this.getView().byId("tablePolizas").setBusy(true);a.getJsonModelAsync(d,function(e,t){var o=e.getProperty("/results");if(o!=null){if(o.length>0){var r=o[0].Name;var n=o[0].Knuma;var a=o.reduce((e,t)=>+e+(+t["Dmbtr"]||0),0);var i=o.reduce((e,t)=>+e+(+t["Wrbtr"]||0),0);var s=o.reduce((e,t)=>+e+(+t["Wmwst"]||0),0);var l={TotBase:Number(a.toFixed(2)),TotDescto:Number(i.toFixed(2)),TotIVA:Number(s.toFixed(2)),VendorName:r,Agreement:n};t.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(l),"acuTotDetModel");t.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(o),"PolizasHdr");t.paginate("PolizasHdr","/PolizasDet",1,0)}}t.getView().byId("tablePolizas").setBusy(false)},function(e){e.getView().byId("tablePolizas").setBusy(false)},this)}},onExit:function(){},clearFilters:function(){var e=new Date;var t=e.getFullYear();this.getView().byId("sociedadInput").setValue("2001");this.getView().byId("documentoInput").setValue("");this.getView().byId("ejercicioInput").setValue(t);var o=this.getOwnerComponent().getModel("PolizasHdr");if(o){o.setData([])}},onDebitDetail:function(){var e=this.getView().byId("documentoInput").getValue();var t=this.getView().byId("ejercicioInput").getValue();var o=this.getOwnerComponent().getModel("PolizasHdr");var r=o.getProperty("/");var n=r[0];this.getOwnerComponent().getRouter().navTo("detailCargoBoletinVta",{layout:sap.f.LayoutType.TwoColumnsMidExpanded,Company:n.Bukrs,Agreement:n.Knuma,Vendor:n.Lifnr,DateCreated:n.Erdat,document:e,year:t},true)},buildExportTable:function(){var e=this.getOwnerComponent().getModel("appTxts");var t=[{name:e.getProperty("/Polizas.sucursal"),template:{content:"{Centro}"}},{name:e.getProperty("/Polizas.base"),template:{content:"{Base}"}},{name:e.getProperty("/Polizas.desc"),template:{content:"{Descuento}"}},{name:e.getProperty("/Polizas.iva"),template:{content:"{IVA}"}},{name:e.getProperty("/Polizas.pDesc"),template:{content:"{PDesc}"}},{name:e.getProperty("/Polizas.unidad"),template:{content:"{Unidad}"}}];this.exportxls("PolizasHdr","/",t)},onPressPDF:function(){var e=this.getOwnerComponent().getModel("AcuerdosHdr");var t=e.getData();var o="/sap/opu/odata/sap/ZOSP_ACUERDOS_SRV/";var r=o+"AcuerdosFilesSet('"+t.UUID+"')/$value";this._pdfViewer.setSource(r);this._pdfViewer.setTitle("CFDI");this._pdfViewer.open()},onClose:function(){var e=r.getInstance();var t=e.getPreviousHash();if(t!==undefined){window.history.go(-1)}else{var o=sap.ui.core.UIComponent.getRouterFor(this);o.navTo("",true)}}})});