sap.ui.define(["sap/ui/model/json/JSONModel","demo/controllers/BaseController","sap/ui/core/mvc/Controller"],function(e,t){"use strict";var o=new this.Remissions;var n=new this.RemissionCancel;return t.extend("demo.controllers.Remissions.Detail",{cajasTarimas:null,onInit:function(){var e=this.getView().byId("exitFullScreenBtn"),t=this.getView().byId("enterFullScreenBtn");this.oRouter=this.getOwnerComponent().getRouter();this.oModel=this.getOwnerComponent().getModel();this.oRouter.getRoute("detailRemission").attachPatternMatched(this._onDocumentMatched,this);[e,t].forEach(function(e){e.addEventDelegate({onAfterRendering:function(){if(this.bFocusFullScreenButton){this.bFocusFullScreenButton=false;e.focus()}}.bind(this)})},this)},handleItemPress:function(e){var t=this.getOwnerComponent().getHelper().getNextUIState(2),o=e.getSource().getBindingContext("tableItemsCfdi").getPath(),n=o.split("/").slice(-1).pop()},handleFullScreen:function(){this.bFocusFullScreenButton=true;var e=this.oModel.getProperty("/actionButtonsInfo/midColumn/fullScreen");this.oRouter.navTo("detailRemission",{layout:e,document:this._document,folio:this._folio})},handleExitFullScreen:function(){this.bFocusFullScreenButton=true;var e=this.oModel.getProperty("/actionButtonsInfo/midColumn/exitFullScreen");this.oRouter.navTo("detailRemission",{layout:e,document:this._document,folio:this._folio})},handleClose:function(){var e=this.oModel.getProperty("/actionButtonsInfo/midColumn/closeColumn");this.oRouter.navTo("masterRemission",{layout:e})},_onDocumentMatched:function(t){this._document=t.getParameter("arguments").document||this._document||"0";this._folio=t.getParameter("arguments").folio;this._lifnr=this.getConfigModel().getProperty("/supplierInputKey");var n=`/HdrAvisoSet?$expand=EFREMNAV,ETREMDNAV&$filter=IOption eq '2' and ILifnr eq '${this._lifnr}' and IZremision eq '${this._document}' and IZremfolio eq '${this._folio}'`;var r=o.getJsonModel(n);var i=r.getProperty("/results/0");this.getOwnerComponent().setModel(new e(i),"tableRemissionDetail");this.paginate("tableRemissionDetail","/ETREMDNAV",1,0)},buildExcel:function(){var e=this.getOwnerComponent().getModel("appTxts");let t=this.getOwnerComponent().getModel("tableRemissionDetail");var o=[{name:e.getProperty("/rem.folio"),template:{content:t.getProperty("/Eremh/Zremision")}},{name:e.getProperty("/rem.createDate"),template:{content:t.getProperty("/Eremh/Zfechrem")}},{name:e.getProperty("/rem.destination"),template:{content:t.getProperty("/Eremh/Werks")}},{name:e.getProperty("/rem.typeRemission"),template:{content:t.getProperty("/Eremh/Ztipoaviso")}},{name:e.getProperty("/rem.statusRemission"),template:{content:t.getProperty("/Eremh/Zstatus")}},{name:e.getProperty("/rem.cancelStatus"),template:{content:t.getProperty("/Eremh/ZstatusCan")}},{name:e.getProperty("/rem.delivdate"),template:{content:t.getProperty("/Eremh/Zfechem")}},{name:e.getProperty("/rem.appointment"),template:{content:t.getProperty("/Eremh/Zcita")}},{name:e.getProperty("/rem.typedeliv"),template:{content:t.getProperty("/Eremh/Ztipoentreg")}},{name:e.getProperty("/rem.countorders"),template:{content:t.getProperty("/Eremh/Zcantped")}},{name:e.getProperty("/rem.packagenumber"),template:{content:t.getProperty("/Eremh/Zcantbul")}},{name:e.getProperty("/rem.order"),template:{content:"{Ebeln}"}},{name:e.getProperty("/rem.palletbox"),template:{content:"{Cajtar}"}},,{name:e.getProperty("/rem.destination"),template:{content:"{Name1}"}},{name:e.getProperty("/rem.codebar"),template:{content:"{Ean11}"}},{name:e.getProperty("/rem.description"),template:{content:"{Maktx}"}},{name:e.getProperty("/rem.quantity"),template:{content:"{Menge}"}},{name:e.getProperty("/rem.netcost"),template:{content:"{Bprei}"}},{name:e.getProperty("/rem.totalcost"),template:{content:"{Bwert}"}},{name:e.getProperty("/rem.currency"),template:{content:"{Waers}"}}];if(t.getProperty("/Eremh/Ztipoentreg")=="Reverse"){o.splice(o.findIndex(t=>t.name==e.getProperty("/rem.palletbox")),1)}this.exportxls("tableRemissionDetail","/ETREMDNAV/results",o)},hancleCandel:function(e){sap.m.MessageBox["confirm"](this.getView().getModel("appTxts").getProperty("/rem.cancelRemission"),{actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(t){if(t===sap.m.MessageBox.Action.YES){this.cancelRemission(e)}}.bind(this)})},cancelRemission:function(e){var t={RemFolio:e,Success:"",Error:""};var o=`/AvisoCancSet`;var r=n.create(o,t);if(r!=null){if(r.Success=="X"){sap.m.MessageBox.success(this.getOwnerComponent().getModel("appTxts").getProperty("/rem.msgCancelDone"))}else{sap.m.MessageBox.error(r.Error)}}},printLabels:function(){if(!this._uploadDialog2){this._uploadDialog2=sap.ui.xmlfragment("printBoxesLabels","demo.views.Remissions.fragments.LabelsRemission",this);this.getView().addDependent(this._uploadDialog2)}var t={};var o="";o='<div id="codeGroupDiv" style= "text-align: center; width: 100%;" >'+'<div style="display: grid;grid-template-columns: auto auto auto; width:40%;">';var n=this.getView().getModel("tableRemissionDetail").getData();if(n.ETREMDNAV.results!=null){var r=this.groupByAuto(n.ETREMDNAV.results,"Cajtar");let e=1;let t=0;for(const i in r){t++;o+='<div style="padding:5px;display:inline; margin-top:40px; margin-right:10px; margin-left:10px; border:1px solid #999999;text-align:center;">'+`<p style="width:100%;font-size: smaller;">${n.Eremh.Zremision}</p>`+`<p style="width:100%;font-size: smaller;">${this.getConfigModel().getProperty("/supplierInput")}</p>`+`<p style="width:100%;font-size: smaller;">${r[i][0].Werks} - ${r[i][0].Name1}</p>`+'<svg class="barcode"'+`jsbarcode-value="${i}"`+'jsbarcode-textmargin="0"'+'jsbarcode-fontoptions="bold" jsbarcode-width="2" jsbarcode-fontSize="12">'+"</svg>"+`<p style="width:60%; text-align:left; font-size: smaller;">${this.getView().getModel("appTxts").getProperty("/rem.palletbox")}: ${e} de ${Object.keys(r).length}</p>`+"</div>";e++;if(t===6){t=0;o+="<br><br><br> <br><br><br> <br><br><br> <br><br><br>"}}}o+="</div></div>";t.html=o;this._uploadDialog2.setModel(new e(t));this._uploadDialog2.open();JsBarcode(".barcode").init()},groupByAuto:function(e,t){var o={};for(var n in e){if(!o.hasOwnProperty(e[n][t]))o[e[n][t]]=[];o[e[n][t]].push(e[n])}return o},onCloseDialogBoxPrint:function(){if(this._uploadDialog2){this._uploadDialog2.destroy();this._uploadDialog2=null}},saveCoordinates:function(){var e=document.getElementById("codeGroupDiv");var t={margin:0,filename:"GroupCode.pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:true},jsPDF:{unit:"in",format:"letter",orientation:"landscape"},pagebreak:{mode:["avoid-all","css","legacy"]}};html2pdf().set(t).from(e).save()},printConsolidated:function(){if(!this._uploadDialog2){this._uploadDialog2=sap.ui.xmlfragment("printBoxesLabels","demo.views.Remissions.fragments.DetailConsolidated",this);this.getView().addDependent(this._uploadDialog2)}var t=this.getView().getModel("tableRemissionDetail").getData();var o={cajtars:[]};o.supplier=this.getConfigModel().getProperty("/supplierInput");o.remisionNo=t.Eremh.Zremision;if(t.ETREMDNAV.results!=null){var n=this.groupByAuto(t.ETREMDNAV.results,"Cajtar");for(const e in n){var r={Cajtar:e,Werks:n[e][0].Werks,Name1:n[e][0].Name1,items:n[e]};o.cajtars.push(r)}}this._uploadDialog2.setModel(new e(o));this._uploadDialog2.open();JsBarcode(".barcode").init()},printDetailConsolidated:function(){var e=document.getElementById("printBoxesLabels--consolidatedDetail");var t={margin:0,filename:"GroupCode.pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:true},jsPDF:{unit:"in",format:"letter",orientation:"portrait"},pagebreak:{mode:["avoid-all","css","legacy"]}};html2pdf().set(t).from(e).save();e.clear()}})});