sap.ui.define(["sap/ui/model/json/JSONModel","demo/controllers/BaseController","sap/ui/core/mvc/Controller"],function(e,t){"use strict";var r=new this.Incidencias;return t.extend("demo.controllers.Incidencias.Master",{onInit:function(){this.getView().addEventDelegate({onBeforeShow:function(e){}},this);var e=sap.ui.core.UIComponent.getRouterFor(this);e.getRoute("masterIncidencias").attachMatched(this._onRouteMatched,this)},_onRouteMatched:function(e){this.clearData()},getData:function(t){this.clearFilters();this.oRouter=this.getOwnerComponent().getRouter();this.oModel=this.getOwnerComponent().getModel();var r=true;var i=this.getConfigModel().getProperty("/supplierInputKey");var n=this.getOwnerComponent().getModel("appTxts");var o=this.getView().byId("dateRange");var a=this.getView().byId("folio");var s=this.getView().byId("estatus");var l=this.buildSapDate(o.getDateValue());var p=this.buildSapDate(o.getSecondDateValue());if(r){let t=[];t.push(new sap.ui.model.Filter({path:"IOption",operator:sap.ui.model.FilterOperator.EQ,value1:"1"}));if(i!=null&&i!=""){t.push(new sap.ui.model.Filter({path:"ILifnr",operator:sap.ui.model.FilterOperator.EQ,value1:i}))}if(l!=null&&l!=""&&p!=null&&p!=""){t.push(new sap.ui.model.Filter({path:"ISdate",operator:sap.ui.model.FilterOperator.EQ,value1:l}));t.push(new sap.ui.model.Filter({path:"IFdate",operator:sap.ui.model.FilterOperator.EQ,value1:p}))}if(a!=null&&a!=""){t.push(new sap.ui.model.Filter({path:"IUuid",operator:sap.ui.model.FilterOperator.EQ,value1:a}))}if(s!=null&&s!=""){t.push(new sap.ui.model.Filter({path:"IStatus",operator:sap.ui.model.FilterOperator.EQ,value1:uustatusid}))}if(i==null||i==""){if(l==null||l==""){if(a==null||a==""){if(s==null||s==""){r=false}}}}if(r){sap.ui.core.BusyIndicator.show();let r=this;this._GetODataV2("ZOSP_INDASHBOARD_SRV","HdrInSet",t,["ETLOGFNAV","ETTLIFNAV","ETCFDINAV"],"").then(t=>{r.getOwnerComponent().setModel(new e(t.data.results[0]),"Incidencias");r.paginate("Incidencias","/ETLOGFNAV",1,0);r.getSegments();sap.ui.core.BusyIndicator.hide()}).catch(e=>{console.error(e)})}else{sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/global.searchFieldsEmpty"))}}},goToMainReleases:function(){this.handleClose()},getSegments:function(){var t=this.getOwnerComponent().getModel("Incidencias").getData();var r={Segmentos:[]};var i="Estatus";var n=this.getView().byId("rbgInc").getSelectedIndex();switch(n){case 0:i="Estatus";break;case 1:i="Lifnr";break}var o=this.groupBySum(t.ETTLIFNAV.results);for(const e in o){var a={};a.provider=e;a.value=o[e];r.Segmentos.push(a)}this.getOwnerComponent().setModel(new e(r),"segmentos")},groupByAuto:function(e,t){var r={};for(var i in e){if(!r.hasOwnProperty(e[i][t]))r[e[i][t]]=[];r[e[i][t]].push(e[i])}return r},groupBySum:function(e){var t={},r=0,i=0;for(var n in e){r+=parseInt(e[n].N1,10);i+=parseInt(e[n].N3,10)}t.Aprobado=i;t.Incidencias=r;return t},clearFilters:function(){},exportTopTen:function(){var e=this.getOwnerComponent().getModel("appTxts");var t=[{name:e.getProperty("/incidencias.supplier"),template:{content:"{Lifnr}"}},{name:e.getProperty("/incidencias.supplier"),template:{content:"{Nlifnr}"}},{name:e.getProperty("/incidencias.error"),template:{content:"{N1}"}},{name:e.getProperty("/incidencias.success"),template:{content:"{N3}"}}];this.exportxls("Incidencias","/ETTLIFNAV/results",t)},buildExcel:function(){var e=this.getOwnerComponent().getModel("appTxts");var t=this.getOwnerComponent().getModel("Incidencias").getProperty("/ETLOGFNAV/results");console.log(t);var r=[{label:e.getProperty("/incidencias.uuid"),property:"Uuid"},{label:e.getProperty("/incidencias.vendor"),property:"Lifnr"},{label:e.getProperty("/incidencias.vendorName"),property:"Nlifnr"},{label:e.getProperty("/incidencias.date"),property:"Fecha"},{label:e.getProperty("/incidencias.hour"),property:"Hora"},{label:e.getProperty("/incidencias.messageN"),property:"Mensaje"},{label:e.getProperty("/incidencias.message"),property:"Descripcion1"},{label:e.getProperty("/incidencias.status"),property:"Estatus"},{label:e.getProperty("/incidencias.serie"),property:"Serie"},{label:e.getProperty("/incidencias.folio"),property:"Folio"},{label:e.getProperty("/incidencias.descTipoDoc"),property:"Tipdoc"},{label:e.getProperty("/incidencias.numDocFact"),property:"Belnr"}];this.buildExcelSpreadSheet(r,t,"Incidencias.xlsx")},clearData:function(){var e=this.getOwnerComponent().getModel("Incidencias");var t=this.getOwnerComponent().getModel("segmentos");var r=this.getView().byId("dateRange");if(e!==undefined){e.setProperty("/ENfacr",0);e.setProperty("/ENtr",0);e.setProperty("/EN3",0);e.setProperty("/EN2",0);e.setProperty("/EN1",0);e.setProperty("/ETTLIFNAV/results",[]);t.setProperty("/Segmentos",{});r.setValue(null)}}})});