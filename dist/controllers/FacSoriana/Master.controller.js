sap.ui.define(["jquery.sap.global","sap/ui/core/Fragment","demo/controllers/BaseController","sap/m/UploadCollectionParameter","sap/ui/core/mvc/Controller","sap/m/PDFViewer","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","sap/m/MessageBox","sap/ui/core/routing/Router","demo/models/BaseModel","sap/f/library"],function(e,t,a,r,o,i,n,s){"use strict";var l=new this.FacSoriana;var d=new this.DevoZipModel;return a.extend("demo.controllers.FacSoriana.Master",{onInit:function(){this.getView().addEventDelegate({onAfterShow:function(e){var t=this.getConfigModel();t.setProperty("/barVisible",true);this.getOwnerComponent().setModel(new n,"tableItemsFacSoriana");this.clearFilters()}},this)},searchData:function(){if(!this.hasAccess(21)){return false}var e=false;if(!l.getModel()){l.initModel()}var t=sap.ui.core.format.DateFormat.getDateTimeInstance({parent:"yyyyMMdd"});var a=this.getView().byId("invoiceDay");var r=this.buildSapDate(a.getDateValue());var o=this.buildSapDate(a.getSecondDateValue());var i=this.getConfigModel().getProperty("/supplierInputKey");var s=this.getView().byId("docno").getValue();if(i!=null&&i!=""){e=true}else{sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/global.supplierSelectError"))}if(e){if(s==""){if(r!=""&&o!=""){e=true}else{e=false;sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/global.searchFieldsEmpty"))}}else{e=true}}if(e){var d="/headSorInvSet?$expand=ETAGDOCNAV,ETDCTDTNAV,ETPMTDCNAV&$filter= IOption eq '1' and ILifnr eq '"+i+"'";if(s!=""){d+=" and IDocnum eq '"+s+"'"}if(r!=""&&o!=""){d+=" and IScdate eq '"+r+"'";d+=" and IFcdate eq '"+o+"'"}var p=l.getJsonModel(d);if(p!=null){var g=p.getProperty("/results/0");this.getOwnerComponent().setModel(new n(g),"tableItemsFacSoriana");this.paginate("tableItemsFacSoriana","/ETPMTDCNAV",1,0);console.log(p)}}},onExit:function(){},downloadButton:function(){if(!this.hasAccess(41)){return false}var e=this.byId("facSorianaTable").getSelectedItems();var t=this.getOwnerComponent().getModel("appTxts");var a=this.getConfigModel().getProperty("/supplierInputKey");var r={};var o="";var i="";var s="";var l="";var p="";a="325670";o="";o="/EDetecnoSet?$filter=Vblnr eq '"+p+"'"+" and Lifnr eq '"+a+"'"+" and Bukrs eq '"+l+"'"+" and Budat eq '"+i+"'"+" &$format=json";var g=d.getJsonModel(o);if(g!=null){var u=g.getProperty("/results/0");this.getOwnerComponent().setModel(new n(u),"zipResult");console.log(g);this.downloadAttach("data:@file/zip;base64,"+u.Zip,"application/zip")}},filtrado:function(e){var t=[];var a=e.getParameter("query");var r=this.getView().byId("selectFilter");var o=r.getSelectedKey();if(a&&a.length>0){var i=new sap.ui.model.Filter(o,sap.ui.model.FilterOperator.Contains,a);t.push(i)}var n=this.getView().byId("complPagoList");var s=n.getBinding("items");s.filter(t)},setDaterangeMaxMin:function(){var e=this.getView().byId("dateRange");var t=new Date;var a=new Date;var r=new Date;r.setDate(t.getDate()-7);a.setDate(t.getDate()-30);e.setSecondDateValue(t);e.setDateValue(r)},clearFilters:function(){this.getView().byId("invoiceDay").setValue("");this.getView().byId("docno").setValue("")},onListItemPress:function(e){var t=e.getSource().getBindingContext("tableItemsFacSoriana").getPath(),a=t.split("/").slice(-1).pop();var r=this.getOwnerComponent().getModel("tableItemsFacSoriana");var o=r.getProperty("/ETPMTDCNAV/results");var i=o[a];this.getOwnerComponent().getRouter().navTo("detailFacSoriana",{layout:sap.f.LayoutType.TwoColumnsMidExpanded,document:i.Augbl,budat:i.Budat,zconfact:i.Zconfact,bukrs:i.Bukrs,lifnr:this.getConfigModel().getProperty("/supplierInputKey")},true)}})});