sap.ui.define(["sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","demo/controllers/BaseController","sap/ui/export/library"],function(e,t,o,r,n){"use strict";var s=new this.Pedidostemp;var i=new this.ModelEDI;var a=new this.ModelTC;var l=new this.ModelXlsPedidos;var d=n.EdmType;return r.extend("demo.controllers.Orders.Detail",{onInit:function(){var e=this.getView().byId("exitFullScreenBtn"),t=this.getView().byId("enterFullScreenBtn");this.oRouter=this.getOwnerComponent().getRouter();this.oModel=this.getOwnerComponent().getModel();this.txtTermsCond=this.getView().byId("txtTermsCond");this.txtTermsCond2=this.getView().byId("txtTermsCond2");this.txtTermsCond3=this.getView().byId("txtTermsCond3");this.ediModel=new sap.ui.model.odata.v2.ODataModel(i.sUrl);this.termModel=new sap.ui.model.odata.v2.ODataModel(a.sUrl);this.xlsModel=new sap.ui.model.odata.v2.ODataModel(l.sUrl);this.oRouter.getRoute("detailOrders").attachPatternMatched(this._onDocumentMatched,this)},handleItemPress:function(e){var t=this.getOwnerComponent().getHelper().getNextUIState(2),r=e.getSource().getBindingContext("tableDetailMoves").getPath();var n=this.getOwnerComponent().getModel("tableDetailMoves").getProperty(r);if(!this._oDialog||this.oDialog===undefined){this._oDialog=sap.ui.xmlfragment("demo.fragments.Exhaustion",this)}this.getView().addDependent(this._oDialog);jQuery.sap.syncStyleClass("sapUiSizeCompact",this.getView(),this._oDialog);this._oDialog.setModel(new o(n));this._oDialog.open()},handleFullScreen:function(){this.bFocusFullScreenButton=true;var e=this.oModel.getProperty("/actionButtonsInfo/midColumn/fullScreen");this.oRouter.navTo("detailOrders",{layout:e,document:this._document})},handleExitFullScreen:function(){this.bFocusFullScreenButton=true;var e=this.oModel.getProperty("/actionButtonsInfo/midColumn/exitFullScreen");this.oRouter.navTo("detailOrders",{layout:e,document:this._document})},handleClose:function(){var e=this.oModel.getProperty("/actionButtonsInfo/midColumn/closeColumn");this.oRouter.navTo("masterOrders",{layout:e})},_onDocumentMatched:function(e){this._document=e.getParameter("arguments").document||this._document||"0";var t="notCreditSet?$expand=Oekponav,OEKKONAV,OEKKOADVRNAV&$filter=IOption eq '5' and IEbeln eq '"+this._document+"'";var r=s.getJsonModel(t);var n=r.getProperty("/results/0");console.log(r);this.getOwnerComponent().setModel(new o(n),"tableDetailMoves");this.paginate("tableDetailMoves","/Oekponav",1,0);this.paginate("tableDetailMoves","/OEKKOADVRNAV",1,0);this.getTermsCons()},formatSatusOrder:function(e){if(e){return"Cerrado"}else{return"Abierto"}},formatBranch:function(e,t,o,r){var n="";if(e=="X"){n=t}else{n=o+" "+r}return n},onCloseDialog:function(){if(this._oDialog){this._oDialog.destroy();this._oDialog=null}},onExit:function(){this.onCloseDialog()},buildExcel:function(){console.log("Expotar excel!!!!");var o=this;var r=[];r.push(new e("Ebeln",t.EQ,this._document));this.xlsModel.read("/EnvExcelSet",{filters:r,success:function(e){var t=e.results[0].Excel;const r=`data:application/vnd.ms-excel;charset=utf-8;base64,${t}`;const n=document.createElement("a");n.href=r;n.download=`Excel_Pedido_${o._document}.xls`;n.click()},error:function(e){sap.m.MessageBox.error(o.getOwnerComponent().getModel("appTxts").getProperty("/order.xlsError"))}})},createColumnConfig:function(){return[{label:this.getOwnerComponent().getModel("appTxts").getProperty("/order.excel.supplierNum"),type:d.Number,property:"Lifnr"},{label:this.getOwnerComponent().getModel("appTxts").getProperty("/order.excel.order"),type:d.Number,property:"Ebeln"},{label:this.getOwnerComponent().getModel("appTxts").getProperty("/order.excel.orderDate"),property:"Bedat"},{label:this.getOwnerComponent().getModel("appTxts").getProperty("/order.excel.warehouseCode"),type:d.String,property:"Werks"},{label:this.getOwnerComponent().getModel("appTxts").getProperty("/order.excel.warehouseDesc"),type:d.String,width:40,property:"Name1"},{label:this.getOwnerComponent().getModel("appTxts").getProperty("/order.excel.fechaEmbarque"),property:"Kdate"},{label:this.getOwnerComponent().getModel("appTxts").getProperty("/order.excel.fechaEndEmbarque"),property:"Kdatb"},{label:this.getOwnerComponent().getModel("appTxts").getProperty("/order.excel.paymentLimit"),type:d.String,property:"Zterm"},{label:this.getOwnerComponent().getModel("appTxts").getProperty("/order.excel.quantity"),type:d.Currency,unitProperty:"Meins",property:"Menge",displayUnit:true,width:25},{label:this.getOwnerComponent().getModel("appTxts").getProperty("/order.excel.code"),property:"Ean11",width:15},{label:this.getOwnerComponent().getModel("appTxts").getProperty("/order.excel.price"),type:d.Currency,unitProperty:"Waers",property:"Netpr",displayUnit:true,width:25},{label:this.getOwnerComponent().getModel("appTxts").getProperty("/order.excel.description"),property:"Txz01",type:d.String,width:40}]},createData:function(){var e=this.getOwnerComponent().getModel("tableDetailMoves").getProperty("/OEKKONAV/results/0");var t=this.getOwnerComponent().getModel("tableDetailMoves").getProperty("/Oekponav/results");t.forEach(function(t){t.Lifnr=e.Lifnr;t.Bedat=e.Bedat;t.Kdate=e.Kdate;t.Kdatb=e.Kdatb;t.Zterm=e.Zterm});return t},downloadEDI:function(o){var r=this;var n=[];n.push(new e("Ebeln",t.EQ,this._document));this.ediModel.read("/EdiFileSet",{filters:n,success:function(e){console.log(e);if(e.results.length>0){var t=e.results[0].Datar;const o=`data:text/plain;charset=utf-8;base64,${t}`;const n=document.createElement("a");n.href=o;n.download=`EDI_${r._document}.txt`;n.click()}else{sap.m.MessageBox.error(r.getOwnerComponent().getModel("appTxts").getProperty("/order.ediEmptyError"))}},error:function(e){sap.m.MessageBox.error(r.getOwnerComponent().getModel("appTxts").getProperty("/order.downEdiError"))}})},getTermsCons:function(o){var r=this;var n=this.getConfigModel().getProperty("/supplierInputKey");var s=[];s.push(new e("Lifnr",t.EQ,n));this.termModel.read("/TxtTermCondSet",{filters:s,success:function(e){var t=e.results[0].Texto;r.txtTermsCond.setText(t);r.txtTermsCond2.setText(t);r.txtTermsCond3.setText(t)},error:function(e){sap.m.MessageBox.error(r.getOwnerComponent().getModel("appTxts").getProperty("/order.termconsError"))}})}})});