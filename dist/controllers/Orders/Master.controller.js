sap.ui.define(["jquery.sap.global","sap/ui/core/Fragment","demo/controllers/BaseController","sap/m/UploadCollectionParameter","sap/ui/core/mvc/Controller","sap/m/PDFViewer","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","sap/m/MessageBox","sap/ui/core/routing/Router","demo/models/BaseModel","sap/f/library"],function(e,t,a,r,i,o,s,l){"use strict";var n="";var d=new this.Pedidostemp;var p="";var u="";var g=true;var m=new this.CfdiModel;var h="ZOSP_DEVO_NC_SRV_01";var c="notCreditSet";return a.extend("demo.controllers.Orders.Master",{onInit:function(){this._pdfViewer=new o;this.getView().addDependent(this._pdfViewer);this.getView().addEventDelegate({onAfterShow:function(e){var t=this.getView().byId("filterBar");var a=this.getOwnerComponent().getModel();a.setProperty("/barVisible",true);this.getOwnerComponent().setModel(new s,"tableItemsOrders");this.clearFilters();this.getConfigModel().setProperty("/updateFormatsSingle","xml")}},this);this.configFilterLanguage(this.getView().byId("filterBar"))},searchData:function(){sap.ui.core.BusyIndicator.show(0);if(!this.hasAccess(1)){sap.ui.core.BusyIndicator.hide();return false}var e=false;if(!d.getModel()){d.initModel()}var t=sap.ui.core.format.DateFormat.getDateTimeInstance({parent:"yyyyMMdd"});var a=this.getView().byId("dateRange");var r=this.getView().byId("dateOrder");var i=this.getView().byId("deliveryDate");var o=this.buildSapDate(a.getDateValue());var l=this.buildSapDate(a.getSecondDateValue());var n=this.buildSapDate(r.getDateValue());var p=this.buildSapDate(r.getSecondDateValue());var u=this.buildSapDate(i.getDateValue());var g=this.buildSapDate(i.getSecondDateValue());var m=this.getConfigModel().getProperty("/supplierInputKey");var f=this.getView().byId("order").getValue();var v=this.getView().byId("closedOrders").getSelected();var y=this.getView().byId("order").getVisible();if(m!=null&&m!=""){e=true}else{sap.ui.core.BusyIndicator.hide();sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/global.supplierSelectError"))}if(e){if(f==""){if(o!=""&&l!=""||n!=""&&p!=""||u!=""&&g!=""){e=true}else{e=false;sap.ui.core.BusyIndicator.hide();sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/global.searchFieldsEmpty"))}}else{e=true}}if(e){var I=[];I.push(new sap.ui.model.Filter("IOption",sap.ui.model.FilterOperator.EQ,"4"));I.push(new sap.ui.model.Filter("ILifnr",sap.ui.model.FilterOperator.EQ,m));if(f!=""){I.push(new sap.ui.model.Filter("IEbeln",sap.ui.model.FilterOperator.EQ,f))}if(u!=""&&g!=""){I.push(new sap.ui.model.Filter("IKdatb",sap.ui.model.FilterOperator.EQ,u));I.push(new sap.ui.model.Filter("IKdate",sap.ui.model.FilterOperator.EQ,g))}if(n!=""&&p!=""){I.push(new sap.ui.model.Filter("IFini",sap.ui.model.FilterOperator.EQ,n));I.push(new sap.ui.model.Filter("IFfin",sap.ui.model.FilterOperator.EQ,p))}if(o!=""&&l!=""){I.push(new sap.ui.model.Filter("IEindt",sap.ui.model.FilterOperator.EQ,o));I.push(new sap.ui.model.Filter("IEindf",sap.ui.model.FilterOperator.EQ,l))}if(v!=null&&v){I.push(new sap.ui.model.Filter("IClose",sap.ui.model.FilterOperator.EQ,"X"))}let e=this;let t=5,a=5;this._GetODataV2(h,c,I,["OEKKONAV"],t,a).then(e=>{var t=e.data.results[0];this.getOwnerComponent().setModel(new s(t),"tableItemsOrders");this.paginate("tableItemsOrders","/OEKKONAV",1,0);sap.ui.core.BusyIndicator.hide()}).catch(e=>{sap.ui.core.BusyIndicator.hide()})}},onExit:function(){if(this._uploadDialog2){this._uploadDialog2.destroy();this._uploadDialog2=null}},openUploadDialog:function(){if(!this.hasAccess(4)){return false}if(!this._uploadDialog2){this._uploadDialog2=sap.ui.xmlfragment("uploadInvoice","demo.fragments.UploadInvoice",this);this.getView().addDependent(this._uploadDialog2)}this._uploadDialog2.open()},onCloseDialogUpload:function(){if(this._uploadDialog2){this._uploadDialog2.destroy();this._uploadDialog2=null}},documentUploadPress:function(){var e=sap.ui.core.Fragment.byId("uploadInvoice","fileUploader");var t=sap.ui.core.Fragment.byId("uploadInvoice","logUploadList");var a=sap.ui.core.Fragment.byId("uploadInvoice","uploadBox");var r=this.getConfigModel().getProperty("/supplierInputKey");if(!e.getValue()){sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/helpDocs.uploader.nodata"));return}var i={Lifnr:r,Type:"",Format:"X",Log:[{Uuid:"",Description:"",Sts:""}]};var o=this.byId("complPagoList").getSelectedItems();if(o.length>0){var l=o[0].getBindingContext("tableItemsOrders").getObject();i.Docmat=l.Ebeln}var n=e.oFileUpload.files[0];var d=new FileReader;d.onload=function(r){var o={};var l=r.target.result.split(",");o.Cfdii=l[1];i.Cfdi=l[1];var n=m.create("/ECfdiSet ",i);if(n!=null){a.setVisible(false);if(n.Log!=null){t.setVisible(true);t.setModel(new s(n))}else{sap.m.MessageBox.error(n.EMessage)}}e.clear()};d.readAsDataURL(n)},onListItemPress:function(e){var t=e.getSource().getBindingContext("tableItemsOrders").getPath(),a=t.split("/").slice(-1).pop();var r=this.getOwnerComponent().getModel("tableItemsOrders");var i=r.getProperty("/OEKKONAV/Paginated/results");var o=i[a].Ebeln;this.getOwnerComponent().getRouter().navTo("detailOrders",{layout:sap.f.LayoutType.MidColumnFullScreen,document:o},true)},buildExportTable:function(){var e=this.getOwnerComponent().getModel("appTxts");var t=[{name:"Pedidos",template:{content:"{Ebeln}"}},{name:"Cliente",template:{content:"{Bukrs} - {Butxt}"}},{name:"Monto",template:{content:"{Netwr}"}},{name:"Moneda",template:{content:"{Waers}"}},{name:"Fecha entrega",template:{content:"{Eindt}"}},{name:e.getProperty("/order.shipmentend"),template:{content:"{Kdate}"}},{name:e.getProperty("/order.ocompra"),template:{content:"{Ekorg}"}},{name:e.getProperty("/order.assorment"),template:{content:"{Telf1}"}}];this.exportxls("tableItemsOrders","/OEKKONAV/results",t)},clearFilters:function(){this.getView().byId("dateRange").setValue("");this.getView().byId("dateOrder").setValue("");this.getView().byId("deliveryDate").setValue("");this.getView().byId("order").setValue("");this.getView().byId("closedOrders").setSelected(false)}})});