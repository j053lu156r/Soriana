sap.ui.define(["demo/controllers/BaseController","sap/m/PDFViewer","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,r,a,o){"use strict";var i=new this.Pedidostemp;var s=new this.CfdiModel;var l="ZOSP_DEVO_NC_SRV_01";var n="notCreditSet";var d=new this.ModelXlsPedidos;var p=new this.ModelEDI;return e.extend("demo.controllers.Orders.Master",{onInit:function(){this._pdfViewer=new t;this.getView().addDependent(this._pdfViewer);this.getView().addEventDelegate({onAfterShow:function(e){var t=this.getView().byId("filterBar");var a=this.getOwnerComponent().getModel();a.setProperty("/barVisible",true);this.getOwnerComponent().setModel(new r,"tableItemsOrders");this.clearFilters();this.getConfigModel().setProperty("/updateFormatsSingle","xml")}},this);this.configFilterLanguage(this.getView().byId("filterBar"));this.xlsModel=new sap.ui.model.odata.v2.ODataModel(d.sUrl);this.ediModel=new sap.ui.model.odata.v2.ODataModel(p.sUrl)},searchData:function(){sap.ui.core.BusyIndicator.show(0);if(!this.hasAccess(1)){sap.ui.core.BusyIndicator.hide();return false}var e=false;if(!i.getModel()){i.initModel()}var t=sap.ui.core.format.DateFormat.getDateTimeInstance({parent:"yyyyMMdd"});var a=this.getView().byId("dateRange");var o=this.getView().byId("dateOrder");var s=this.getView().byId("deliveryDate");var d=this.buildSapDate(a.getDateValue());var p=this.buildSapDate(a.getSecondDateValue());var u=this.buildSapDate(o.getDateValue());var g=this.buildSapDate(o.getSecondDateValue());var c=this.buildSapDate(s.getDateValue());var m=this.buildSapDate(s.getSecondDateValue());var h=this.getConfigModel().getProperty("/supplierInputKey");var f=this.getView().byId("order").getValue();var v=this.getView().byId("closedOrders").getSelected();var y=this.getView().byId("order").getVisible();if(h!=null&&h!=""){e=true}else{sap.ui.core.BusyIndicator.hide();sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/global.supplierSelectError"))}if(e){if(f==""){if(d!=""&&p!=""||u!=""&&g!=""||c!=""&&m!=""){e=true}else{e=false;sap.ui.core.BusyIndicator.hide();sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/global.searchFieldsEmpty"))}}else{e=true}}if(e){var w=[];w.push(new sap.ui.model.Filter("IOption",sap.ui.model.FilterOperator.EQ,"4"));w.push(new sap.ui.model.Filter("ILifnr",sap.ui.model.FilterOperator.EQ,h));if(f!=""){w.push(new sap.ui.model.Filter("IEbeln",sap.ui.model.FilterOperator.EQ,f))}if(c!=""&&m!=""){w.push(new sap.ui.model.Filter("IKdatb",sap.ui.model.FilterOperator.EQ,c));w.push(new sap.ui.model.Filter("IKdate",sap.ui.model.FilterOperator.EQ,m))}if(u!=""&&g!=""){w.push(new sap.ui.model.Filter("IFini",sap.ui.model.FilterOperator.EQ,u));w.push(new sap.ui.model.Filter("IFfin",sap.ui.model.FilterOperator.EQ,g))}if(d!=""&&p!=""){w.push(new sap.ui.model.Filter("IEindt",sap.ui.model.FilterOperator.EQ,d));w.push(new sap.ui.model.Filter("IEindf",sap.ui.model.FilterOperator.EQ,p))}if(v!=null&&v){w.push(new sap.ui.model.Filter("IClose",sap.ui.model.FilterOperator.EQ,"X"))}let e=this;let t=5,a=5;this._GetODataV2(l,n,w,["OEKKONAV"],t,a).then(e=>{var t=e.data.results[0];this.getOwnerComponent().setModel(new r(t),"tableItemsOrders");this.paginate("tableItemsOrders","/OEKKONAV",1,0);sap.ui.core.BusyIndicator.hide()}).catch(e=>{sap.ui.core.BusyIndicator.hide()})}},onExit:function(){if(this._uploadDialog2){this._uploadDialog2.destroy();this._uploadDialog2=null}},openUploadDialog:function(){if(!this.hasAccess(4)){return false}if(!this._uploadDialog2){this._uploadDialog2=sap.ui.xmlfragment("uploadInvoice","demo.fragments.UploadInvoice",this);this.getView().addDependent(this._uploadDialog2)}this._uploadDialog2.open()},onCloseDialogUpload:function(){if(this._uploadDialog2){this._uploadDialog2.destroy();this._uploadDialog2=null}},documentUploadPress:function(){var e=sap.ui.core.Fragment.byId("uploadInvoice","fileUploader");var t=sap.ui.core.Fragment.byId("uploadInvoice","logUploadList");var a=sap.ui.core.Fragment.byId("uploadInvoice","uploadBox");var o=this.getConfigModel().getProperty("/supplierInputKey");if(!e.getValue()){sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/helpDocs.uploader.nodata"));return}var i={Lifnr:o,Type:"",Format:"X",Log:[{Uuid:"",Description:"",Sts:""}]};var l=this.byId("complPagoList").getSelectedItems();if(l.length>0){var n=l[0].getBindingContext("tableItemsOrders").getObject();i.Docmat=n.Ebeln}var d=e.oFileUpload.files[0];var p=new FileReader;p.onload=function(o){var l={};var n=o.target.result.split(",");l.Cfdii=n[1];i.Cfdi=n[1];var d=s.create("/ECfdiSet ",i);if(d!=null){a.setVisible(false);if(d.Log!=null){t.setVisible(true);t.setModel(new r(d))}else{sap.m.MessageBox.error(d.EMessage)}}e.clear()};p.readAsDataURL(d)},onListItemPress:function(e){var t=e.getSource().getBindingContext("tableItemsOrders").getPath(),r=t.split("/").slice(-1).pop();var a=this.getOwnerComponent().getModel("tableItemsOrders");var o=a.getProperty("/OEKKONAV/Paginated/results");var i=o[r].Ebeln;this.getOwnerComponent().getRouter().navTo("detailOrders",{layout:sap.f.LayoutType.MidColumnFullScreen,document:i},true)},buildExportTable:function(){var e=this.getOwnerComponent().getModel("appTxts");var t=[{name:e.getProperty("/order.title"),template:{content:"{Ebeln}"}},{name:e.getProperty("/order.customer"),template:{content:"{Bukrs} - {Butxt}"}},{name:e.getProperty("/order.amount"),template:{content:"{Netwr}"}},{name:e.getProperty("/order.currency"),template:{content:"{Waers}"}},{name:e.getProperty("/order.deliveryend"),template:{content:"{Eindt}"}},{name:e.getProperty("/order.shipmentstart"),template:{content:"{Kdatb}"}},{name:e.getProperty("/order.shipmentend"),template:{content:"{Kdate}"}},{name:e.getProperty("/order.ocompra"),template:{content:"{Ekorg}"}},{name:e.getProperty("/order.clase"),template:{content:"{Bsart}"}},{name:e.getProperty("/order.descript"),template:{content:"{Bsart_d}"}},{name:e.getProperty("/order.assorment"),template:{content:"{Telf1}"}},{name:e.getProperty("/order.center"),template:{content:"{Werks}"}}];this.exportxls("tableItemsOrders","/OEKKONAV/results",t)},clearFilters:function(){this.getView().byId("dateRange").setValue("");this.getView().byId("dateOrder").setValue("");this.getView().byId("deliveryDate").setValue("");this.getView().byId("order").setValue("");this.getView().byId("closedOrders").setSelected(false)},buildExcel:function(e){var t=this;var r=e.getSource().getBindingContext("tableItemsOrders").getObject();var i=[];i.push(new a("Ebeln",o.EQ,r.Ebeln));this.xlsModel.read("/EnvExcelSet",{filters:i,success:function(e){var t=e.results[0].Excel;const a=`data:application/vnd.ms-excel;charset=utf-8;base64,${t}`;const o=document.createElement("a");o.href=a;o.download=`Excel_Pedido_${r.Ebeln}.xls`;o.click()},error:function(e){console.log(e);sap.m.MessageBox.error(t.getOwnerComponent().getModel("appTxts").getProperty("/order.xlsError"))}})},downloadEDI:function(e){var t=this;var r=e.getSource().getBindingContext("tableItemsOrders").getObject();var i=[];i.push(new a("Ebeln",o.EQ,r.Ebeln));this.ediModel.read("/EdiFileSet",{filters:i,success:function(e){console.log(e);if(e.results.length>0){var a=e.results[0].Datar;const t=`data:text/plain;charset=utf-8;base64,${a}`;const o=document.createElement("a");o.href=t;o.download=`EDI_${r.Ebeln}.txt`;o.click()}else{sap.m.MessageBox.error(t.getOwnerComponent().getModel("appTxts").getProperty("/order.ediEmptyError"))}},error:function(e){sap.m.MessageBox.error(t.getOwnerComponent().getModel("appTxts").getProperty("/order.downEdiError"))}})}})});