sap.ui.define(["jquery.sap.global","sap/ui/core/Fragment","demo/controllers/BaseController","sap/m/UploadCollectionParameter","sap/ui/core/mvc/Controller","sap/m/PDFViewer","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","sap/m/MessageBox","sap/ui/core/routing/Router","demo/models/BaseModel","sap/f/library"],function(e,t,r,a,o,i,s,l){"use strict";var n=new this.Devoluciones;var d="ZOSP_RETURNS_SRV";var p="HrdReturnsSet";return r.extend("demo.controllers.Devoluciones.Master",{onInit:function(){this.getView().addEventDelegate({onAfterShow:function(e){var t=this.getConfigModel();t.setProperty("/barVisible",true);this.getOwnerComponent().setModel(new s,"tableHeaderDevo");this.clearFilters()}},this)},searchData:function(){sap.ui.core.BusyIndicator.show(0);if(!this.hasAccess(25)){sap.ui.core.BusyIndicator.hide();return false}var e=false;if(!n.getModel()){n.initModel()}var t=sap.ui.core.format.DateFormat.getDateTimeInstance({parent:"yyyyMMdd"});var r=this.getView().byId("budat");var a=this.getView().byId("zfechreg");var o=this.buildSapDate(r.getDateValue());var i=this.buildSapDate(r.getSecondDateValue());var l=this.buildSapDate(a.getDateValue());var u=this.buildSapDate(a.getSecondDateValue());var g=this.getConfigModel().getProperty("/supplierInputKey");var c=this.getView().byId("xblnr").getValue();var f=this.getView().byId("werks").getValue();var v=this.getView().byId("zfolagrup").getValue();var h=this.getView().byId("zfolfedex").getValue();var m=this.getView().byId("zfechreg").getValue();if(g!=null&&g!=""){e=true}else{sap.ui.core.BusyIndicator.hide();sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/global.supplierSelectError"))}if(e){if(c==""){if(o==""&&i==""){if(l==""&&u==""){if(f==""){if(v==""){if(h==""){e=false;sap.ui.core.BusyIndicator.hide();sap.m.MessageBox.error(this.getOwnerComponent().getModel("appTxts").getProperty("/global.searchFieldsEmpty"))}else{e=true}}else{e=true}}else{e=true}e=true}else{e=true}}else{e=true}}else{e=true}}if(e){var b=[];b.push(new sap.ui.model.Filter("IOption",sap.ui.model.FilterOperator.EQ,"2"));b.push(new sap.ui.model.Filter("ILifnr",sap.ui.model.FilterOperator.EQ,g));if(c!=""){b.push(new sap.ui.model.Filter("IXblnr",sap.ui.model.FilterOperator.EQ,c))}if(o!=""&&i!=""){b.push(new sap.ui.model.Filter("IBudats",sap.ui.model.FilterOperator.EQ,o));b.push(new sap.ui.model.Filter("IBudatf",sap.ui.model.FilterOperator.EQ,i))}if(l!=""&&zfechregEndtDate!=""){b.push(new sap.ui.model.Filter("IRdates",sap.ui.model.FilterOperator.EQ,l));b.push(new sap.ui.model.Filter("IRdatef",sap.ui.model.FilterOperator.EQ,u))}if(f!=""){b.push(new sap.ui.model.Filter("IWerks",sap.ui.model.FilterOperator.EQ,f))}if(v!=""){b.push(new sap.ui.model.Filter("IZfolagrup",sap.ui.model.FilterOperator.EQ,v))}if(h!=""){b.push(new sap.ui.model.Filter("IZfolfedex",sap.ui.model.FilterOperator.EQ,h))}this._GetODataV2(d,p,b,["ETDTDEVNAV","ETFDEVNAV","ITDFAGR"]).then(e=>{var t=e.data.results[0];console.log(t);this.getOwnerComponent().setModel(new s(t),"tableHeaderDevo");this.paginate("tableHeaderDevo","/ETFDEVNAV",1,0);sap.ui.core.BusyIndicator.hide()}).catch(e=>{sap.ui.core.BusyIndicator.hide()})}},onExit:function(){},codeButton:function(){if(!this.hasAccess(35)){return false}var e=this.byId("tableHeader").getSelectedItems();var t=this.getOwnerComponent().getModel("appTxts");if(e.length>0){if(e.length<=20){var r={IOption:"4",ITDFAGR:[]};e.forEach(function(e){var t=e.getBindingContext("tableHeaderDevo").getObject();var a={};a.Ebeln=t.Ebeln;a.Xblnr=t.Xblnr;a.Bktxt=t.Bktxt;a.Bsart=t.Bsart;a.Werks=t.Werks;a.Lifnr=t.Lifnr;r.ITDFAGR.push(a)});var a=n.create("/HrdReturnsSet",r);if(a!=null){if(a.ESuccess=="X"){var o="";this.getOwnerComponent().setModel(new s(a),"tablecode");console.log(a);this.searchData();sap.m.MessageBox.success(t.getProperty("/devo.success"))}else{sap.m.MessageBox.error(a.EMessage)}}}else{sap.m.MessageBox.error(t.getProperty("/devo.MaxLines"))}}else{sap.m.MessageBox.error(t.getProperty("/devo.NoSelections"))}},printButton:function(){if(!this.hasAccess(36)){return false}var e=this.byId("tableHeader").getSelectedItems();console.log(e);var t=this.getOwnerComponent().getModel("appTxts");if(e.length>0){if(e.length==1){var r={};var a="";e.forEach(function(e){var t=e.getBindingContext("tableHeaderDevo").getObject();console.log(t);var r={};r.Ebeln=t.Ebeln;r.Xblnr=t.Xblnr;r.Bktxt=t.Bktxt;r.Bsart=t.Bsart;r.Werks=t.Werks;r.Lifnr=t.Lifnr;r.Zfolagrup=t.Zfolagrup;a="/HrdReturnsSet?$expand=ETDTDEVNAV,ETFDEVNAV,ITDFAGR&$filter= IOption eq '5' and ILifnr eq '"+t.Lifnr+"'";a+=" and IZfolagrup eq '"+t.Zfolagrup+"'";a+=" and ICprint eq 'X'"});console.log(a);var o=n.getJsonModel(a);if(o!=null){var i=o.getProperty("/results/0");console.log(i);if(!this._uploadDialog2){this._uploadDialog2=sap.ui.xmlfragment("printGroupFragment","demo.views.Devoluciones.fragments.GroupCode",this);this.getView().addDependent(this._uploadDialog2)}var l="";if(i.Esprintd.Wname!=""&&i.Esprintd.Nlif!=""&&i.Esprintd.Ref!=""&&i.Esprintd.Zfolagrup!=""){l='<div id="codeGroupDiv" style= "text-align: center; width: 100%;" >'+'<img src ="./images/LogoSoriana.svg" width="350px" />'+'<div style="text-align: center; width: 100%; font-size: large; font-weight: bold; margin: 10pt;" >'+"Formatos de devoluciones y retiros a recolectar"+"</div>"+'<div style= "text-align:left; width: 100%;" >'+`<b>Entrega en:</b> ${i.Esprintd.Wname}`+"</div>"+'<div style= "text-align:left; width: 100%;" >'+`<b>Proveedor:</b> ${i.Esprintd.Nlif}`+"</div>"+'<div style= "text-align:left; width: 100%;" >'+`<b>No. Referencia:</b> ${i.Esprintd.Ref}`+"</div>"+'<div style= "text-align:left; width: 100%;" >'+"<b>Código agrupador:</b>"+i.Esprintd.Zfolagrup+"</div>"+'<svg id="barcode"></svg>'+"<p>"+"Este documento acredita al portador como representante del proveedor para realizar la recolección de mercancia contenida en esta cita."+"Su uso indebido será responsabilidad del proveedor."+"</p>"+"</div>";i.Esprintd.html=l;this.getOwnerComponent().setModel(new s(i),"tableprint");this._uploadDialog2.open();JsBarcode("#barcode",i.Esprintd.Zfolagrup)}}}else{sap.m.MessageBox.error(t.getProperty("/devo.Maxprint"))}}else{sap.m.MessageBox.error(t.getProperty("/devo.NoSelections"))}},onCloseDialogPrint:function(){if(this._uploadDialog2){this._uploadDialog2.close();this._uploadDialog2.destroy();this._uploadDialog2=undefined}},saveCoordinates:function(){var e=document.getElementById("codeGroupDiv");var t={margin:1,filename:"GroupCode.pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:true},jsPDF:{unit:"in",format:"letter",orientation:"portrait"},pagebreak:{mode:["avoid-all","css","legacy"]}};html2pdf().set(t).from(e).save();e.clear()},filtrado:function(e){var t=[];var r=e.getParameter("query");var a=this.getView().byId("selectFilter");var o=a.getSelectedKey();if(r&&r.length>0){var i=new sap.ui.model.Filter(o,sap.ui.model.FilterOperator.Contains,r);t.push(i)}var s=this.getView().byId("complPagoList");var l=s.getBinding("items");l.filter(t)},setDaterangeMaxMin:function(){var e=this.getView().byId("dateRange");var t=new Date;var r=new Date;var a=new Date;a.setDate(t.getDate()-7);r.setDate(t.getDate()-30);e.setSecondDateValue(t);e.setDateValue(a)},onListItemPress:function(e){var t=e.getSource().getBindingContext("tableHeaderDevo").getPath(),r=t.split("/").slice(-1).pop();var a=this.getOwnerComponent().getModel("tableHeaderDevo");var o=a.getProperty("/ETFDEVNAV/Paginated/results");var i=o[r];this.getOwnerComponent().getRouter().navTo("detailDevo",{layout:sap.f.LayoutType.TwoColumnsMidExpanded,xblnr:i.Xblnr,lifnr:i.Lifnr,ebeln:i.Ebeln,suc:i.Werks},true)},buildExportTable:function(){var e=this.getOwnerComponent().getModel("appTxts");var t=[{name:e.getProperty("/devo.folioDevo"),template:{content:"{Xblnr}"}},{name:e.getProperty("/devo.fechaDevo"),template:{content:"{Budat}"}},{name:e.getProperty("/devo.sucursal"),template:{content:"{Werks}"}},{name:e.getProperty("/devo.sucursal"),template:{content:"{Nwerks}"}},{name:e.getProperty("/devo.folioFedex"),template:{content:"{Zfolfedex}"}},{name:e.getProperty("/devo.Code"),template:{content:"{Zfolagrup}"}},{name:e.getProperty("/devo.status"),template:{content:"{Devol}"}}];this.exportxls("tableHeaderDevo","/ETFDEVNAV/results",t)},clearFilters:function(){this.getView().byId("xblnr").setValue("");this.getView().byId("budat").setValue("");this.getView().byId("werks").setValue("");this.getView().byId("zfolagrup").setValue("");this.getView().byId("zfolfedex").setValue("");this.getView().byId("zfechreg").setValue("")}})});