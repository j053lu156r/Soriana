sap.ui.define(["demo/controllers/BaseController","sap/ui/core/Fragment","sap/ui/model/json/JSONModel","sap/m/MessageBox","demo/models/formatter"],function(e,t,s,a,r){"use strict";var l=new this.Pedidostemp;var i=new this.Citas1;var n=null;var o="";var d=false;var g="";var u={generalData:{cedisType:"",tipoCita:"",totalBultos:"",tarimas:"",tipoUnidad:"",tipoProducto:"",transportista:""},pedidos:[]};var p="ZOSP_CITAS_ADM_SRV";var C="MainSet";var O="ZOSP_PO_CITAS_SRV";var T="CitasPOSet";var E=null;var M=[];return e.extend("demo.controllers.Quotes.wizards.WQuoteCreate",{formatter:r,setInitialDate(){let e=this.getView().byId("DP1");let t=new Date;t=t.getTime()+1e3*60*60*24*1;e.setDateValue(new Date(t));e.setMinDate(new Date(t));e.fireChange();this.setInitialDateAuditoria()},setInitialDateAuditoria(){let e=this.getView().byId("DP2");let t=new Date;t=t.getTime()+1e3*60*60*24*1;e.setDateValue(new Date(t));e.setMinDate(new Date(t));e.fireChange()},createQuote:function(e){if(!this.hasAccess(31)){return}if(this.getConfigModel().getProperty("/supplierInputKey")!=null){this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel,"CitaMainData");this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel([]),"CitaCreationArray");if(e==="N"){this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel({lectura:false}),"ModelLectura")}this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel({editable:true}),"Modeleditable");var s=this.getView();var a="demo.views.Quotes.wizards.WQuoteCreate";let r=this;if(!this._pDialog){this._pDialog=t.load({id:s.getId(),name:a,controller:this}).then(function(e){e.attachAfterOpen(this.onDialogAfterOpen,this);s.addDependent(e);return e}.bind(this))}this._pDialog.then(function(t){t.open();var s=e;if(e==="N"){r.getView().byId("ModCita").setVisible(false);r.getView().byId("cancCita").setVisible(false)}else{r.getView().byId("ModCita").setVisible(true);r.getView().byId("cancCita").setVisible(true)}if(!s.lectura){r.getView().byId("wizardDialog").setTitle(r.getView().getModel("appTxts").getProperty("/quotes.createNewQuote"));r.setInitialDate();r.getView().byId("sTipoCita").setSelectedKey("");r.getView().byId("sTipoUnidad").setSelectedKey("");r.getView().byId("sTipoCita").setEditable(true);r.getView().byId("sOrdenes").setEditable(true);r.getView().byId("totalpackagesInput").setEditable(true);r.getView().byId("platformsInput").setEditable(true);r.getView().byId("sTipoUnidad").setEditable(true);r.getView().byId("carrierInput").setEditable(true);r.getView().byId("DP1").setEditable(true);r.getView().byId("totalpackagesInput").setEditable(true);r.getView().byId("platformsInput").setEditable(true);r.getView().byId("carrierInput").setEditable(true)}else{r.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(s),"ModelLectura");r.getView().byId("wizardDialog").setTitle(r.getView().getModel("appTxts").getProperty("/quotes.editNewQuote"));g=s.Tipocita;r.getView().byId("sTipoCita").setSelectedKey(s.Tipocita);r.getView().byId("sOrdenes").setSelectedKey(s.Centro);r.getView().byId("sTipoUnidad").setSelectedKey(s.Tipounidad);r.getView().byId("DP1").setDateValue(new Date(s.Fechacita.replaceAll("-",",")));r.getView().byId("totalpackagesInput").setValue(s.Bultos);r.getView().byId("platformsInput").setValue(Number(s.Tarimas));r.getView().byId("carrierInput").setValue(s.Transportista);if(s.Tipocita==="01"||s.Tipocita==="02"&&s.Fechacita!==null){r.getView().byId("DP2").setDateValue(new Date(s.Fechacita.replaceAll("-",",")))}r.getView().byId("sTipoCita").setEditable(false);r.getView().byId("sOrdenes").setEditable(false);r.getView().byId("totalpackagesInput").setEditable(false);r.getView().byId("platformsInput").setEditable(false);r.getView().byId("sTipoUnidad").setEditable(false);r.getView().byId("carrierInput").setEditable(false);r.getView().byId("DP1").setEditable(false);r.getView().byId("totalpackagesInput").setEditable(false);r.getView().byId("platformsInput").setEditable(false);r.getView().byId("carrierInput").setEditable(false)}})}else{sap.m.MessageBox.error(this.getView().getModel("appTxts").getProperty("/quotes.messageNoSupplier"))}},onDialogAfterOpen:function(){this._oWizard=this.byId("QuoteCedisWizard");this._oWizard._getProgressNavigator().ontap=function(){};this.handleButtonsVisibility();n=new s(u);this.getView().setModel(n,"TemporalModel");n.setProperty("/generalData/tipoCita",this.getView().byId("sTipoCita").getSelectedKey());n.setProperty("/generalData/tipoUnidad",this.getView().byId("sTipoUnidad").getSelectedKey());if(this.getView().byId("sTipoCita").getSelectedKey()==="01"||this.getView().byId("sTipoCita").getSelectedKey()==="02"){this.getView().byId("txtDP2").setVisible(true);this.getView().byId("DP2").setVisible(true)}else{this.getView().byId("txtDP2").setVisible(false);this.getView().byId("DP2").setVisible(false)}},handleButtonsVisibility:function(){var e=this.getView().getModel();var t=e.getProperty("/selectedPayment");switch(this._oWizard.getProgress()){case 1:e.setProperty("/nextButtonVisible",true);e.setProperty("/backButtonVisible",true);e.setProperty("/finishButtonVisible",false);break;case 2:e.setProperty("/nextButtonVisible",true);e.setProperty("/backButtonVisible",true);e.setProperty("/finishButtonVisible",false);break;case 3:e.setProperty("/nextButtonVisible",false);e.setProperty("/backButtonVisible",true);e.setProperty("/finishButtonVisible",true);break;default:break}},onDialogNextButton:function(){if(this.getView().byId("platformsInput").getValue()===""&&this.getView().byId("sTipoCita").getSelectedKey()==="01"){a.warning("Cantidad de Tarimas es Obligatorio");return}if(this.getView().byId("sTipoUnidad").getSelectedKey()===""){a.warning("Tipo de unidad es Obligatorio");return}this.getView().getModel("TemporalModel").getData().generalData.totalBultos=this.getView().byId("totalpackagesInput").getValue();this.getView().getModel("TemporalModel").getData().generalData.tarimas=this.getView().byId("platformsInput").getValue();this.getView().getModel("TemporalModel").getData().generalData.transportista=this.getView().byId("carrierInput").getValue();if(this._oWizard.getProgressStep().getValidated()){if(this._oWizard.getProgressStep().sButtonText==="Paso 2"){let e=this.byId("DP1").getDateValue();this.searchOrders(this.buildSapDate(e))}if(this._oWizard.getProgressStep().sButtonText==="Paso 3"){if(this.getView().byId("tableWizardOrder").getSelectedIndices().length===0){a.warning("No Existen Posiciones Seleccionadas");return}else{if(this.getView().byId("fileUploader").getValue()===""){d=false}else{d=true}if(this.getView().byId("sTipoCita").getSelectedKey()==="01"){var e=false;for(var t=0;t<this.getView().byId("tableWizardOrder").getSelectedIndices().length;t++){if(this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[this.getView().byId("tableWizardOrder").getSelectedIndices()[t]].Tarima.length===0){a.alert("La posicion tienda "+this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[this.getView().byId("tableWizardOrder").getSelectedIndices()[t]].ZWerks+" no tiene tarima Ingresada");return}}}}}this._oWizard.nextStep()}this.handleButtonsVisibility()},onDialogBackButton:function(){this._oWizard.previousStep();this.handleButtonsVisibility()},onCloseWizard:function(){var e=this.getOwnerComponent().getModel("ModelLectura").getData();if(!e.lectura){this._handleMessageBoxOpen(this.getView().getModel("appTxts").getProperty("/quotes.discardButton"),"warning")}else{this._handleMessageBoxOpen(this.getView().getModel("appTxts").getProperty("/quotes.closeButton"),"warning")}},testModelos:function(){},async handleWizardSubmit(){sap.m.MessageBox["confirm"](this.getView().getModel("appTxts").getProperty("/quotes.submitAppoinment"),{actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:async function(e){if(e===sap.m.MessageBox.Action.YES){this._oWizard.discardProgress(this._oWizard.getSteps()[0]);this.byId("wizardDialog").destroy();this._pDialog=null;this._oWizard=null;let e=this.getOwnerComponent().getModel("CitaCreationArray").getData();var t=this.getView().getModel("configSite").getData();var s=this.getView().getModel("TemporalModel").getData();var r=this.getView().getModel("Platforms").getData();var l=this.getOwnerComponent().getModel("ModelLectura").getData();if(this.getOwnerComponent().getModel("ModelLectura").getData().lectura===true){var i=[];for(var n=0;n<this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results.length;n++){if(this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Selected){if(s.generalData.tipoCita==="01"){for(var o of this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Tarima){o.Menge=o.Menge.toString()}i.push({Abeln:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Abeln,Abelp:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Abelp,Bednr:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Bednr,Bwart:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Bwart,Ean11:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Ean11,Ebeln:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Ebeln,Ebelp:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Ebelp,Kdatb:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Kdatb+"T00:00:00",Kdate:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Kdate+"T00:00:00",Lifnr:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Lifnr,Matnr:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Matnr,Meins:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Meins,Menge:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Menge.toString(),MengeA:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].MengeA,MengeR:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].MengeR,Werks:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Werks,ETOCSTOPALLDET:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Tarima})}else if(s.generalData.tipoCita==="02"){i.push({Abeln:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Abeln,Abelp:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Abelp,Bednr:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Bednr,Bwart:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Bwart,Ean11:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Ean11,Ebeln:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Ebeln,Ebelp:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Ebelp,Kdatb:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Kdatb+"T00:00:00",Kdate:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Kdate+"T00:00:00",Lifnr:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Lifnr,Matnr:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Matnr,Meins:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Meins,Menge:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Menge,MengeA:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].MengeA,MengeR:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].MengeR,Werks:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].ZwerksD})}else{i.push({Folio:this.getOwnerComponent().getModel("ModelLectura").getData().Folio,Ebeln:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Ebeln,Ebelp:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Ebelp,Matnr:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Matnr,Cantidad:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Citado,Fechaini:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Kdatb,Fechafin:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Kdate,Umedida:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Meins,Citado:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Citado})}}}var g=[];if(e[0].Anden!==undefined&&e[0].Anden!==null){g={Proveedor:this.getOwnerComponent().getModel("ModelLectura").getData().Proveedor,Action:"2",CTCITASCAB:[{Folio:this.getOwnerComponent().getModel("ModelLectura").getData().Folio,Centro:this.getOwnerComponent().getModel("ModelLectura").getData().Centro,Fechacita:e[0].FechaCita,FechaAud:e[0].FechaAud,Proveedor:this.getOwnerComponent().getModel("ModelLectura").getData().Proveedor,Tipocita:s.generalData.tipoCita,Tipounidad:s.generalData.tipoUnidad,Transportista:s.generalData.transportista,Bultos:s.generalData.totalBultos,Tarimas:s.generalData.tarimas,HoraIni:e[0].HoraIni,HoraFin:e[0].HoraFin,Anden:r[Number(e[0].Anden)].name}],CTCITASDET:i,ETRETURN:[]}}else{g={Proveedor:this.getOwnerComponent().getModel("ModelLectura").getData().Proveedor,Action:"2",CTCITASCAB:[{Folio:this.getOwnerComponent().getModel("ModelLectura").getData().Folio,Centro:this.getOwnerComponent().getModel("ModelLectura").getData().Centro,Fechacita:this.getOwnerComponent().getModel("ModelLectura").getData().Fechacita,FechaAud:this.getOwnerComponent().getModel("ModelLectura").getData().FechaAud,Proveedor:this.getOwnerComponent().getModel("ModelLectura").getData().Proveedor,Tipounidad:s.generalData.tipoUnidad,Transportista:s.generalData.transportista,Bultos:s.generalData.totalBultos,Tarimas:s.generalData.tarimas,HoraIni:this.getOwnerComponent().getModel("ModelLectura").getData().HoraIni,HoraFin:this.getOwnerComponent().getModel("ModelLectura").getData().HoraFin,Anden:this.getOwnerComponent().getModel("ModelLectura").getData().Anden,Tipocita:s.generalData.tipoCita}],CTCITASDET:i,ETRETURN:[]}}var u=p;var O="/"+C;var T=JSON.stringify(g);var M=this;M._POSToData(u,O,T).then(function(e){sap.ui.core.BusyIndicator.hide();var t=e.d;if(t.Success==="X"){sap.m.MessageBox.success(t.Message)}else{sap.m.MessageBox.error(t.Message)}})}else{var h=[];var c=[];if(s.generalData.tipoCita==="02"){for(var n=0;n<this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results.length;n++){if(this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Selected){for(var b=0;b<this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results.length;b++){if(this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Abeln===this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[b].Zabeln&&this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].ZwerksD===this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[b].ZwerksD&&this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Abelp===this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[b].Zabelp){h.push({Zabeln:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[b].Zabeln.trim(),Zabelp:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[b].Zabelp.trim(),Zmatnr:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[b].Zmatnr.trim(),ZwerksD:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[b].ZwerksD.trim(),Zpmngu:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[b].Zpmngu.trim(),Zaufme:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[b].Zceqfu.trim(),Zceqfu:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[b].Zceqfu.trim(),Zueqfu:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[b].Zueqfu.trim(),Zceqfp:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[b].Zceqfp.trim(),Zaufpf:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[b].Zaufpf.trim(),Zcpemf:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[b].Zcpemf.trim(),Zupemf:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[b].Zupemf.trim(),Zcpemp:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[b].Zcpemp.trim(),Zaufmp:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[b].Zaufmp.trim(),Zcjpic:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[b].Zcjpic.trim(),Zuncom:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[b].Zuncom.trim()})}}}}for(var n=0;n<e.length;n++){c.push({Ebeln:e[n].Ebeln,Ebelp:e[n].Ebelp,Matnr:e[n].Matnr,Citado:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Citado,FechaCita:e[n].FechaCita,HoraIni:e[n].HoraIni,HoraFin:e[n].HoraFin,Anden:r[Number(e[0].Anden)].name,TipoCita:s.generalData.tipoCita,Lifnr:t.supplierInputKey,Bultos:s.generalData.totalBultos,Tarimas:s.generalData.tarimas,TipoUnidad:s.generalData.tipoUnidad,Transportista:s.generalData.transportista})}}else if(s.generalData.tipoCita==="01"){for(var n=0;n<this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results.length;n++){if(this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Selected){h.push({Abeln:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].ZAbeln,Abelp:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].ZAbelp,Bednr:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].ZBednr,Bwart:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].ZBwart,Ean11:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].ZEan11,Ebeln:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].ZEbeln,Ebelp:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].ZEbelp,Kdatb:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].ZKdatb,Kdate:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].ZKdate,Lifnr:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].ZLifnr,Matnr:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].ZMatnr,Meins:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].ZMeins,Menge:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].ZMenge,MengeA:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].ZMengeA,MengeR:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].ZMengeR,Werks:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].ZWerks,ETOCSTOPALL:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Tarima})}}for(var n=0;n<e.length;n++){c.push({Ebeln:e[n].Ebeln,Ebelp:e[n].Ebelp,Matnr:e[n].Matnr,Citado:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Citado,FechaCita:e[n].FechaCita,HoraIni:e[n].HoraIni,HoraFin:e[n].HoraFin,Anden:r[Number(e[0].Anden)].name,TipoCita:s.generalData.tipoCita,Lifnr:t.supplierInputKey,Bultos:s.generalData.totalBultos,Tarimas:s.generalData.tarimas,TipoUnidad:s.generalData.tipoUnidad,Transportista:s.generalData.transportista})}}else{for(var n=0;n<e.length;n++){let a="";if(d===false){if(e[n].Citado.toLocaleString().includes(",")){a=e[n].Citado.toLocaleString();a=a.replace(",","")}else{a=e[n].Citado.toLocaleString()}}else{if(this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Citado.toLocaleString().includes(",")){a=this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Citado.toLocaleString();a=a.replace(",","")}else{a=this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[n].Citado.toLocaleString()}}c.push({Ebeln:e[n].Ebeln,Ebelp:e[n].Ebelp,Matnr:e[n].Matnr,Citado:a,FechaCita:e[n].FechaCita,HoraIni:e[n].HoraIni,HoraFin:e[n].HoraFin,Anden:r[Number(e[0].Anden)].name,TipoCita:s.generalData.tipoCita,Lifnr:t.supplierInputKey,Bultos:s.generalData.totalBultos,Tarimas:s.generalData.tarimas,TipoUnidad:s.generalData.tipoUnidad,Transportista:s.generalData.transportista})}}let l;if(c.length===0){a.alert("error al crear la cabecera es vacio");return}if(s.generalData.tipoCita==="01"){l={Proveedor:t.supplierInputKey.padStart(10,0),Action:"1",ETOCSTO:h,ETCITANUEVA:c,ETRETURN:[]}}else{l={Proveedor:t.supplierInputKey.padStart(10,0),Action:"1",ETCITANUEVA:c,ETMINIFULL03:h,ETRETURN:[]}}sap.ui.core.BusyIndicator.show();let i=null;var u=p;var O="/"+C;var T=JSON.stringify(l);var M=this;M._POSToData(u,O,T).then(function(e){sap.ui.core.BusyIndicator.hide();var t=e.d;if(t.Success==="X"){sap.m.MessageBox.success(t.Message)}else{sap.m.MessageBox.error(t.ETRETURN.results[0].Message)}})}M.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel([]),"ModelLectura");M.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel([]),"Modeleditable");M.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel([]),"Platforms");E=null;M.searchData()}}.bind(this)})},_POSToData:function(e,t,s){var a="/sap/opu/odata/sap/"+e;var r=this;return new Promise(function(e,r){$.ajax({url:a+t,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:s,headers:{"X-Requested-With":"X"},success:function(t){e(t)},error:function(e,t,s){sap.ui.core.BusyIndicator.hide();r(new Error(e))}})})},_handleMessageBoxOpen:function(e,t){sap.m.MessageBox[t](e,{actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(e){if(e===sap.m.MessageBox.Action.YES){var t=new sap.ui.model.json.JSONModel([]);this.getView().byId("tableWizardOrder").setEnableSelectAll(false);this.getOwnerComponent().setModel(t,"Platforms");this._oWizard.discardProgress(this._oWizard.getSteps()[0]);this.byId("wizardDialog").destroy();this._pDialog=null;this._oWizard=null;this.getView().setModel(new s,"ModelLectura");this.getView().setModel(new s,"tableWizardOrderPosition");this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel([]),"CitaMainData");this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel([]),"CitaCreationArray");this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel([]),"Pedidos");this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel([]),"Platforms");E=null}}.bind(this)})},searchOrders:function(e){let t=[];let a=this;t.push(this.buildFiltro("IOption",a.getView().byId("sTipoCita").getSelectedKey()));t.push(a.buildFiltro("ILifnr",a.getConfigModel().getProperty("/supplierInputKey")));t.push(a.buildFiltro("Iwerks",a.getView().byId("sOrdenes").getSelectedKey()));t.push(a.buildFiltro("IKdatb",e));var r=a.getOwnerComponent().getModel("ModelLectura").getData();if(a.getView().getModel("PosicionesG")===undefined){var l=[]}else{var l=a.getView().getModel("PosicionesG").getData()}sap.ui.core.BusyIndicator.show();let i=[];a._GetODataV2(O,T,t,["ETOC","ETMINIFULL03","ETOCSTO"],"").then(e=>{a.getView().byId("tableWizardOrder").clearSelection();let t=[];let n=[];let o=[];if(r.lectura){var d=a.getOwnerComponent().getModel("PosicionesG").getData();this.getView().byId("tableWizardOrder").setEnableSelectAll(true);this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel({editable:false}),"Modeleditable");for(var u=0;u<e.data.results[0].ETOC.results.length;u++){e.data.results[0].ETOC.results[u].Menge=parseInt(e.data.results[0].ETOC.results[u].Menge);e.data.results[0].ETOC.results[u].Menge=e.data.results[0].ETOC.results[u].Menge.toString();e.data.results[0].ETOC.results[u].MengeR=parseInt(e.data.results[0].ETOC.results[u].MengeR);e.data.results[0].ETOC.results[u].MengeR=e.data.results[0].ETOC.results[u].MengeR.toString();e.data.results[0].ETOC.results[u].MengeA=parseInt(e.data.results[0].ETOC.results[u].MengeA);e.data.results[0].ETOC.results[u].MengeA=e.data.results[0].ETOC.results[u].MengeA.toString();e.data.results[0].ETOC.results[u].Selected=true;for(var p=0;p<l.length;p++){if(e.data.results[0].ETOC.results[u].Matnr===l[p].Matnr&&e.data.results[0].ETOC.results[u].Werks===l[p].Werks&&e.data.results[0].ETOC.results[u].Ebeln===l[p].Ebeln){e.data.results[0].ETOC.results[u].Citado=l[p].Citado;if(r.Tipocita==="01"){for(var C=0;C<e.data.results[0].ETOCSTO.results.length;C++){if(parseInt(e.data.results[0].ETOC.results[u].Ebeln)===parseInt(e.data.results[0].ETOCSTO.results[C].Bednr)&&e.data.results[0].ETOC.results[u].Abeln===e.data.results[0].ETOCSTO.results[C].Abeln){e.data.results[0].ETOC.results[u].ZwerksD=e.data.results[0].ETOCSTO.results[C].Werks}}e.data.results[0].ETOC.results[u].Tarima=l[p].ETOCSTOPALLEXT.results;for(var O=0;O<e.data.results[0].ETOC.results[u].Tarima.length;O++){e.data.results[0].ETOC.results[u].Tarima[O].Menge=Number(e.data.results[0].ETOC.results[u].Tarima[O].Menge)}}else if(a.getView().byId("sTipoCita").getSelectedKey()==="02"){var T=[];for(var E=0;E<e.data.results[0].ETOC.results.length;E++){for(var M=0;M<e.data.results[0].ETMINIFULL03.results.length;M++){for(var O=0;O<d.length;O++){if(e.data.results[0].ETOC.results[E].Abeln===e.data.results[0].ETMINIFULL03.results[M].Zabeln&&e.data.results[0].ETOC.results[E].Abeln===d[O].Zabeln&&e.data.results[0].ETOC.results[E].Abelp===e.data.results[0].ETMINIFULL03.results[M].Zabelp&&e.data.results[0].ETOC.results[E].Abelp===d[O].Zabelp&&e.data.results[0].ETOC.results[E].Ebelp===d[O].Ebelp&&e.data.results[0].ETMINIFULL03.results[M].ZwerksD===d[O].ZwerksD){T.push({Abeln:e.data.results[0].ETOC.results[E].Abeln,Bwart:e.data.results[0].ETOC.results[E].Bwart,Citado:e.data.results[0].ETOC.results[E].Citado,Ean11:e.data.results[0].ETOC.results[E].Ean11,Ebeln:e.data.results[0].ETOC.results[E].Ebeln,Ebelp:e.data.results[0].ETOC.results[E].Ebelp,Kdatb:e.data.results[0].ETOC.results[E].Kdatb,Kdate:e.data.results[0].ETOC.results[E].Kdate,Lifnr:e.data.results[0].ETOC.results[E].Lifnr,Matnr:e.data.results[0].ETOC.results[E].Matnr,Meins:e.data.results[0].ETOC.results[E].Meins,Menge:e.data.results[0].ETOC.results[E].Menge,MengeA:e.data.results[0].ETOC.results[E].MengeA,MengeR:e.data.results[0].ETOC.results[E].MengeR,Maktx:e.data.results[0].ETOC.results[E].Maktx,Selected:e.data.results[0].ETOC.results[E].Selected,Werks:e.data.results[0].ETOC.results[E].Werks,ZwerksD:e.data.results[0].ETMINIFULL03.results[M].ZwerksD,Abelp:e.data.results[0].ETMINIFULL03.results[M].Zabelp});e.data.results[0].ETOC.results[E].ZwerksD=e.data.results[0].ETMINIFULL03.results[M].ZwerksD;e.data.results[0].ETOC.results[E].Abelp=e.data.results[0].ETMINIFULL03.results[M].Zabelp}}}}console.log(g);a.getOwnerComponent().setModel(new s(e.data.results[0]),"Pedidos")}else{e.data.results[0].ETOC.results[u].Tarima=[];e.data.results[0].ETOC.results[u].ZwerksD=l[p].Werks}e.data.results[0].ETOC.results[u].Ltc=true;i.push(e.data.results[0].ETOC.results[u])}}}e.data.results[0].ETOC.results=i}else{this.getView().byId("tableWizardOrder").setEnableSelectAll(false);let t=[];for(var u=0;u<e.data.results[0].ETOC.results.length;u++){e.data.results[0].ETOC.results[u].Menge=parseInt(e.data.results[0].ETOC.results[u].Menge);e.data.results[0].ETOC.results[u].Menge=e.data.results[0].ETOC.results[u].Menge.toString();e.data.results[0].ETOC.results[u].MengeR=parseInt(e.data.results[0].ETOC.results[u].MengeR);e.data.results[0].ETOC.results[u].MengeR=e.data.results[0].ETOC.results[u].MengeR.toString();e.data.results[0].ETOC.results[u].MengeA=parseInt(e.data.results[0].ETOC.results[u].MengeA);e.data.results[0].ETOC.results[u].MengeA=e.data.results[0].ETOC.results[u].MengeA.toString();n.push({Finicio:new Date(e.data.results[0].ETOC.results[u].Kdatb)});o.push({Ffin:new Date(e.data.results[0].ETOC.results[u].Kdate)});e.data.results[0].ETOC.results[u].Selected=false;console.log(a.getView().byId("sTipoCita").getSelectedKey());if(a.getView().byId("sTipoCita").getSelectedKey()==="01"){for(var p=0;p<e.data.results[0].ETOCSTO.results.length;p++){if(parseInt(e.data.results[0].ETOC.results[u].Ebeln)===parseInt(e.data.results[0].ETOCSTO.results[p].Bednr)&&e.data.results[0].ETOC.results[u].Abelp===e.data.results[0].ETOCSTO.results[p].Abelp&&Number(e.data.results[0].ETOC.results[u].MengeA)>0){t.push({Abeln:e.data.results[0].ETOC.results[u].Abeln,Bwart:e.data.results[0].ETOC.results[u].Bwart,Citado:e.data.results[0].ETOC.results[u].Zpmngu,Ean11:e.data.results[0].ETOC.results[u].Ean11,Ebeln:e.data.results[0].ETOC.results[u].Ebeln,Ebelp:e.data.results[0].ETOC.results[u].Ebelp,Kdatb:e.data.results[0].ETOC.results[u].Kdatb,Kdate:e.data.results[0].ETOC.results[u].Kdate,Lifnr:e.data.results[0].ETOC.results[u].Lifnr,Matnr:e.data.results[0].ETOC.results[u].Matnr,Meins:e.data.results[0].ETOC.results[u].Meins,Menge:e.data.results[0].ETOC.results[u].Menge,Menge2:e.data.results[0].ETOCSTO.results[p].Menge,MengeA:e.data.results[0].ETOCSTO.results[p].MengeA,MengeR:e.data.results[0].ETOC.results[u].MengeR,Maktx:e.data.results[0].ETOC.results[u].Maktx,Selected:e.data.results[0].ETOC.results[u].Selected,Werks:e.data.results[0].ETOC.results[u].Werks,ZwerksD:e.data.results[0].ETOCSTO.results[p].Werks,Tarima:[],ZAbeln:e.data.results[0].ETOCSTO.results[p].Abeln,ZAbelp:e.data.results[0].ETOCSTO.results[p].Abelp,ZBednr:e.data.results[0].ETOCSTO.results[p].Bednr,ZBwart:e.data.results[0].ETOCSTO.results[p].Bwart,ZEan11:e.data.results[0].ETOCSTO.results[p].Ean11,ZEbeln:e.data.results[0].ETOCSTO.results[p].Ebeln,ZEbelp:e.data.results[0].ETOCSTO.results[p].Ebelp,ZKdatb:e.data.results[0].ETOCSTO.results[p].Kdatb,ZKdate:e.data.results[0].ETOCSTO.results[p].Kdate,ZLifnr:e.data.results[0].ETOCSTO.results[p].Lifnr,ZMatnr:e.data.results[0].ETOCSTO.results[p].Matnr,ZMeins:e.data.results[0].ETOCSTO.results[p].Meins,ZMenge:e.data.results[0].ETOCSTO.results[p].Menge,ZMengeA:e.data.results[0].ETOCSTO.results[p].MengeA,ZMengeR:e.data.results[0].ETOCSTO.results[p].MengeR,ZWerks:e.data.results[0].ETOCSTO.results[p].Werks})}}}if(a.getView().byId("sTipoCita").getSelectedKey()==="04"){for(var p=0;p<e.data.results[0].ETMINIFULL03.results.length;p++){if(e.data.results[0].ETOC.results[u].Abeln===e.data.results[0].ETMINIFULL03.results[p].Zabeln&&e.data.results[0].ETOC.results[u].Abelp===e.data.results[0].ETMINIFULL03.results[p].Zabelp&&Number(e.data.results[0].ETOC.results[u].MengeA)>0){e.data.results[0].ETOC.results[u].Zceqfp=e.data.results[0].ETMINIFULL03.results[p].Zceqfp;e.data.results[0].ETOC.results[u].Zceqfu=e.data.results[0].ETMINIFULL03.results[p].Zceqfu;e.data.results[0].ETOC.results[u].Zcjpic=e.data.results[0].ETMINIFULL03.results[p].Zcjpic;e.data.results[0].ETOC.results[u].Zcpemf=e.data.results[0].ETMINIFULL03.results[p].Zcpemf;e.data.results[0].ETOC.results[u].Zcpemp=e.data.results[0].ETMINIFULL03.results[p].Zcpemp}}}console.log(a.getView().byId("sTipoCita").getSelectedKey());if(a.getView().byId("sTipoCita").getSelectedKey()==="02"){for(var p=0;p<e.data.results[0].ETMINIFULL03.results.length;p++){if(e.data.results[0].ETOC.results[u].Abeln===e.data.results[0].ETMINIFULL03.results[p].Zabeln&&e.data.results[0].ETOC.results[u].Abelp===e.data.results[0].ETMINIFULL03.results[p].Zabelp&&Number(e.data.results[0].ETOC.results[u].MengeA)>0){t.push({Abeln:e.data.results[0].ETOC.results[u].Abeln,Bwart:e.data.results[0].ETOC.results[u].Bwart,Citado:e.data.results[0].ETMINIFULL03.results[p].Zpmngu.trim().split(".")[0],Ean11:e.data.results[0].ETOC.results[u].Ean11,Ebeln:e.data.results[0].ETOC.results[u].Ebeln,Ebelp:e.data.results[0].ETOC.results[u].Ebelp,Kdatb:e.data.results[0].ETOC.results[u].Kdatb,Kdate:e.data.results[0].ETOC.results[u].Kdate,Lifnr:e.data.results[0].ETOC.results[u].Lifnr,Matnr:e.data.results[0].ETOC.results[u].Matnr,Meins:e.data.results[0].ETOC.results[u].Meins,Menge:e.data.results[0].ETOC.results[u].Menge,MengeA:e.data.results[0].ETOC.results[u].MengeA,MengeR:e.data.results[0].ETOC.results[u].MengeR,Maktx:e.data.results[0].ETOC.results[u].Maktx,Selected:e.data.results[0].ETOC.results[u].Selected,Werks:e.data.results[0].ETOC.results[u].Werks,ZwerksD:e.data.results[0].ETMINIFULL03.results[p].ZwerksD,Abelp:e.data.results[0].ETMINIFULL03.results[p].Zabelp})}}}if(a.getView().byId("sTipoCita").getSelectedKey()==="03"){if(parseInt(e.data.results[0].ETOC.results[u].MengeA)>0){e.data.results[0].ETOC.results[u].MengeA=parseInt(e.data.results[0].ETOC.results[u].MengeA);e.data.results[0].ETOC.results[u].MengeA=e.data.results[0].ETOC.results[u].MengeA.toString();t.push(e.data.results[0].ETOC.results[u])}}}if(a.getView().byId("sTipoCita").getSelectedKey()==="02"||a.getView().byId("sTipoCita").getSelectedKey()==="01"||a.getView().byId("sTipoCita").getSelectedKey()==="03"){e.data.results[0].ETOC.results=[];e.data.results[0].ETOC.results=t}}a.getOwnerComponent().setModel(new s(e.data.results[0]),"Pedidos");function h(e,t){return e.Finicio==t.Finicio?0:e.Finicio<t.Finicio?1:-1}function c(e,t){return e.Ffin==t.Ffin?0:e.Ffin>t.Ffin?1:-1}n.sort(h);o.sort(c);e.data.results[0].fechaInicio=new Date(n[0].Finicio).toISOString().slice(0,10);e.data.results[0].fechaFFin=new Date(o[0].Ffin).toISOString().slice(0,10);sap.ui.core.BusyIndicator.hide()}).catch(e=>{sap.ui.core.BusyIndicator.hide()})},selectTarima:function(e){var t=e.getSource().getParent();o=t.getBindingContext("Pedidos").sPath.split("/")[3];if(t.getBindingContext("Pedidos").getProperty("Tarima").length===0){var s=[];var a=this.getView().byId("platformsInput").getValue();for(var r=1;r<=a;r++){s.push({Ztarima:r.toString(),Bednr:t.getBindingContext("Pedidos").getProperty("ZBednr"),Abeln:t.getBindingContext("Pedidos").getProperty("ZAbeln"),Abelp:t.getBindingContext("Pedidos").getProperty("ZAbelp"),Werks:t.getBindingContext("Pedidos").getProperty("ZWerks"),Menge:""})}this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(s),"Tarimas")}else{var s=[];var a=this.getView().byId("platformsInput").getValue();for(var r=1;r<=a;r++){var l="";for(var i=0;i<t.getBindingContext("Pedidos").getProperty("Tarima").length;i++){if(r===Number(t.getBindingContext("Pedidos").getProperty("Tarima")[i].Ztarima)){l=t.getBindingContext("Pedidos").getProperty("Tarima")[i].Menge}}s.push({Ztarima:r.toString(),Bednr:t.getBindingContext("Pedidos").getProperty("ZBednr"),Abeln:t.getBindingContext("Pedidos").getProperty("ZAbeln"),Abelp:t.getBindingContext("Pedidos").getProperty("ZAbelp"),Werks:t.getBindingContext("Pedidos").getProperty("ZWerks"),Menge:l})}}this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(s),"Tarimas");var n=this.getView().byId("myDialog");if(!n){n=sap.ui.xmlfragment(this.getView().getId(),"demo.views.Quotes.wizards.fragments.Tarimas",this);this.getView().addDependent(n)}n.open()},handleClose:function(e){o="";var t=this.getView().byId("myDialog");t.close()},ActualizacionTarima:function(){if(this.ValidaCantidad()){this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].Tarima=[];for(var e=0;e<this.getView().byId("tableid").getSelectedItems().length;e++){if(Number(this.getOwnerComponent().getModel("Tarimas").getData()[this.getView().byId("tableid").getSelectedItems()[e].sId.split("-")[4]].Menge)>0){this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].Tarima.push(this.getOwnerComponent().getModel("Tarimas").getData()[this.getView().byId("tableid").getSelectedItems()[e].sId.split("-")[4]])}else{a.warning("Cantidad en Tarima n° "+this.getOwnerComponent().getModel("Tarimas").getData()[this.getView().byId("tableid").getSelectedItems()[e].sId.split("-")[4]].Ztarima+" es Vacia o tiene un valor inferior a 0");return}}this.handleClose()}},ValidaCantidad:function(){var e=0;var t=false;if(this.getView().byId("tableid").getSelectedItems().length<1){a.warning("No ha seleccionado ninguna posición ");t=false}for(var s=0;s<this.getView().byId("tableid").getSelectedItems().length;s++){if(this.getOwnerComponent().getModel("Tarimas").getData()[this.getView().byId("tableid").getSelectedItems()[s].sId.split("-")[4]].Menge===""){a.warning("Cantidad en Tarima n° "+this.getOwnerComponent().getModel("Tarimas").getData()[this.getView().byId("tableid").getSelectedItems()[s].sId.split("-")[4]].Ztarima+" es Vacia o tiene un valor inferior a 0");t=false}else{e=e+Number(this.getOwnerComponent().getModel("Tarimas").getData()[this.getView().byId("tableid").getSelectedItems()[s].sId.split("-")[4]].Menge);this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].Tarima=[];if(e>this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].MengeA){t=false;a.warning("Las cantidades ingresadas son superior a la cantidad disponible para la tienda")}else{this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].Tarima.push(this.getOwnerComponent().getModel("Tarimas").getData()[this.getView().byId("tableid").getSelectedItems()[s].sId.split("-")[4]]);t=true}}}if(t){return t}},getDetailOrder:function(){var e=this;var t=`/Valida_citasSet?$expand=Po_validas&$filter=IOption eq '1' and IEbeln eq '${this._document}'`;this.getView().setModel(new s,"tableWizardPo_validas");i.getJsonModelAsync(t,function(t){var s=t.getProperty("/results/0");if(s.ESuccess=="X"){var a=e.getView().getModel("tableWizardPo_validas");a.setProperty("/Oekponav",s.Po_validas)}else{sap.m.MessageBox.error(s.EMessage)}},function(){sap.m.MessageBox.error("")},this)},onSelectRBOption:function(e){n.setProperty("/generalData/cedisType",e.getParameters().selectedIndex)},onChangeSelectTipoCita:function(e){n.setProperty("/generalData/tipoCita",e.getParameters().selectedItem.getKey());this.getOwnerComponent().getModel("CitaMainData").setProperty("/TipoCita",e.getParameters().selectedItem.getKey());if(e.getParameters().selectedItem.getKey()==="01"||e.getParameters().selectedItem.getKey()==="02"){this.getView().byId("txtDP2").setVisible(true);this.getView().byId("DP2").setVisible(true)}else{this.getView().byId("txtDP2").setVisible(false);this.getView().byId("DP2").setVisible(false)}},onChangeSelectTipoUnidad:function(e){n.setProperty("/generalData/tipoUnidad",e.getParameters().selectedItem.getKey());for(var t=0;t<this.getView().getModel("CAtalogo2").getData().length;t++){if(this.getView().getModel("CAtalogo2").getData()[t].ZNumunidad===e.getParameters().selectedItem.getKey()){n.setProperty("/generalData/tiempo",this.getView().getModel("CAtalogo2").getData()[t].ZservMinutos)}}},onSelectProductType:function(e){n.setProperty("/generalData/tipoProducto",e.getParameters().selectedItem.getKey())},selectChange:function(e){},onListItemPress:function(e){},appointmentDateChange(e){let t=e.getSource();let s=t.getDateValue();this.getOwnerComponent().getModel("CitaMainData").setProperty("/FechaCita",this.buildSapDate(s));let a=this.getView().byId("DP2");let r=new Date;r=s.getTime()-1e3*60*60*24*1;a.setDateValue(new Date(r));a.setMinDate(new Date(r));a.fireChange();this.getOwnerComponent().getModel("CitaMainData").setProperty("/FechaAud",new Date(r).toISOString().slice(0,10))},setAppoimentCalendar(e,t){var s="";if(this.getOwnerComponent().getModel("Pedidos").getData().fechaFFin===undefined){var a=this.byId("DP1").getDateValue().getTime()+1e3*60*60*24*7;a=new Date(a).toISOString().slice(0,10);s=new Date(a+" 23:59:59")}else{s=this.getOwnerComponent().getModel("Pedidos").getData().fechaFFin;s=new Date(s+" 23:59:59")}let r=this.getView().byId("appoinmentPC");e.setHours(8,0);r.setStartDate(this.byId("DP1").getDateValue());r.setMinDate(this.byId("DP1").getDateValue());r.setMaxDate(s);let l=new Date;l.setHours(10,0)},handleIntervalSelect:function(e){var t=e.getSource(),s=e.getParameter("startDate"),a=e.getParameter("endDate"),r=e.getParameter("row"),l=this.getOwnerComponent().getModel("Platforms"),i=l.getData(),n=-1;for(var o=0;o<i.length;o++){for(var d=0;d<i[o].appointments.length;d++){if(i[o].appointments[d].type==="Type08"){sap.m.MessageBox.warning("Favor Guarde la cita abierta");return}}}let g=s.getHours();let u=Number(this.getView().getModel("TemporalModel").getData().generalData.tiempo)-1;s.setHours(g);a.setMinutes(s.getMinutes()+u);var p=new Date(new Date(s).toISOString().slice(0,10)+" "+i[0].DispIni);var C=new Date(new Date(a).toISOString().slice(0,10)+" "+i[0].DispFin);if(s.toLocaleString("en-GB")>p.toLocaleString("en-GB")&&a.toLocaleString("en-GB").trim()<C.toLocaleString("en-GB")){i[t.indexOfRow(r)].appointments.push({start:s,end:a,title:"Entrega "+s.toISOString().substr(0,10),type:"Type08"});l.setData(i)}else{sap.m.MessageBox.warning("El Horario Seleccionado esta fuera del rango Habilitado")}let O=this.getOwnerComponent().getModel("CitaCreationArray").getData();O.forEach(e=>{e.FechaCita=s.toISOString().substr(0,10);e.HoraIni=s.toTimeString().substr(0,8);e.HoraFin=a.toTimeString().substr(0,8);e.Anden=t.indexOfRow(r)});this.getOwnerComponent().getModel("CitaCreationArray").setData(O)},handleAppointmentSelect:function(e){var t=this;var s=e.getParameter("appointment"),r,l,i;if(s){r=s.getSelected()?"selected":"deselected";if(s.getType()==="Type08"){a.information("'"+s.getTitle()+"' "+r+". \n  Cita: "+this.byId("appoinmentPC").getSelectedAppointments().length,{actions:["Cancelar Cita",a.Action.CLOSE],emphasizedAction:"Cancelar Cita",onClose:function(e){var s=t.getView().getModel("Platforms").getData();for(var a=0;a<s.length;a++){s[a].appointments=[]}t.GetCitas()}})}else{a.show("'"+s.getTitle()+"' "+r+". \n  Cita: "+this.byId("appoinmentPC").getSelectedAppointments().length)}}else{l=e.getParameter("appointments");i=l.length+" Appointments selected";a.show(i)}s.setSelected(false)},selectPedido:async function(e){let t=e.getSource();let s=e.getParameter("rowContext").getModel().getData();let a=e.getParameter("rowContext").getObject();let r=e.getParameter("rowIndex");let l=t.getSelectedIndices();let i=l.some(e=>e==r);if(l.length==0){E=null}else if(E===null){E=a.Werks;this.fetchConfigCentro(E);this.byId("btnAppoimentNext").setVisible(true);this.byId("btnAppoimentNext").setEnabled(true);this.byId("inputCantidad").setEnabled(true)}else if(E!=a.Werks){sap.m.MessageBox.warning("Todos los pedidos deben pertencer al mismo centro");t.removeSelectionInterval(r,r);return}s.ETOC.results.forEach(e=>{if(this.getView().byId("sTipoCita").getSelectedKey()==="02"){if(e.Ebeln===a.Ebeln&&e.Ean11===a.Ean11&&e.ZwerksD===a.ZwerksD&&e.Abeln===a.Abeln&&e.Abelp===a.Abelp){e.Selected=true}else{}}else if(this.getView().byId("sTipoCita").getSelectedKey()==="01"){if(e.Ebeln===a.Ebeln&&e.ZWerks===a.ZWerks&&e.Ean11===a.Ean11&&e.ZAbeln===a.ZAbeln){e.Selected=true}else{}}else{if(e.Ebeln===a.Ebeln&&e.Ean11===a.Ean11){e.Selected=i}}});await new Promise(e=>setTimeout(e,100));if(i)this.addToCreationArray(a);else this.dropFromCreationArray(a);let n=this.getOwnerComponent().getModel("CitaCreationArray").getData();let o=this.findMaxDate(n,s);let d=this.byId("DP1").getDateValue();this.setAppoimentCalendar(d,o)},findMaxDate(e,t){let s=[];t.ETOC.results.forEach(t=>{if(e.some(e=>e.Ebeln==t.Ebeln&&e.Matnr==t.Matnr))s.push(t)});let a=new Date;s.forEach(e=>{let t=new Date(e.Kdate);if(a<t)a=t});return a},captureQuntSummon:function(e){let t=e.getSource();t.setValueState(sap.ui.core.ValueState.None);let s=t.data("matnr");let a=t.data("ebeln");let r=Number(t.data("menger"));let l=Number(e.getParameter("value"));if(r<l){t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText("Debe ser menor a la cantidad por agotar");M.push(t.getId());this.byId("btnAppoimentNext").setEnabled(M.length==0);return}else{let e=M.filter(e=>e!=t.getId());M=e}let i=this.getOwnerComponent().getModel("CitaCreationArray").getData();i.forEach(e=>{if(e.Matnr==s&&e.Ebeln==a)e.Citado=l});this.getOwnerComponent().getModel("CitaCreationArray").setData(i)},hasOnlyNumbers:function(){this.byId("btnAppoimentNext").setEnabled(true)},addToCreationArray(e){let t=this.getOwnerComponent().getModel("CitaCreationArray").getData();let s=this.getOwnerComponent().getModel("CitaMainData").getData();let a={Ebeln:e.Ebeln,Ebelp:e.Ebelp,Matnr:e.Matnr,TipoCita:s.TipoCita,FechaAud:s.FechaAud};t.push(a);this.getOwnerComponent().getModel("CitaCreationArray").setData(t)},dropFromCreationArray(e){let t=this.getOwnerComponent().getModel("CitaCreationArray").getData();let s=t.filter(t=>t.Matnr!=e.Matnr&&t.Ebeln!=e.Ebeln);this.getOwnerComponent().getModel("CitaCreationArray").setData(s)},clearModelsOnFilter(e){this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel([]),"CitaCreationArray");E=null},convertHora:function(e){var t=e;var s="";var a="";var r="";s=t.slice(2,4);a=t.slice(5,7);r=t.slice(8,10);return s+":"+a+":"+r},fetchConfigCentro(e){let t=[];t.push(this.buildFiltro("Action","3"));t.push(this.buildFiltro("Centro",e));sap.ui.core.BusyIndicator.show();let s=this;var a=p;var r=C;var l="ETCONFIG";var i=t;var n="";sap.ui.core.BusyIndicator.show();s._GEToDataV2(a,r,i,l,n).then(function(e){sap.ui.core.BusyIndicator.hide();var t=e.data.results[0].ETCONFIG.results;var a="";var r=[];for(var l=0;l<t.length;l++){t[l].DatoH01=s.convertHora(t[l].DatoH01);t[l].DatoH02=s.convertHora(t[l].DatoH02)}for(var l=0;l<t.length;l++){if(t[l].Func==="ANDENES"){a=Number(t[l].Dato1)}}var i=new Date;i=i.getTime()+1e3*60*60*24*1;i=new Date(i).toISOString().slice(0,10);for(var l=0;l<a-1;l++){var n=l;r.push({name:t[l].Dato1,role:t[l].Func,DispIni:t[l].DatoH01,DispFin:t[l].DatoH02,appointments:[]})}var o=new sap.ui.model.json.JSONModel(r);s.getOwnerComponent().setModel(o,"Platforms");s.GetCitas()})},buildFiltro(e,t){return new sap.ui.model.Filter({path:e,operator:sap.ui.model.FilterOperator.EQ,value1:`${t}`})},GetCitas:function(){let e=this;var t=this.getConfigModel().getProperty("/supplierInputKey");var s=this.getView().byId("quoteFolioIniInput").getValue();var a=this.getView().byId("quoteFolioFinInput").getValue();var r=this.getView().byId("quotedateRange");var l=this.buildSapDate(r.getDateValue());var i=this.buildSapDate(r.getSecondDateValue());let n=[];n.push(new sap.ui.model.Filter({path:"Action",operator:sap.ui.model.FilterOperator.EQ,value1:"1"}));n.push(new sap.ui.model.Filter({path:"Centro",operator:sap.ui.model.FilterOperator.EQ,value1:e.getView().byId("sOrdenes").getSelectedKey()}));if(s!=null&&s!=""&&a!=null&&a!=""){n.push(new sap.ui.model.Filter({path:"Folioini",operator:sap.ui.model.FilterOperator.EQ,value1:s}));n.push(new sap.ui.model.Filter({path:"Foliofin",operator:sap.ui.model.FilterOperator.EQ,value1:a}))}if(l!=null&&l!=""&&i!=null&&i!=""){n.push(new sap.ui.model.Filter({path:"Fechaini",operator:sap.ui.model.FilterOperator.EQ,value1:l}));n.push(new sap.ui.model.Filter({path:"Fechafin",operator:sap.ui.model.FilterOperator.EQ,value1:i}))}var o="ZOSP_CITAS_ADM_SRV";var d="MainSet";var g="CTCITASCAB";var u=n;var p="";var C=e.getView().getModel("Platforms").getData();sap.ui.core.BusyIndicator.show();e._GEToDataV2(o,d,u,g,p).then(function(t){sap.ui.core.BusyIndicator.hide();var s=t.data.results[0].CTCITASCAB.results;for(var a=0;a<s.length;a++){for(var r=0;r<C.length;r++){if(s[a].Anden===C[r].name){C[r].appointments.push({start:new Date(s[a].Fechacita+" "+s[a].HoraIni),end:new Date(s[a].Fechacita+" "+s[a].HoraFin),title:"Cita "+s[a].Folio,type:"Type02",pic:"",tentative:false})}}}var l=new sap.ui.model.json.JSONModel(C);e.getOwnerComponent().setModel(l,"Platforms")})},Modificar_Primera_Vista:function(){var e=this.getView().getModel();this._oWizard=this.byId("QuoteCedisWizard");var t=this;if(this._oWizard.getProgress()===1){t.getView().byId("totalpackagesInput").setEditable(true);t.getView().byId("platformsInput").setEditable(true);t.getView().byId("sTipoUnidad").setEditable(true);t.getView().byId("carrierInput").setEditable(true);t.getView().byId("DP1").setEditable(true)}if(this._oWizard.getProgress()===2){this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel({editable:true}),"Modeleditable");let e=this.byId("DP1").getDateValue();this.searchOrders2(this.buildSapDate(e))}this.handleButtonsVisibility()},searchOrders2:function(e){let t=[];let a=this;t.push(this.buildFiltro("IOption",a.getView().byId("sTipoCita").getSelectedKey()));t.push(a.buildFiltro("ILifnr",a.getConfigModel().getProperty("/supplierInputKey")));t.push(a.buildFiltro("Iwerks",a.getView().byId("sOrdenes").getSelectedKey()));t.push(a.buildFiltro("IKdatb",e));var r=a.getOwnerComponent().getModel("ModelLectura").getData();if(a.getView().getModel("PosicionesG")===undefined){var l=[]}else{var l=a.getView().getModel("PosicionesG").getData()}sap.ui.core.BusyIndicator.show();let i=[];a._GetODataV2(O,T,t,["ETOC","ETMINIFULL03","ETOCSTO"],"").then(e=>{a.getView().byId("tableWizardOrder").clearSelection();var t=a.getView().getModel("Pedidos").getData();let r=[];let l=[];let i=[];let n=[];for(var o=0;o<e.data.results[0].ETOC.results.length;o++){l.push({Finicio:new Date(e.data.results[0].ETOC.results[o].Kdatb)});i.push({Ffin:new Date(e.data.results[0].ETOC.results[o].Kdate)});e.data.results[0].ETOC.results[o].Selected=false;e.data.results[0].ETOC.results[o].Menge=parseInt(e.data.results[0].ETOC.results[o].Menge);e.data.results[0].ETOC.results[o].Menge=e.data.results[0].ETOC.results[o].Menge.toString();e.data.results[0].ETOC.results[o].MengeR=parseInt(e.data.results[0].ETOC.results[o].MengeR);e.data.results[0].ETOC.results[o].MengeR=e.data.results[0].ETOC.results[o].MengeR.toString();e.data.results[0].ETOC.results[o].MengeA=parseInt(e.data.results[0].ETOC.results[o].MengeA);e.data.results[0].ETOC.results[o].MengeA=e.data.results[0].ETOC.results[o].MengeA.toString();if(a.getView().byId("sTipoCita").getSelectedKey()==="01"){for(var d=0;d<e.data.results[0].ETOCSTO.results.length;d++){if(parseInt(e.data.results[0].ETOC.results[o].Ebeln)===parseInt(e.data.results[0].ETOCSTO.results[d].Bednr)&&e.data.results[0].ETOC.results[o].Abelp===e.data.results[0].ETOCSTO.results[d].Abelp&&Number(e.data.results[0].ETOC.results[o].MengeA)>0){n.push({Abeln:e.data.results[0].ETOC.results[o].Abeln,Bwart:e.data.results[0].ETOC.results[o].Bwart,Citado:e.data.results[0].ETOC.results[o].Zpmngu,Ean11:e.data.results[0].ETOC.results[o].Ean11,Ebeln:e.data.results[0].ETOC.results[o].Ebeln,Ebelp:e.data.results[0].ETOC.results[o].Ebelp,Kdatb:e.data.results[0].ETOC.results[o].Kdatb,Kdate:e.data.results[0].ETOC.results[o].Kdate,Lifnr:e.data.results[0].ETOC.results[o].Lifnr,Matnr:e.data.results[0].ETOC.results[o].Matnr,Meins:e.data.results[0].ETOC.results[o].Meins,Menge:e.data.results[0].ETOC.results[o].Menge,Menge2:e.data.results[0].ETOCSTO.results[d].Menge,MengeA:e.data.results[0].ETOCSTO.results[d].MengeA,MengeR:e.data.results[0].ETOC.results[o].MengeR,Maktx:e.data.results[0].ETOC.results[o].Maktx,Selected:e.data.results[0].ETOC.results[o].Selected,Werks:e.data.results[0].ETOC.results[o].Werks,ZwerksD:e.data.results[0].ETOCSTO.results[d].Werks,Tarima:[],ZAbeln:e.data.results[0].ETOCSTO.results[d].Abeln,ZAbelp:e.data.results[0].ETOCSTO.results[d].Abelp,ZBednr:e.data.results[0].ETOCSTO.results[d].Bednr,ZBwart:e.data.results[0].ETOCSTO.results[d].Bwart,ZEan11:e.data.results[0].ETOCSTO.results[d].Ean11,ZEbeln:e.data.results[0].ETOCSTO.results[d].Ebeln,ZEbelp:e.data.results[0].ETOCSTO.results[d].Ebelp,ZKdatb:e.data.results[0].ETOCSTO.results[d].Kdatb,ZKdate:e.data.results[0].ETOCSTO.results[d].Kdate,ZLifnr:e.data.results[0].ETOCSTO.results[d].Lifnr,ZMatnr:e.data.results[0].ETOCSTO.results[d].Matnr,ZMeins:e.data.results[0].ETOCSTO.results[d].Meins,ZMenge:e.data.results[0].ETOCSTO.results[d].Menge,ZMengeA:e.data.results[0].ETOCSTO.results[d].MengeA,ZMengeR:e.data.results[0].ETOCSTO.results[d].MengeR,ZWerks:e.data.results[0].ETOCSTO.results[d].Werks})}}}if(a.getView().byId("sTipoCita").getSelectedKey()==="04"){for(var d=0;d<e.data.results[0].ETMINIFULL03.results.length;d++){if(e.data.results[0].ETOC.results[o].Abeln===e.data.results[0].ETMINIFULL03.results[d].Zabeln&&e.data.results[0].ETOC.results[o].Abelp===e.data.results[0].ETMINIFULL03.results[d].Zabelp&&Number(e.data.results[0].ETOC.results[o].MengeA)>0){e.data.results[0].ETOC.results[o].Zceqfp=e.data.results[0].ETMINIFULL03.results[d].Zceqfp;e.data.results[0].ETOC.results[o].Zceqfu=e.data.results[0].ETMINIFULL03.results[d].Zceqfu;e.data.results[0].ETOC.results[o].Zcjpic=e.data.results[0].ETMINIFULL03.results[d].Zcjpic;e.data.results[0].ETOC.results[o].Zcpemf=e.data.results[0].ETMINIFULL03.results[d].Zcpemf;e.data.results[0].ETOC.results[o].Zcpemp=e.data.results[0].ETMINIFULL03.results[d].Zcpemp}}}if(a.getView().byId("sTipoCita").getSelectedKey()==="02"){for(var d=0;d<e.data.results[0].ETMINIFULL03.results.length;d++){if(e.data.results[0].ETOC.results[o].Abeln===e.data.results[0].ETMINIFULL03.results[d].Zabeln&&e.data.results[0].ETOC.results[o].Abelp===e.data.results[0].ETMINIFULL03.results[d].Zabelp&&Number(e.data.results[0].ETOC.results[o].MengeA)>0&&Number(e.data.results[0].ETMINIFULL03.results[d].Zpmngu.trim().split(".")[0])>0){e.data.results[0].ETOC.results[o].MengeA=parseInt(e.data.results[0].ETOC.results[o].MengeA);e.data.results[0].ETOC.results[o].MengeA=e.data.results[0].ETOC.results[o].MengeA.toString();n.push({Abeln:e.data.results[0].ETOC.results[o].Abeln,Bwart:e.data.results[0].ETOC.results[o].Bwart,Citado:e.data.results[0].ETMINIFULL03.results[d].Zpmngu.trim().split(".")[0],Ean11:e.data.results[0].ETOC.results[o].Ean11,Ebeln:e.data.results[0].ETOC.results[o].Ebeln,Ebelp:e.data.results[0].ETOC.results[o].Ebelp,Kdatb:e.data.results[0].ETOC.results[o].Kdatb,Kdate:e.data.results[0].ETOC.results[o].Kdate,Lifnr:e.data.results[0].ETOC.results[o].Lifnr,Matnr:e.data.results[0].ETOC.results[o].Matnr,Meins:e.data.results[0].ETOC.results[o].Meins,Menge:e.data.results[0].ETOC.results[o].Menge,MengeA:e.data.results[0].ETOC.results[o].MengeA,MengeR:e.data.results[0].ETOC.results[o].MengeR,Maktx:e.data.results[0].ETOC.results[o].Maktx,Selected:e.data.results[0].ETOC.results[o].Selected,Werks:e.data.results[0].ETOC.results[o].Werks,ZwerksD:e.data.results[0].ETMINIFULL03.results[d].ZwerksD,Abelp:e.data.results[0].ETMINIFULL03.results[d].Zabelp})}}}if(a.getView().byId("sTipoCita").getSelectedKey()==="03"){if(parseInt(e.data.results[0].ETOC.results[o].MengeA)>0){n.push(e.data.results[0].ETOC.results[o])}}}if(a.getView().byId("sTipoCita").getSelectedKey()==="02"||a.getView().byId("sTipoCita").getSelectedKey()==="01"||a.getView().byId("sTipoCita").getSelectedKey()==="03"){e.data.results[0].ETOC.results=[];e.data.results[0].ETOC.results=n}for(var g=0;g<t.ETOC.results.length;g++){e.data.results[0].ETOC.results.push(t.ETOC.results[g])}a.getOwnerComponent().setModel(new s(e.data.results[0]),"Pedidos");function u(e,t){return e.Finicio==t.Finicio?0:e.Finicio<t.Finicio?1:-1}function p(e,t){return e.Ffin==t.Ffin?0:e.Ffin>t.Ffin?1:-1}l.sort(u);i.sort(p);e.data.results[0].fechaInicio=new Date(l[0].Finicio).toISOString().slice(0,10);e.data.results[0].fechaFFin=new Date(i[0].Ffin).toISOString().slice(0,10);sap.ui.core.BusyIndicator.hide()}).catch(e=>{sap.ui.core.BusyIndicator.hide()})},CancelarCita:function(){sap.m.MessageBox["confirm"](this.getView().getModel("appTxts").getProperty("/quotes.cancel"),{actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:async function(e){if(e===sap.m.MessageBox.Action.YES){this._oWizard=this.getView().byId("QuoteCedisWizard");let e=this.getOwnerComponent().getModel("CitaCreationArray").getData();var t={Proveedor:this.getOwnerComponent().getModel("ModelLectura").getData().Proveedor,Action:"3",CTCITASCAB:[{Folio:this.getOwnerComponent().getModel("ModelLectura").getData().Folio,Centro:this.getOwnerComponent().getModel("ModelLectura").getData().Centro,Fechacita:this.getOwnerComponent().getModel("ModelLectura").getData().Fechacita,Proveedor:this.getOwnerComponent().getModel("ModelLectura").getData().Proveedor}],CTCITASDET:[],ETRETURN:[]};var a=p;var r="/"+C;var l=JSON.stringify(t);var i=this;i._POSToData(a,r,l).then(function(e){sap.ui.core.BusyIndicator.hide();var t=e.d;if(t.Success==="X"){sap.m.MessageBox.success("cita Cancelada correctamente")}else{sap.m.MessageBox.error(t.ETRETURN.results[0].Message)}i._oWizard.discardProgress(i._oWizard.getSteps()[0]);i.byId("wizardDialog").destroy();i._pDialog=null;i._oWizard=null;i.getView().setModel(new s,"ModelLectura");i.getView().setModel(new s,"tableWizardOrderPosition");i.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel,"CitaMainData");i.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel([]),"CitaCreationArray");E=null;i.searchData()})}}.bind(this)})},Busqueda:function(){let e="";if(this.getView().byId("FP").getSelected()){e="1"}if(this.getView().byId("PB").getSelected()){e="2"}if(this.getView().byId("RS").getSelected()){e="3"}if(!this.getView().byId("RS").getSelected()&&!this.getView().byId("RS").getSelected()&&!this.getView().byId("PB").getSelected()){e="7"}},inspeccion:function(e){let t=e.getSource();let s=t.getDateValue();this.getOwnerComponent().getModel("CitaMainData").setProperty("/FechaAud",new Date(s).toISOString().slice(0,10))},onUpload:function(e){this._import(e.getParameter("files")&&e.getParameter("files")[0])},_import:function(e){var t=this;var s=t.getView().getModel("Pedidos").getData().ETOC.results;var a=t.getView().getModel("Pedidos").getData().ETMINIFULL03.results;var r={};if(e&&window.FileReader){var l=new FileReader;l.onload=function(e){var a=e.target.result;var r=Number(t.getConfigModel().getProperty("/supplierInputKey").padStart(10,0));if(r!==Number(a.split("\n")[1].split("|")[1])){sap.m.MessageBox.error(t.getView().getModel("appTxts").getProperty("/quotes.ErrorMasivo"));return}if(t.getView().byId("sTipoCita").getSelectedKey()==="02"){let e=[];for(var l=0;l<a.split("\n").length;l++){if(a.split("\n")[l].split("|")[0]=="DD"){e.push({tipo:a.split("\n")[l].split("|")[0],Ebeln:a.split("\n")[l].split("|")[1],Ean11:a.split("\n")[l].split("|")[2],ZwerksD:a.split("\n")[l].split("|")[3]})}}var i=[];if(e.length>0){for(var l=0;l<e.length;l++){for(var n=0;n<s.length;n++){if(s[n].Ebeln===e[l].Ebeln&&s[n].Ean11===e[l].Ean11&&s[n].ZwerksD===e[l].ZwerksD){i.push(s[n])}}}}t.getOwnerComponent().getModel("Pedidos").setProperty("/ETOC/results",[]);t.getOwnerComponent().getModel("Pedidos").setProperty("/ETOC/results",i);t.getView().byId("tableWizardOrder").setEnableSelectAll(true);t.getView().byId("tableWizardOrder").setSelectionInterval(0,i.length-1);t.selectPedido()}if(t.getView().byId("sTipoCita").getSelectedKey()==="01"){let e=[];for(var l=0;l<a.split("\n").length;l++){if(a.split("\n")[l].split("|")[0]=="DD"){e.push({tipo:a.split("\n")[l].split("|")[0],Ebeln:a.split("\n")[l].split("|")[1],Ean11:a.split("\n")[l].split("|")[2],ZwerksD:a.split("\n")[l].split("|")[3],Tarima:a.split("\n")[l].split("|")[4],Citado:Number(a.split("\n")[l].split("|")[5])})}}var i=[];var o=t.getView().byId("platformsInput").getValue();if(e.length>0){for(var l=0;l<e.length;l++){for(var n=0;n<s.length;n++){if(s[n].Ebeln===e[l].Ebeln&&s[n].Ean11===e[l].Ean11&&s[n].ZwerksD===e[l].ZwerksD){for(var d=1;d<=o;d++){if(e[l].Tarima===d.toString()){s[n].Tarima.push({Ztarima:e[l].Tarima,Bednr:s[n].ZBednr,Abeln:s[n].ZAbeln,Abelp:s[n].ZAbelp,Werks:s[n].ZWerks,Menge:e[l].Citado.toString()})}}i.push(s[n])}}}}t.getOwnerComponent().getModel("Pedidos").setProperty("/ETOC/results",[]);t.getOwnerComponent().getModel("Pedidos").setProperty("/ETOC/results",i);t.getView().byId("tableWizardOrder").setEnableSelectAll(true);t.getView().byId("tableWizardOrder").setSelectionInterval(0,i.length-1);t.selectPedido()}if(t.getView().byId("sTipoCita").getSelectedKey()==="03"){let e=[];for(var l=0;l<a.split("\n").length;l++){if(a.split("\n")[l].split("|")[0]=="DD"){e.push({tipo:a.split("\n")[l].split("|")[0],Ebeln:a.split("\n")[l].split("|")[1],Ean11:a.split("\n")[l].split("|")[2],ZwerksD:a.split("\n")[l].split("|")[3],Tarima:a.split("\n")[l].split("|")[4],Citado:Number(a.split("\n")[l].split("|")[5])})}}var i=[];if(e.length>0){for(var l=0;l<e.length;l++){for(var n=0;n<s.length;n++){if(s[n].Ebeln===e[l].Ebeln&&s[n].Ean11===e[l].Ean11){s[n].Citado=e[l].Citado.toString();i.push(s[n])}}}}t.getOwnerComponent().getModel("Pedidos").setProperty("/ETOC/results",[]);t.getOwnerComponent().getModel("Pedidos").setProperty("/ETOC/results",i);t.getView().byId("tableWizardOrder").setEnableSelectAll(true);t.getView().byId("tableWizardOrder").setSelectionInterval(0,i.length-1);t.selectPedido()}if(t.getView().byId("sTipoCita").getSelectedKey()==="04"){let e=[];for(var l=0;l<a.split("\n").length;l++){if(a.split("\n")[l].split("|")[0]=="DD"){e.push({tipo:a.split("\n")[l].split("|")[0],Ebeln:a.split("\n")[l].split("|")[1],Ean11:a.split("\n")[l].split("|")[2],ZwerksD:a.split("\n")[l].split("|")[3],Tarima:a.split("\n")[l].split("|")[4],Citado:Number(a.split("\n")[l].split("|")[5])})}}var i=[];if(e.length>0){for(var l=0;l<e.length;l++){for(var n=0;n<s.length;n++){if(s[n].Ebeln===e[l].Ebeln&&s[n].Ean11===e[l].Ean11){s[n].Citado=e[l].Citado.toString();i.push(s[n])}}}}t.getOwnerComponent().getModel("Pedidos").setProperty("/ETOC/results",[]);t.getOwnerComponent().getModel("Pedidos").setProperty("/ETOC/results",i);t.getView().byId("tableWizardOrder").setEnableSelectAll(true);t.getView().byId("tableWizardOrder").setSelectionInterval(0,i.length-1);t.selectPedido()}};l.onerror=function(e){};l.readAsBinaryString(e)}}})});