sap.ui.define(["demo/controllers/BaseController","sap/ui/core/Fragment","sap/ui/model/json/JSONModel","sap/m/MessageBox","demo/models/formatter"],function(e,t,a,s,i){"use strict";var r=new this.Pedidostemp;var o=new this.Citas1;var n=null;var l="";var d={generalData:{cedisType:"",tipoCita:"",totalBultos:"",tarimas:"",tipoUnidad:"",tipoProducto:"",transportista:""},pedidos:[]};var g="ZOSP_CITAS_ADM_SRV";var u="MainSet";var p="ZOSP_PO_CITAS_SRV";var c="CitasPOSet";var h=null;var C=[];return e.extend("demo.controllers.Quotes.wizards.WQuoteCreate",{formatter:i,setInitialDate(){let e=this.getView().byId("DP1");let t=new Date;t=t.getTime()+1e3*60*60*24*2;e.setDateValue(new Date(t));e.setMinDate(new Date(t));e.fireChange();this.setInitialDateAuditoria()},setInitialDateAuditoria(){let e=this.getView().byId("DP2");let t=new Date;t=t.getTime()+1e3*60*60*24*1;e.setDateValue(new Date(t));e.setMinDate(new Date(t));e.fireChange()},createQuote:function(e){console.log("paso 2");if(!this.hasAccess(31)){return}if(this.getConfigModel().getProperty("/supplierInputKey")!=null){this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel,"CitaMainData");this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel([]),"CitaCreationArray");if(e==="N"){this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel({lectura:false}),"ModelLectura")}this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel({editable:true}),"Modeleditable");var a=this.getView();var s="demo.views.Quotes.wizards.WQuoteCreate";let i=this;if(!this._pDialog){this._pDialog=t.load({id:a.getId(),name:s,controller:this}).then(function(e){e.attachAfterOpen(this.onDialogAfterOpen,this);a.addDependent(e);return e}.bind(this))}this._pDialog.then(function(t){t.open();var a=e;console.log(a);if(e==="N"){i.getView().byId("ModCita").setVisible(false);i.getView().byId("cancCita").setVisible(false)}else{i.getView().byId("ModCita").setVisible(true);i.getView().byId("cancCita").setVisible(true)}if(!a.lectura){i.getView().byId("wizardDialog").setTitle(i.getView().getModel("appTxts").getProperty("/quotes.createNewQuote"));i.setInitialDate();i.getView().byId("sTipoCita").setSelectedKey("");i.getView().byId("sTipoUnidad").setSelectedKey("");i.getView().byId("sTipoCita").setEditable(true);i.getView().byId("totalpackagesInput").setEditable(true);i.getView().byId("platformsInput").setEditable(true);i.getView().byId("sTipoUnidad").setEditable(true);i.getView().byId("carrierInput").setEditable(true);i.getView().byId("DP1").setEditable(true);i.getView().byId("totalpackagesInput").setEditable(true);i.getView().byId("platformsInput").setEditable(true);i.getView().byId("carrierInput").setEditable(true)}else{console.log("paso 3");i.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(a),"ModelLectura");i.getView().byId("wizardDialog").setTitle(i.getView().getModel("appTxts").getProperty("/quotes.editNewQuote"));i.getView().byId("sTipoCita").setSelectedKey(a.Tipocita);i.getView().byId("sTipoUnidad").setSelectedKey(a.Tipounidad);i.getView().byId("DP1").setDateValue(new Date(a.Fechacita.replaceAll("-",",")));i.getView().byId("totalpackagesInput").setValue(a.Bultos);i.getView().byId("platformsInput").setValue(Number(a.Tarimas));i.getView().byId("carrierInput").setValue(a.Transportista);if(a.Tipocita==="01"||a.Tipocita==="02"&&a.Fechacita!==null){console.log("entro");i.getView().byId("DP2").setDateValue(new Date(a.Fechacita.replaceAll("-",",")))}i.getView().byId("sTipoCita").setEditable(false);i.getView().byId("totalpackagesInput").setEditable(false);i.getView().byId("platformsInput").setEditable(false);i.getView().byId("sTipoUnidad").setEditable(false);i.getView().byId("carrierInput").setEditable(false);i.getView().byId("DP1").setEditable(false);i.getView().byId("totalpackagesInput").setEditable(false);i.getView().byId("platformsInput").setEditable(false);i.getView().byId("carrierInput").setEditable(false)}})}else{sap.m.MessageBox.error(this.getView().getModel("appTxts").getProperty("/quotes.messageNoSupplier"))}},onDialogAfterOpen:function(){this._oWizard=this.byId("QuoteCedisWizard");this._oWizard._getProgressNavigator().ontap=function(){};this.handleButtonsVisibility();n=new a(d);this.getView().setModel(n,"TemporalModel");n.setProperty("/generalData/tipoCita",this.getView().byId("sTipoCita").getSelectedKey());n.setProperty("/generalData/tipoUnidad",this.getView().byId("sTipoUnidad").getSelectedKey());if(this.getView().byId("sTipoCita").getSelectedKey()==="01"||this.getView().byId("sTipoCita").getSelectedKey()==="02"){this.getView().byId("txtDP2").setVisible(true);this.getView().byId("DP2").setVisible(true)}else{this.getView().byId("txtDP2").setVisible(false);this.getView().byId("DP2").setVisible(false)}},handleButtonsVisibility:function(){var e=this.getView().getModel();var t=e.getProperty("/selectedPayment");switch(this._oWizard.getProgress()){case 1:e.setProperty("/nextButtonVisible",true);e.setProperty("/backButtonVisible",true);e.setProperty("/finishButtonVisible",false);break;case 2:e.setProperty("/nextButtonVisible",true);e.setProperty("/backButtonVisible",true);e.setProperty("/finishButtonVisible",false);break;case 3:e.setProperty("/nextButtonVisible",false);e.setProperty("/backButtonVisible",true);e.setProperty("/finishButtonVisible",true);break;default:break}},onDialogNextButton:function(){if(this.getView().byId("platformsInput").getValue()===""&&this.getView().byId("sTipoCita").getSelectedKey()==="01"){s.warning("Cantidad de Tarimas es Obligatorio");return}this.getView().getModel("TemporalModel").getData().generalData.totalBultos=this.getView().byId("totalpackagesInput").getValue();this.getView().getModel("TemporalModel").getData().generalData.tarimas=this.getView().byId("platformsInput").getValue();this.getView().getModel("TemporalModel").getData().generalData.transportista=this.getView().byId("carrierInput").getValue();if(this._oWizard.getProgressStep().getValidated()){if(this._oWizard.getProgressStep().sButtonText==="Paso 2"){let e=this.byId("DP1").getDateValue();this.searchOrders(this.buildSapDate(e))}if(this._oWizard.getProgressStep().sButtonText==="Paso 3"){if(this.getView().byId("tableWizardOrder").getSelectedIndices().length===0){console.log("no puede pasar ")}else{if(this.getView().byId("sTipoCita").getSelectedKey()==="01"){var e=false;for(var t=0;t<this.getView().byId("tableWizardOrder").getSelectedIndices().length;t++){if(this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[this.getView().byId("tableWizardOrder").getSelectedIndices()[t]].Tarima.length===0){s.alert("La posicion tienda "+this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[this.getView().byId("tableWizardOrder").getSelectedIndices()[t]].ZWerks+" no tiene tarima Ingresada");return}}}}}this._oWizard.nextStep()}this.handleButtonsVisibility()},onDialogBackButton:function(){this._oWizard.previousStep();this.handleButtonsVisibility()},onCloseWizard:function(){var e=this.getView().getModel("ModelLectura").getData();var t=new sap.ui.model.json.JSONModel([]);this.getOwnerComponent().setModel(t,"Platforms");if(e.lectura){this._handleMessageBoxOpen(this.getView().getModel("appTxts").getProperty("/quotes.discardButton"),"warning")}else{this._handleMessageBoxOpen(this.getView().getModel("appTxts").getProperty("/quotes.closeButton"),"warning")}},testModelos:function(){},async handleWizardSubmit(){sap.m.MessageBox["confirm"](this.getView().getModel("appTxts").getProperty("/quotes.submitAppoinment"),{actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:async function(e){if(e===sap.m.MessageBox.Action.YES){this._oWizard.discardProgress(this._oWizard.getSteps()[0]);this.byId("wizardDialog").destroy();this._pDialog=null;this._oWizard=null;let e=this.getOwnerComponent().getModel("CitaCreationArray").getData();var t=this.getView().getModel("configSite").getData();var a=this.getView().getModel("TemporalModel").getData();var i=this.getView().getModel("Platforms").getData();console.log(e);console.log(t);console.log(a);console.log(i);if(this.getOwnerComponent().getModel("ModelLectura").getData().lectura===true){var r=[];for(var o=0;o<this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results.length;o++){if(this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].Selected){r.push({Folio:this.getOwnerComponent().getModel("ModelLectura").getData().Folio,Ebeln:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].Ebeln,Ebelp:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].Ebelp,Matnr:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].Matnr,Cantidad:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].Citado,Fechaini:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].Kdatb,Fechafin:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].Kdate,Umedida:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].Meins,Citado:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].Citado})}}var n={Proveedor:this.getOwnerComponent().getModel("ModelLectura").getData().Proveedor,Action:"2",CTCITASCAB:[{Folio:this.getOwnerComponent().getModel("ModelLectura").getData().Folio,Centro:this.getOwnerComponent().getModel("ModelLectura").getData().Centro,Fechacita:e[0].FechaCita,FechaAud:e[0].FechaAud,Proveedor:this.getOwnerComponent().getModel("ModelLectura").getData().Proveedor,Tipocita:a.generalData.Tipocita,Tipounidad:a.generalData.tipoUnidad,Transportista:a.generalData.transportista,Bultos:a.generalData.totalBultos,Tarimas:a.generalData.tarimas,HoraIni:e[0].HoraIni,HoraFin:e[0].HoraFin,Anden:i[Number(e[0].Anden)].name}],CTCITASDET:r,ETRETURN:[]};var l=g;var d="/"+u;var p=JSON.stringify(n);var c=this;c._POSToData(l,d,p).then(function(e){sap.ui.core.BusyIndicator.hide();var t=e.d;if(t.Success==="X"){sap.m.MessageBox.success(t.Message)}else{sap.m.MessageBox.error(t.Message)}})}else{var h=[];var C=[];if(a.generalData.tipoCita==="02"){for(var o=0;o<this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results.length;o++){if(this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].Selected){for(var m=0;m<this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results.length;m++){if(this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].Abeln===this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[m].Zabeln&&this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].ZwerksD===this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[m].ZwerksD&&this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].Abelp===this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[m].Zabelp){h.push({Zabeln:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[m].Zabeln.trim(),Zabelp:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[m].Zabelp.trim(),Zmatnr:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[m].Zmatnr.trim(),ZwerksD:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[m].ZwerksD.trim(),Zpmngu:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[m].Zpmngu.trim(),Zaufme:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[m].Zceqfu.trim(),Zceqfu:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[m].Zceqfu.trim(),Zueqfu:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[m].Zueqfu.trim(),Zceqfp:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[m].Zceqfp.trim(),Zaufpf:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[m].Zaufpf.trim(),Zcpemf:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[m].Zcpemf.trim(),Zupemf:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[m].Zupemf.trim(),Zcpemp:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[m].Zcpemp.trim(),Zaufmp:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[m].Zaufmp.trim(),Zcjpic:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[m].Zcjpic.trim(),Zuncom:this.getOwnerComponent().getModel("Pedidos").getData().ETMINIFULL03.results[m].Zuncom.trim()})}}}}for(var o=0;o<e.length;o++){C.push({Ebeln:e[o].Ebeln,Ebelp:e[o].Ebelp,Matnr:e[o].Matnr,Citado:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].Citado,FechaCita:e[o].FechaCita,HoraIni:e[o].HoraIni,HoraFin:e[o].HoraFin,Anden:i[Number(e[0].Anden)].name,TipoCita:a.generalData.tipoCita,Lifnr:t.supplierInputKey,Bultos:a.generalData.totalBultos,Tarimas:a.generalData.tarimas,TipoUnidad:a.generalData.tipoUnidad,Transportista:a.generalData.transportista})}}else if(a.generalData.tipoCita==="01"){for(var o=0;o<this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results.length;o++){if(this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].Selected){h.push({Abeln:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].ZAbeln,Abelp:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].ZAbelp,Bednr:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].ZBednr,Bwart:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].ZBwart,Ean11:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].ZEan11,Ebeln:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].ZEbeln,Ebelp:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].ZEbelp,Kdatb:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].ZKdatb,Kdate:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].ZKdate,Lifnr:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].ZLifnr,Matnr:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].ZMatnr,Meins:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].ZMeins,Menge:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].ZMenge,MengeA:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].ZMengeA,MengeR:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].ZMengeR,Werks:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].ZWerks,ETOCSTOPALL:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].Tarima})}}for(var o=0;o<e.length;o++){C.push({Ebeln:e[o].Ebeln,Ebelp:e[o].Ebelp,Matnr:e[o].Matnr,Citado:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].Citado,FechaCita:e[o].FechaCita,HoraIni:e[o].HoraIni,HoraFin:e[o].HoraFin,Anden:i[Number(e[0].Anden)].name,TipoCita:a.generalData.tipoCita,Lifnr:t.supplierInputKey,Bultos:a.generalData.totalBultos,Tarimas:a.generalData.tarimas,TipoUnidad:a.generalData.tipoUnidad,Transportista:a.generalData.transportista})}}else{for(var o=0;o<e.length;o++){C.push({Ebeln:e[o].Ebeln,Ebelp:e[o].Ebelp,Matnr:e[o].Matnr,Citado:e[o].Citado.toLocaleString(),FechaCita:e[o].FechaCita,HoraIni:e[o].HoraIni,HoraFin:e[o].HoraFin,Anden:i[Number(e[0].Anden)].name,TipoCita:a.generalData.tipoCita,Lifnr:t.supplierInputKey,Bultos:a.generalData.totalBultos,Tarimas:a.generalData.tarimas,TipoUnidad:a.generalData.tipoUnidad,Transportista:a.generalData.transportista})}}let r;if(C.length===0){s.alert("error al crear la cabecera es vacio");return}if(a.generalData.tipoCita==="01"){r={Proveedor:t.supplierInputKey.padStart(10,0),Action:"1",ETOCSTO:h,ETCITANUEVA:C,ETRETURN:[]}}else{r={Proveedor:t.supplierInputKey.padStart(10,0),Action:"1",ETCITANUEVA:C,ETMINIFULL03:h,ETRETURN:[]}}sap.ui.core.BusyIndicator.show();let n=null;var l=g;var d="/"+u;var p=JSON.stringify(r);var c=this}c._POSToData(l,d,p).then(function(e){sap.ui.core.BusyIndicator.hide();var t=e.d;if(t.Success==="X"){sap.m.MessageBox.success(t.Message)}else{sap.m.MessageBox.error(t.ETRETURN.results[0].Message)}});this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel([]),"ModelLectura");this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel([]),"Modeleditable")}}.bind(this)})},_POSToData:function(e,t,a){var s="/sap/opu/odata/sap/"+e;var i=this;return new Promise(function(e,i){$.ajax({url:s+t,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:a,headers:{"X-Requested-With":"X"},success:function(t){e(t)},error:function(e,t,a){sap.ui.core.BusyIndicator.hide();i(new Error(e))}})})},_handleMessageBoxOpen:function(e,t){sap.m.MessageBox[t](e,{actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(e){if(e===sap.m.MessageBox.Action.YES){this._oWizard.discardProgress(this._oWizard.getSteps()[0]);this.byId("wizardDialog").destroy();this._pDialog=null;this._oWizard=null;this.getView().setModel(new a,"ModelLectura");this.getView().setModel(new a,"tableWizardOrderPosition");this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel([]),"CitaMainData");this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel([]),"CitaCreationArray");this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel([]),"Pedidos");this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel([]),"Platforms");h=null}}.bind(this)})},searchOrders:function(e){let t=[];let s=this;console.log("paso 4");t.push(this.buildFiltro("IOption",s.getView().byId("sTipoCita").getSelectedKey()));t.push(s.buildFiltro("ILifnr",s.getConfigModel().getProperty("/supplierInputKey")));t.push(s.buildFiltro("IKdatb",e));var i=s.getOwnerComponent().getModel("ModelLectura").getData();console.log(i);if(s.getView().getModel("PosicionesG")===undefined){var r=[]}else{var r=s.getView().getModel("PosicionesG").getData()}console.log(r);sap.ui.core.BusyIndicator.show();let o=[];s._GetODataV2(p,c,t,["ETOC","ETMINIFULL03","ETOCSTO"],"").then(e=>{s.getView().byId("tableWizardOrder").clearSelection();let t=[];let n=[];let l=[];if(i.lectura){console.log("paso 5");this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel({editable:false}),"Modeleditable");for(var d=0;d<e.data.results[0].ETOC.results.length;d++){e.data.results[0].ETOC.results[d].Selected=true;for(var g=0;g<r.length;g++){if(e.data.results[0].ETOC.results[d].Matnr===r[g].Matnr&&e.data.results[0].ETOC.results[d].Werks===r[g].Werks&&e.data.results[0].ETOC.results[d].Ebeln===r[g].Ebeln){e.data.results[0].ETOC.results[d].Citado=r[g].Citado;e.data.results[0].ETOC.results[d].ZwerksD=r[g].Werks;e.data.results[0].ETOC.results[d].Tarima=[];o.push(e.data.results[0].ETOC.results[d])}}}e.data.results[0].ETOC.results=o}else{console.log("paso 6");let t=[];for(var d=0;d<e.data.results[0].ETOC.results.length;d++){n.push({Finicio:new Date(e.data.results[0].ETOC.results[d].Kdatb)});l.push({Ffin:new Date(e.data.results[0].ETOC.results[d].Kdate)});e.data.results[0].ETOC.results[d].Selected=false;if(s.getView().byId("sTipoCita").getSelectedKey()==="01"){for(var g=0;g<e.data.results[0].ETOCSTO.results.length;g++){if(parseInt(e.data.results[0].ETOC.results[0].Ebeln)===parseInt(e.data.results[0].ETOCSTO.results[0].Bednr)&&e.data.results[0].ETOC.results[d].Abelp===e.data.results[0].ETOCSTO.results[g].Abelp){t.push({Abeln:e.data.results[0].ETOC.results[d].Abeln,Bwart:e.data.results[0].ETOC.results[d].Bwart,Citado:e.data.results[0].ETOC.results[d].Zpmngu,Ean11:e.data.results[0].ETOC.results[d].Ean11,Ebeln:e.data.results[0].ETOC.results[d].Ebeln,Ebelp:e.data.results[0].ETOC.results[d].Ebelp,Kdatb:e.data.results[0].ETOC.results[d].Kdatb,Kdate:e.data.results[0].ETOC.results[d].Kdate,Lifnr:e.data.results[0].ETOC.results[d].Lifnr,Matnr:e.data.results[0].ETOC.results[d].Matnr,Meins:e.data.results[0].ETOC.results[d].Meins,Menge:e.data.results[0].ETOC.results[d].Menge,Menge2:e.data.results[0].ETOCSTO.results[g].Menge,MengeA:e.data.results[0].ETOCSTO.results[g].MengeA,MengeR:e.data.results[0].ETOC.results[d].MengeR,Selected:e.data.results[0].ETOC.results[d].Selected,Werks:e.data.results[0].ETOC.results[d].Werks,ZwerksD:e.data.results[0].ETOCSTO.results[g].Werks,Tarima:[],ZAbeln:e.data.results[0].ETOCSTO.results[g].Abeln,ZAbelp:e.data.results[0].ETOCSTO.results[g].Abelp,ZBednr:e.data.results[0].ETOCSTO.results[g].Bednr,ZBwart:e.data.results[0].ETOCSTO.results[g].Bwart,ZEan11:e.data.results[0].ETOCSTO.results[g].Ean11,ZEbeln:e.data.results[0].ETOCSTO.results[g].Ebeln,ZEbelp:e.data.results[0].ETOCSTO.results[g].Ebelp,ZKdatb:e.data.results[0].ETOCSTO.results[g].Kdatb,ZKdate:e.data.results[0].ETOCSTO.results[g].Kdate,ZLifnr:e.data.results[0].ETOCSTO.results[g].Lifnr,ZMatnr:e.data.results[0].ETOCSTO.results[g].Matnr,ZMeins:e.data.results[0].ETOCSTO.results[g].Meins,ZMenge:e.data.results[0].ETOCSTO.results[g].Menge,ZMengeA:e.data.results[0].ETOCSTO.results[g].MengeA,ZMengeR:e.data.results[0].ETOCSTO.results[g].MengeR,ZWerks:e.data.results[0].ETOCSTO.results[g].Werks})}}}if(s.getView().byId("sTipoCita").getSelectedKey()==="04"){for(var g=0;g<e.data.results[0].ETMINIFULL03.results.length;g++){if(e.data.results[0].ETOC.results[d].Abeln===e.data.results[0].ETMINIFULL03.results[g].Zabeln&&e.data.results[0].ETOC.results[d].Abelp===e.data.results[0].ETMINIFULL03.results[g].Zabelp){e.data.results[0].ETOC.results[d].Zceqfp=e.data.results[0].ETMINIFULL03.results[g].Zceqfp;e.data.results[0].ETOC.results[d].Zceqfu=e.data.results[0].ETMINIFULL03.results[g].Zceqfu;e.data.results[0].ETOC.results[d].Zcjpic=e.data.results[0].ETMINIFULL03.results[g].Zcjpic;e.data.results[0].ETOC.results[d].Zcpemf=e.data.results[0].ETMINIFULL03.results[g].Zcpemf;e.data.results[0].ETOC.results[d].Zcpemp=e.data.results[0].ETMINIFULL03.results[g].Zcpemp}}}if(s.getView().byId("sTipoCita").getSelectedKey()==="02"){for(var g=0;g<e.data.results[0].ETMINIFULL03.results.length;g++){if(e.data.results[0].ETOC.results[d].Abeln===e.data.results[0].ETMINIFULL03.results[g].Zabeln&&e.data.results[0].ETOC.results[d].Abelp===e.data.results[0].ETMINIFULL03.results[g].Zabelp){t.push({Abeln:e.data.results[0].ETOC.results[d].Abeln,Bwart:e.data.results[0].ETOC.results[d].Bwart,Citado:e.data.results[0].ETMINIFULL03.results[g].Zpmngu.trim().split(".")[0],Ean11:e.data.results[0].ETOC.results[d].Ean11,Ebeln:e.data.results[0].ETOC.results[d].Ebeln,Ebelp:e.data.results[0].ETOC.results[d].Ebelp,Kdatb:e.data.results[0].ETOC.results[d].Kdatb,Kdate:e.data.results[0].ETOC.results[d].Kdate,Lifnr:e.data.results[0].ETOC.results[d].Lifnr,Matnr:e.data.results[0].ETOC.results[d].Matnr,Meins:e.data.results[0].ETOC.results[d].Meins,Menge:e.data.results[0].ETOC.results[d].Menge,MengeA:e.data.results[0].ETOC.results[d].MengeA,MengeR:e.data.results[0].ETOC.results[d].MengeR,Selected:e.data.results[0].ETOC.results[d].Selected,Werks:e.data.results[0].ETOC.results[d].Werks,ZwerksD:e.data.results[0].ETMINIFULL03.results[g].ZwerksD,Abelp:e.data.results[0].ETMINIFULL03.results[g].Zabelp})}}}}if(s.getView().byId("sTipoCita").getSelectedKey()==="02"||s.getView().byId("sTipoCita").getSelectedKey()==="01"){e.data.results[0].ETOC.results=[];e.data.results[0].ETOC.results=t}}s.getOwnerComponent().setModel(new a(e.data.results[0]),"Pedidos");function u(e,t){return e.Finicio==t.Finicio?0:e.Finicio<t.Finicio?1:-1}function p(e,t){return e.Ffin==t.Ffin?0:e.Ffin>t.Ffin?1:-1}n.sort(u);l.sort(p);e.data.results[0].fechaInicio=new Date(n[0].Finicio).toISOString().slice(0,10);e.data.results[0].fechaFFin=new Date(l[0].Ffin).toISOString().slice(0,10);sap.ui.core.BusyIndicator.hide()}).catch(e=>{sap.ui.core.BusyIndicator.hide()})},selectTarima:function(e){var t=e.getSource().getParent();console.log(t);console.log(this.getView().getModel("ModelLectura").getData());console.log(t.getBindingContext("Pedidos"));console.log(t.getBindingContext("Pedidos").sPath.split("/")[3]);l=t.getBindingContext("Pedidos").sPath.split("/")[3];console.log(t.getBindingContext("Pedidos").getProperty("Tarima"));if(t.getBindingContext("Pedidos").getProperty("Tarima").length===0){var a=[];var s=this.getView().byId("platformsInput").getValue();for(var i=1;i<=s;i++){a.push({Ztarima:i.toString(),Bednr:t.getBindingContext("Pedidos").getProperty("ZBednr"),Abeln:t.getBindingContext("Pedidos").getProperty("ZAbeln"),Abelp:t.getBindingContext("Pedidos").getProperty("ZAbelp"),Werks:t.getBindingContext("Pedidos").getProperty("ZWerks"),Menge:""})}this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(a),"Tarimas")}else{var a=[];var s=this.getView().byId("platformsInput").getValue();for(var i=1;i<=s;i++){var r="";for(var o=0;o<t.getBindingContext("Pedidos").getProperty("Tarima").length;o++){if(i===Number(t.getBindingContext("Pedidos").getProperty("Tarima")[o].Ztarima)){r=t.getBindingContext("Pedidos").getProperty("Tarima")[o].Menge}}a.push({Ztarima:i.toString(),Bednr:t.getBindingContext("Pedidos").getProperty("ZBednr"),Abeln:t.getBindingContext("Pedidos").getProperty("ZAbeln"),Abelp:t.getBindingContext("Pedidos").getProperty("ZAbelp"),Werks:t.getBindingContext("Pedidos").getProperty("ZWerks"),Menge:r})}}this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(a),"Tarimas");var n=this.getView().byId("myDialog");if(!n){n=sap.ui.xmlfragment(this.getView().getId(),"demo.views.Quotes.wizards.fragments.Tarimas",this);this.getView().addDependent(n)}n.open()},handleClose:function(e){l="";var t=this.getView().byId("myDialog");t.close()},ActualizacionTarima:function(){if(this.ValidaCantidad()){this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[l].Tarima=[];for(var e=0;e<this.getView().byId("tableid").getSelectedItems().length;e++){if(Number(this.getOwnerComponent().getModel("Tarimas").getData()[this.getView().byId("tableid").getSelectedItems()[e].sId.split("-")[4]].Menge)>0){this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[l].Tarima.push(this.getOwnerComponent().getModel("Tarimas").getData()[this.getView().byId("tableid").getSelectedItems()[e].sId.split("-")[4]])}else{s.warning("Cantidad en Tarima n° "+this.getOwnerComponent().getModel("Tarimas").getData()[this.getView().byId("tableid").getSelectedItems()[e].sId.split("-")[4]].Ztarima+" es Vacia o tiene un valor inferior a 0");return}}this.handleClose()}},ValidaCantidad:function(){var e=0;var t=false;if(this.getView().byId("tableid").getSelectedItems().length<1){s.warning("No ha seleccionado ninguna posición ");t=false}for(var a=0;a<this.getView().byId("tableid").getSelectedItems().length;a++){if(this.getOwnerComponent().getModel("Tarimas").getData()[this.getView().byId("tableid").getSelectedItems()[a].sId.split("-")[4]].Menge===""){s.warning("Cantidad en Tarima n° "+this.getOwnerComponent().getModel("Tarimas").getData()[this.getView().byId("tableid").getSelectedItems()[a].sId.split("-")[4]].Ztarima+" es Vacia o tiene un valor inferior a 0");t=false}else{e=e+Number(this.getOwnerComponent().getModel("Tarimas").getData()[this.getView().byId("tableid").getSelectedItems()[a].sId.split("-")[4]].Menge);this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[l].Tarima=[];if(e>this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[l].MengeA){t=false;s.warning("Las cantidades ingresadas son superior a la cantidad disponible para la tienda")}else{this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[l].Tarima.push(this.getOwnerComponent().getModel("Tarimas").getData()[this.getView().byId("tableid").getSelectedItems()[a].sId.split("-")[4]]);t=true}}}if(t){return t}},getDetailOrder:function(){var e=this;var t=`/Valida_citasSet?$expand=Po_validas&$filter=IOption eq '1' and IEbeln eq '${this._document}'`;this.getView().setModel(new a,"tableWizardPo_validas");o.getJsonModelAsync(t,function(t){var a=t.getProperty("/results/0");if(a.ESuccess=="X"){var s=e.getView().getModel("tableWizardPo_validas");s.setProperty("/Oekponav",a.Po_validas)}else{sap.m.MessageBox.error(a.EMessage)}},function(){sap.m.MessageBox.error("")},this)},onSelectRBOption:function(e){n.setProperty("/generalData/cedisType",e.getParameters().selectedIndex)},onChangeSelectTipoCita:function(e){n.setProperty("/generalData/tipoCita",e.getParameters().selectedItem.getKey());this.getOwnerComponent().getModel("CitaMainData").setProperty("/TipoCita",e.getParameters().selectedItem.getKey());if(e.getParameters().selectedItem.getKey()==="01"||e.getParameters().selectedItem.getKey()==="02"){this.getView().byId("txtDP2").setVisible(true);this.getView().byId("DP2").setVisible(true)}else{this.getView().byId("txtDP2").setVisible(false);this.getView().byId("DP2").setVisible(false)}},onChangeSelectTipoUnidad:function(e){n.setProperty("/generalData/tipoUnidad",e.getParameters().selectedItem.getKey())},onSelectProductType:function(e){n.setProperty("/generalData/tipoProducto",e.getParameters().selectedItem.getKey())},selectChange:function(e){},onListItemPress:function(e){},appointmentDateChange(e){console.log("entro");let t=e.getSource();let a=t.getDateValue();this.setAppoimentCalendar(a,a);this.getOwnerComponent().getModel("CitaMainData").setProperty("/FechaCita",this.buildSapDate(a));let s=this.getView().byId("DP2");let i=new Date;i=a.getTime()-1e3*60*60*24*1;console.log(i);s.setDateValue(new Date(i));s.setMinDate(new Date(i));s.fireChange();this.getOwnerComponent().getModel("CitaMainData").setProperty("/FechaAud",new Date(i).toISOString().slice(0,10));console.log(this.getOwnerComponent().getModel("CitaMainData").getData())},setAppoimentCalendar(e,t){let a=this.getView().byId("appoinmentPC");e.setHours(8,0);a.setStartDate(e);a.setMinDate(e);a.setMaxDate(t);let s=new Date;s.setHours(10,0)},handleIntervalSelect:function(e){var t=e.getSource(),a=e.getParameter("startDate"),s=e.getParameter("endDate"),i=e.getParameter("row"),r=this.getOwnerComponent().getModel("Platforms"),o=r.getData(),n=-1;for(var l=0;l<o.length;l++){for(var d=0;d<o[l].appointments.length;d++){if(o[l].appointments[d].type==="Type08"){sap.m.MessageBox.warning("Favor Guarde la cita abierta");return}}}let g=a.getHours();a.setHours(g);g++;s.setHours(g);var u=new Date(new Date(a).toISOString().slice(0,10)+" "+o[0].DispIni);var p=new Date(new Date(s).toISOString().slice(0,10)+" "+o[0].DispFin);if(a.toLocaleString("en-GB")>u.toLocaleString("en-GB")&&s.toLocaleString("en-GB").trim()<p.toLocaleString("en-GB")){o[t.indexOfRow(i)].appointments.push({start:a,end:s,title:"Entrega "+a.toISOString().substr(0,10),type:"Type08"});r.setData(o)}else{sap.m.MessageBox.warning("El Horario Seleccionado esta fuera del rango Habilitado")}let c=this.getOwnerComponent().getModel("CitaCreationArray").getData();c.forEach(e=>{e.FechaCita=a.toISOString().substr(0,10);e.HoraIni=a.toTimeString().substr(0,8);e.HoraFin=s.toTimeString().substr(0,8);e.Anden=t.indexOfRow(i)});this.getOwnerComponent().getModel("CitaCreationArray").setData(c)},handleAppointmentSelect:function(e){var t=this;var a=e.getParameter("appointment"),i,r,o;if(a){i=a.getSelected()?"selected":"deselected";if(a.getType()==="Type08"){s.information("'"+a.getTitle()+"' "+i+". \n  Cita: "+this.byId("appoinmentPC").getSelectedAppointments().length,{actions:["Cancelar Cita",s.Action.CLOSE],emphasizedAction:"Cancelar Cita",onClose:function(e){var a=t.getView().getModel("Platforms").getData();for(var s=0;s<a.length;s++){a[s].appointments=[]}t.GetCitas()}})}else{s.show("'"+a.getTitle()+"' "+i+". \n  Cita: "+this.byId("appoinmentPC").getSelectedAppointments().length)}}else{r=e.getParameter("appointments");o=r.length+" Appointments selected";s.show(o)}a.setSelected(false)},selectPedido:async function(e){let t=e.getSource();let a=e.getParameter("rowContext").getModel().getData();let s=e.getParameter("rowContext").getObject();let i=e.getParameter("rowIndex");let r=t.getSelectedIndices();let o=r.some(e=>e==i);if(r.length==0){h=null}else if(h==null){h=s.Werks;this.fetchConfigCentro(h);this.byId("btnAppoimentNext").setVisible(true);this.byId("btnAppoimentNext").setEnabled(true);this.byId("inputCantidad").setEnabled(true)}else if(h!=s.Werks){sap.m.MessageBox.warning("Todos los pedidos deben pertencer al mismo centro");t.removeSelectionInterval(i,i);return}a.ETOC.results.forEach(e=>{if(this.getView().byId("sTipoCita").getSelectedKey()==="02"){if(e.Ebeln===s.Ebeln&&e.Ean11===s.Ean11&&e.ZwerksD===s.ZwerksD&&e.Abeln===s.Abeln&&e.Abelp===s.Abelp){e.Selected=true}else{}}else if(this.getView().byId("sTipoCita").getSelectedKey()==="01"){if(e.Ebeln===s.Ebeln&&e.ZWerks===s.ZWerks&&e.Ean11===s.Ean11&&e.ZAbeln===s.ZAbeln){e.Selected=true}else{}}else{if(e.Ebeln===s.Ebeln&&e.Ean11===s.Ean11){e.Selected=o}}});await new Promise(e=>setTimeout(e,100));if(o)this.addToCreationArray(s);else this.dropFromCreationArray(s);let n=this.getOwnerComponent().getModel("CitaCreationArray").getData();let l=this.findMaxDate(n,a);let d=this.byId("DP1").getDateValue();this.setAppoimentCalendar(d,l)},findMaxDate(e,t){let a=[];t.ETOC.results.forEach(t=>{if(e.some(e=>e.Ebeln==t.Ebeln&&e.Matnr==t.Matnr))a.push(t)});let s=new Date;a.forEach(e=>{let t=new Date(e.Kdate);if(s<t)s=t});return s},captureQuntSummon:function(e){let t=e.getSource();t.setValueState(sap.ui.core.ValueState.None);let a=t.data("matnr");let s=t.data("ebeln");let i=Number(t.data("menger"));let r=Number(e.getParameter("value"));if(i<r){t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText("Debe ser menor a la cantidad por agotar");C.push(t.getId());this.byId("btnAppoimentNext").setEnabled(C.length==0);return}else{let e=C.filter(e=>e!=t.getId());C=e}this.byId("btnAppoimentNext").setEnabled(C.length==0&&r>0);let o=this.getOwnerComponent().getModel("CitaCreationArray").getData();o.forEach(e=>{if(e.Matnr==a&&e.Ebeln==s)e.Citado=r});this.getOwnerComponent().getModel("CitaCreationArray").setData(o)},hasOnlyNumbers:function(){this.byId("btnAppoimentNext").setEnabled(true)},addToCreationArray(e){let t=this.getOwnerComponent().getModel("CitaCreationArray").getData();let a=this.getOwnerComponent().getModel("CitaMainData").getData();console.log(a);let s={Ebeln:e.Ebeln,Ebelp:e.Ebelp,Matnr:e.Matnr,TipoCita:a.TipoCita,FechaAud:a.FechaAud};t.push(s);this.getOwnerComponent().getModel("CitaCreationArray").setData(t)},dropFromCreationArray(e){let t=this.getOwnerComponent().getModel("CitaCreationArray").getData();let a=t.filter(t=>t.Matnr!=e.Matnr&&t.Ebeln!=e.Ebeln);this.getOwnerComponent().getModel("CitaCreationArray").setData(a)},clearModelsOnFilter(e){this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel([]),"CitaCreationArray");h=null},convertHora:function(e){var t=e;var a="";var s="";var i="";a=t.slice(2,4);s=t.slice(5,7);i=t.slice(8,10);return a+":"+s+":"+i},fetchConfigCentro(e){let t=[];t.push(this.buildFiltro("Action","3"));t.push(this.buildFiltro("Centro",e));sap.ui.core.BusyIndicator.show();let a=this;var s=g;var i=u;var r="ETCONFIG";var o=t;var n="";sap.ui.core.BusyIndicator.show();a._GEToDataV2(s,i,o,r,n).then(function(e){sap.ui.core.BusyIndicator.hide();var t=e.data.results[0].ETCONFIG.results;var s="";var i=[];for(var r=0;r<t.length;r++){t[r].DatoH01=a.convertHora(t[r].DatoH01);t[r].DatoH02=a.convertHora(t[r].DatoH02)}for(var r=0;r<t.length;r++){if(t[r].Func==="ANDENES"){s=Number(t[r].Dato1)}}var o=new Date;o=o.getTime()+1e3*60*60*24*2;o=new Date(o).toISOString().slice(0,10);for(var r=0;r<s-1;r++){var n=r;i.push({name:t[r].Dato1,role:t[r].Func,DispIni:t[r].DatoH01,DispFin:t[r].DatoH02,appointments:[]})}var l=new sap.ui.model.json.JSONModel(i);a.getOwnerComponent().setModel(l,"Platforms");a.GetCitas()})},buildFiltro(e,t){return new sap.ui.model.Filter({path:e,operator:sap.ui.model.FilterOperator.EQ,value1:`${t}`})},GetCitas:function(){let e=this;var t=this.getConfigModel().getProperty("/supplierInputKey");var a=this.getView().byId("quoteFolioIniInput").getValue();var s=this.getView().byId("quoteFolioFinInput").getValue();var i=this.getView().byId("quotedateRange");var r=this.buildSapDate(i.getDateValue());var o=this.buildSapDate(i.getSecondDateValue());let n=[];n.push(new sap.ui.model.Filter({path:"Action",operator:sap.ui.model.FilterOperator.EQ,value1:"1"}));n.push(new sap.ui.model.Filter({path:"Proveedor",operator:sap.ui.model.FilterOperator.EQ,value1:t}));if(a!=null&&a!=""&&s!=null&&s!=""){n.push(new sap.ui.model.Filter({path:"Folioini",operator:sap.ui.model.FilterOperator.EQ,value1:a}));n.push(new sap.ui.model.Filter({path:"Foliofin",operator:sap.ui.model.FilterOperator.EQ,value1:s}))}if(r!=null&&r!=""&&o!=null&&o!=""){n.push(new sap.ui.model.Filter({path:"Fechaini",operator:sap.ui.model.FilterOperator.EQ,value1:r}));n.push(new sap.ui.model.Filter({path:"Fechafin",operator:sap.ui.model.FilterOperator.EQ,value1:o}))}var l="ZOSP_CITAS_ADM_SRV";var d="MainSet";var g="CTCITASCAB";var u=n;var p="";var c=e.getView().getModel("Platforms").getData();sap.ui.core.BusyIndicator.show();e._GEToDataV2(l,d,u,g,p).then(function(t){sap.ui.core.BusyIndicator.hide();var a=t.data.results[0].CTCITASCAB.results;console.log(a);console.log(c);for(var s=0;s<a.length;s++){for(var i=0;i<c.length;i++){console.log(a[s].Anden);console.log(c[i].name);if(a[s].Anden===c[i].name){c[i].appointments.push({start:new Date(a[s].Fechacita+" "+a[s].HoraIni),end:new Date(a[s].Fechacita+" "+a[s].HoraFin),title:"Descarga  ",type:"Type02",pic:"",tentative:false})}}}console.log(c);var r=new sap.ui.model.json.JSONModel(c);e.getOwnerComponent().setModel(r,"Platforms")})},Modificar_Primera_Vista:function(){var e=this.getView().getModel();this._oWizard=this.byId("QuoteCedisWizard");var t=this;if(this._oWizard.getProgress()===1){t.getView().byId("sTipoCita").setEditable(true);t.getView().byId("totalpackagesInput").setEditable(true);t.getView().byId("platformsInput").setEditable(true);t.getView().byId("sTipoUnidad").setEditable(true);t.getView().byId("carrierInput").setEditable(true);t.getView().byId("DP1").setEditable(true)}if(this._oWizard.getProgress()===2){this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel({editable:true}),"Modeleditable");let e=this.byId("DP1").getDateValue();this.searchOrders2(this.buildSapDate(e))}this.handleButtonsVisibility()},searchOrders2:function(e){let t=[];let s=this;t.push(this.buildFiltro("IOption",s.getView().byId("sTipoCita").getSelectedKey()));t.push(s.buildFiltro("ILifnr",s.getConfigModel().getProperty("/supplierInputKey")));t.push(s.buildFiltro("IKdatb",e));var i=s.getView().getModel("ModelLectura").getData();var r=s.getView().getModel("Pedidos").getData();var o=s.getView().getModel("PosicionesG").getData();sap.ui.core.BusyIndicator.show();let n=[];s._GetODataV2(p,c,t,["ETOC"],"").then(e=>{s.getView().byId("tableWizardOrder").clearSelection();for(var t=0;t<e.data.results[0].ETOC.results.length;t++){e.data.results[0].ETOC.results[t].Selected=false}for(var i=0;i<r.ETOC.results.length;i++){e.data.results[0].ETOC.results.push(r.ETOC.results[i])}s.getOwnerComponent().setModel(new a(e.data.results[0]),"Pedidos");sap.ui.core.BusyIndicator.hide()}).catch(e=>{sap.ui.core.BusyIndicator.hide()})},CancelarCita:function(){sap.m.MessageBox["confirm"](this.getView().getModel("appTxts").getProperty("/quotes.cancel"),{actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:async function(e){if(e===sap.m.MessageBox.Action.YES){this._oWizard=this.getView().byId("QuoteCedisWizard");let e=this.getOwnerComponent().getModel("CitaCreationArray").getData();var t={Proveedor:this.getOwnerComponent().getModel("ModelLectura").getData().Proveedor,Action:"3",CTCITASCAB:[{Folio:this.getOwnerComponent().getModel("ModelLectura").getData().Folio,Centro:this.getOwnerComponent().getModel("ModelLectura").getData().Centro,Fechacita:this.getOwnerComponent().getModel("ModelLectura").getData().Fechacita,Proveedor:this.getOwnerComponent().getModel("ModelLectura").getData().Proveedor}],CTCITASDET:[],ETRETURN:[]};var s=g;var i="/"+u;var r=JSON.stringify(t);var o=this;o._POSToData(s,i,r).then(function(e){sap.ui.core.BusyIndicator.hide();var t=e.d;if(t.Success==="X"){sap.m.MessageBox.success("cita Cancelada correctamente")}else{sap.m.MessageBox.error(t.ETRETURN.results[0].Message)}o._oWizard.discardProgress(o._oWizard.getSteps()[0]);o.byId("wizardDialog").destroy();o._pDialog=null;o._oWizard=null;o.getView().setModel(new a,"ModelLectura");o.getView().setModel(new a,"tableWizardOrderPosition");o.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel,"CitaMainData");o.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel([]),"CitaCreationArray");h=null;o.searchData()})}}.bind(this)})},Busqueda:function(){let e="";if(this.getView().byId("FP").getSelected()){e="1"}if(this.getView().byId("PB").getSelected()){e="2"}if(this.getView().byId("RS").getSelected()){e="3"}if(!this.getView().byId("RS").getSelected()&&!this.getView().byId("RS").getSelected()&&!this.getView().byId("PB").getSelected()){e="7"}},inspeccion:function(e){let t=e.getSource();let a=t.getDateValue();this.getOwnerComponent().getModel("CitaMainData").setProperty("/FechaAud",new Date(a).toISOString().slice(0,10))},onUpload:function(e){this._import(e.getParameter("files")&&e.getParameter("files")[0])},_import:function(e){var t=this;var a={};if(e&&window.FileReader){var s=new FileReader;s.onload=function(e){var s=e.target.result;var i=XLSX.read(s,{type:"binary"});i.SheetNames.forEach(function(e){a=XLSX.utils.sheet_to_row_object_array(i.Sheets[e])});t.valida_excel(a)};s.onerror=function(e){};s.readAsBinaryString(e)}},valida_excel:function(e){var t=this.getView().getModel("Pedidos").getData().ETOC.results;var a=[];for(var s=0;s<t.length;s++){for(var i=0;i<e.length;i++){}}}})});