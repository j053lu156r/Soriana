sap.ui.define(["demo/controllers/BaseController","sap/ui/core/Fragment","sap/ui/model/json/JSONModel","sap/m/MessageBox","demo/models/formatter"],function(e,t,a,i,o){"use strict";var r=new this.Pedidostemp;var s=new this.Citas1;var n=null;var l={generalData:{cedisType:"",tipoCita:"",totalBultos:"",tarimas:"",tipoUnidad:"",tipoProducto:"",transportista:""},pedidos:[]};var d="ZOSP_CITAS_ADM_SRV";var g="MainSet";var u="ZOSP_DEVO_NC_SRV_01";var p="notCreditSet";var c=null;var h=[];return e.extend("demo.controllers.Quotes.wizards.WQuoteCreate",{formatter:o,setInitialDate(){let e=this.getView().byId("DP1");let t=new Date;t=t.getTime()+1e3*60*60*24*2;e.setDateValue(new Date(t));e.setMinDate(new Date(t));e.fireChange()},createQuote:function(e){if(!this.hasAccess(31)){return}if(this.getConfigModel().getProperty("/supplierInputKey")!=null){this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel,"CitaMainData");this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel([]),"CitaCreationArray");if(e==="N"){this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel({lectura:false}),"ModelLectura")}this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel({editable:true}),"Modeleditable");var a=this.getView();var i="demo.views.Quotes.wizards.WQuoteCreate";this.remissionType=e;let o=this;if(!this._pDialog){this._pDialog=t.load({id:a.getId(),name:i,controller:this}).then(function(e){e.attachAfterOpen(this.onDialogAfterOpen,this);a.addDependent(e);return e}.bind(this))}this._pDialog.then(function(t){t.open();var a=o.getView().getModel("ModelLectura").getData();console.log(a);if(e==="N"){o.getView().byId("ModCita").setVisible(false);o.getView().byId("cancCita").setVisible(false)}else{o.getView().byId("ModCita").setVisible(true);o.getView().byId("cancCita").setVisible(true)}if(!a.lectura){o.setInitialDate();o.getView().byId("sTipoCita").setSelectedKey("");o.getView().byId("sTipoUnidad").setSelectedKey("");o.getView().byId("sTipoCita").setEditable(true);o.getView().byId("totalpackagesInput").setEditable(true);o.getView().byId("platformsInput").setEditable(true);o.getView().byId("sTipoUnidad").setEditable(true);o.getView().byId("carrierInput").setEditable(true);o.getView().byId("DP1").setEditable(true);o.getView().byId("totalpackagesInput").setEditable(true);o.getView().byId("platformsInput").setEditable(true);o.getView().byId("carrierInput").setEditable(true)}else{o.getView().byId("sTipoCita").setSelectedKey(a.Tipocita);o.getView().byId("sTipoUnidad").setSelectedKey(a.Tipounidad);o.getView().byId("DP1").setDateValue(new Date(a.Fechacita));o.getView().byId("totalpackagesInput").setValue(a.Bultos);o.getView().byId("platformsInput").setValue(a.Tarimas);o.getView().byId("carrierInput").setValue(a.Transportista);o.getView().byId("sTipoCita").setEditable(false);o.getView().byId("totalpackagesInput").setEditable(false);o.getView().byId("platformsInput").setEditable(false);o.getView().byId("sTipoUnidad").setEditable(false);o.getView().byId("carrierInput").setEditable(false);o.getView().byId("DP1").setEditable(false);o.getView().byId("totalpackagesInput").setEditable(false);o.getView().byId("platformsInput").setEditable(false);o.getView().byId("carrierInput").setEditable(false)}})}else{sap.m.MessageBox.error(this.getView().getModel("appTxts").getProperty("/quotes.messageNoSupplier"))}},onDialogAfterOpen:function(){this._oWizard=this.byId("QuoteCedisWizard");this._oWizard._getProgressNavigator().ontap=function(){};this.handleButtonsVisibility();n=new a(l);this.getView().setModel(n,"TemporalModel");n.setProperty("/generalData/tipoCita",this.getView().byId("sTipoCita").getSelectedKey());n.setProperty("/generalData/tipoUnidad",this.getView().byId("sTipoUnidad").getSelectedKey())},handleButtonsVisibility:function(){var e=this.getView().getModel();var t=e.getProperty("/selectedPayment");switch(this._oWizard.getProgress()){case 1:e.setProperty("/nextButtonVisible",true);e.setProperty("/backButtonVisible",true);e.setProperty("/finishButtonVisible",false);break;case 2:e.setProperty("/nextButtonVisible",false);e.setProperty("/backButtonVisible",true);e.setProperty("/finishButtonVisible",false);break;case 3:e.setProperty("/nextButtonVisible",false);e.setProperty("/backButtonVisible",true);e.setProperty("/finishButtonVisible",true);break;default:break}},onDialogNextButton:function(){this.getView().getModel("TemporalModel").getData().generalData.totalBultos=this.getView().byId("totalpackagesInput").getValue();this.getView().getModel("TemporalModel").getData().generalData.tarimas=this.getView().byId("platformsInput").getValue();this.getView().getModel("TemporalModel").getData().generalData.transportista=this.getView().byId("carrierInput").getValue();if(this._oWizard.getProgressStep().getValidated()){if(this._oWizard.getProgressStep().sButtonText==="Paso 2"){let e=this.byId("DP1").getDateValue();this.searchOrders(this.buildSapDate(e))}this._oWizard.nextStep()}this.handleButtonsVisibility()},onDialogBackButton:function(){this._oWizard.previousStep();this.handleButtonsVisibility()},onCloseWizard:function(){var e=this.getView().getModel("ModelLectura").getData();if(e.lectura){this._handleMessageBoxOpen(this.getView().getModel("appTxts").getProperty("/quotes.closeButton"),"warning")}else{this._handleMessageBoxOpen(this.getView().getModel("appTxts").getProperty("/quotes.discardButton"),"warning")}},testModelos:function(){},async handleWizardSubmit(){sap.m.MessageBox["confirm"](this.getView().getModel("appTxts").getProperty("/quotes.submitAppoinment"),{actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:async function(e){if(e===sap.m.MessageBox.Action.YES){this._oWizard.discardProgress(this._oWizard.getSteps()[0]);this.byId("wizardDialog").destroy();this._pDialog=null;this._oWizard=null;let e=this.getOwnerComponent().getModel("CitaCreationArray").getData();var t=this.getView().getModel("configSite").getData();var a=this.getView().getModel("TemporalModel").getData();if(this.getOwnerComponent().getModel("ModelLectura").getData().lectura===true){var i=[];for(var o=0;o<this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results.length;o++){if(this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].Selected){i.push({Folio:this.getOwnerComponent().getModel("ModelLectura").getData().Folio,Ebeln:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].Ebeln,Ebelp:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].Ebelp,Matnr:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].Matnr,Cantidad:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].Citado,Fechaini:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].Kdatb,Fechafin:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].Kdate,Umedida:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].Meins,Citado:this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results[o].Citado})}}var r={Proveedor:this.getOwnerComponent().getModel("ModelLectura").getData().Proveedor,Action:"2",CTCITASCAB:[{Folio:this.getOwnerComponent().getModel("ModelLectura").getData().Folio,Centro:this.getOwnerComponent().getModel("ModelLectura").getData().Centro,Fechacita:e[0].FechaCita,Proveedor:this.getOwnerComponent().getModel("ModelLectura").getData().Proveedor,Tipocita:a.generalData.Tipocita,Tipounidad:a.generalData.tipoUnidad,Transportista:a.generalData.transportista,Bultos:a.generalData.totalBultos,Tarimas:a.generalData.tarimas,HoraIni:e[0].HoraIni,HoraFin:e[0].HoraFin,Anden:(Number(e[0].Anden)+1).toString()}],CTCITASDET:i,ETRETURN:[]};var s=d;var n="/"+g;var l=JSON.stringify(r);var u=this;u._POSToData(s,n,l).then(function(e){sap.ui.core.BusyIndicator.hide();var t=e.d;if(t.Success==="X"){sap.m.MessageBox.success(t.Message)}else{sap.m.MessageBox.error(t.Message)}})}else{var p=[];for(var o=0;o<this.getOwnerComponent().getModel("Pedidos").getData().ETOC.results.length;o++){p.push({Ebeln:e[o].Ebeln,Ebelp:e[o].Ebelp,Matnr:e[o].Matnr,Citado:e[o].Citado.toLocaleString(),FechaCita:e[o].FechaCita,HoraIni:e[o].HoraIni,HoraFin:e[o].HoraFin,Anden:Number(e[o].Anden)+1,TipoCita:a.generalData.tipoCita,Lifnr:t.supplierInputKey,Bultos:a.generalData.totalBultos,Tarimas:a.generalData.tarimas,TipoUnidad:a.generalData.tipoUnidad,Transportista:a.generalData.transportista})}let i={Proveedor:t.supplierInputKey.padStart(10,0),Action:"1",ETCITANUEVA:p,ETRETURN:[]};sap.ui.core.BusyIndicator.show();let r=null;var s=d;var n="/"+g;var l=JSON.stringify(i);var u=this}this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel([]),"ModelLectura");this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel([]),"Modeleditable")}}.bind(this)})},_POSToData:function(e,t,a){var i="/sap/opu/odata/sap/"+e;var o=this;return new Promise(function(e,o){$.ajax({url:i+t,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:a,headers:{"X-Requested-With":"X"},success:function(t){e(t)},error:function(e,t,a){sap.ui.core.BusyIndicator.hide();o(new Error(e))}})})},getToken:function(e){var t=null;$.ajax({type:"GET",url:"/sap/opu/odata/sap/model/ZOSP_CITAS_ADM_SRV/MainSet$filter=Fechaini eq '20221101' and Fechafin eq '20221130'",headers:{"X-CSRF-Token":"Fetch"},contentType:"application/json; charset=utf-8",dataType:"json",async:false,success:function(e,a,i){t=i.getResponseHeader("X-CSRF-Token")},error:function(e,a,i){t=e.getResponseHeader("X-CSRF-Token")}});return t},_handleMessageBoxOpen:function(e,t){sap.m.MessageBox[t](e,{actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(e){if(e===sap.m.MessageBox.Action.YES){this._oWizard.discardProgress(this._oWizard.getSteps()[0]);this.byId("wizardDialog").destroy();this._pDialog=null;this._oWizard=null;this.getView().setModel(new a,"ModelLectura");this.getView().setModel(new a,"tableWizardOrderPosition");this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel,"CitaMainData");this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel([]),"CitaCreationArray");c=null}}.bind(this)})},searchOrders:function(e){let t=[];let i=this;t.push(this.buildFiltro("IOption",7));t.push(i.buildFiltro("ILifnr",i.getConfigModel().getProperty("/supplierInputKey")));t.push(i.buildFiltro("IKdatb",e));var o=i.getView().getModel("ModelLectura").getData();var r=i.getView().getModel("PosicionesG").getData();sap.ui.core.BusyIndicator.show();let s=[];i._GetODataV2(u,p,t,["ETOC"],"").then(e=>{if(o.lectura){this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel({editable:false}),"Modeleditable");for(var t=0;t<e.data.results[0].ETOC.results.length;t++){e.data.results[0].ETOC.results[t].Selected=true;for(var n=0;n<r.length;n++){if(e.data.results[0].ETOC.results[t].Matnr===r[n].Matnr&&e.data.results[0].ETOC.results[t].Werks===r[n].Werks){e.data.results[0].ETOC.results[t].Citado=r[n].Citado;s.push(e.data.results[0].ETOC.results[t])}}}e.data.results[0].ETOC.results=s}else{for(var t=0;t<e.data.results[0].ETOC.results.length;t++){e.data.results[0].ETOC.results[t].Selected=false}}i.getOwnerComponent().setModel(new a(e.data.results[0]),"Pedidos");sap.ui.core.BusyIndicator.hide()}).catch(e=>{})},getDetailOrder:function(){var e=this;var t=`/Valida_citasSet?$expand=Po_validas&$filter=IOption eq '1' and IEbeln eq '${this._document}'`;this.getView().setModel(new a,"tableWizardPo_validas");s.getJsonModelAsync(t,function(t){var a=t.getProperty("/results/0");if(a.ESuccess=="X"){var i=e.getView().getModel("tableWizardPo_validas");i.setProperty("/Oekponav",a.Po_validas)}else{sap.m.MessageBox.error(a.EMessage)}},function(){sap.m.MessageBox.error("")},this)},onSelectRBOption:function(e){n.setProperty("/generalData/cedisType",e.getParameters().selectedIndex)},onChangeSelectTipoCita:function(e){n.setProperty("/generalData/tipoCita",e.getParameters().selectedItem.getKey());this.getOwnerComponent().getModel("CitaMainData").setProperty("/TipoCita",e.getParameters().selectedItem.getKey())},onChangeSelectTipoUnidad:function(e){n.setProperty("/generalData/tipoUnidad",e.getParameters().selectedItem.getKey())},onSelectProductType:function(e){n.setProperty("/generalData/tipoProducto",e.getParameters().selectedItem.getKey())},selectChange:function(e){},appointmentDateChange(e){let t=e.getSource();let a=t.getDateValue();this.setAppoimentCalendar(a,a);this.getOwnerComponent().getModel("CitaMainData").setProperty("/FechaCita",this.buildSapDate(a))},setAppoimentCalendar(e,t){let a=this.getView().byId("appoinmentPC");e.setHours(8,0);a.setStartDate(e);a.setMinDate(e);a.setMaxDate(t);let i=new Date;i.setHours(10,0)},handleIntervalSelect:function(e){var t=e.getSource(),a=e.getParameter("startDate"),i=e.getParameter("endDate"),o=e.getParameter("row"),r=this.getOwnerComponent().getModel("Platforms"),s=r.getData(),n=-1;for(var l=0;l<s.length;l++){for(var d=0;d<s[l].appointments.length;d++){if(s[l].appointments[d].type==="Type08"){sap.m.MessageBox.warning("Favor Guarde la cita abierta");return}}}let g=a.getHours();a.setHours(g);g++;i.setHours(g);var u=new Date(new Date(a).toISOString().slice(0,10)+" "+s[0].DispIni);var p=new Date(new Date(i).toISOString().slice(0,10)+" "+s[0].DispFin);if(a.toLocaleString("en-GB")>u.toLocaleString("en-GB")&&i.toLocaleString("en-GB").trim()<p.toLocaleString("en-GB")){s[t.indexOfRow(o)].appointments.push({start:a,end:i,title:"Entrega "+a.toISOString().substr(0,10),type:"Type08"});r.setData(s)}else{sap.m.MessageBox.warning("El Horario Seleccionado esta fuera del rango Habilitado")}let c=this.getOwnerComponent().getModel("CitaCreationArray").getData();c.forEach(e=>{e.FechaCita=a.toISOString().substr(0,10);e.HoraIni=a.toTimeString().substr(0,8);e.HoraFin=i.toTimeString().substr(0,8);e.Anden=t.indexOfRow(o)});this.getOwnerComponent().getModel("CitaCreationArray").setData(c)},handleAppointmentSelect:function(e){var t=e.getParameter("appointment"),a,o,r;if(t){a=t.getSelected()?"selected":"deselected";i.show("'"+t.getTitle()+"' "+a+". \n  Cita: "+this.byId("appoinmentPC").getSelectedAppointments().length)}else{o=e.getParameter("appointments");r=o.length+" Appointments selected";i.show(r)}t.setSelected(false)},selectPedido:async function(e){let t=e.getSource();let a=e.getParameter("rowContext").getModel().getData();let i=e.getParameter("rowContext").getObject();let o=e.getParameter("rowIndex");let r=t.getSelectedIndices();let s=r.some(e=>e==o);if(r.length==0){c=null}else if(c==null){c=i.Werks;this.fetchConfigCentro(c);this.byId("btnAppoimentNext").setVisible(true);this.byId("btnAppoimentNext").setEnabled(true);this.byId("inputCantidad").setEnabled(true)}else if(c!=i.Werks){sap.m.MessageBox.warning("Todos los pedidos deben pertencer al mismo centro");t.removeSelectionInterval(o,o);return}a.ETOC.results.forEach(e=>{if(e.Ebeln==i.Ebeln&&e.Ean11==i.Ean11)e.Selected=s});t.setFirstVisibleRow(o+2);await new Promise(e=>setTimeout(e,100));t.setFirstVisibleRow(s?o:0);if(s)this.addToCreationArray(i);else this.dropFromCreationArray(i);let n=this.getOwnerComponent().getModel("CitaCreationArray").getData();let l=this.findMaxDate(n,a);let d=this.byId("DP1").getDateValue();this.setAppoimentCalendar(d,l)},findMaxDate(e,t){let a=[];t.ETOC.results.forEach(t=>{if(e.some(e=>e.Ebeln==t.Ebeln&&e.Matnr==t.Matnr))a.push(t)});let i=new Date;a.forEach(e=>{let t=new Date(e.Kdate);if(i<t)i=t});return i},captureQuntSummon:function(e){let t=e.getSource();t.setValueState(sap.ui.core.ValueState.None);let a=t.data("matnr");let i=t.data("ebeln");let o=Number(t.data("menger"));let r=Number(e.getParameter("value"));if(o<r){t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText("Debe ser menor a la cantidad por agotar");h.push(t.getId());this.byId("btnAppoimentNext").setEnabled(h.length==0);return}else{let e=h.filter(e=>e!=t.getId());h=e}this.byId("btnAppoimentNext").setEnabled(h.length==0&&r>0);let s=this.getOwnerComponent().getModel("CitaCreationArray").getData();s.forEach(e=>{if(e.Matnr==a&&e.Ebeln==i)e.Citado=r});this.getOwnerComponent().getModel("CitaCreationArray").setData(s)},hasOnlyNumbers:function(){this.byId("btnAppoimentNext").setEnabled(true)},addToCreationArray(e){let t=this.getOwnerComponent().getModel("CitaCreationArray").getData();let a=this.getOwnerComponent().getModel("CitaMainData").getData();let i={Ebeln:e.Ebeln,Ebelp:e.Ebelp,Matnr:e.Matnr,TipoCita:a.TipoCita};t.push(i);this.getOwnerComponent().getModel("CitaCreationArray").setData(t)},dropFromCreationArray(e){let t=this.getOwnerComponent().getModel("CitaCreationArray").getData();let a=t.filter(t=>t.Matnr!=e.Matnr&&t.Ebeln!=e.Ebeln);this.getOwnerComponent().getModel("CitaCreationArray").setData(a)},clearModelsOnFilter(e){this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel([]),"CitaCreationArray");c=null},convertHora:function(e){var t=e;var a="";var i="";var o="";a=t.slice(2,4);i=t.slice(5,7);o=t.slice(8,10);return a+":"+i+":"+o},fetchConfigCentro(e){let t=[];t.push(this.buildFiltro("Action","3"));t.push(this.buildFiltro("Centro",e));sap.ui.core.BusyIndicator.show();let a=this;var i=d;var o=g;var r="ETCONFIG";var s=t;var n="";sap.ui.core.BusyIndicator.show();a._GEToDataV2(i,o,s,r,n).then(function(e){sap.ui.core.BusyIndicator.hide();var t=e.data.results[0].ETCONFIG.results;var i="";var o=[];for(var r=0;r<t.length;r++){t[r].DatoH01=a.convertHora(t[r].DatoH01);t[r].DatoH02=a.convertHora(t[r].DatoH02)}for(var r=0;r<t.length;r++){if(t[r].Func==="ANDENES"){i=Number(t[r].Dato1)}}var s=new Date;s=s.getTime()+1e3*60*60*24*2;s=new Date(s).toISOString().slice(0,10);for(var r=0;r<i-1;r++){var n=r;o.push({name:t[r].Func+"-"+Number(n+1),role:t[r].Func,DispIni:t[r].DatoH01,DispFin:t[r].DatoH02,appointments:[]})}var l=new sap.ui.model.json.JSONModel(o);a.getOwnerComponent().setModel(l,"Platforms");a.GetCitas()})},buildFiltro(e,t){return new sap.ui.model.Filter({path:e,operator:sap.ui.model.FilterOperator.EQ,value1:`${t}`})},GetCitas:function(){let e=this;var t=this.getConfigModel().getProperty("/supplierInputKey");var a=this.getView().byId("quoteFolioIniInput").getValue();var i=this.getView().byId("quoteFolioFinInput").getValue();var o=this.getView().byId("quotedateRange");var r=this.buildSapDate(o.getDateValue());var s=this.buildSapDate(o.getSecondDateValue());let n=[];n.push(new sap.ui.model.Filter({path:"Action",operator:sap.ui.model.FilterOperator.EQ,value1:"1"}));n.push(new sap.ui.model.Filter({path:"Proveedor",operator:sap.ui.model.FilterOperator.EQ,value1:t}));if(a!=null&&a!=""&&i!=null&&i!=""){n.push(new sap.ui.model.Filter({path:"Folioini",operator:sap.ui.model.FilterOperator.EQ,value1:a}));n.push(new sap.ui.model.Filter({path:"Foliofin",operator:sap.ui.model.FilterOperator.EQ,value1:i}))}if(r!=null&&r!=""&&s!=null&&s!=""){n.push(new sap.ui.model.Filter({path:"Fechaini",operator:sap.ui.model.FilterOperator.EQ,value1:r}));n.push(new sap.ui.model.Filter({path:"Fechafin",operator:sap.ui.model.FilterOperator.EQ,value1:s}))}var l="ZOSP_CITAS_ADM_SRV";var d="MainSet";var g="CTCITASCAB";var u=n;var p="";var c=e.getView().getModel("Platforms").getData();sap.ui.core.BusyIndicator.show();e._GEToDataV2(l,d,u,g,p).then(function(t){sap.ui.core.BusyIndicator.hide();var a=t.data.results[0].CTCITASCAB.results;for(var i=0;i<a.length;i++){for(var o=0;o<c.length;o++){if(Number(a[i].Anden)===Number(c[o].name.split("-")[1].trim())){c[o].appointments.push({start:new Date(a[i].Fechacita+" "+a[i].HoraIni),end:new Date(a[i].Fechacita+" "+a[i].HoraFin),title:"Descarga  ",type:"Type02",pic:"",tentative:false})}}}var r=new sap.ui.model.json.JSONModel(c);e.getOwnerComponent().setModel(r,"Platforms")})},Modificar_Primera_Vista:function(){var e=this.getView().getModel();this._oWizard=this.byId("QuoteCedisWizard");var t=this;if(this._oWizard.getProgress()===1){t.getView().byId("sTipoCita").setEditable(true);t.getView().byId("totalpackagesInput").setEditable(true);t.getView().byId("platformsInput").setEditable(true);t.getView().byId("sTipoUnidad").setEditable(true);t.getView().byId("carrierInput").setEditable(true);t.getView().byId("DP1").setEditable(true)}if(this._oWizard.getProgress()===2){this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel({editable:true}),"Modeleditable");let e=this.byId("DP1").getDateValue();this.searchOrders2(this.buildSapDate(e))}this.handleButtonsVisibility()},searchOrders2:function(e){let t=[];let i=this;t.push(this.buildFiltro("IOption",7));t.push(i.buildFiltro("ILifnr",i.getConfigModel().getProperty("/supplierInputKey")));t.push(i.buildFiltro("IKdatb",e));var o=i.getView().getModel("ModelLectura").getData();var r=i.getView().getModel("Pedidos").getData();var s=i.getView().getModel("PosicionesG").getData();sap.ui.core.BusyIndicator.show();let n=[];i._GetODataV2(u,p,t,["ETOC"],"").then(e=>{for(var t=0;t<e.data.results[0].ETOC.results.length;t++){e.data.results[0].ETOC.results[t].Selected=false}for(var o=0;o<r.ETOC.results.length;o++){e.data.results[0].ETOC.results.push(r.ETOC.results[o])}i.getOwnerComponent().setModel(new a(e.data.results[0]),"Pedidos");sap.ui.core.BusyIndicator.hide()}).catch(e=>{})},CancelarCita:function(){this._oWizard=this.getView().byId("QuoteCedisWizard");let e=this.getOwnerComponent().getModel("CitaCreationArray").getData();var t={Proveedor:this.getOwnerComponent().getModel("ModelLectura").getData().Proveedor,Action:"3",CTCITASCAB:[{Folio:this.getOwnerComponent().getModel("ModelLectura").getData().Folio,Centro:this.getOwnerComponent().getModel("ModelLectura").getData().Centro,Fechacita:this.getOwnerComponent().getModel("ModelLectura").getData().Fechacita,Proveedor:this.getOwnerComponent().getModel("ModelLectura").getData().Proveedor}],CTCITASDET:[],ETRETURN:[]};var i=d;var o="/"+g;var r=JSON.stringify(t);var s=this;s._POSToData(i,o,r).then(function(e){sap.ui.core.BusyIndicator.hide();var t=e.d;if(t.Success==="X"){sap.m.MessageBox.success("cita Cancelada correctamente")}else{sap.m.MessageBox.error(t.ETRETURN.results[0].Message)}s._oWizard.discardProgress(s._oWizard.getSteps()[0]);s.byId("wizardDialog").destroy();s._pDialog=null;s._oWizard=null;s.getView().setModel(new a,"ModelLectura");s.getView().setModel(new a,"tableWizardOrderPosition");s.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel,"CitaMainData");s.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel([]),"CitaCreationArray");c=null;s.searchData()})}})});