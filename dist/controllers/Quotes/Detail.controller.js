sap.ui.define(["sap/ui/model/json/JSONModel","demo/controllers/BaseController","sap/ui/core/mvc/Controller","sap/ui/core/Fragment"],function(e,t,o){"use strict";var a=new this.Citas1;var s=new this.Citas2;return t.extend("demo.controllers.Quotes.Detail",{onInit:function(){var e=this.getView().byId("exitFullScreenBtn"),t=this.getView().byId("enterFullScreenBtn");this.oRouter=this.getOwnerComponent().getRouter();this.oModel=this.getOwnerComponent().getModel();this.oRouter.getRoute("detailQuotes").attachPatternMatched(this._onDocumentMatched,this);[e,t].forEach(function(e){e.addEventDelegate({onAfterRendering:function(){if(this.bFocusFullScreenButton){this.bFocusFullScreenButton=false;e.focus()}}.bind(this)})},this)},handleItemPress:function(e){var t=this.getOwnerComponent().getHelper().getNextUIState(2),o=e.getSource().getBindingContext("tableQuotesDetail").getPath(),a=o.split("/").slice(-1).pop(),s=this.getView();var r=this.getOwnerComponent().getModel("tableQuotesDetail");var i=r.getProperty("/ECITASDETNAV/Paginated/results");var n=i[a].ZPedido;var l=r.getProperty("/ECITASARTPEDNAV/results");var u={ECITASARTPEDNAV:{results:l.filter(e=>e.ZNumpedido==n)}};if(!this._posDetailsDialog){this._posDetailsDialog=sap.ui.xmlfragment("posDetQuoteFragment","demo.views.Quotes.PosDetail",this);this.getView().addDependent(this._posDetailsDialog)}this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(u),"tableQuotesDetailPositions");this.paginate("tableQuotesDetailPositions","/ECITASARTPEDNAV",1,0);this._posDetailsDialog.open()},handleFullScreen:function(){this.bFocusFullScreenButton=true;var e=this.oModel.getProperty("/actionButtonsInfo/midColumn/fullScreen");this.oRouter.navTo("detailQuotes",{layout:e,document:this._document})},handleExitFullScreen:function(){this.bFocusFullScreenButton=true;var e=this.oModel.getProperty("/actionButtonsInfo/midColumn/exitFullScreen");this.oRouter.navTo("detailQuotes",{layout:e,document:this._document})},handleClose:function(){var e=this.oModel.getProperty("/actionButtonsInfo/midColumn/closeColumn");this.oRouter.navTo("masterQuotes",{layout:e})},_onDocumentMatched:function(t){this._document=t.getParameter("arguments").document||this._document||"0";this._lifnr=this.getConfigModel().getProperty("/supplierInputKey");var o=`/HeaderCITASSet?$expand=ECITASCONSNAV,ECITASDETNAV,ECITASARTPEDNAV&$filter= IOption eq '2'`;o+=` and IZproveedor eq '${this._lifnr}' `;if(this._document!=null&&this._document!=""){o+=` and IZfolioCita eq '${this._document}'`}var a=s.getJsonModel(o);var r=a.getProperty("/results/0");this.getOwnerComponent().setModel(new e(r),"tableQuotesDetail");this.paginate("tableQuotesDetail","/ECITASDETNAV",1,0)},buildExcelPositions:function(){var e=this.getOwnerComponent().getModel("appTxts");var t=[{name:e.getProperty("/quotes.order"),template:{content:"{ZNumpedido}"}},{name:e.getProperty("/quotes.position"),template:{content:"{ZPosicion}"}},{name:e.getProperty("/quotes.branch"),template:{content:"{ZSucursal}"}},{name:e.getProperty("/quotes.branch"),template:{content:"{ZDescrsucursal}"}},,{name:e.getProperty("/quotes.codebar"),template:{content:"{Zean11}"}},{name:e.getProperty("/quotes.description"),template:{content:"{ZDescrarticulo}"}},{name:e.getProperty("/quotes.palletBox"),template:{content:"{ZCtdartarima1}"}},{name:e.getProperty("/quotes.quantity"),template:{content:"{ZCtdtarrec}"}}];this.exportxls("tableQuotesDetailPositions","/ECITASARTPEDNAV/results",t)},buildExcelOrders:function(){var e=this.getOwnerComponent().getModel("appTxts");let t=this.getOwnerComponent().getModel("tableQuotesDetail");var o=[{name:e.getProperty("/quotes.quoteFolio"),template:{content:t.getProperty("/ECITASCONSNAV/results/0/ZfolioCita")}},{name:e.getProperty("/quotes.branch"),template:{content:t.getProperty("/ECITASCONSNAV/results/0/Zsucursal")}},{name:e.getProperty("/quotes.branch"),template:{content:t.getProperty("/ECITASCONSNAV/results/0/Zdescrsucursal")}},{name:e.getProperty("/quotes.platform"),template:{content:t.getProperty("/ECITASCONSNAV/results/0/Zanden")}},{name:e.getProperty("/quotes.turn"),template:{content:t.getProperty("/ECITASCONSNAV/results/0/Zturno")}},{name:e.getProperty("/quotes.turn"),template:{content:t.getProperty("/ECITASCONSNAV/results/0/ZTipoturno")}},{name:e.getProperty("/quotes.status"),template:{content:t.getProperty("/ECITASCONSNAV/results/0/Zstatus")}},{name:e.getProperty("/quotes.quoteType"),template:{content:t.getProperty("/ECITASCONSNAV/results/0/ZtipoCita")}},{name:e.getProperty("/quotes.productType"),template:{content:t.getProperty("/ECITASCONSNAV/results/0/ZtipoProd")}},{name:e.getProperty("/quotes.unitType"),template:{content:t.getProperty("/ECITASCONSNAV/results/0/ZtipoUnidad")}},{name:e.getProperty("/quotes.assortmentType"),template:{content:t.getProperty("/ECITASCONSNAV/results/0/ZtipoSurtido")}},{name:e.getProperty("/quotes.codesNum"),template:{content:t.getProperty("/ECITASCONSNAV/results/0/ZnumCodigos")}},{name:e.getProperty("/quotes.totalpackages"),template:{content:t.getProperty("/ECITASCONSNAV/results/0/ZtotalBultoped")}},{name:e.getProperty("/quotes.shipmentEndDate"),template:{content:t.getProperty("/ECITASCONSNAV/results/0/Zfechafinemb")}},{name:e.getProperty("/quotes.packagesReceived"),template:{content:t.getProperty("/ECITASCONSNAV/results/0/ZtotalBultorec")}},{name:e.getProperty("/quotes.weight"),template:{content:t.getProperty("/ECITASCONSNAV/results/0/Zpeso")}},{name:e.getProperty("/quotes.quoteDate"),template:{content:t.getProperty("/ECITASCONSNAV/results/0/Zfecharegcita")}},{name:e.getProperty("/quotes.dateReceipt"),template:{content:t.getProperty("/ECITASCONSNAV/results/0/ZfechaRecibo")}},{name:e.getProperty("/quotes.boardingStartDate"),template:{content:t.getProperty("/ECITASCONSNAV/results/0/Zfechainiemb")}},{name:e.getProperty("/quotes.order"),template:{content:"{ZPedido}"}},{name:e.getProperty("/quotes.branch"),template:{content:"{ZSucursal}"}},{name:e.getProperty("/quotes.branch"),template:{content:"{Zdescrsucursal}"}},,{name:e.getProperty("/quotes.totalPackageOrdered"),template:{content:"{ZTotalbultoped}"}},{name:e.getProperty("/quotes.totalPackageReceive"),template:{content:"{ZTotalbultorec}"}}];this.exportxls("tableQuotesDetail","/ECITASDETNAV/results",o)},selectedParamQuote:function(e){var t=e.getParameter("selectedItem").getProperty("key");var o=sap.ui.core.Fragment.byId("editValuesQuote","paramQuoteValue");switch(t){case"1":o.setValue(this.getOwnerComponent().getModel("tableQuotesDetail").getProperty("/ECITASCONSNAV/results/0/ZfechaRecibo"));break;case"2":o.setValue(this.getOwnerComponent().getModel("tableQuotesDetail").getProperty("/ECITASCONSNAV/results/0/Zfechainiemb"));break;case"3":o.setValue(this.getOwnerComponent().getModel("tableQuotesDetail").getProperty("/ECITASCONSNAV/results/0/Zfechafinemb"));break;case"4":sap.ui.core.Fragment.byId("editValuesQuote","inputQuoteValue").setValue(this.getOwnerComponent().getModel("tableQuotesDetail").getProperty("/ECITASCONSNAV/results/0/Zanden"));break}if(t==4){sap.ui.core.Fragment.byId("editValuesQuote","paramQuoteValue").setVisible(false);sap.ui.core.Fragment.byId("editValuesQuote","inputQuoteValue").setVisible(true);sap.ui.core.Fragment.byId("editValuesQuote","paramQuoteValue").setValue("")}else{sap.ui.core.Fragment.byId("editValuesQuote","paramQuoteValue").setVisible(true);sap.ui.core.Fragment.byId("editValuesQuote","inputQuoteValue").setVisible(false);sap.ui.core.Fragment.byId("editValuesQuote","inputQuoteValue").setValue("")}},handleEditBtn:function(){if(!this.hasAccess(47)){return false}if(!this._EditQuoteDialog){this._EditQuoteDialog=sap.ui.xmlfragment("editValuesQuote","demo.views.Quotes.EditDates",this);this.getView().addDependent(this._EditQuoteDialog)}this._EditQuoteDialog.setModel(new e);this._EditQuoteDialog.setEscapeHandler(e=>{this.handleCloseEdit()},this);sap.ui.core.Fragment.byId("editValuesQuote","paramQuoteValue").setValue(this.getOwnerComponent().getModel("tableQuotesDetail").getProperty("/ECITASCONSNAV/results/0/ZfechaRecibo"));this._EditQuoteDialog.open()},hancleCandel:function(e,t){var o="";switch(t){case 2:o=this.getView().getModel("appTxts").getProperty("/quotes.cancelQuote");if(!this.hasAccess(34)){return false}break;case 3:o=this.getView().getModel("appTxts").getProperty("/quotes.rejectQuote");if(!this.hasAccess(33)){return false}break}sap.m.MessageBox["confirm"](o,{actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(t){if(t===sap.m.MessageBox.Action.YES){this.cancelQuote(e,iOption)}}.bind(this)})},cancelQuote:function(e,t){var o=`/Valida_citasSet?$expand=Po_validas&$filter=IOption eq '${t}' and ICita eq '${e}'`;this.callMethods(o)},editValues:function(e){var t=sap.ui.core.Fragment.byId("editValuesQuote","paramQuoteId").getSelectedKey();var o="";if(t==4){o=sap.ui.core.Fragment.byId("editValuesQuote","inputQuoteValue").getValue()}else{o=sap.ui.core.Fragment.byId("editValuesQuote","paramQuoteValue").getValue()}var a=`/Valida_citasSet?$expand=Po_validas&$filter=IOption eq '4' and ICita eq '${e}'`+` and IParametro eq '${t}'`+` and IValor eq '${o}'`;this.callMethods(a)},callMethods:function(e){var t=a.getJsonModel(e);if(t!=null){var o=t.getProperty("/results/0");if(o!=null){if(o.ESuccess=="X"){sap.m.MessageBox.success(o.EMessage);this.handleClose();this.handleCloseEdit()}else{sap.m.MessageBox.error(o.EMessage)}}}},groupByAuto:function(e,t){var o={};for(var a in e){if(!o.hasOwnProperty(e[a][t]))o[e[a][t]]=[];o[e[a][t]].push(e[a])}return o},onCloseDialogPosDetails:function(){if(this._posDetailsDialog){this._posDetailsDialog.destroy();this._posDetailsDialog=null}},printQuoteCard:function(){if(!this._CardDialog){this._CardDialog=sap.ui.xmlfragment("printBoxesLabels","demo.views.Quotes.AppointmentCard",this);this.getView().addDependent(this._CardDialog)}var t=this.getView().getModel("appTxts");var o=this.getView().getModel("tableQuotesDetail");var a=o.getProperty("/ECITASCONSNAV/results/0/ZfolioCita");var s=`${o.getProperty("/ECITASCONSNAV/results/0/Zsucursal")} - ${o.getProperty("/ECITASCONSNAV/results/0/Zdescrsucursal")}`;var r=`${o.getProperty("/ECITASCONSNAV/results/0/ZtipoUnidad")}`;var i=`${o.getProperty("/ECITASCONSNAV/results/0/ZTransportista")}`;var n=this.getConfigModel().getProperty("/supplierInput");var l=sap.ui.core.format.DateFormat.getDateInstance({pattern:"MMMM d, yyyy"});var u=l.format(new Date(o.getProperty("/ECITASCONSNAV/results/0/Zfecharegcita")));var p={};var d="";d='<div id="codeGroupDiv" style= "text-align: center; width: 100%;" >'+`<p style="width:100%;text-align:center;"><h1>${this.getView().getModel("appTxts").getProperty("/quotes.cardTitle")}</h1></p>`+'<img src ="./images/LogoSoriana.svg" width="350px" />'+'<div style="width:100%;">'+`<p style="width:100%;font-size:smaller;text-align:right;"><font style="font-weight:bold;">${t.getProperty("/quotes.quoteFolio")}:`+`</font> ${a}</p>`+`<p style="width:100%;font-size:smaller;text-align:right;"><font style="font-weight:bold;">${t.getProperty("/quotes.dateTimeRegAppointment")}:`+`</font> ${u}</p>`+`<p style="width:100%;font-size:smaller;text-align:left;"><font style="font-weight:bold;">${t.getProperty("/quotes.cedis")}:`+`</font> ${s}</p>`+`<p style="width:100%;font-size:smaller;text-align:left;"><font style="font-weight:bold;">${t.getProperty("/quotes.supplier")}:`+`</font> ${n}</p>`+`<p style="width:100%;font-size:smaller;text-align:left;"><font style="font-weight:bold;">${t.getProperty("/quotes.carrier")}:`+`</font> ${i}</p>`+`<p style="width:100%;font-size:smaller;text-align:left;"><font style="font-weight:bold;">${t.getProperty("/quotes.unitType")}:`+`</font> ${r}</p>`+'<svg class="barcode"'+`jsbarcode-value="${a}"`+'jsbarcode-textmargin="0"'+'jsbarcode-fontoptions="bold">'+"</svg>";d+="</div></div>";p.html=d;this._CardDialog.setModel(new e(p));this._CardDialog.open();JsBarcode(".barcode").init()},handleCloseCard:function(){if(this._CardDialog){this._CardDialog.destroy();this._CardDialog=null}},handleCloseEdit:function(){if(this._EditQuoteDialog){this._EditQuoteDialog.destroy();this._EditQuoteDialog=null}},saveCoordinates:function(){var e=document.getElementById("codeGroupDiv");var t={margin:1,filename:"GroupCode.pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:true},jsPDF:{unit:"in",format:"letter",orientation:"portrait"},pagebreak:{mode:["avoid-all","css","legacy"]}};html2pdf().set(t).from(e).save();e.clear()},senMailCard:function(){var e=this.getOwnerComponent().getModel("userdata").getProperty("/Esusdata/SmtpAddr");var t=this.getConfigModel().getProperty("/supplierInputKey");var o=document.getElementById("codeGroupDiv");var s={margin:1,filename:"GroupCode.pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:true},jsPDF:{unit:"in",format:"letter",orientation:"portrait"},pagebreak:{mode:["avoid-all","css","legacy"]}};html2pdf().set(s).from(o).outputPdf().then(function(o){var s={IOption:"5",ICita:this._document,IEmail:e,ILifnr:t,EMAILSet:[{Zdocvalue64:o}]};var r=`/Valida_citasSet`;var i=a.create(r,s);if(i!=null){if(i.ESuccess=="X"){sap.m.MessageBox.success(i.EMessage)}else{sap.m.MessageBox.error(i.EMessage)}}})}})});