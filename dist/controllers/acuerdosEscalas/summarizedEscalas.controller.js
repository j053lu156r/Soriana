sap.ui.define(["sap/ui/model/json/JSONModel","demo/controllers/BaseController","sap/m/MessageBox","sap/m/PDFViewer","sap/ui/core/routing/History","sap/ui/core/routing/Router"],function(e,t,r,a,s,o){"use strict";var n=new this.ACEscalas;return t.extend("demo.controllers.acuerdosEscalas.summarizedEscalas",{onInit:function(){this.oRouter=this.getOwnerComponent().getRouter();this.oModel=this.getOwnerComponent().getModel();this.oRouter.getRoute("summarizedEscalas").attachPatternMatched(this._onDocumentMatched,this);this.getView().addEventDelegate({onAfterShow:function(e){var t=this.getOwnerComponent().getModel();t.setProperty("/barVisible",true);this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel,"EscalasDta")}},this);this.configFilterLanguage(this.getView().byId("filterBar"))},handleFullScreen:function(){this.bFocusFullScreenButton=true;var e=this.oModel.getProperty("/actionButtonsInfo/midColumn/fullScreen");this.oRouter.navTo("summarizedEscalas",{layout:e,bukrs:this._bukrs,belnr:this._belnr,gjahr:this._gjahr,lifnr:this._lifnr})},handleExitFullScreen:function(){this.bFocusFullScreenButton=true;var e=this.oModel.getProperty("/actionButtonsInfo/midColumn/exitFullScreen");this.oRouter.navTo("summarizedEscalas",{layout:e,bukrs:this._bukrs,belnr:this._belnr,gjahr:this._gjahr,lifnr:this._lifnr})},handleClose:function(){var e=this.oModel.getProperty("/actionButtonsInfo/midColumn/exitFullScreen");e=sap.f.LayoutType.TwoColumnsMidExpanded;this.oRouter.navTo("masterEscalas",{layout:e,bukrs:this._bukrs,belnr:this._belnr,gjahr:this._gjahr,lifnr:this._lifnr},true)},searchData:function(){var e=this.getOwnerComponent().getModel("appTxts");var t=e.getProperty("/ACEscalas.indSoc");var a=e.getProperty("/ACEscalas.indEje");var s=e.getProperty("/foliosCap.indVendor");var o=true;if(!n.getModel()){n.initModel()}var i=this.getView().byId("sociedadInput").getValue();var l=this.getView().byId("documentoInput").getValue();var u=this.getView().byId("ejercicioInput").getValue();var d=this.getConfigModel().getProperty("/supplierInputKey");if(d===""||d===null||d==="undefined"){o=false;r.error(s)}else if(l==""||l==null){r.error(e.getProperty("/ACEscalas.indNo"));o=false}else if(l!=""&&l!=null){if(i==""||i==null){r.error(t);o=false}else if(u==""||u==null){r.error(a);o=false}}if(o){var c="ScaleByForumSet?$filter=bukrs eq '"+i+"' and belnr eq '"+l+"' and gjahr eq '"+u+"' and lifnr eq '"+d+"'";this.getView().byId("tableEscalas").setBusy(true);n.getJsonModelAsync(c,function(e,t){var r=e.getProperty("/results");if(r!=null){var a=r.reduce((e,t)=>+e+(+t["dmbtr"]||0),0);var s=r.reduce((e,t)=>+e+(+t["zboni"]||0),0);var o=r.reduce((e,t)=>+e+(+t["ziva"]||0),0);var n=r.reduce((e,t)=>+e+(+t["zieps"]||0),0);var i=r.reduce((e,t)=>+e+(+t["stotal"]||0),0);if(r.length>0){var l=r[0].waers}var u={totImporte:Number(a.toFixed(2)),TotDescto:Number(s.toFixed(2)),totIVA:Number(o.toFixed(2)),totIEPS:Number(n.toFixed(2)),TotStot:Number(i.toFixed(2)),currCode:l};t.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(u),"escalaTotModel");t.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(r),"EscalasDta");t.paginate("EscalasDta","/",1,0)}t.getView().byId("tableEscalas").setBusy(false)},function(e){e.getView().byId("tableEscalas").setBusy(false)},this)}},onExit:function(){},buildExportTable:function(){var e=this.getOwnerComponent().getModel("appTxts");var t=[{name:e.getProperty("/ACEscalas.plant"),template:{content:"{werks}"}},{name:e.getProperty("/ACEscalas.plantName"),template:{content:"{name}"}},{name:e.getProperty("/ACEscalas.amount"),template:{content:"{dmbtr}"}},{name:e.getProperty("/ACEscalas.Descount"),template:{content:"{zboni}"}},{name:e.getProperty("/ACEscalas.IVA"),template:{content:"{ziva}"}},{name:e.getProperty("/ACEscalas.IEPS"),template:{content:"{zieps}"}},{name:e.getProperty("/ACEscalas.subtotal"),template:{content:"{stotal}"}}];this.exportxls("EscalasDta","/",t)},onClose:function(){var e=s.getInstance();var t=e.getPreviousHash();if(t!==undefined){window.history.go(-1)}else{var r=sap.ui.core.UIComponent.getRouterFor(this);r.navTo("",true)}},_onDocumentMatched:function(t){this._bukrs=t.getParameter("arguments").bukrs||this._bukrs||"0";this._belnr=t.getParameter("arguments").belnr||this._belnr||"0";this._gjahr=t.getParameter("arguments").gjahr||this._gjahr||"0";this._lifnr=t.getParameter("arguments").lifnr||this._lifnr||"0";var r={bukrs:this._bukrs,belnr:this._belnr,gjahr:this._gjahr,lifnr:this._lifnr};this.getOwnerComponent().setModel(new e(r),"scalSumModel");var a="ScaleByForumSet?$filter=bukrs eq '"+this._bukrs+"' and belnr eq '"+this._belnr+"' and gjahr eq '"+this._gjahr+"' and lifnr eq '"+this._lifnr+"'";this.getView().byId("tableEscalas").setBusy(true);n.getJsonModelAsync(a,function(e,t){var r=e.getProperty("/results");if(r!=null){var a=r.reduce((e,t)=>+e+(+t["dmbtr"]||0),0);var s=r.reduce((e,t)=>+e+(+t["zboni"]||0),0);var o=r.reduce((e,t)=>+e+(+t["ziva"]||0),0);var n=r.reduce((e,t)=>+e+(+t["zieps"]||0),0);var i=r.reduce((e,t)=>+e+(+t["stotal"]||0),0);if(r.length>0){var l=r[0].waers}var u={totImporte:Number(a.toFixed(2)),TotDescto:Number(s.toFixed(2)),totIVA:Number(o.toFixed(2)),totIEPS:Number(n.toFixed(2)),TotStot:Number(i.toFixed(2)),currCode:l};t.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(u),"escalaTotModel");t.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(r),"EscalasDta");t.paginate("EscalasDta","/",1,0)}t.getView().byId("tableEscalas").setBusy(false)},function(e){e.getView().byId("tableEscalas").setBusy(false)},this)},onListItemPress:function(e){var t=e.getSource().getBindingContext("EscalasDta").getPath(),r=t.split("/").slice(-1).pop();var a=this.getOwnerComponent().getModel("EscalasDta");var s=a.getProperty("/");var o=s[r];this.getOwnerComponent().getRouter().navTo("detailEscalasCentro",{layout:sap.f.LayoutType.ThreeColumnsEndExpanded,bukrs:o.bukrs,belnr:o.belnr,gjahr:o.gjahr,lifnr:o.lifnr,werks:o.werks,name:o.name},true)}})});