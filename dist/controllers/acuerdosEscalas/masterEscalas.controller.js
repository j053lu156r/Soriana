sap.ui.define(["demo/controllers/BaseController","sap/m/MessageBox","sap/m/PDFViewer","sap/ui/core/routing/History","sap/ui/core/routing/Router"],function(e,t,a,s,r){"use strict";var o=new this.ACEscalas;return e.extend("demo.controllers.acuerdosEscalas.masterEscalas",{onInit:function(){this._pdfViewer=new a;this.getView().addDependent(this._pdfViewer);this.getView().addEventDelegate({onAfterShow:function(e){var t=this.getOwnerComponent().getModel();t.setProperty("/barVisible",true);this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel,"policyEscalasDta");this.clearFilters()}},this);this.configFilterLanguage(this.getView().byId("filterBar"))},searchData:function(){var e=this.getOwnerComponent().getModel("appTxts");var a=e.getProperty("/ACEscalas.indSoc");var s=e.getProperty("/ACEscalas.indEje");var r=e.getProperty("/foliosCap.indVendor");var n=true;if(!o.getModel()){o.initModel()}var i=this.getView().byId("sociedadInput").getValue();var l=this.getView().byId("documentoInput").getValue();var u=this.getView().byId("ejercicioInput").getValue();var d=this.getConfigModel().getProperty("/supplierInputKey");if(d===""||d===null||d==="undefined"){n=false;t.error(r)}else if(l==""||l==null){t.error(e.getProperty("/ACEscalas.indNo"));n=false}else if(l!=""&&l!=null){if(i==""||i==null){t.error(a);n=false}else if(u==""||u==null){t.error(s);n=false}}if(n){var c="accPolicySet?$filter=bukrs eq '"+i+"' and belnr eq '"+l+"' and gjahr eq '"+u+"' and lifnr eq '"+d+"'";this.getView().byId("tablePolicyEscalas").setBusy(true);o.getJsonModelAsync(c,function(e,t){var a=e.getProperty("/results");if(a!=null){var s=a.reduce((e,t)=>+e+(+t["dmbtr"]||0),0);var r=a.reduce((e,t)=>+e+(+t["wrbtr"]||0),0);var o=a.reduce((e,t)=>+e+(+t["wmwst"]||0),0);if(a.length>0){var n=a[0].waers;var i=a[0].name}var l={totImporte:Number(s.toFixed(2)),TotDescto:Number(r.toFixed(2)),TotIVA:Number(o.toFixed(2)),currCode:n,VendorName:i};t.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(l),"policyEscalaTotModel");t.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(a),"policyEscalasDta");t.paginate("policyEscalasDta","/",1,0)}t.getView().byId("tablePolicyEscalas").setBusy(false)},function(e){e.getView().byId("tablePolicyEscalas").setBusy(false)},this)}},onExit:function(){},clearFilters:function(){var e=new Date;var t=e.getFullYear();this.getView().byId("sociedadInput").setValue("2001");this.getView().byId("documentoInput").setValue("");this.getView().byId("ejercicioInput").setValue(t);var a=this.getOwnerComponent().getModel("EscalasDta");if(a){a.setData([])}},buildExportTable:function(){var e=this.getOwnerComponent().getModel("appTxts");var t=[{name:e.getProperty("/ACEscalas.polizas.sucursal"),template:{content:"{segment}"}},{name:e.getProperty("/ACEscalas.polizas.base"),template:{content:"{dmbtr}"}},{name:e.getProperty("/ACEscalas.polizas.desc"),template:{content:"{wrbtr}"}},{name:e.getProperty("/ACEscalas.polizas.iva"),template:{content:"{wmwst}"}}];this.exportxls("policyEscalasDta","/",t)},onClose:function(){var e=s.getInstance();var t=e.getPreviousHash();if(t!==undefined){window.history.go(-1)}else{var a=sap.ui.core.UIComponent.getRouterFor(this);a.navTo("",true)}},onSummarizedScale:function(){var e=this.getView().byId("sociedadInput").getValue();var t=this.getView().byId("documentoInput").getValue();var a=this.getView().byId("ejercicioInput").getValue();var s=this.getOwnerComponent().getModel("policyEscalasDta");var r=s.getProperty("/");var o=r[0];if(o.lifnr!==""){this.getOwnerComponent().getRouter().navTo("summarizedEscalas",{layout:sap.f.LayoutType.TwoColumnsMidExpanded,bukrs:e,belnr:t,gjahr:a,lifnr:o.lifnr},true)}else{sap.m.MessageToast.show(this.getOwnerComponent().getModel("appTxts").getProperty("/ACEscalas.polizas.nodetailData"))}},onListItemPress:function(e){var t=e.getSource().getBindingContext("EscalasDta").getPath(),a=t.split("/").slice(-1).pop();var s=this.getOwnerComponent().getModel("EscalasDta");var r=s.getProperty("/");var o=r[a];this.getOwnerComponent().getRouter().navTo("detailEscalasCentro",{layout:sap.f.LayoutType.TwoColumnsMidExpanded,bukrs:o.bukrs,belnr:o.belnr,gjahr:o.gjahr,lifnr:o.lifnr,werks:o.werks,name:o.name},true)}})});