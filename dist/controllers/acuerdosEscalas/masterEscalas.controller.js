sap.ui.define(["demo/controllers/BaseController","sap/m/MessageBox","sap/m/PDFViewer","sap/ui/core/routing/History","sap/ui/core/routing/Router"],function(e,t,a,o,r){"use strict";var n=new this.ACEscalas;return e.extend("demo.controllers.acuerdosEscalas.masterEscalas",{onInit:function(){this._pdfViewer=new a;this.getView().addDependent(this._pdfViewer);this.oRouter=this.getOwnerComponent().getRouter();this.oModel=this.getOwnerComponent().getModel();this.getView().addEventDelegate({onAfterShow:function(e){var t=this.getOwnerComponent().getModel();t.setProperty("/barVisible",true);this.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel,"EscalasDta");this.clearFilters()}},this);this.configFilterLanguage(this.getView().byId("filterBar"))},searchData:function(){var e=this.getOwnerComponent().getModel("appTxts");var a=e.getProperty("/ACEscalas.indSoc");var o=e.getProperty("/ACEscalas.indEje");var r=e.getProperty("/foliosCap.indVendor");var s=true;if(!n.getModel()){n.initModel()}var i=this.getView().byId("sociedadInput").getValue();var l=this.getView().byId("documentoInput").getValue();var d=this.getView().byId("ejercicioInput").getValue();var u=this.getConfigModel().getProperty("/supplierInputKey");if(u===""||u===null||u==="undefined"){s=false;t.error(r)}else if(l==""||l==null){t.error(e.getProperty("/ACEscalas.indNo"));s=false}else if(l!=""&&l!=null){if(i==""||i==null){t.error(a);s=false}else if(d==""||d==null){t.error(o);s=false}}if(s){var p="ScaleSet?$filter=bukrs eq '"+i+"' and belnr eq '"+l+"' and gjahr eq '"+d+"' and lifnr eq '"+u+"'";this.getView().byId("tableEscalas").setBusy(true);n.getJsonModelAsync(p,function(e,t){var a=e.getProperty("/results");if(a!=null){if(a.length>0){var o=a.reduce((e,t)=>+e+(+t["dmbtr"]||0),0);var r=a.reduce((e,t)=>+e+(+t["zboni"]||0),0);var n=a.reduce((e,t)=>+e+(+t["ziva"]||0),0);var s=a.reduce((e,t)=>+e+(+t["zieps"]||0),0);var i=a.reduce((e,t)=>+e+(+t["stotal"]||0),0);var l=a[0].waers;var d={totImporte:Number(o.toFixed(2)),TotDescto:Number(r.toFixed(2)),totIVA:Number(n.toFixed(2)),totIEPS:Number(s.toFixed(2)),TotStot:Number(i.toFixed(2)),currCode:l};t.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(d),"escalaTotModel");t.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(a),"EscalasDta");t.paginate("EscalasDta","/",1,0)}}t.getView().byId("tableEscalas").setBusy(false)},function(e){e.getView().byId("tableEscalas").setBusy(false)},this)}},onExit:function(){},clearFilters:function(){var e=new Date;var t=e.getFullYear();this.getView().byId("sociedadInput").setValue("2001");this.getView().byId("documentoInput").setValue("");this.getView().byId("ejercicioInput").setValue(t);var a=this.getOwnerComponent().getModel("EscalasDta");if(a){a.setData([])}},buildExportTable:function(){var e=this.getOwnerComponent().getModel("appTxts");var t=[{name:e.getProperty("/Polizas.sucursal"),template:{content:"{bukrs}"}},{name:e.getProperty("/Polizas.base"),template:{content:"{mblnr}"}},{name:e.getProperty("/Polizas.desc"),template:{content:"{mjahr}"}},{name:e.getProperty("/Polizas.iva"),template:{content:"{lifnr}"}},{name:e.getProperty("/Polizas.pDesc"),template:{content:"{knuma}"}},{name:e.getProperty("/Polizas.unidad"),template:{content:"{bwart}"}},{name:e.getProperty("/Polizas.unidad"),template:{content:"{xblnr}"}},{name:e.getProperty("/Polizas.unidad"),template:{content:"{werks}"}},{name:e.getProperty("/Polizas.unidad"),template:{content:"{dmbtr}"}},{name:e.getProperty("/Polizas.unidad"),template:{content:"{zboni}"}},{name:e.getProperty("/Polizas.unidad"),template:{content:"{zmgn3}"}},{name:e.getProperty("/Polizas.unidad"),template:{content:"{meins}"}},{name:e.getProperty("/Polizas.unidad"),template:{content:"{konwa}"}}];this.exportxls("EscalasDta","/",t)},onPressPDF:function(){var e=this.getOwnerComponent().getModel("AcuerdosHdr");var t=e.getData();var a="/sap/opu/odata/sap/ZOSP_ACUERDOS_SRV/";var o=a+"AcuerdosFilesSet('"+t.UUID+"')/$value";this._pdfViewer.setSource(o);this._pdfViewer.setTitle("CFDI");this._pdfViewer.open()},onClose:function(){var e=o.getInstance();var t=e.getPreviousHash();if(t!==undefined){window.history.go(-1)}else{var a=sap.ui.core.UIComponent.getRouterFor(this);a.navTo("",true)}}})});